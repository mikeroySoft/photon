<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.82.0"><link rel=canonical type=text/html href=../../docs/><link rel=alternate type=application/rss+xml href=../../docs/index.xml><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=../../favicons/favicon.ico><link rel=apple-touch-icon href=../../favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=../../favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=../../favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=../../favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=../../favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=../../favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=../../favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=../../favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=../../favicons/android-192x192.png sizes=192x192><title>Photon OS Documentation |</title><meta property="og:title" content="Photon OS Documentation"><meta property="og:description" content="VMware Photon docs"><meta property="og:type" content="website"><meta property="og:url" content="/docs/"><meta itemprop=name content="Photon OS Documentation"><meta itemprop=description content="VMware Photon docs"><meta name=twitter:card content="summary"><meta name=twitter:title content="Photon OS Documentation"><meta name=twitter:description content="VMware Photon docs"><link rel=preload href=../../scss/main.min.37920ca9c3c378ff1556150cf2bce5faf1a7ed81d061a0bc35771668193fe176.css as=style><link href=../../scss/main.min.37920ca9c3c378ff1556150cf2bce5faf1a7ed81d061a0bc35771668193fe176.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script></head><body class=td-section><header><div class="container-fluid pl-3 pr-3" id=navbarish><nav class="navbar navbar-default navbar-dark navbar-expand-md d-flex justify-content-between" role=navigation data-toggle=collapse data-target=#menu_items aria-expanded=false aria-controls=navbar><div class="navbar-header d-flex align-items-center justify-content-between"><a class=navbar-brand href=../../><span class=navbar-logo><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 511.4375 135.7375" height="135.7375" width="511.4375" id="svg3355"><defs id="defs3359"><clipPath id="clipPath3387" clipPathUnits="userSpaceOnUse"><path id="path3389" d="M142.293 245.191l494.93 337.36L74.8398 348.098"/></clipPath><linearGradient id="linearGradient3391" spreadMethod="pad" gradientTransform="matrix(-493.8,-339.007,339.007,-493.8,601.845,634.081)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3393" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3395" offset="1" style="stop-opacity:1;stop-color:#80c64c"/></linearGradient><clipPath id="clipPath3405" clipPathUnits="userSpaceOnUse"><path id="path3407" d="M85.2852 570.719 516.813 593.84 54.5195 690.582"/></clipPath><linearGradient id="linearGradient3409" spreadMethod="pad" gradientTransform="matrix(-304.079,-208.759,208.759,-304.079,420.197,734.568)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3411" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3413" offset="1" style="stop-opacity:1;stop-color:#22437e"/></linearGradient><clipPath id="clipPath3423" clipPathUnits="userSpaceOnUse"><path id="path3425" d="m538.137 270.234 95.324 293.5-205.699-247.089"/></clipPath><linearGradient id="linearGradient3427" spreadMethod="pad" gradientTransform="matrix(-255.101,-175.134,175.134,-255.101,686.667,486.234)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3429" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3431" offset="1" style="stop-opacity:1;stop-color:#65a5de"/></linearGradient><clipPath id="clipPath3441" clipPathUnits="userSpaceOnUse"><path id="path3443" d="M857.758 94.3906 656.035 546.801 745.172 53.6406"/></clipPath><linearGradient id="linearGradient3445" spreadMethod="pad" gradientTransform="matrix(-102.35,-449.574,449.574,-102.35,800.888,513.826)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3447" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3449" offset="1" style="stop-opacity:1;stop-color:#c6da3a"/></linearGradient><clipPath id="clipPath3459" clipPathUnits="userSpaceOnUse"><path id="path3461" d="M481.316 864.746 635.938 602.125l-41.313 301.32"/></clipPath><linearGradient id="linearGradient3463" spreadMethod="pad" gradientTransform="matrix(67.7401,274.401,-274.401,67.7401,532.514,627.656)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3465" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3467" offset="1" style="stop-opacity:1;stop-color:#c6da3a"/></linearGradient><clipPath id="clipPath3477" clipPathUnits="userSpaceOnUse"><path id="path3479" d="M1085.54 913.828 683.598 585.359l456.522 219.75"/></clipPath><linearGradient id="linearGradient3481" spreadMethod="pad" gradientTransform="matrix(441.375,262.068,-262.068,441.375,675.147,599.59)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3483" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3485" offset="1" style="stop-opacity:1;stop-color:#22638b"/></linearGradient><clipPath id="clipPath3495" clipPathUnits="userSpaceOnUse"><path id="path3497" d="M1177.19 335.031 693.664 556.211 1106.69 235.887"/></clipPath><linearGradient id="linearGradient3499" spreadMethod="pad" gradientTransform="matrix(450.785,-274.875,274.875,450.785,694.818,558.101)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3501" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3503" offset="1" style="stop-opacity:1;stop-color:#a6dbe7"/></linearGradient><clipPath id="clipPath3513" clipPathUnits="userSpaceOnUse"><path id="path3515" d="M209.754 773.73l382.32-187.417L280.926 872.391"/></clipPath><linearGradient id="linearGradient3517" spreadMethod="pad" gradientTransform="matrix(-360.263,223.047,-223.047,-360.263,601.957,602.271)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3519" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3521" offset="1" style="stop-opacity:1;stop-color:#a6dbe7"/></linearGradient></defs><g transform="matrix(1.25,0,0,-1.25,0,135.7375)" id="g3363"><g transform="scale(0.1,0.1)" id="g3365"><path id="path3367" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m1544.2 536.77c69.27.0 114.66 37.031 114.66 91.972v1.192c0 59.726-44.79 90.781-112.28 90.781h-105.7V536.77h103.32zm-150.51 203.652c0 13.141 10.75 23.891 23.29 23.891h133.19c94.36.0 156.47-50.172 156.47-132.586v-1.192c0-90.183-75.25-136.765-164.24-136.765h-101.52V367.148c0-13.132-10.76-23.886-23.9-23.886-12.54.0-23.29 10.754-23.29 23.886v373.274"/><path id="path3369" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m1765.51 743.41c0 13.141 10.76 23.887 23.29 23.887 13.14.0 23.9-10.746 23.9-23.887V578.574h241.28V743.41c0 13.141 10.74 23.887 23.88 23.887 12.55.0 23.3-10.746 23.3-23.887V367.148c0-13.132-10.75-23.886-23.3-23.886-13.14.0-23.88 10.754-23.88 23.886v167.227H1812.7V367.148c0-13.132-10.76-23.886-23.9-23.886-12.53.0-23.29 10.754-23.29 23.886V743.41"/><path id="path3371" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m2554.86 554.082v1.203c0 94.957-69.28 172.598-164.83 172.598-95.56.0-163.65-76.445-163.65-171.406v-1.192c0-94.961 69.28-172.597 164.84-172.597 95.55.0 163.64 76.445 163.64 171.394zm-377.45.0v1.203c0 115.262 86.6 216.192 213.81 216.192 127.2.0 212.6-99.739 212.6-215v-1.192c0-115.265-86.59-216.203-213.79-216.203-127.22.0-212.62 99.738-212.62 215"/><path id="path3373" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m2756.35 720.715h-121.24c-11.94.0-22.09 9.555-22.09 21.5.0 11.941 10.15 22.098 22.09 22.098h290.26c11.94.0 22.1-10.157 22.1-22.098.0-11.945-10.16-21.5-22.1-21.5h-121.23V367.148c0-13.132-10.75-23.886-23.9-23.886-13.13.0-23.89 10.754-23.89 23.886v353.567"/><path id="path3375" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m3332.78 554.082v1.203c0 94.957-69.28 172.598-164.83 172.598-95.56.0-163.65-76.445-163.65-171.406v-1.192c0-94.961 69.28-172.597 164.84-172.597 95.55.0 163.64 76.445 163.64 171.394zm-377.45.0v1.203c0 115.262 86.6 216.192 213.81 216.192 127.2.0 212.6-99.739 212.6-215v-1.192c0-115.265-86.59-216.203-213.79-216.203-127.22.0-212.62 99.738-212.62 215"/><path id="path3377" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m3458.31 742.813c0 12.539 10.75 23.292 23.29 23.292h6.57c10.75.0 17.32-5.375 23.89-13.742l253.83-323.691v315.332c0 12.547 10.14 23.293 23.29 23.293 12.54.0 22.69-10.746 22.69-23.293V366.555c0-12.539-8.96-22.09-21.5-22.09h-2.4c-10.14.0-17.31 5.965-24.48 14.324l-259.2 331.465V366.555c0-12.539-10.14-23.293-23.29-23.293-12.54.0-22.69 10.754-22.69 23.293v376.258"/><path id="path3379" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m3982.91 759.98c0 4.528 3.13 7.665 7.66 7.665h2.09c3.14.0 5.22-1.395 6.97-3.829l37.6-58.503 38.3 58.503c1.74 2.434 3.83 3.829 6.61 3.829h2.09c3.83.0 7.32-3.485 7.32-7.665v-94.011c0-4.18-3.49-7.66-7.66-7.66-4.18.0-7.31 3.48-7.31 7.66v72.426l-32.38-48.403c-1.75-2.785-3.83-4.527-6.97-4.527-3.13.0-5.22 1.742-6.96 4.527l-32.04 48.403v-72.426c0-4.18-3.48-7.66-7.66-7.66s-7.66 3.48-7.66 7.66v94.011zm-73.47-7.308h-28.91c-3.82.0-7.3 3.48-7.3 7.308.0 3.836 3.48 7.317 7.3 7.317h72.78c4.18.0 7.31-3.481 7.31-7.317.0-3.828-3.13-7.308-7.31-7.308h-28.55v-86.703c0-4.18-3.48-7.66-8.01-7.66-4.18.0-7.31 3.48-7.31 7.66v86.703"/><path id="path3381" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m597.898 989.039c-236.39.0-428.714-192.324-428.714-428.719.0-236.39 192.324-428.715 428.714-428.715 236.395.0 428.722 192.325 428.722 428.715.0 236.395-192.327 428.719-428.722 428.719zm0-954.289c-289.796.0-525.566 235.773-525.566 525.57s235.77 525.57 525.566 525.57c289.801.0 525.572-235.773 525.572-525.57S887.699 34.75 597.898 34.75"/><g id="g3383"><g clip-path="url(#clipPath3387)" id="g3385"><path id="path3397" style="fill:url(#linearGradient3391);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M142.293 245.191l494.93 337.36L74.8398 348.098"/></g></g><path id="path3399" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m167.938 304.09c-4.524 34.332-36.024 58.496-70.356 53.973-34.332-4.52-58.5-36.02-53.9765-70.352 4.5234-34.336 36.0234-58.5 70.3555-53.977 34.332 4.524 58.5 36.02 53.977 70.356"/><g id="g3401"><g clip-path="url(#clipPath3405)" id="g3403"><path id="path3415" style="fill:url(#linearGradient3409);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M85.2852 570.719 516.813 593.84 54.5195 690.582"/></g></g><path id="path3417" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m124.875 636.605c-4.523 34.333-36.0234 58.5-70.3555 53.977C20.1875 686.059-3.98047 654.559.542969 620.227 5.06641 585.895 36.5664 561.727 70.8984 566.25c34.3356 4.523 58.4996 36.023 53.9766 70.355"/><g id="g3419"><g clip-path="url(#clipPath3423)" id="g3421"><path id="path3433" style="fill:url(#linearGradient3427);fill-opacity:1;fill-rule:nonzero;stroke:none" d="m538.137 270.234 95.324 293.5-205.699-247.089"/></g></g><path id="path3435" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m541.352 289.715c-4.524 34.332-36.024 58.5-70.356 53.973-34.336-4.52-58.5-36.02-53.976-70.352 4.523-34.336 36.023-58.5 70.355-53.977 34.332 4.524 58.496 36.024 53.977 70.356"/><g id="g3437"><g clip-path="url(#clipPath3441)" id="g3439"><path id="path3451" style="fill:url(#linearGradient3445);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M857.758 94.3906 656.035 546.801 745.172 53.6406"/></g></g><path id="path3453" style="fill:#b9d110;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m846.91 110.883c-26.609 22.164-66.144 18.558-88.308-8.051-22.164-26.6132-18.559-66.1406 8.05-88.3125 26.61-22.16013 66.145-18.55075 88.309 8.0586 22.164 26.6016 18.559 66.1446-8.051 88.3049"/><g id="g3455"><g clip-path="url(#clipPath3459)" id="g3457"><path id="path3469" style="fill:url(#linearGradient3463);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M481.316 864.746 635.938 602.125l-41.313 301.32"/></g></g><path id="path3471" style="fill:#b9d110;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m491.863 848.059c26.203-22.645 65.797-19.758 88.442 6.441 22.64 26.203 19.758 65.797-6.446 88.441-26.199 22.645-65.796 19.758-88.437-6.445-22.645-26.199-19.762-65.797 6.441-88.437"/><g id="g3473"><g clip-path="url(#clipPath3477)" id="g3475"><path id="path3487" style="fill:url(#linearGradient3481);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M1085.54 913.828 683.598 585.359l456.522 219.75"/></g></g><path id="path3489" style="fill:#22638b;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m1050.12 855.145c2.26-34.555 32.1-60.743 66.66-58.485 34.55 2.254 60.74 32.098 58.48 66.653-2.25 34.554-32.09 60.742-66.65 58.484-34.56-2.254-60.74-32.098-58.49-66.652"/><g id="g3491"><g clip-path="url(#clipPath3495)" id="g3493"><path id="path3505" style="fill:url(#linearGradient3499);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M1177.19 335.031 693.664 556.211 1106.69 235.887"/></g></g><path id="path3507" style="fill:#91d2e1;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m1108.75 338.84c-29.47-18.176-38.63-56.805-20.46-86.281 18.18-29.477 56.81-38.637 86.29-20.461 29.47 18.179 38.63 56.808 20.45 86.285-18.17 29.476-56.8 38.637-86.28 20.457"/><g id="g3509"><g clip-path="url(#clipPath3513)" id="g3511"><path id="path3523" style="fill:url(#linearGradient3517);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M209.754 773.73l382.32-187.417L280.926 872.391"/></g></g><path id="path3525" style="fill:#91d2e1;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m278.168 769.453c29.598 17.977 39.02 56.543 21.043 86.145-17.977 29.597-56.543 39.019-86.145 21.043-29.597-17.977-39.019-56.543-21.043-86.141 17.977-29.602 56.543-39.023 86.145-21.047"/><path id="path3527" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m714.422 718.262c8.172-9.321 22.351-10.246 31.672-2.074 9.316 8.175 10.246 22.355 2.07 31.675-8.172 9.317-22.351 10.246-31.672 2.071-9.316-8.172-10.246-22.356-2.07-31.672"/><path id="path3529" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m827.305 484.969c8.175-9.321 22.355-10.25 31.672-2.074 9.32 8.171 10.25 22.355 2.074 31.671-8.172 9.321-22.356 10.247-31.672 2.075-9.32-8.176-10.246-22.356-2.074-31.672"/><path id="path3531" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m906.813 877.289c8.175-9.316 22.355-10.246 31.675-2.07 9.317 8.172 10.246 22.351 2.071 31.672-8.172 9.32-22.356 10.246-31.672 2.074-9.321-8.176-10.246-22.356-2.074-31.676"/><path id="path3533" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m987.531 166.984c8.172-9.32 22.359-10.246 31.669-2.074 9.32 8.176 10.25 22.356 2.08 31.676-8.18 9.316-22.358 10.242-31.678 2.07-9.317-8.176-10.247-22.355-2.071-31.672"/><path id="path3535" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m140.008 473.707c8.172-9.32 22.351-10.246 31.672-2.074 9.316 8.176 10.246 22.355 2.074 31.676-8.176 9.316-22.356 10.246-31.676 2.07-9.316-8.172-10.246-22.356-2.07-31.672"/><path id="path3537" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m609.063 315.641c8.171-9.321 22.355-10.246 31.671-2.075 9.321 8.176 10.246 22.356 2.075 31.676-8.176 9.317-22.356 10.246-31.676 2.071-9.317-8.172-10.246-22.352-2.07-31.672"/><path id="path3539" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m458.551 398.422c8.172-9.317 22.351-10.246 31.672-2.07 9.32 8.171 10.246 22.351 2.074 31.671-8.176 9.317-22.356 10.247-31.676 2.071-9.316-8.172-10.246-22.352-2.07-31.672"/><path id="path3541" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m518.754 661.82c8.176-9.32 22.355-10.246 31.672-2.074 9.32 8.176 10.25 22.356 2.074 31.676-8.176 9.316-22.355 10.246-31.672 2.07-9.32-8.172-10.25-22.355-2.074-31.672"/><path id="path3543" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m744.523 394.66c8.172-9.32 22.356-10.246 31.672-2.074 9.321 8.176 10.246 22.355 2.075 31.676-8.176 9.316-22.356 10.246-31.672 2.07-9.321-8.172-10.25-22.355-2.075-31.672"/><path id="path3545" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m714.422 605.379c8.172-9.32 22.351-10.246 31.672-2.074 9.316 8.172 10.246 22.355 2.07 31.672-8.172 9.32-22.351 10.246-31.672 2.074-9.316-8.176-10.246-22.356-2.07-31.672"/><path id="path3547" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m368.242 469.918c8.172-9.32 22.356-10.25 31.672-2.074 9.32 8.172 10.246 22.355 2.074 31.672-8.175 9.32-22.355 10.246-31.675 2.074-9.317-8.176-10.247-22.356-2.071-31.672"/><path id="path3549" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m633.461 620.176c8.172-9.317 22.355-10.246 31.672-2.071 9.32 8.172 10.246 22.356 2.074 31.672-8.176 9.321-22.355 10.246-31.676 2.075-9.316-8.176-10.246-22.356-2.07-31.676"/><path id="path3551" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m646.691 752.129c8.172-9.32 22.352-10.25 31.672-2.074 9.321 8.172 10.246 22.355 2.075 31.672-8.176 9.32-22.356 10.246-31.676 2.074-9.317-8.176-10.246-22.356-2.071-31.672"/><path id="path3553" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m819.777 334.453c8.176-9.316 22.356-10.246 31.676-2.07 9.317 8.172 10.246 22.351 2.07 31.672-8.171 9.32-22.351 10.246-31.671 2.074-9.321-8.176-10.247-22.356-2.075-31.676"/><path id="path3555" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m812.242 571.512c8.176-9.321 22.356-10.246 31.676-2.074 9.316 8.175 10.246 22.355 2.07 31.675-8.172 9.317-22.351 10.246-31.672 2.071-9.316-8.172-10.246-22.356-2.074-31.672"/><path id="path3557" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m382.156 392.988c8.172-9.316 22.356-10.246 31.672-2.07 9.32 8.172 10.246 22.355 2.074 31.672-8.175 9.32-22.355 10.246-31.672 2.074-9.32-8.176-10.25-22.355-2.074-31.676"/><path id="path3559" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m613.543 476.398c8.176-9.32 22.355-10.25 31.676-2.074 9.316 8.176 10.246 22.356 2.07 31.672-8.172 9.32-22.355 10.246-31.672 2.074-9.32-8.175-10.246-22.355-2.074-31.672"/><path id="path3561" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m435.969 645.902c8.172-9.32 22.351-10.246 31.672-2.074 9.32 8.176 10.246 22.356 2.074 31.676-8.176 9.316-22.356 10.246-31.676 2.07-9.316-8.172-10.246-22.355-2.07-31.672"/><path id="path3563" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m629.688 164.293c8.171-9.32 22.355-10.246 31.671-2.074 9.321 8.176 10.246 22.355 2.075 31.676-8.176 9.316-22.356 10.246-31.672 2.07-9.321-8.172-10.25-22.356-2.074-31.672"/><path id="path3565" style="fill:#b9d110;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m499.398 462.395c12.329-1.301 23.379 7.632 24.684 19.96 1.305 12.325-7.633 23.375-19.961 24.68-12.324 1.305-23.375-7.633-24.68-19.957-1.304-12.328 7.633-23.379 19.957-24.683"/><path id="path3567" style="fill:#b9d110;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m721.23 510.641c-12.3 1.527-23.511-7.207-25.039-19.508-1.527-12.301 7.207-23.512 19.508-25.039 12.301-1.528 23.512 7.207 25.039 19.508 1.528 12.3-7.207 23.507-19.508 25.039"/><path id="path3569" style="fill:#22638b;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m594.34 420.676c-7.543 9.836-21.629 11.695-31.469 4.152-9.836-7.543-11.691-21.633-4.148-31.469s21.632-11.695 31.468-4.152 11.696 21.633 4.149 31.469"/><path id="path3571" style="fill:#22638b;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m594.828 581.156c-7.543 9.836-21.633 11.696-31.469 4.153s-11.695-21.633-4.152-31.469c7.547-9.836 21.633-11.695 31.469-4.152 9.836 7.542 11.695 21.632 4.152 31.468"/><path id="path3573" style="fill:#91d2e1;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m458.199 576.973c5.156 11.273.199 24.59-11.07 29.75-11.274 5.156-24.59.199-29.746-11.071-5.16-11.273-.203-24.589 11.066-29.75 11.274-5.156 24.594-.199 29.75 11.071"/><path id="path3575" style="fill:#91d2e1;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m635.691 569.449c-5.234-11.234-.367-24.59 10.868-29.82 11.238-5.234 24.589-.371 29.824 10.867 5.234 11.234.367 24.586-10.867 29.82-11.239 5.235-24.59.372-29.825-10.867"/></g></g></svg></span><span class="text-uppercase font-weight-bold"></span></a></div><div class=ml-auto><button type=button class="navbar-toggler third-button collapsed" data-toggle=collapse data-target=#menu_items aria-expanded=false aria-controls=navbar><div class=animated-icon><span></span><span></span><span></span></div></button></div><div id=menu_items class="navbar-collapse collapse ml-md-auto justify-content-end text-center"><ul class="nav navbar-nav"><li class="nav-item p-0"><a class=nav-link href=../../><span>Home</span></a></li><li class="nav-item p-0"><a class=nav-link href=../../blog/><span>Blog</span></a></li><li class="nav-item p-0"><a class=nav-link href=../../#features><span>Features</span></a></li><li class="nav-item p-0"><a class=nav-link href=../../#contributing><span>Contribute</span></a></li><li class="nav-item p-0"><a class="nav-link active" href=../../docs/><span class=active>Docs</span></a></li><li class="nav-item p-0"><a class=nav-link href=https://github.com/vmware/photon target=_blank><span>Github</span></a></li><div class="navbar-nav dropdown border-0"><li class=nav-item><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Release</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=../../docs/>v4 - Latest</a>
<a class=dropdown-item href=../../docs-v3/>v3</a>
<a class=dropdown-item href=../../assets/files/html/3.0/>v3 (old)</a>
<a class=dropdown-item href=../../assets/files/html/1.0-2.0/>v2 and v1</a></div></li></div></ul></div></nav></div></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=../../docs/>Return to the regular view of this page</a>.</p></div><h1 class=title>Photon OS Documentation</h1><ul><li>1: <a href=#pg-ae80ff934737545e46f31924c72ccd98>Quick Start Links</a></li><li>2: <a href=#pg-efbe830c8e6b33a1da6e2a60fa9d86ee>What is New in Photon OS 4</a></li><li>3: <a href=#pg-6e17e09fffc1050f46600282def85180>Overview</a></li><ul><li>3.1: <a href=#pg-afb5e8782b084babc072fa6f3bdd2a63>Introduction to Photon OS</a></li><li>3.2: <a href=#pg-cf18e5d308624319aff0a4061896ab70>Flavours</a></li></ul><li>4: <a href=#pg-1e29a42acbd6dbfaaa05d7c92ca5ccc5>Installation Guide</a></li><ul><li>4.1: <a href=#pg-0039a3f013699dc4f7f1dd4092ce6977>Downloading Photon OS</a></li><li>4.2: <a href=#pg-8ccac281ee95518faa0eec95576505af>Upgrading to Photon OS 4.0</a></li><li>4.3: <a href=#pg-91e141c3992b27f53801ceefa4cabedb>Building Images</a></li><ul><li>4.3.1: <a href=#pg-48a1bd9dec8ba490f9db4f579675d370>Folder Layout</a></li><li>4.3.2: <a href=#pg-6da699b8cf8e1d34d27dee90fd6a107f>Build Prerequisites</a></li><li>4.3.3: <a href=#pg-96f1248c47caa7dc91a91ae9a9782fb7>Build an ISO from the Source Code for Photon OS</a></li><ul><li>4.3.3.1: <a href=#pg-2767fa2c88f55f64c66613697826720c>Building the ISO</a></li></ul><li>4.3.4: <a href=#pg-b12b25e17fade9fa2411d9dce445271a>Build Other Images for Photon OS</a></li><ul><li>4.3.4.1: <a href=#pg-62c5b1e7a2b85c2d6cef0f10f3a9712f>Building Cloud Images</a></li><li>4.3.4.2: <a href=#pg-669b29ad634e5e92dcfff70a9782d2fd>Building OVA image</a></li></ul><li>4.3.5: <a href=#pg-b6991bcd5348c5d6cc84f11f25b1e69a>Use the Cached Toolchain and RPMS</a></li><li>4.3.6: <a href=#pg-3683869621c9cc8ea742011cbd44760a>Use Cached Sources</a></li><li>4.3.7: <a href=#pg-8f2627a45c87f9d5bb9b499554b7b4e4>View Build Logs</a></li></ul><li>4.4: <a href=#pg-1490f4e78e1199856d0d6e3e29ad521c>Building Package or Kernel Modules Using a Script</a></li><li>4.5: <a href=#pg-86c81e0066c56399910447073a8c5e26>Running Photon OS on vSphere</a></li><ul><li>4.5.1: <a href=#pg-0574ffce9e6845b458abaf26dc4a2d18>Prerequisites for Running Photon OS on vSphere</a></li><li>4.5.2: <a href=#pg-5850c535a4ee04f01d28f929938d0aca>Importing the OVA for Photon OS 4.0</a></li><li>4.5.3: <a href=#pg-a7dc4fe0a9a00299ac444c39be809ebc>Installing the ISO Image for Photon OS 4.0</a></li></ul><li>4.6: <a href=#pg-39867b78caa0d199a4aa2df16555fe0d>Running Photon OS on Fusion</a></li><ul><li>4.6.1: <a href=#pg-46826b92f418128381d32649220f3d3c>Prerequisites for Running Photon OS on Fusion</a></li><li>4.6.2: <a href=#pg-d727c054277b44a62d85fd9bf15b1513>Importing the OVA for Photon OS 4.0</a></li><li>4.6.3: <a href=#pg-e11c39697efefcddc432366210d20744>Installing the ISO Image for Photon OS 4.0</a></li></ul><li>4.7: <a href=#pg-5a7a1ecb093e3902032d62824c159def>Running Photon OS on Workstation</a></li><ul><li>4.7.1: <a href=#pg-739bea0a866a6cf4a71dd605cf66a49f>Prerequisites for Running Photon OS on Workstation</a></li><li>4.7.2: <a href=#pg-3d45c79839e9d9488f2251ad6c2dea10>Importing the OVA for Photon OS 4.0</a></li><li>4.7.3: <a href=#pg-f539c9ffb01773e1b86948893a63693a>Installing the ISO Image for Photon OS 4.0</a></li></ul><li>4.8: <a href=#pg-535d80257a605affbcfa3cd7f4b405c7>Running Photon OS on Amazon Elastic Cloud Compute</a></li><ul><li>4.8.1: <a href=#pg-7e44b1d49947e5e0f228af5c2d22a820>Prerequisites for Running Photon OS on AWS EC2</a></li><li>4.8.2: <a href=#pg-13bdc4e2d439d9398ab01daeeb4bb1ec>Set Up Photon OS on EC2</a></li><li>4.8.3: <a href=#pg-c217b6cbe163c7d25a8803f7e23c0069>Deploy a Containerized Application in Photon OS</a></li><li>4.8.4: <a href=#pg-6ee250fdb6cd3aa3b2089a643ebc99a1>Launch the Web Server with Cloud-Init</a></li><li>4.8.5: <a href=#pg-39b73afa8f1609a442a680b04297799e>Terminate the AMI Instance</a></li></ul><li>4.9: <a href=#pg-82b942d068e235c58b388388bb1a4e4a>Running Photon OS on Microsoft Azure</a></li><ul><li>4.9.1: <a href=#pg-ad1b426636b0abebe6331214188cbb7a>Prerequisites for Running Photon OS on Azure</a></li><li>4.9.2: <a href=#pg-6033e80ea39d7d9d45cd24d672ef58f3>Set Up Azure Storage and Uploading the VHD</a></li><li>4.9.3: <a href=#pg-9a8d0861f63e4cbd91bcd0136f402e8b>Remove Photon OS From Azure</a></li></ul><li>4.10: <a href=#pg-afab1e848c12bf1991fdaa11793b3aec>Running Photon OS on Google Compute Engine</a></li><ul><li>4.10.1: <a href=#pg-550dbc0b52c6260a1bd98c719abf40f2>Prerequisites for Running Photon OS on GCE</a></li><li>4.10.2: <a href=#pg-05f30b7237da7a556f6587e7eafd1eed>Installing Photon OS on Google Compute Engine</a></li></ul><li>4.11: <a href=#pg-eedc963d153cd71329bd6ec6858e74e3>Running Photon OS on Raspberry Pi</a></li><ul><li>4.11.1: <a href=#pg-fd6c69e7b25eaa3c6701cf504027a315>Prerequisites for Running Photon OS on Raspberry Pi</a></li><li>4.11.2: <a href=#pg-78c035034a5ada974bce4b9c1670954e>Installing Photon OS on Raspberry Pi</a></li><li>4.11.3: <a href=#pg-f06c107c3d3441cf06142fa7233fa7f9>Enabling Raspberry Pi Interfaces using Device Tree</a></li></ul><li>4.12: <a href=#pg-801c34aa27a2a7bdc5b108048947dda6>Deploying a Containerized Application in Photon OS</a></li><li>4.13: <a href=#pg-71272c24f261fdad461dadc21c3eeffb>Compatible Cloud Images</a></li></ul><li>5: <a href=#pg-da713ae841dc4fb2318a7048de8be834>Administration Guide</a></li><ul><li>5.1: <a href=#pg-a0565d71cffc68256f1eef73c83d610d>Photon OS Packages</a></li><ul><li>5.1.1: <a href=#pg-5c060815eb25a8fdde3f32aa63e23ac2>Examining the Packages in the SPECS Directory on Github</a></li><li>5.1.2: <a href=#pg-2ac7b05fa6cf7d20b74178c9da921230>Looking at the Differences Between the Minimal and the Full Version</a></li><li>5.1.3: <a href=#pg-124e20efdc731b13cbd4b8db1880534f>The Root Account and the 'sudo' and 'su' Commands</a></li><li>5.1.4: <a href=#pg-145afbb86032e888cc4af8fd6f202be5>Examining Signed Packages</a></li><li>5.1.5: <a href=#pg-5becdc54572776a2fdbf1b9fa0f1b160>Photon OS Package Repositories</a></li><li>5.1.6: <a href=#pg-2f71ba1afee7ee244482d802b30ff4ee>Building a Package from a Source RPM</a></li><li>5.1.7: <a href=#pg-c3d21e7c9b262c639d62bccd74a99f6f>Compiling C++ Code on the Minimal Version of Photon OS</a></li></ul><li>5.2: <a href=#pg-c8ae78810d3ae5754cbe6a65f8c5135f>Package Management in Photon OS with 'tdnf'</a></li><ul><li>5.2.1: <a href=#pg-aeccf4f6e90eebd94ddf84852fb0d862>Introduction to 'tdnf'</a></li><li>5.2.2: <a href=#pg-6be25b0c71d43e9d95b95caace1ff5ad>Configuration Files and Repositories</a></li><li>5.2.3: <a href=#pg-8b0a5b9452d0d77879fd1eda17c6482e>Adding a New Repository</a></li><li>5.2.4: <a href=#pg-22786583a3c44dee63ba82f7ee05def1>Mount the Photon ISO Image for the Photon-ISO Repository</a></li><li>5.2.5: <a href=#pg-2bc8840342a170e58fd10f1e939e9fa4>Adding the Dev Repository to Get New Packages from the GitHub Dev Branch</a></li><li>5.2.6: <a href=#pg-444ec768f07dc7d65abd846e1d83ed06>tdnf-automatic</a></li><li>5.2.7: <a href=#pg-9d1ec0e86cc83f47a85563f817d4e446>Install Packages from CLI</a></li><li>5.2.8: <a href=#pg-3698094ce22ba1a521e28ad24f2a29a3>SSL Options</a></li><li>5.2.9: <a href=#pg-11b8159529e3f82cce563049b0388450>Standard Syntax for tdnf Commands</a></li><ul><li>5.2.9.1: <a href=#pg-71f32dc6708994c40c40019a3c250f21>tdnf Commands</a></li><li>5.2.9.2: <a href=#pg-147b87d31129020a1635f26df1914a29>tdnf Command Options</a></li></ul></ul><li>5.3: <a href=#pg-e3d4bf08b8b5944ee1453e9ff5330375>Managing Services with 'systemd'</a></li><ul><li>5.3.1: <a href=#pg-5ccb448ef95f9f2329e6d403e088cea1>Viewing Services</a></li><li>5.3.2: <a href=#pg-66dba9f3a2f81395d9cc5c35c31646b9>Controlling Services</a></li><li>5.3.3: <a href=#pg-84ec517b3c52f4a54ff9df18e89efcc4>Creating a Startup Service</a></li><li>5.3.4: <a href=#pg-141a8337aedbb0fd60532447b3aa306b>Disabling the Photon OS httpd.service</a></li><li>5.3.5: <a href=#pg-082bb917d85eb3624ea734a682a26df9>Installing Sendmail</a></li><li>5.3.6: <a href=#pg-483f2401135eb4c2ae692c7468e5aa2b>Auditing System Events with auditd</a></li><li>5.3.7: <a href=#pg-4ad47e48a6306d7ff4ed44fc615b27cd>Analyzing systemd Logs with journalctl</a></li><li>5.3.8: <a href=#pg-b9f969e7b87cad20b3c6d3787094cbeb>Migrating Scripts to systemd</a></li></ul><li>5.4: <a href=#pg-4683813d869e45229ca84b5042671f7c>Configure Wireless Networking</a></li><li>5.5: <a href=#pg-fe179aab9393b273079ffe04e8fad7e0>Managing the Network Configuration</a></li><ul><li>5.5.1: <a href=#pg-17b7fcb6d6f65ac49d6354d26e82fc87>Commands to Manage Network Service</a></li><li>5.5.2: <a href=#pg-19edb075ace34c2817b538b6c8928d9e>Using the Network Configuration Manager</a></li><li>5.5.3: <a href=#pg-0d2237ec1d2245aa00e53d192972035f>Use 'ip' and 'ss' Commands</a></li><li>5.5.4: <a href=#pg-814aab1ca524fe8161cabbeb97b41245>Configuring Network Interfaces</a></li><li>5.5.5: <a href=#pg-dca0a6deea7101803fda13a748dac408>Setting a Static IP Address</a></li><li>5.5.6: <a href=#pg-bd9ce63678e73d1d44c65642730f1d78>Turning Off DHCP</a></li><li>5.5.7: <a href=#pg-35836b706928911e82d888ac98641d48>Adding a DNS Server</a></li><li>5.5.8: <a href=#pg-917e3b297c548020673bd24fd16dd9b8>Setting Up Networking for Multiple NICs</a></li><ul><li>5.5.8.1: <a href=#pg-8b2539c60ae140a0c48f29f684251c19>Combining DHCP and Static IP Addresses with IPv4 and IPv6</a></li></ul><li>5.5.9: <a href=#pg-3d98de3abe5f5da1ebfc410dc1a2248d>Clearing the Machine ID of a Cloned Instance for DHCP</a></li><li>5.5.10: <a href=#pg-5e27003890310835c92e92f35843ab6a>Using Predictable Network Interface Names</a></li><li>5.5.11: <a href=#pg-4ea08cc28e5e5f522fa95c3c72090442>Inspecting the Status of Network Links with 'networkctl'</a></li><li>5.5.12: <a href=#pg-a00cc124cdf4736e59e993eeaa08ee44>Turning On Network Debugging</a></li><li>5.5.13: <a href=#pg-479bf00c311a853d785a6dc9305907f7>Installing packgages for 'tcpdump' and 'netcat'</a></li><li>5.5.14: <a href=#pg-b7601ca8c4e5e39041eccbb4999f7acf>Mounting a Network File System</a></li><li>5.5.15: <a href=#pg-828a2d1bdd0ecad85958910a1b9be255>Network Configuration Manager - C API</a></li><li>5.5.16: <a href=#pg-4299bb3fa9afcfaa59c358ed5e38b45c>Network Configuration Manager - Python API</a></li></ul><li>5.6: <a href=#pg-0bfcc1b7d9a91fb1d816496988d37f11>Prioritize eth0 Route Over WLAN</a></li><li>5.7: <a href=#pg-cb030bcd5f415cc6eeb046d6275d154a>Configuring Photon Real-Time Operating System for Real-Time Applications</a></li><li>5.8: <a href=#pg-c39deeb962197c0195d8085996a492b2>Containers</a></li><ul><li>5.8.1: <a href=#pg-3c85173b7e03660b8116a574fecbe1a6>Docker Containers</a></li><li>5.8.2: <a href=#pg-cd77c6cfde6cdc9255067f5244f24828>Kubernetes</a></li><li>5.8.3: <a href=#pg-12d91d44b04a8488753e0a3b7821c033>Support for distributed builds using Kubernetes</a></li></ul><li>5.9: <a href=#pg-6f374aedcb0c4dd758aa1c4ab8c53097>Changing the Locale</a></li><li>5.10: <a href=#pg-351873e35b3210b1fd2c75ee59aae9b9>Cloud-Init on Photon OS</a></li><ul><li>5.10.1: <a href=#pg-45a9071d4b2303ca5bee1814357045fa>Cloud-Init Overview</a></li><li>5.10.2: <a href=#pg-fc5006c88c80971acbca7940e17b0725>Deploy Photon OS With 'cloud-init'</a></li><li>5.10.3: <a href=#pg-fa7d64bfcbea74033841042b4fd4e18d>Customizing Guest OS using Cloud-Init</a></li><li>5.10.4: <a href=#pg-90768e3143907dab9e81d5e71765b0d5>Creating a Stand-Alone Photon Machine With cloud-init</a></li><li>5.10.5: <a href=#pg-5c9391c3710ae2d40436be84cf9345c3>Customizing a Photon OS Machine on EC2</a></li><li>5.10.6: <a href=#pg-9f61c6c264d1df7b73b27626ea4f116b>Running a Photon OS Machine on GCE</a></li></ul><li>5.11: <a href=#pg-16ff02d147dd57523646b981a1952802>Security Policy</a></li><ul><li>5.11.1: <a href=#pg-21b4f8060fb157189e39cf89b75a12de>Default Firewall Settings</a></li><li>5.11.2: <a href=#pg-c3f7621bce00345c0b7fcade70c90aa4>Default Permissions and umask</a></li><li>5.11.3: <a href=#pg-e1086d06bb0107dfdf9b62e051f61061>Disabling TLS 1.0 to Improve Transport Layer Security</a></li></ul><li>5.12: <a href=#pg-13106be5fcb8287185875884ee4a7512>Support for zstd Compression</a></li><li>5.13: <a href=#pg-899c827da6c0f512d273c2430de59fa2>Photon RPM OSTree: a simple guide</a></li><ul><li>5.13.1: <a href=#pg-8f7f63a7d25766bd5b0ef616451b55bb>Introduction</a></li><ul></ul><li>5.13.2: <a href=#pg-ec749f9f7439e85434ec839477fa69dd>Installing a host against default server repository</a></li><ul></ul><li>5.13.3: <a href=#pg-63adc650f4a841f3597922787528f17c>Concepts in Action</a></li><ul></ul><li>5.13.4: <a href=#pg-b62b64295450ca65a5186142fd9f1603>Querying For Commit File and Package Metadata</a></li><ul></ul><li>5.13.5: <a href=#pg-6b453783bf3141d3bc03b2e2732f3afc>Host Updating Operations</a></li><ul></ul><li>5.13.6: <a href=#pg-9a48799a4bec43b263b76904358449d1>Creating a Server</a></li><ul></ul><li>5.13.7: <a href=#pg-51d1d7888a9d42c1f88448d4c263a998>Installing a Photon RPM-OStree host against a custom server repository</a></li><ul></ul><li>5.13.8: <a href=#pg-d4ceeae3e03f91651df3a54320340a53>Automatic Updates</a></li><ul></ul><li>5.13.9: <a href=#pg-b7d11860a5b7ce11ea16ac719d59deb4>File Oriented Server Operations</a></li><ul></ul><li>5.13.10: <a href=#pg-80a9484e4b01a64f6235e211efb26409>Package Oriented Server Operations</a></li><ul></ul><li>5.13.11: <a href=#pg-2472b0296edd8e9542da1d39ed9b48cd>Remotes</a></li><ul></ul><li>5.13.12: <a href=#pg-732a7f8dd299bd9ffbffb4afab9b21f0>Running container applications between bootable images</a></li><ul></ul><li>5.13.13: <a href=#pg-f4acccc20969d619858c0e6c930ecb82>Install or rebase to Photon OS 4.0</a></li><ul></ul></ul><li>5.14: <a href=#pg-87f63a5ed86c6655df43ce9b8c2f6383>Support for SELinux</a></li><li>5.15: <a href=#pg-609cd3e20218b5ed125525c70414aa5c>Remotely Upgrading a Photon OS Machine</a></li><ul><li>5.15.1: <a href=#pg-64564c8401761ee407f956d4bdf12d0c>Remotely Update a Single Photon OS Machine With Photon Management Daemon</a></li><li>5.15.2: <a href=#pg-7e033ac460a478424d7c28d77b997e4a>Remotely Upgrade Multiple Photon OS Machines With Photon Management Daemon</a></li></ul><li>5.16: <a href=#pg-34235c83fd1b0edbbc2dac2b8fb771b2>Photon Management Daemon</a></li><ul><li>5.16.1: <a href=#pg-7dffd29a0ca59a5a04679d712683415b>Installing the pmd Package</a></li><li>5.16.2: <a href=#pg-b832cd5094aa75f632bd942ae68c5edc>Available APIs</a></li></ul></ul><li>6: <a href=#pg-ecf7e357d2a131135219db95eddda49c>User Guide</a></li><ul><li>6.1: <a href=#pg-16393cd33404005ea8f912eb0e0786ed>Setting Up Network PXE Boot</a></li><li>6.2: <a href=#pg-e3ea9979ca5ac1affcaa6aea392fd501>Kickstart Support in Photon OS</a></li><li>6.3: <a href=#pg-79efb1f65c2452f0b90208ebaf1a084a>Kickstart Through HTTP</a></li><ul><li>6.3.1: <a href=#pg-b338b8d42ae84dbcbff83de1753e995c>Prerequisites</a></li><li>6.3.2: <a href=#pg-c6671d9a6869cb4af2c047b4f76575c9>Procedure</a></li><li>6.3.3: <a href=#pg-7721e9f0e5e555bb6640c7092e191a79>Photon Packer Template</a></li><li>6.3.4: <a href=#pg-b3fb62a9ed54be9848715232ab3fd71e>packages_minimal.json File</a></li></ul><li>6.4: <a href=#pg-3e27135293bfebb45948275ce7512443>Kubernetes on Photon OS</a></li><ul><li>6.4.1: <a href=#pg-8be233206817193d67a60d7415f17ef9>Prerequisites</a></li><li>6.4.2: <a href=#pg-ea490ab437c762e0efed3eb8be4354d4>Running Kubernetes on Photon OS</a></li><ul><li>6.4.2.1: <a href=#pg-a1d2e42542f91c88d6de82a65837b7e5>System Information</a></li><li>6.4.2.2: <a href=#pg-6a11cf2f4ce782f763245a10cdcfc7b9>Prepare the Hosts</a></li><li>6.4.2.3: <a href=#pg-fe4d3e3b9b42532a4e4db9ae8a685b08>Configure Kubernetes Services on the Master</a></li><li>6.4.2.4: <a href=#pg-8bb2c13b46e9ad89de8e37d2b8c8929b>Configure the Kubernetes services on Node</a></li></ul></ul><li>6.5: <a href=#pg-b667c012d3f48edb1e0e30433c8f9a6e>Photon NFS Utilities for Mounting Remote File Systems</a></li></ul><li>7: <a href=#pg-8b6282a218a1c99be95898ab027a0a44>Command-Line Reference</a></li><ul><li>7.1: <a href=#pg-108c8be60349f80ed2fa1d40951c15a7>Command-line Interfaces</a></li><ul><li>7.1.1: <a href=#pg-f05528a6ba8fdbf06e535912d97d5811>Photon Management Daemon Command-line Interface (pmd-cli)</a></li><li>7.1.2: <a href=#pg-0451f1b066f757da7d2004f4800d8c68>Photon Network Config Manager Command-line Interface (nmctl)</a></li><li>7.1.3: <a href=#pg-11a388c580ecc399f748da69eeed2d7d>Photon Real-Time Operating System Command-line Interface</a></li></ul></ul><li>8: <a href=#pg-fd5b9e03b9ec98a8e94a78696bd95809>Troubleshooting Guide</a></li><ul><li>8.1: <a href=#pg-d1a2c64570ea618afcac34853d3591b8>Introduction</a></li><ul><li>8.1.1: <a href=#pg-0c24d695daaa503ab5b136189f98b352>Systemd and TDNF</a></li><li>8.1.2: <a href=#pg-c51d8fa43bbff78136c63ead3844946b>The Root Account and the `sudo` and `su` Commands</a></li><li>8.1.3: <a href=#pg-5160821fa4b3d287aa428b4db0b0377e>Checking the Version and Build Number</a></li><li>8.1.4: <a href=#pg-24401492a50648e7339365977f2b076b>General Best Practices</a></li><li>8.1.5: <a href=#pg-c4fee82bb026acdb479d18f12f8cadfd>Photon OS Logs</a></li><li>8.1.6: <a href=#pg-dd1666053f4fa67749224c02b1c8be5a>Troubleshooting Progression</a></li></ul><li>8.2: <a href=#pg-f1d4a7ec328436687337c431d2f92fe7>Solutions to Common Problems</a></li><ul><li>8.2.1: <a href=#pg-1f1ad9ca2f9874120dd824aae9b7fb29>Boot in Emergency Mode</a></li><li>8.2.2: <a href=#pg-3b774a1d8adcb06d7ddc820bab2163c4>Resetting a Lost Root Password</a></li><li>8.2.3: <a href=#pg-ac6ea7a2ae283997a41310a5017afebf>Fixing Permissions on Network Config Files</a></li><li>8.2.4: <a href=#pg-dcc310ada5d14b412cd7a0a3b235f5a9>Permitting Root Login with SSH</a></li><li>8.2.5: <a href=#pg-70929a5c761504aaa356aca81dcf5de7>Fixing Sendmail</a></li></ul><li>8.3: <a href=#pg-12ed3b235a2c62adb1a16a7644accee1>Photon OS General Troubleshooting</a></li><ul><li>8.3.1: <a href=#pg-664cc9cec9a044cfca15b926a17dd983>Photon Code</a></li><li>8.3.2: <a href=#pg-5404bf48493f97cd2de8f602f761fc79>Package Management</a></li><li>8.3.3: <a href=#pg-ff9fc3434cbe8db979342d9736dbfeb6>Network Configuration</a></li><li>8.3.4: <a href=#pg-51e16a96644c046ffe6a824b4489b09d>Cloud-init</a></li><li>8.3.5: <a href=#pg-bc1ceb0533f29196c7d5f82d8eea575e>Open-vm-tools/Vmtoolsd</a></li></ul><li>8.4: <a href=#pg-d65d5ffc0a2bedf288766d2b9faf15ce>Troubleshooting Tools</a></li><ul><li>8.4.1: <a href=#pg-04a89d7f32cd8174c5a820a6ee655974>Common Tools</a></li><li>8.4.2: <a href=#pg-f13d060552ebaf87170062c96f0cb71b>Troubleshooting Tools Installed by Default</a></li><li>8.4.3: <a href=#pg-8541e2426271c83233d26031263d756e>Installing Tools from Repositories</a></li><li>8.4.4: <a href=#pg-3dc35a0dd7f3bbf95344f20fea8d9dc4>Linux Troubleshooting Tools</a></li></ul><li>8.5: <a href=#pg-e6dc8e85bd84cbb48db5ca550e3adf9c>Systemd</a></li><ul><li>8.5.1: <a href=#pg-45a60780101b99e8a21a9620bfe7ca73>Enabling 'systemd' Debug Shell During Boot</a></li><li>8.5.2: <a href=#pg-2222dbb3d5c5a8cb432250b8b95f41ff>Troubleshooting Services With 'systemctl'</a></li><li>8.5.3: <a href=#pg-37ee182b89ad2f34aa7aafa527b6186b>Analyzing System Logs with 'journalctl'</a></li><li>8.5.4: <a href=#pg-a3e35c7adc2aa5828f3d0a03d03c0bf3>Inspecting Services with 'systemd-analyze'</a></li><li>8.5.5: <a href=#pg-21502ba89b3fba5480b548821dfd1e69>Inspecting Services with 'systemd-analyze'</a></li></ul><li>8.6: <a href=#pg-641b474d7b8d4100941d5a2750526038>Network Troubleshooting</a></li><ul><li>8.6.1: <a href=#pg-7443880a71f96c7150bcd520d1ab0dd2>Managing the Network Configuration</a></li><li>8.6.2: <a href=#pg-86f4c5c53619c0832267e20fef9c5119>Inspecting IP Addresses</a></li><li>8.6.3: <a href=#pg-7bdf729c29d245264a8c0847b910259e>Inspecting the Status of Network Links with 'networkctl'</a></li><li>8.6.4: <a href=#pg-ead329f4a50d05b1e092b3096d4f90b4>Network Debugging</a></li><li>8.6.5: <a href=#pg-6c30537e08221469979d45c47f7dc8c4>Checking Firewall Rules</a></li><li>8.6.6: <a href=#pg-46e6e1e0a8903d55cdd88d1f424ce291>Inspect Network Settings with 'netmgr'</a></li></ul><li>8.7: <a href=#pg-9bc167ac28d85c2f0972b58d26097676>File System Troubleshooting</a></li><ul><li>8.7.1: <a href=#pg-47439fb3c02145fdc25f8c11bf0b5e3f>Checking Disk Space</a></li><li>8.7.2: <a href=#pg-abc971fcad72a9dad157e05c66304fb6>Adding a Disk and Partitioning It</a></li><li>8.7.3: <a href=#pg-4a539020bc72ef2270f43ba0b05f0192>Expanding Disk Partition</a></li><li>8.7.4: <a href=#pg-3affa41adcd49c9555f8960c2615e3aa>List Disk Partitions with 'fdisk'</a></li><li>8.7.5: <a href=#pg-497391c40467e0c63cef258c129588cd>File System Consistency Check Tool</a></li><li>8.7.6: <a href=#pg-0d8a66f1aaaa1d930b395e737a470b71>Fixing File System Errors When fsck Fails</a></li></ul><li>8.8: <a href=#pg-45fccef9bd97bc1ac84237b20daca982>Troubleshooting Packages</a></li><li>8.9: <a href=#pg-249cb7133f08d5ee19182ae009f48b92>Kernel Problems and Boot and Login Errors</a></li><ul><li>8.9.1: <a href=#pg-fb6a01033307d1364f3304460e9609eb>Kernel Overview</a></li><li>8.9.2: <a href=#pg-1bc1d49db5f317bcf9d37ee4fbc9e850>Boot Process Overview</a></li><li>8.9.3: <a href=#pg-d493e733f13166e75be33c14d5041e24>Blank Screen on Reboot</a></li><li>8.9.4: <a href=#pg-acbad8eeeb152ca4b47202019d5e6fbc>Investigating Unexpected Behavior</a></li><li>8.9.5: <a href=#pg-0e252e3664ed9f5e850a0bbbc6d40b21>Investigating the Guest Kernel</a></li><li>8.9.6: <a href=#pg-daeaab5c036a9bfeb7dc2da74aa8256a>Kernel Log Replication with VProbes</a></li><li>8.9.7: <a href=#pg-f8bffb3e220b96d1c691fab6b2f4b171>Linux Kernel</a></li></ul><li>8.10: <a href=#pg-db6c8d892731b711d7d08232c88d660e>Performance Issues</a></li><ul><li>8.10.1: <a href=#pg-d7dfe1c13df4b2c19bc5a19455b7c5c6>General Performance Guidelines</a></li><li>8.10.2: <a href=#pg-0be0e0ec49fb47fcbab6983167f5f866>Throughput Performance</a></li></ul></ul><li>9: <a href=#pg-72c6e6702f26ff779b1da5b328a144b1>Security Advisories</a></li><ul></ul></ul><div class=content><p>The Photon OS Documentation provides information about how to install, configure, and use VMware Photon OS™.</p><p><img src=../../docs/images/Photon-4-bootsplash.png alt="PhotonOS Logo"></p><p><strong>Product version: 4.0</strong></p><p>This documentation applies to all 4.0.x releases.</p><h2 id=intended-audiences>Intended Audiences</h2><p>This information is intended for Photon OS administrators and developers:</p><table><thead><tr><th><strong>Description of Task</strong></th><th><strong>Relevant Documentation</strong></th></tr></thead><tbody><tr><td>Understand Photon OS</td><td><a href=overview/>Overview of Photon OS</a></td></tr><tr><td>Download and Install Photon OS</td><td><a href=installation-guide/>Installation Guide</a></td></tr><tr><td>Fundamentals of administering Photon OS</td><td><a href=administration-guide/>Administration Guide</a></td></tr><tr><td>Using Photon OS</td><td><a href=user-guide/>User Guide</a></td></tr><tr><td>Using Photon OS command-line utilities</td><td><a href=command-line-reference/>Command-Line Interface Reference</a></td></tr><tr><td>Solutions for common problems</td><td><a href=troubleshooting-guide/>Troubleshooting Guide</a></td></tr></tbody></table><hr></div></div><div class=td-content style=page-break-before:always><h1 id=pg-ae80ff934737545e46f31924c72ccd98>1 - Quick Start Links</h1><p>If you want to start using Photon OS straight away, see the following topics:</p><ul><li><a href=../../docs/overview/>Overview</a></li><li><a href=../../docs/installation-guide/downloading-photon/>Downloading Photon OS</a></li><li><a href=../../docs/installation-guide/build-iso-from-source/>Build an ISO from the source code for Photon OS</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-efbe830c8e6b33a1da6e2a60fa9d86ee>2 - What is New in Photon OS 4</h1><p>Photon OS 4.0 provides support for the Real Time flavor of kernel linux-rt, SELinux , installer improvements, PMD role management improvements and critical updates to OSS packages including linux kernel, systemd, and glibc. This topic summarizes what&rsquo;s new and different in Photon OS 4.0.</p><h2 id=new-features>New Features</h2><ul><li><p>Photon OS 4.0 features a kernel flavor called &lsquo;linux-rt&rsquo; to support low-latency real time applications. <code>linux-rt</code> is based on the Linux kernel PREEMPT_RT patchset that turns Linux into a hard real time operating system. In addition to the real time kernel itself, Photon OS 4.0 supports several userspace packages such as tuned, tuna, stalld etc., that are useful to configure the operating system for real time workloads. The linux-rt kernel and the associated userspace packages together are referred to as Photon Real Time (RT).</p></li><li><p>SELinux is an implementation of mandatory access controls (MAC) on Linux. Photon OS 4.0 provides an opportunity for the appliance to enable SElinux, either in Permissive or Enforcement mode. Photon OS ships will also include a default policy which the appliance can choose to customise depending on their needs during the build time. Photon also supports SELinux for containers.</p></li><li><p>Photon 4.0 brings out a completely revamped network configuration management library. It is a totally new avatar of the previous netmgr and has been developed with the goal of providing a set of APIs for common tasks such as configuring IP addresses, network routes, interface states, DNS, etc. This allows the user to configure the network on a Photon OS through simpler API calls that handle much of the complexity of configuring the network, which the user would have to do if they took the route of directly manipulating the various configuration files.</p></li><li><p>Photon OS 4.0 provides support for Raspberry Pi 4.</p></li><li><p>OVA and AMI images for ARM architecture are available in Photon OS 4.0.</p></li><li><p>In <code>tdnf</code>, support is added for the following:</p></li></ul><ol><li>Validation of externally configured GPGkeys</li><li><code>tdnf-automatic</code> to allow administrators to configure systems to automatically download and perform updates without manual intervention</li><li>Metalink in the <code>tdnf</code> repositories allows configuration of multiple mirrors to download the repository data</li><li>Local and remote URL package installation</li><li>SSL Options</li></ol><h3 id=installer-and-build-system-updates>Installer and Build System Updates</h3><ul><li>Support for distributed builds using Kubernetes</li><li>Availability of Photon OS installer as RPM</li><li>Support for multiple disks in image builder</li><li>Support for untrusted (self-signed) HTTPS in kickstart ISO installation</li><li><code>zstd</code> as the default compression mechanism for RPM</li></ul><h3 id=package-and-binary-maintenance>Package and Binary Maintenance</h3><ul><li>Cloud-ready images for rapid deployment on Microsoft Azure (new), Google Compute Engine (GCE), Amazon Elastic Compute Cloud (EC2), and VMware products (vSphere, Fusion, and Workstation)</li><li>Critical updates to the following base OS packages:<ul><li>Linux kernel 5.10 LTS</li><li>Glibc 2.32</li><li>systemd 247</li><li>Python3 3.9</li><li>Openjdk : 1.8.0.265, 11.0.9</li><li>Openssl : 1.1.1</li><li>Cloud-init: 20.4.1</li><li>GCC: 10.2.0</li></ul></li><li>Up-to-date versions for most packages available in the repository.</li></ul><p>##Notes
Openjdk 1.10 is end of life and is being shipped to serve the sole purpose of build dependency. There will no future updates - Updates to security or otherwise will be done to the openjdk10 package.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6e17e09fffc1050f46600282def85180>3 - Overview</h1><p><em>Overview of Photon OS</em> provides an introduction to Photon OS, its versions, and distinguishing features.</p><p><strong>Product version: 4.0</strong></p><p>This documentation applies to all 4.0.x releases.</p><h2 id=intended-audiences>Intended Audiences</h2><p>This information is intended for Photon OS administrators who install and set up Photon OS.</p></div><div class=td-content><h1 id=pg-afb5e8782b084babc072fa6f3bdd2a63>3.1 - Introduction to Photon OS</h1><p>Photon OS, is an open-source minimalist Linux operating system from VMware that is optimized for cloud computing platforms, VMware vSphere deployments, and applications native to the cloud.</p><p>Photon OS is a Linux container host optimized for vSphere and cloud-computing platforms such as Amazon Elastic Compute and Google Compute Engine. As a lightweight and extensible operating system, Photon OS works with the most common container formats, including Docker, Rocket, and Garden. Photon OS includes a yum-compatible, package-based lifecycle management system called tdnf.</p><p>When used with development tools and environments such as VMware Fusion, VMware Workstation, and production runtime environments (vSphere), Photon OS lets you seamlessly migrate container-based applications from development to production. With a small footprint and fast boot and run times, Photon OS is optimized for cloud computing and cloud applications.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-cf18e5d308624319aff0a4061896ab70>3.2 - Flavours</h1><p>Photon OS consists of a minimal version, a full version, RPM OSTree, and Photon Real-Time Operating System.</p><ul><li><p>The minimal version of Photon OS is lightweight container host runtime environment that is suited to managing and hosting containers. The minimal version contains just enough packaging and functionality to manage and modify containers while remaining a fast runtime environment. The minimal version is ready to work with appliances.</p></li><li><p>The Developer version of Photon OS includes additional packages to help you customize the system and create containerized applications. For running containers, the developer version is excessive. The devloper version helps you create, develop, test, and package an application that runs a container.</p></li><li><p>OSTree is a tool to manage bootable, immutable, versioned filesystem trees. Unlike traditional package managers like rpm or dpkg that know how to install, uninstall, configure packages, OSTree has no knowledge of the relationship between files. But when you add rpm capabilities on top of OSTree, it becomes RPM-OSTree, meaning a filetree replication system that is also package-aware.</p></li><li><p>Photon OS features a kernel flavor called &lsquo;linux-rt&rsquo; to support low-latency real time applications. linux-rt is based on the Linux kernel PREEMPT_RT patchset that turns Linux into a hard real time operating system. In addition to the real time kernel itself, Photon OS 4.0 supports several userspace packages such as tuned, tuna, stalld etc., that are useful to configure the operating system for real time workloads. The linux-rt kernel and the associated userspace packages together are referred to as Photon Real Time (RT).</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-1e29a42acbd6dbfaaa05d7c92ca5ccc5>4 - Installation Guide</h1><p>The Photon OS <em>Installation Guide</em> provides information about how administrators can install Photon OS.</p><p><strong>Product version: 4.0</strong></p><p>This documentation applies to all 4.0.x releases.</p><h2 id=intended-audiences>Intended Audiences</h2><p>This information is intended for Photon OS administrators who install and set up Photon OS.</p></div><div class=td-content><h1 id=pg-0039a3f013699dc4f7f1dd4092ce6977>4.1 - Downloading Photon OS</h1><p>Detailed instructions for obtaining Photon OS 4.0 are located at: <a href=https://github.com/vmware/photon/wiki/Downloading-Photon-OS>https://github.com/vmware/photon/wiki/Downloading-Photon-OS</a></p><h2 id=download-formats>Download Formats</h2><p>Photon OS is available in the following pre-packaged, binary formats:</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>Format</td><td>Description</td></tr><tr><td><img width=1000 class=px-5></td><td></td></tr><tr><td><a href=https://packages.vmware.com/photon/4.0/GA/iso/>ISO Image</a></td><td>Contains everything needed to install the minimal or full installation of Photon OS or the Real-Time flavor of Photon OS. The bootable ISO has a manual installer or can be used with PXE/kickstart environments for automated installations.</td></tr><tr><td><a href=https://packages.vmware.com/photon/4.0/GA/ova/>OVA</a></td><td>Pre-installed minimal environment, customized for VMware hypervisor environments. These customizations include a highly sanitized and optimized kernel to give improved boot and runtime performance for containers and Linux applications. Since an OVA is a complete virtual machine definition, we&rsquo;ve made available a Photon OS OVA that has virtual hardware version 13 arm64, version 13, and version 11; this will allow for compatibility with several versions of VMware platforms or allow for the latest and greatest virtual hardware enhancements.</td></tr><tr><td><a href=https://packages.vmware.com/photon/4.0/GA/ami/>Amazon AMI</a></td><td>Pre-packaged and tested version of Photon OS with Amazon AMI and Amazon AMI arm64 packages made ready to deploy in your Amazon EC2 cloud environment. Previously, we&rsquo;d published documentation on how to create an Amazon compatible instance, but, now we&rsquo;ve done the work for you.</td></tr><tr><td><a href=https://packages.vmware.com/photon/4.0/GA/gce/>Google GCE Image</a></td><td>Pre-packaged and tested Google GCE image that is ready to deploy in your Google Compute Engine Environment, with all modifications and package requirements for running Photon OS in GCE.</td></tr><tr><td><a href=https://packages.vmware.com/photon/4.0/GA/azure/>Azure VHD</a></td><td>Pre-packaged and tested Azure HD image that is ready to deploy in your Microsoft Azure Cloud, with all modifications and package requirements for running Photon OS in Azure.</td></tr><tr><td><a href=https://packages.vmware.com/photon/4.0/GA/rpi/>Raspberry Pi Image</a></td><td>Pre-packaged and tested Raspberry Pi Image on ARM64 architecture.</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-8ccac281ee95518faa0eec95576505af>4.2 - Upgrading to Photon OS 4.0</h1><p>You can upgrade your existing Photon OS 3.0 VMs to take advantage of the functionality enhancements in Photon OS 4.0. For details, see <a href=../../overview/whats-new/>What&rsquo;s New in Photon OS 4.0</a>.</p><p>Photon OS 4.0 provides a seamless upgrade for Photon OS 3.0 implementations. You simply download an upgrade package, run a script, and reboot the VM. The upgrade script will update your packages and retain your 3.0 customizations in your new OS 4.0 VM.</p><p><strong>Note</strong>: If your 3.0 VM is a full install, then you will have a 4.0 VM that represents a full install (all packages and dependencies). Upgrading a minimal installation takes less time due to fewer packages.</p><p>For each Photon OS 3.0 VM that you want to upgrade, complete the following steps:</p><ol><li><p>Back up all existing settings and data for the Photon OS 3.0 VM.</p></li><li><p>Stop any services (for example, docker) that are currently running in the VM.</p></li><li><p>Install photon-upgrade package</p><pre><code># tdnf -y install photon-upgrade
</code></pre></li><li><p>Run the upgrade script</p><pre><code># photon-upgrade.sh
</code></pre></li><li><p>Answer y to reboot the VM. The upgrade script powers down the Photon OS 3.0 VM and powers it on as a Photon OS 4.0 VM.</p></li></ol><p>After the upgrade, before you deploy into production, test all previous functionality to ensure that everything works as expected.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-91e141c3992b27f53801ceefa4cabedb>4.3 - Building Images</h1><p>You can build an ISO from the source code and other images for Photon OS. This section describes how to build the ISO, build other images, use the cached toolchain and RPMS, and cached sources. You can use this method as an alternative to downloading a pre-built version.</p><p>For information on how to install and build a package on Photon OS from the package&rsquo;s source RPM, see the <a href=../../administration-guide/photon-os-packages/building-a-package-from-a-source-rpm/>Photon OS Administration Guide</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-48a1bd9dec8ba490f9db4f579675d370>4.3.1 - Folder Layout</h1><p>The structure of the directories on GitHub that contain the source code for Photon OS is as follows:</p><pre><code>photon/
├── Makefile
├── README
├── Dockerfile
├── Vagrantfile
├── PUBLISHRPMS_SPECS        # RPM SPEC files
├── SPECS                    # RPM SPEC files
├── common                   # Build, packaging config
├── docs                     # Documentation
├── build.py                 # Package builder
├── config.json              # Package builder
├── support                  # Build scripts
└── tools

</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-6da699b8cf8e1d34d27dee90fd6a107f>4.3.2 - Build Prerequisites</h1><p>Before you build the ISO, verify that you have the performed the following tasks:</p><ul><li><p>Installed a build operating system running the 64-bit version of Ubuntu 14.04 or later version.</p></li><li><p>Downloaded and installed the following packages for Ubuntu:
bison
gawk
g++
createrepo
python-aptdaemon
genisoimage
texinfo
python-requests
libfuse-dev
libssl-dev
uuid-dev
libreadline-dev
kpartx
git
bc</p></li><li><p>Downloaded and installed the following packages for Photon OS:<br>&ldquo;rsync&rdquo;
&ldquo;docker-18.09.9&rdquo;
&ldquo;docker-py3&rdquo;
&ldquo;python3-pyOpenSSL&rdquo;
&ldquo;python3-six&rdquo;
&ldquo;python3-pip&rdquo;
&ldquo;cdrkit&rdquo;
&ldquo;createrepo_c&rdquo;
&ldquo;dosfstools&rdquo;
&ldquo;openssl-devel&rdquo;
&ldquo;python3-curses&rdquo;
&ldquo;zlib-devel&rdquo;
&ldquo;util-linux-devel&rdquo;</p></li><li><p>Installed Docker</p></li><li><p>Downloaded the source code from the Photon OS repository on GitHub into <code>$HOME/workspaces/photon</code>.</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-96f1248c47caa7dc91a91ae9a9782fb7>4.3.3 - Build an ISO from the Source Code for Photon OS</h1><p>You can build an ISO from the source code for Photon OS. This section describes how to build the ISO, use the cached toolchain and RPMS, and cached sources. You can use this method as an alternative to downloading a pre-built version.</p><p>For information on how to install and build a package on Photon OS from the package&rsquo;s source RPM, see the <a href=../../../administration-guide/photon-os-packages/building-a-package-from-a-source-rpm/>Photon OS Administration Guide</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-2767fa2c88f55f64c66613697826720c>4.3.3.1 - Building the ISO</h1><p>Perform the following steps to install the packages on Ubuntu:</p><ol><li><p>Install the packages:</p><pre><code>sudo apt-get -y install bison gawk g++ createrepo python-aptdaemon genisoimage texinfo python-requests libfuse-dev libssl-dev uuid-dev libreadline-dev kpartx git bc
</code></pre></li><li><p>Get Docker:</p><pre><code>wget -qO- https://get.docker.com/ | sh
</code></pre></li><li><p>Install pip and docker 2.3.0</p><pre><code>sudo apt install python3-pip
pip3 install docker==2.3.0
</code></pre><p>If you encounter an error for LOCALE when you run these commands, then export the following variables in the terminal:</p><pre><code>export LC_ALL=&quot;en_US.UTF-8&quot;
export LC_CTYPE=&quot;en_US.UTF-8&quot;
</code></pre></li><li><p>The default configuration parameters are available in config.json. If you want to csutomize them, then the configuration information is available at the following location:</p><pre><code>[https://github.com/vmware/photon/blob/dev/photon-build-config.txt](https://github.com/vmware/photon/blob/dev/photon-build-config.txt)

</code></pre></li><li><p>Clone`the Photon project:</p><p><code>git clone https://github.com/vmware/photon.git</code>
<code>cd $HOME/workspaces/photon</code></p></li><li><p>Make ISO as follows:</p><p><code>sudo make iso</code></p></li><li><p>Make Minimal ISO as follows:</p><p><code>sudo make minimal-iso</code></p></li><li><p>Make Real-Time ISO as follows:</p><p><code>sudo make rt-iso</code></p></li></ol><p><strong>Result</strong></p><p>This command first builds all RPMs corresponding to the SPEC files in your Photon repository and then builds a bootable ISO containing those RPMs.</p><p>The RPMs thus built are stored under <code>stage/RPMS/</code> directory within the repository, using the following directory hierarchy:</p><pre><code>$HOME/workspaces/photon/stage/:
├──RPMS/:
    ├──noarch/*.noarch.rpm    [Architecture-independent RPMs]
    ├──x86_64/*.x86_64.rpm    [RPMs built for the x86-64 architecture]
    ├──aarch64/*.aarch64.rpm  [RPMs built for the aarch64 (ARM64) architecture]
</code></pre><p>The ISO is created at <code>$HOME/workspaces/photon/stage/photon.iso</code>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b12b25e17fade9fa2411d9dce445271a>4.3.4 - Build Other Images for Photon OS</h1><p>This section describes how to build the cloud images, OVA, and RPM.</p><p>For information on how to install and build a package on Photon OS from the package&rsquo;s source RPM, see the <a href=../../administration-guide/photon-os-packages/building-a-package-from-a-source-rpm/>Photon OS Administration Guide</a>.</p></div><div class=td-content><h1 id=pg-62c5b1e7a2b85c2d6cef0f10f3a9712f>4.3.4.1 - Building Cloud Images</h1><p>Perform the following steps to build the cloud images on Ubuntu:</p><ol><li><p>Install the packages:</p><pre><code>sudo apt-get -y install bison gawk g++ createrepo python-aptdaemon genisoimage texinfo python-requests libfuse-dev libssl-dev uuid-dev libreadline-dev kpartx git bc
</code></pre></li><li><p>Get Docker:</p><pre><code>wget -qO- https://get.docker.com/ | sh
</code></pre></li><li><p>Install pip</p><pre><code>sudo apt install python3-pip
pip3 install git+https://github.com/vmware/photon-os-installer.git
git clone https://github.com/vmware/photon.git
    
    
    
</code></pre></li></ol><p>If you encounter an error for LOCALE when you run these commands, then export the following variables in the terminal:</p><pre><code>   `export LC_ALL=&quot;en_US.UTF-8&quot;`
</code></pre><p><code>export LC_CTYPE="en_US.UTF-8"</code></p><ol start=3><li><p>Clone`the Photon project:</p><p><code>git clone https://github.com/vmware/photon.git</code>
<code>cd $HOME/workspaces/photon</code></p></li><li><p>Make the cloud image for AMI.</p><p><code>sudo make image IMG_NAME=ami</code></p></li><li><p>Make the cloud image for Azure.</p><p><code>sudo make image IMG_NAME=azure</code></p></li><li><p>Make the cloud image for GCE.</p><p><code>sudo make image IMG_NAME=gce</code></p></li></ol><p><strong>Result</strong></p><p>This command first builds all RPMs corresponding to the SPEC files in your Photon repository and then builds a bootable ISO containing those RPMs.</p><p>The RPMs thus built are stored under <code>stage/RPMS/</code> directory within the repository, using the following directory hierarchy:</p><pre><code>$HOME/workspaces/photon/stage/:
├──RPMS/:
    ├──noarch/*.noarch.rpm    [Architecture-independent RPMs]
    ├──x86_64/*.x86_64.rpm    [RPMs built for the x86-64 architecture]
    ├──aarch64/*.aarch64.rpm  [RPMs built for the aarch64 (ARM64) architecture]
</code></pre><p>The cloud image is created at `$HOME/workspaces/photon.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-669b29ad634e5e92dcfff70a9782d2fd>4.3.4.2 - Building OVA image</h1><p>Perform the following steps to build OVA on Ubuntu:</p><ol><li><p>Install the packages:</p><pre><code>sudo apt-get -y install bison gawk g++ createrepo python-aptdaemon genisoimage texinfo python-requests libfuse-dev libssl-dev uuid-dev libreadline-dev kpartx git bc
</code></pre></li><li><p>Get Docker:</p><pre><code>wget -qO- https://get.docker.com/ | sh
</code></pre></li><li><p>Install pip</p><pre><code>sudo apt install python3-pip
pip3 install git+https://github.com/vmware/photon-os-installer.git
git clone https://github.com/vmware/photon.git
    
    
    
If you encounter an error for LOCALE when you run these commands, then export the following variables in the terminal:
    
    
    export LC_ALL=&quot;en_US.UTF-8&quot;
`export LC_CTYPE=&quot;en_US.UTF-8&quot;`


</code></pre></li><li><p>Clone the Photon project:</p><pre><code>git clone https://github.com/vmware/photon.git
</code></pre><p><code>cd $HOME/workspaces/photon</code></p></li><li><p>Download latest VDDK from below link:</p><p><a href="https://my.vmware.com/web/vmware/downloads/details?downloadGroup=VDDK670&productId=742" title="Link to VMware ovftool site">https://my.vmware.com/web/vmware/downloads/details?downloadGroup=VDDK670&productId=742</a></p></li><li><p>Search for <code>VMware-ovftool</code> in the same site and install it.</p><p>For example:</p><p>ovftool downloaded file:</p><p><code>VMware-ovftool-4.3.0-13981069-lin.x86_64.bundle</code></p><p>Add exec permission and run it as sudo:</p><p><code>$ chmod +x VMware-ovftool-4.3.0-13981069-lin.x86_64.bundle && sudo ./VMware-ovftool-4.3.0-13981069-lin.x86_64.bundle --eulas-agreed --required</code></p></li><li><p>For VDDK, if the downloaded file is <code>VMware-vix-disklib-6.7.0-8173251.x86_64.tar.gz</code>, untar the downloaded tarball:</p><p><code>$ tar xf VMware-vix-disklib-6.7.0-8173251.x86_64.tar.gz</code></p></li><li><p>Navigate to extracted directory.</p></li></ol><ul><li><p>Move the header files to /usr/include</p><p>$ <code>sudo mv include/*.h /usr/include</code></p></li><li><p>Move the shared libs to /usr/lib/vmware
<code>$ sudo mkdir -p /usr/lib/vmware && sudo mv lib64/* /usr/lib/vmware && sudo rm /usr/lib/vmware/libstdc++.so*</code></p></li></ul><ol start=8><li><p>Export /usr/lib/vmware library path(only for current session). Do this step every time you try to build an ova image.</p><p><code>$ export LD_LIBRARY_PATH=/usr/lib/vmware</code></p></li><li><p>Navigate to your intended Photon source repository and run the following command.</p><pre><code>   
`sudo make image IMG_NAME=ova`

</code></pre></li><li><p>Make the image for OVA UEFI</p></li></ol><p><code>sudo make image IMG_NAME=ova_uefi</code></p><p><strong>Result</strong></p><p>This command first builds all RPMs corresponding to the SPEC files in your Photon repository and then builds a bootable ISO containing those RPMs.</p><p>The RPMs thus built are stored under <code>stage/RPMS/</code> directory within the repository, using the following directory hierarchy:</p><pre><code>$HOME/workspaces/photon/stage/:
├──RPMS/:
    ├──noarch/*.noarch.rpm    [Architecture-independent RPMs]
    ├──x86_64/*.x86_64.rpm    [RPMs built for the x86-64 architecture]
    ├──aarch64/*.aarch64.rpm  [RPMs built for the aarch64 (ARM64) architecture]
</code></pre><p>The cloud image is created at `$HOME/workspaces/photon.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b6991bcd5348c5d6cc84f11f25b1e69a>4.3.5 - Use the Cached Toolchain and RPMS</h1><p>When the necessary RPMs are available under the <code>stage/RPMS/</code> directory, the commands that you use to create any Photon artifact such as, ISO or OVA will reuse those RPMs to create the specified image.</p><p>If you already have the Photon RPMs available elsewhere, and not under <code>stage/RPMS/</code> in the Photon repository, you can build Photon artifacts using those cached RPMs by setting the <code>PHOTON_CACHE_PATH</code> variable to point to the directory containing those RPMs.</p><p>For example, if your RPMs are located under <code>$HOME/photon-cache/</code>, then use the following command to build an ISO:</p><p><code>sudo make iso PHOTON_CACHE_PATH=$HOME/photon-cache</code></p><p>The <code>$HOME/photon-cache/</code> directory should follow the same structure as the <code>stage/RPMS/</code> directory:</p><pre><code>photon-cache/:
├──RPMS/:
    ├──noarch/*.noarch.rpm
    ├──x86_64/*.x86_64.rpm
    ├──aarch64/*.aarch64.rpm

</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-3683869621c9cc8ea742011cbd44760a>4.3.6 - Use Cached Sources</h1><p>To use the cached sources, run the following command:</p><pre><code>mkdir $HOME/photon-sources
sudo make iso PHOTON_SOURCES_PATH=$HOME/photon-sources
</code></pre><p>The directory format of <code>PHOTON_SOURCES_PATH</code> is as follows:</p><pre><code>photon-sources/
├──src1.tar.gz
├──src2.tar.gz
└──...
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-8f2627a45c87f9d5bb9b499554b7b4e4>4.3.7 - View Build Logs</h1><p>You can view build logs at the following location:</p><pre><code>$HOME/workspaces/photon/stage/LOGS
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-1490f4e78e1199856d0d6e3e29ad521c>4.4 - Building Package or Kernel Modules Using a Script</h1><p>You can use a script to build a single Photon OS package without rebuilding all Photon OS packages. You just need a <code>.spec</code> specification file and sources. You place the sources and the specification files in the same folder and run the <code>build_spec.sh</code> script. The script performs the following steps:</p><ul><li>Creates sandbox using docker.</li><li>Installs build tools and <code>.spec</code> build requirements from the Photon OS repository.</li><li>Runs <code>rpmbuild</code>.</li></ul><p><strong>Result:</strong> You have a native Photon OS RPM package.</p><p>The <code>build-spec.sh</code> script is located in the <code>photon/tools/scripts/</code> folder.</p><ul><li><a href=#prerequisites>Prerequisties</a></li><li><a href=#procedure>Procedure</a></li><li><a href=#example>Example</a></li><li><a href=#build-logs>Build Logs</a></li></ul><h2 id=prerequisites>Prerequisites</h2><p>Before you run the <code>build-spec.sh</code> script, perform the following steps:</p><ul><li>Ensure you have any Linux OS with docker daemon running.</li><li>Place the source and RPM <code>.spec</code> files in the same folder, that is, <code>$WORKDIR</code>.</li></ul><h2 id=procedure>Procedure</h2><p>Run the script. Provide the RPM <code>.spec</code> file name, including absolute or relative path, as argument:</p><pre><code>./photon/tools/scripts/build_spec.sh &lt;$WORKDIR/rpm_spec_file.spec&gt;
</code></pre><p>The RPMs and full build logs are generated in the <code>$WORKDIR/stage</code> folder.</p><h2 id=example>Example</h2><p>The following example runs the script with <code>simple-module.spec</code> as argument, where <code>simple-module.spec</code> is the specification file:</p><pre><code>./photon/tools/scripts/build_spec.sh ~/photon/tools/examples/build_spec/simple-module.spec
</code></pre><p>The following are the contents of the <code>simple-module.spec</code> file:</p><pre><code>Summary:        Simple Linux module
Name:           simple-module
Version:        4.18.9
Release:        5%{?dist}
License:    	GPLv2
Group:        	System Environment/Kernel
Vendor:         VMware, Inc.
Distribution: 	Photon
Source0:        module_example.tar.xz
BuildRequires:  linux-devel = 4.18.9
BuildRequires:  kmod
Requires:       linux = 4.18.9

%description
Example of building linux module for Photon OS

%prep
%setup -q -n module_example

%build
make -C `echo /usr/src/linux-headers-4.18.9*` M=`pwd` VERBOSE=1 modules %{?_smp_mflags}

%install
make -C `echo /usr/src/linux-headers-4.18.9*` M=`pwd` INSTALL_MOD_PATH=%{buildroot} modules_install
# fix permissins to generate non empty debuginfo
find %{buildroot}/lib/modules -name '*.ko' -print0 | xargs -0 chmod u+x

%post
/sbin/depmod -a

%files
%defattr(-,root,root)
/lib/modules/*

</code></pre><h2 id=build-logs>Build Logs</h2><p>The followiing logs indicate the steps that the script performs internally:</p><pre><code>1. Create sandbox
	Use local build template image OK
2. Prepare build environment
	Create source folder OK
	Copy sources from &lt;HOME&gt;/photon/tools/examples/build_spec/simple-module OK
	Install build requirements OK
3. Build
	Run rpmbuild OK
4. Get binaries
	Copy RPMS OK
	Copy SRPMS OK
5. Destroy sandbox
	Stop container OK
	Remove container OK

Build completed. RPMS are in '&lt;HOME&gt;/photon/tools/examples/build_spec/simple-module/stage' folder
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-86c81e0066c56399910447073a8c5e26>4.5 - Running Photon OS on vSphere</h1><p>You can use Photon OS as a virtual machine within VMware vSphere. You can download Photon OS, as an OVA or ISO file, and install the Photon OS distribution on vSphere. After you install Photon OS, you can deploy a containerized application in Docker with a single command.</p><p><strong>Note</strong>: If you want to upgrade an existing Photon 1.0 VM, see the Upgrade to Photon OS 4.0 section.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0574ffce9e6845b458abaf26dc4a2d18>4.5.1 - Prerequisites for Running Photon OS on vSphere</h1><p>Resource requirements and recommendations vary depending on several factors, including the host environment (for example, VMware vSphere and VMware Fusion), the distribution file used (ISO or OVA), and the selected installation settings (for example, full or basic installation).</p><p>Before you use Photon OS within VMware vSphere, perform the following prerequisite tasks:</p><ol><li><p>Verify that you have the following resources:</p><table style=height:170px border=1 width=auto cellspacing=0 cellpadding=10><tbody><tr><td><b>Resource</b></td><td><b>Description</b></td></tr><tr><td>VMware vSphere installed</td><td>VMware web client (v6.5) for ESXi hosts (recommended)<p><b>Note</b>: vSphere 6 and vSphere 5.5 (these clients provide limited support; Not all features are available).</p></td></tr><tr><td>Memory</td><td>ESXi host with 2GB of free RAM (recommended)</td></tr><tr><td>Storage</td><td><b>Minimal Photon install</b>: ESXi host with at least 512MB of free space (minimum); <b>Full Photon install</b>: ESXi host with at least 4GB of free space (minimum); 16GB is recommended; 16GB recommended.</td></tr><tr><td>Distribution File</td><td>Photon OS ISO or OVA file downloaded from [https://packages.vmware.com/photon/](https://packages.vmware.com/photon/).</td></tr></tbody></table><p><strong>Note:</strong> The setup instructions in this guide use VMware vSphere 6 and the vSphere web client.</p></li><li><p>Decide whether to use the OVA or ISO distribution to set up Photon OS.</p><ul><li><strong>OVA import</strong> : Because of the nature of an OVA, you&rsquo;re getting a pre-installed version of Photon OS. You can choose the hardware version you want (OVA with hardware version 13 or 11). The OVA benefits from a simple import process and some kernel tuning for VMware environments. However, because it&rsquo;s a pre-installed version, the set of packages that are installed are predetermined. Any additional packages that you need can be installed using tdnf.</li><li><strong>ISO install</strong> : The ISO, on the other hand, allows for a more complete installation or automated installation via kickstart.</li></ul><p>To get Photon OS up and running quickly, use the OVA.</p></li><li><p>Download Photon OS. Go to the following URL and download the latest release of Photon OS:</p><p><a href=https://packages.vmware.com/photon/>https://packages.vmware.com/photon/</a></p><p>For instructions, see <a href=https://github.com/vmware/photon/wiki/Downloading-Photon-OS>https://github.com/vmware/photon/wiki/Downloading-Photon-OS</a>.</p><p><strong>Note:</strong> For ISO installation, you must upload to a datashare that is attached to the ESXi host, or mount the file share where the ISO resides as a data store.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-5850c535a4ee04f01d28f929938d0aca>4.5.2 - Importing the OVA for Photon OS 4.0</h1><p>Using the OVA is a fast and easy way to create a Photon OS VM on VMware vSphere.</p><p>After you have downloaded the OVA, log in to your vSphere environment and perform the following steps:</p><ol><li><p>Start the Import Process</p><p>From the Actions pull-down menu, choose <strong>Create/Register VM</strong>.</p><p>In the Select creation type window, choose <strong>Deploy a virtual machine from an OVF or OVA file</strong>.</p><p><img src=../../docs/installation-guide/images/vs-iso-new.png alt="Create new virtual machine"></p><p>Choose <strong>Next</strong>.</p></li><li><p>Select the OVA File</p><p>Enter a name for the virtual machine, and select the OVA file.</p><p><img src=../../docs/installation-guide/images/vs-ova-name-selected.png alt="OVA file"></p><p>Choose <strong>Next</strong>.</p></li><li><p>Specify the Target Datastore</p><p>From the Select storage screen, select the target datastore for your VM.</p><p><img src=../../docs/installation-guide/images/vs-ova-storage.png alt="Target datastore"></p><p>Choose <strong>Next</strong>.</p></li><li><p>Accept the License Agreement</p><p>Read through the Photon OS License Agreement, and then choose <strong>I Agree</strong>.</p><p><img src=../../docs/installation-guide/images/vs-ova-license.png alt=License></p><p>Choose <strong>Next</strong>.</p></li><li><p>Select Deployment Options</p><p>Photon OS is provisioned with a maximum disk size. By default, Photon OS uses only the portion of disk space that it needs, usually much less that the entire disk size ( <strong>Thin</strong> client). If you want to pre-allocate the entire disk size (reserving it entirely for Photon OS instead), select <strong>Thick</strong> instead.</p><p><img src=../../docs/installation-guide/images/vs-ova-deployment-options.png alt="Deployment Options"></p><p>Choose <strong>Next</strong>.</p></li><li><p>Verify Deployment Settings</p><p><img src=../../docs/installation-guide/images/vs-ova-settings.png alt="Deployment settings"></p><p>Click <strong>Finish</strong>. vSphere uploads and validates your OVA. Depending on bandwidth, this operation might take a while.</p><p>When finished, vShield powers up a new VM based on your selections.</p></li><li><p>Change Login Settings</p><p><img src=../../docs/installation-guide/images/splashscreen23.png alt="Login prompt"></p><p>After the VM is booted, open the command window. vSphere prompts you to log in.</p><p><strong>Note</strong>: Because of limitations within OVA support on vSphere, it was necessary to specify a default password for the OVA option. However, all Photon OS instances that are created by importing the OVA require an immediate password change upon login. The default account credentials are:</p><pre><code> - Username: ``root``
 - Password: ``changeme``
</code></pre><p>After you provide these credentials, vSphere prompts you to create a new password and type it a second time to verify it.</p><p><strong>Note:</strong> For security, Photon OS forbids common dictionary words for the root password.  </p><p>Once logged in, you will see the shell prompt.</p><p><img src=../../docs/installation-guide/images/vs-ova-login.png alt="Shell prompt"></p><p>Once complete, proceed to <a href=../../docs/installation-guide/deploying-a-containerized-application-in-photon-os/>Deploying a Containerized Application in Photon OS</a>.</p></li><li><p>Export the VM as a Template (Optional)</p><p>Consider converting this imported VM into a template (from the Actions menu, choose <strong>Export</strong> ) so that you have a master Photon OS instance that can be combined with vSphere Guest Customization to enable rapid provisioning of Photon OS instances.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-a7dc4fe0a9a00299ac444c39be809ebc>4.5.3 - Installing the ISO Image for Photon OS 4.0</h1><p>After you download the Photon OS ISO image into a folder of your choice, complete the following steps.</p><ol><li><p>Upload the ISO Image</p><p>Upload the ISO image to a datastore that is attached to the host on which you&rsquo;ll create the Photon OS virtual machine.</p></li><li><p>Create a new VM</p><p>Log in to your vSphere environment. In the Virtual Machines window, choose <strong>Create/Register VM</strong>.</p><p>On the Select creation type screen, select <strong>Create a new virtual machine</strong>.</p><p><img src=../../docs/installation-guide/images/vs-iso-new.png alt="Create new virtual machine"></p><p>Choose <strong>Next</strong>.</p></li><li><p>Configure VM Settings</p><p>Specify a VM name.</p><p><img src=../../docs/installation-guide/images/vs-iso-name.png alt="VM name"></p><p>Specify a guest operating system.</p><ul><li>For Compatibility, select <strong>ESXi 6.7</strong>.</li><li>For Guest OS family, select <strong>Linux</strong>.</li><li>For Guest OS version, select <strong>VMware Photon OS (64-bit)</strong>.</li></ul><p><img src=../../docs/installation-guide/images/guestossettings3.png alt="Guest operating system"></p><p>Choose <strong>Next</strong>.</p></li><li><p>Select the Target Datastore</p><p>Select the datastore where you want to store the VM.</p><p><img src=../../docs/installation-guide/images/storage4.png alt="Target datastore"></p><p>Click <strong>Next</strong>.</p></li><li><p>Customize VM Settings</p><p>Customize the virtual machine settings.</p><p><img src=../../docs/installation-guide/images/settings5.png alt=Settings></p><p>For CD/DVD Drive 1, click the drop-down and select <strong>Datastore ISO file</strong>.</p><p>In the Datastore browser, select the ISO that you want to import.</p><p>Change other settings as applicable.</p><ul><li>The recommended virtual hardware settings for your Photon VM are heavily dependent upon the container load you intend to run within Photon OS – more containers or more intensive containers will require you to adjust these settings for your application load. VMware suggests 2 vCPU, 1024MB memory, 20GB hard disk. Any unwanted devices should be removed. Be sure to mount the Photon OS ISO on the CD/DVD Drive and put a check in the box next to, Connect At Power On.</li><li>If you want to configure a secure boot for the Photon OS VM you created, choose the VM Options tab, expand Boot Options, and select EFI from the firmware drop-down. An EFI boot ensures that the ISO content is signed by VMware and that the entire stack is secure.</li></ul><p>Choose <strong>Next</strong>.</p></li><li><p>Verify VM Settings</p><p>The installer displays a summary of your selected settings.</p><p><img src=../../docs/installation-guide/images/overview6.png alt=Summary></p><p>Click <strong>Finish</strong>. vSphere creates the VM.</p></li><li><p>Power on the VM</p><p>Select the VM and power it on.</p><p><img src=../../docs/installation-guide/images/bootscreen7.png alt="Power on VM"></p><p>When you see the Photon Installer boot menu, press Enter on your keyboard to start installing.</p></li><li><p>Accept the License Agreement</p><p>Read the License Agreement and press the Enter key to accept.</p><p><img src=../../docs/installation-guide/images/license8.png alt="License Agreement"></p></li><li><p>Configure the Partition</p><p>The installer detects one disk, which should be the 16GB volume configured as part of the virtual machine creation. Choose <strong>Auto</strong> to have the installer automatically allocate the partition, or choose <strong>Custom</strong> if you want to configure individual partitions, and then press the Enter key.</p><p><img src=../../docs/installation-guide/images/diskselection9.png alt=Partition></p><p><strong>Note:</strong> If you choose Custom, the installer displays the following screen.</p><p><img src=../../docs/installation-guide/images/manualpartition10.png alt="Custom Partition"></p><p>For each custom partition, choose <strong>Create New</strong> and specify the following information:</p><p><img src=../../docs/installation-guide/images/custompartitionsetting11.png alt="New Partition"></p><p><strong>Size</strong> - Preallocated size of this partition, in MB.</p><p><strong>Type</strong> - One of the following options:</p><ul><li><strong>ext3</strong> - ext3 file system</li><li><strong>ext4</strong> - ext4 file system</li><li><strong>swap</strong> - swap partition</li></ul><p><strong>Mountpoint</strong> - Mount point for this partition.</p><p>Choose <strong>OK</strong> and press the Enter key. When you are done defining custom partitions, choose <strong>Next</strong> and press the Enter key.</p><p>The installer prompts you to confirm that you want to erase the entire disk.</p><p><img src=../../docs/installation-guide/images/erasedisk21.png alt="Erase disk"></p><p>Choose <strong>Yes</strong> and press the Enter key.</p></li><li><p>Select an Installation Option</p><p>After partitioning the disk, the installer prompts you to select an installation option.</p><p><img src=../../docs/installation-guide/images/flavorselection12.png alt="Installation Option"></p><p>Each install option provides a different run-time environment, depending on your requirements.</p><table style=height:170px border=1 cellspacing=0 cellpadding=10><tbody><tr><td><b>Option</b></td><td><b>Description</b></td></tr><tr><td><b>Photon Minimal</b></td><td>Photon Minimum is a very lightweight version of the container host runtime that is best suited for for devices that have limited compute and memory capabilities. There is sufficient packaging and functionality to allow most common operations around modifying existing containers, as well as being a highly performant and full-featured runtime.</p></td></tr><tr><td><b>Photon Developer</b></td><td>Photon Developer includes several additional packages to enhance the authoring and packaging of containerized applications and/or system customization. Use Photon Developer for developing and packaging the application that will be run as a container, as well as authoring the container, itself. For testing and validation purposes, Photon Developer includes all components necessary to run containers.</td></tr><tr><td><b>Photon OSTree Host<b></td><td>This installation profile creates a Photon OS instance that will source its packages from a central rpm-ostree server and continue to have the library and state of packages managed by the definition that is maintained on the central rpm-ostree server.</td></tr><tr><td><b>Photon Real Time<b></td><td>This profile is available only for the x86_64 architecture.</td></tr></tbody></table><p><strong>Note:</strong> The option you choose determines the disk and memory resources required for your installation.</p><p>Select the option you want and press the Enter key.</p></li><li><p>The <strong>Network Configuration</strong> screen appears, select one of the four options to configure your network.</p><p><img src=../../docs/installation-guide//images/networkconfig13.png alt="Network Configuration"></p><ol><li><p>Choose <strong>Configure network automatically</strong> and select <strong>Next</strong> to configure the network automatically.</p></li><li><p>To configure network automatically with the DHCP hostname, select <strong>Configure network automatically with a DHCP hostname</strong> and select <strong>Next</strong>. Enter the DHCP Hostname and select <strong>Next</strong>.
<img src=../../docs/installation-guide/images/dhcphostname14.png alt=../images/DHCP_hostname_for_your_system.png></p></li><li><p>To configure the network manually, select <strong>Configure Network manually</strong>. In the window that appears, enter the IP Address, Netmask, Gateway and Nameserver and select <strong>OK</strong>.
<img src=../../docs/images/Configure_Network_Manually.png alt=../images/Configure_Network_Manually.png></p></li><li><p>If your network interface is directly connected to the VLAN trunk port, choose <strong>YES</strong> on the Configure the network screen. Enter the VLAN ID and select <strong>Next</strong>.
<img src=../../docs/images/Configure_the_network.png alt="Configure the network">.</p></li></ol></li><li><p>Select the Linux Kernel</p><p>Select a Linux kernel to install.</p><p><img src=../../docs/installation-guide/images/linuxflavor17.png alt="Linux Kernel"></p><ul><li><strong>Hypervisor</strong> optimized means that any components that are not needed for running under a VMware hypervisor have been removed for faster boot times.</li><li><strong>Generic</strong> means that all components are included.</li></ul><p>Choose <strong>Next</strong> and press the Enter key.</p></li><li><p>Specify the Hostname</p><p>The installer prompts you for a hostname and suggest a randomly generated, unique hostname that you can change if you want.</p><p><img src=../../docs/installation-guide/images/hostname18.png alt=Hostname></p><p>Press the Enter key.</p></li><li><p>Specify the System root Password</p><p>The installer prompts you to enter the system root password.</p><p><em>Note: Photon OS will not permit commonly used dictionary words to be set as a root password.</em></p><p><img src=../../docs/installation-guide/images/rootpassword19.png alt="Root password"></p><p>Type a password and press the Enter key.</p><p>The installer prompts you to confirm your root password by typing it a second time.</p><p><img src=../../docs/installation-guide/images/confirmrootpassword20.png alt="Password confirmation"></p><p><strong>Note:</strong> If you have trouble with unintentional repeated characters in the Remote Console, follow VMware KB 196 ( <a href=http://kb.vmware.com/kb/196>http://kb.vmware.com/kb/196</a>) for a setting to apply to the virtual machine.</p><p>Press the <code>Enter</code> key. The installer proceeds to install the software. Installation times will vary based on the system hardware and installation options you selected. Most installations complete in less than one minute.</p></li><li><p>Reboot the VM and Log In</p><p>Once finished, the installer displays a confirmation message (which includes how long it took to install Photon OS) and prompts you to press a key on your keyboard to boot the new VM.</p><p><img src=../../docs/installation-guide/images/installationcomplete22.png alt="Boot VM"></p><p>As the initial boot process begins, the installer displays the Photon splash screen, and then a login prompt.</p><p><img src=../../docs/installation-guide/images/splashscreen23.png alt="Login prompt"></p><p>At the login prompt, type <strong>root</strong> as the username and provide the password chosen during the installation.</p><p><img src=../../docs/installation-guide/images/loginprompt24.png alt=Password></p></li></ol><p>You can now use your container runtime environment and deploy a containerized application.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-39867b78caa0d199a4aa2df16555fe0d>4.6 - Running Photon OS on Fusion</h1><p>You can use Photon OS as a virtual machine within VMware Fusion. You can download Photon OS, as an OVA or ISO file, and install the Photon OS distribution on Fusion. After you install Photon OS, you can deploy a containerized application in Docker with a single command.</p><p><strong>Note</strong>: If you want to upgrade an existing Photon 1.0 VM, refer to the instructions in the Upgrading to Photon OS 4.0 section.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-46826b92f418128381d32649220f3d3c>4.6.1 - Prerequisites for Running Photon OS on Fusion</h1><p>Resource requirements and recommendations vary depending on several factors, including the host environment (for example, VMware Fusion and VMware vSphere), the distribution file used (ISO or OVA), and the selected installation settings (for example, full or basic installation).</p><p>Before you use Photon OS within Fusion, perform the following prerequisite tasks:</p><ol><li><p>Verify that you have the following resources:</p><table style=height:170px border=1 width=auto cellspacing=0 cellpadding=10><tbody><tr><td><b>Resource</b></td><td><b>Description</b></td></tr><tr><td>VMware Fusion</td><td>VMware Fusion (v7.0 or higher) must be installed. The latest version (v12) is recommended.</td></tr><tr><td>Memory</td><td>2GB of free RAM (recommended)</td></tr><tr><td>Storage</td><td><b>Minimal Photon install</b> : 512MB of free space (minimum); <b>Full Photon install</b> : 4GB of free space (minimum); 8GB recommended.</td></tr><tr><td>Distribution File</td><td>Photon OS ISO or OVA file downloaded from [https://packages.vmware.com/photon/](https://packages.vmware.com/photon/).</td></tr></tbody></table></br><p><strong>Note:</strong> The setup instructions in this guide use VMware Fusion Professional version 8.5.8, as per the following screenshot.</p><p><img src=../../docs/installation-guide/images/fs-version.png alt="Fusion version"></p></li><li><p>Decide whether to use the OVA or ISO distribution to set up Photon OS.</p><ul><li><strong>OVA import</strong> : Because of the nature of an OVA, you&rsquo;re getting a pre-installed version of Photon OS. You can choose the hardware version you want (OVA with hardware version 13 or 11). The OVA benefits from a simple import process and some kernel tuning for VMware environments. However, because it&rsquo;s a pre-installed version, the set of packages that are installed are predetermined. Any additional packages that you need can be installed using tdnf.</li><li><strong>ISO install</strong> : The ISO, on the other hand, allows for a more complete installation or automated installation via kickstart.</li></ul><p>To get Photon OS up and running quickly, use the OVA.</p></li><li><p>Download Photon OS. Go to the following URL and download the latest release of Photon OS:</p><p><a href=https://packages.vmware.com/photon/>https://packages.vmware.com/photon/</a></p><p>For instructions, see <a href=../../downloading-photon/>Downloading Photon OS</a>.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-d727c054277b44a62d85fd9bf15b1513>4.6.2 - Importing the OVA for Photon OS 4.0</h1><p>Using the OVA is a fast and easy way to create a Photon OS VM on Fusion.</p><p>After you have downloaded the Photon OS OVA image (OVA with Hardware Version 11) into a folder of your choice, open VMware Fusion and perform the following steps:</p><ol><li><p>Start the Import Process</p><p>From the File menu, choose <strong>Import …</strong>. Fusion prompts you to choose an existing virtual machine.</p><p><img src=../../docs/installation-guide/images/fs-ova-import.png alt="Import process"></p><p>Choose the <strong>Choose File …</strong> button to locate and select the Photon OS OVA, then choose <strong>Continue</strong>.</p><p><img src=../../docs/installation-guide/images/fs-ova-selected.png alt="Select OVA "></p></li><li><p>Specify the Name and Storage Location</p><p>Provide the name and storage location for your Photon OS VM, then choose <strong>Save</strong>.</p><p><img src=../../docs/installation-guide/images/fs-ova-name.png alt="Name and storage location"></p><p>Review the Photon OS License Agreement, then choose <strong>Accept</strong> to start the import process.</p><p><img src=../../docs/installation-guide/images/fs-ova-license.png alt=License></p></li><li><p>Configure VM Settings</p><p>After the OVA is imported, Fusion displays a confirmation that the import has completed and a summary of the settings for your Photon OS VM. The following screen shot is an example (your settings may vary).</p><p><img src=../../docs/installation-guide/images/fs-ova-finish.png alt="VM settings"></p><p><strong>Important:</strong> Choose <strong>Customize Settings</strong> to change the operating system (as recognized by the hypervisor) for the newly imported VM.</p><p><img src=../../docs/installation-guide/images/fs-ova-settings.png alt="Custom settings"></p><p>Choose <strong>General</strong>.</p><p>Click the selection box next to <strong>OS</strong>, select <strong>Linux</strong> , and then select <strong>VMware Photon 64-bit</strong>.</p><p><img src=../../docs/installation-guide/images/fs-ova-os.png alt="Operating system"></p><p>Close the settings window. Fusion prompts you to verify that you want to change the operating system.</p><p><img src=../../docs/installation-guide/images/fs-ova-os-confirm.png alt="Confirm settings"></p><p>Click <strong>Change</strong>. Your Photon OS VM is ready to power on.</p></li><li><p>Power on the VM</p><p>Power on the Photon OS VM. Fusion may ask you whether you want to upgrade this VM.</p><p><img src=../../docs/installation-guide/images/fs-ova-upgrade.png alt="Upgrade VM"></p><p>How you respond depends on which hardware version (13 or 11) that you want to use. Upgrade if you need to use devices supported only in hardware version 13. Don&rsquo;t upgrade if you want to be compatible with older tools that are supported in hardware version 11.</p></li><li><p>Update Login Credentials</p><p><img src=../../docs/installation-guide/images/splashscreen23.png alt="Login prompt"></p><p>After the VM is booted, Fusion prompts you to log in.</p><p><strong>Note</strong> : Because of limitations within OVA support on Fusion, it was necessary to specify a default password for the OVA option. However, all Photon OS instances that are created by importing the OVA will require an immediate password change upon login. The default account credentials are:</p><ul><li>Username: <code>root</code></li><li>Password: <code>changeme</code></li></ul><p>After you provide these credentials, Fusion prompts you to create a new password and type it a second time to verify it. For security, Photon OS forbids common dictionary words for the root password. Once logged in, you will see the shell prompt.</p></li></ol><p>Once complete, proceed to <a href=../../deploying-a-containerized-application-in-photon-os/>Deploying a Containerized Application in Photon OS</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e11c39697efefcddc432366210d20744>4.6.3 - Installing the ISO Image for Photon OS 4.0</h1><p>After you have downloaded the latest Photon OS ISO image into a folder of your choice, open VMware Fusion.</p><ol><li><p>Start the Installation Process</p><p>From the File menu, choose <strong>New</strong>.</p><p><img src=../../docs/installation-guide/images/fs-iso-new.png alt=Installation></p><p>From the Select the Installation Method dialog, select <strong>Install from disc or image</strong>, and then choose <strong>Continue</strong>.</p><p><img src=../../docs/installation-guide/images/fs-iso-new-prompt.png alt="Installation method"></p></li><li><p>Select the ISO Image</p><p>Drag a disc image onto the window or choose <strong>Use another disc or disc image&mldr;</strong>, choose the ISO file you want, and then choose <strong>Continue</strong>.</p><p><img src=../../docs/installation-guide/images/fs-iso-new-selected.png alt="ISO image"></p></li><li><p>Select the Operating System</p><p>On the Choose Operating System dialog, select <strong>Linux</strong> in the left-hand column and <strong>VMware Photon 64-bit</strong> in the right-hand column.</p><p><img src=../../docs/installation-guide/images/fs-iso-os.png alt="Operating system"></p><p>Choose <strong>Continue</strong>.</p></li><li><p>Select the Virtual Disk (Optional)</p><p>If you are using a Fusion version that is older than Fusion 8, you might see the following dialog.</p><p><img src=../../docs/installation-guide/images/fs-iso-virtual-disk.png alt="Virtual disk"></p><p>If you see this dialog, unless you&rsquo;re installing into an existing machine, choose <strong>Create a new virtual disk</strong> from the Choose a Virtual Disk dialog, and then choose <strong>Continue</strong>.</p><p><strong>Note:</strong> Fusion v8 and later automatically defaults to creating a new 8GB disk and formats it automatically. If you want to use an existing disk, or if you want to pre-allocate all 8GB, go into VM Settings, choose <strong>Add Device</strong>, and choose either <strong>New Hard Disk</strong> or <strong>Existing Hard Disk</strong>. Expand <strong>Advanced options</strong> and configure whether you want to pre-allocate disk space (disabled by default) or split into multiple files (enabled by default).</p></li><li><p>Configure VM Settings</p><p><strong>Important:</strong> Before you finish creating the Photon OS Virtual Machine, we strongly recommend that you customize the virtual machine and remove any unwanted devices that are not needed for a container run-time environment.</p><p><img src=../../docs/installation-guide/images/fs-iso-finish.png alt="VM settings"></p><p>To remove unnecessary devices, choose <strong>Customize Settings</strong>.</p><p>First, choose a name for your Virtual Machine, along with the folder into which you create the Virtual Machine (or accept the default folder).</p><p><img src=../../docs/installation-guide/images/fs-iso-name.png alt="Custom settings"></p><p>Choose <strong>Save</strong>. The virtual machine will be created. The Settings screen allows you to customize virtual hardware for the new virtual machine. If it does not automatically appear, open <strong>Settings</strong> from the Virtual Machine menu bar.</p><p><img src=../../docs/installation-guide/images/fs-iso-settings.png alt=Settings></p><p>You can remove (recommended) the following components that are not used by Photon OS:</p><ul><li>Select <strong>Display</strong> and ensure that the <strong>Accelerate 3D Graphics</strong> option is unchecked (it should be unchecked, by default). Select <strong>Show All</strong> to return to the VM Settings.</li><li>Select <strong>CD/DVD (IDE)</strong> and ensure that the <strong>Connect CD/DVD Drive</strong> box is checked (it should be checked by default). Select <strong>Show All</strong> to return to the VM Settings.</li><li>Select <strong>Sound Card</strong>, un-check the <strong>Connect Sound Card</strong> Option, and click <strong>Remove Sound Card.</strong> Choose <strong>Remove</strong> to confirm your action. Select <strong>Show All</strong> to return to the VM Settings.</li><li>Select <strong>USB & Bluetooth</strong> and uncheck the <strong>Share Bluetooth devices with Linux</strong> setting. Select <strong>Show All</strong> to return to the VM Settings.</li><li>Select <strong>Printer</strong> and press the <strong>Remove Printer Port</strong> button in the bottom left hand corner. Choose <strong>Remove</strong> to confirm your action. Select <strong>Show All</strong> to return to the VM Settings.</li><li>Select <strong>Camera</strong> and press the <strong>Remove Camera</strong> button in the bottom left hand corner. Choose <strong>Remove</strong> to confirm your action. Select <strong>Show All</strong> to return to the VM Settings.</li><li>Select <strong>Advanced</strong> and ensure that the <strong>Pass Power Status to VM</strong> option is unchecked (it should be unchecked, by default). Select <strong>Show All,</strong> but do not close the VM Settings window.</li></ul><p>By default, Photon OS is configured with a disk size of 8GB. However, Photon OS uses only the portion of disk space it needs, usually much less that the entire disk size. If you want to pre-allocate the entire disk size (reserving it entirely for Photon OS instead), select <strong>Hard Disk</strong>, expand <strong>Advanced options</strong>, and check <strong>Pre-allocate disk space</strong> (by default, it is unchecked). Select <strong>Show All</strong> to return to the VM Settings.</p></li><li><p>Configure a Secure Boot (Optional)</p><p><strong>Note:</strong> If you want to configure a secure boot for the Photon OS VM you created, edit its .vmx file and add the following line:</p><p><strong>firmware = &ldquo;efi&rdquo;</strong></p><p>The EFI boot ensures that the ISO content is signed by VMware and that the entire stack is secure.</p><p>After you have made the customizations you want, close the Virtual Machine Settings window. You are now ready to boot and begin the installation process.</p></li><li><p>Power On the VM</p><p>Return to the Fusion main menu, select the Photon OS Virtual Machine, and click <strong>Start Up</strong> (you can also choose <strong>Start Up</strong> from the Virtual Machine menu).</p><p>Fusion powers on the host and starts the installation. Within a few seconds, Fusion displays the Photon OS installer boot menu.</p><p><img src=../../docs/installation-guide/images/bootscreen7.png alt="Photon OS installer"></p><p>Press the Enter key on your keyboard to start installing.</p><p><img src=../../docs/installation-guide/images/license8.png alt=License></p><p>Read the License Agreement and press the Enter key to accept.</p></li><li><p>Configure the Partition</p><p>The Installer will detect one disk, which should be the 8GB volume configured as part of the virtual machine creation.</p><p><img src=../../docs/installation-guide/images/diskselection9.png alt=Partition></p><p>Choose <strong>Auto</strong> to have the installer automatically allocate the partition, or choose <strong>Custom</strong> if you want to configure individual partitions, and then press the Enter key.</p><p><strong>Note:</strong> If you choose <strong>Custom</strong>, the installer displays the following screen.</p><p><img src=../../docs/installation-guide/images/manualpartition10.png alt="Custom partition"></p><p>For each custom partition, choose <strong>Create New</strong> and specify the following information:</p><p><img src=../../docs/installation-guide/images/custompartitionsetting11.png alt="New partition"></p><p><strong>Size</strong> - Preallocated size of this partition, in MB.</p><p><strong>Type</strong> - One of the following options:</p><ul><li><strong>ext3</strong> - ext3 file system</li><li><strong>ext4</strong> - ext4 file system</li><li><strong>swap</strong> - swap partition</li></ul><p><strong>Mountpoint</strong> - Mount point for this partition.</p><p>Choose <strong>OK</strong> and press the Enter key. When you are done defining custom partitions, choose <strong>Next</strong> and press the Enter key.</p><p>The installer prompts you to confirm that you want to erase the entire disk.</p><p><img src=../../docs/installation-guide/images/erasedisk21.png alt="Disk erase"></p><p>Choose <strong>Yes</strong> and press the Enter key to accept and proceed with the installation.</p></li><li><p>Select an Installation Option</p><p>After partitioning, the installer prompts you to select one of three installation options:</p><p><img src=../../docs/installation-guide/images/flavorselection12.png alt="Installation options"></p><p>Each install option provides a different run-time environment. Select the option that best meets your requirements.</p><table style=height:170px border=1 cellspacing=0 cellpadding=10 width=auto><tbody><tr><td><img width=350px><b>Option</b></td><td><b>Description</b></td></tr><tr><td><b>Photon Minimal</b></td><td>Photon Minimum is a very lightweight version of the container host runtime that is best suited for container management and hosting. There is sufficient packaging and functionality to allow most common operations around modifying existing containers, as well as being a highly performant and full-featured runtime.</p></td></tr><tr><td><b>Photon Full</b></td><td>Photon Full includes several additional packages to enhance the authoring and packaging of containerized applications and/or system customization. For simply running containers, Photon Full will be overkill. Use Photon Full for developing and packaging the application that will be run as a container, as well as authoring the container, itself. For testing and validation purposes, Photon Full will include all components necessary to run containers.</td></tr><tr><td><b>Photon OSTree Server<b></td><td>This installation profile will create the server instance that will host the filesystem tree and managed definitions for rpm-ostree managed hosts created with the "Photon OSTree Host" installation profile. Most environments should need only one Photon OSTree Server instance to manage the state of the Photon OSTree Hosts. Use Photon OSTree Server when you are establishing a new repository and management node for Photon OS hosts.</td></tr></tbody></table><p><strong>Note:</strong> The option you choose determines the disk and memory resources required for your installation.</p><p>Select the option you want and press the Enter key.</p></li><li><p>The <strong>Network Configuration</strong> screen appears, select one of the four options to configure your network.
<img src=../../docs/images/networkconfig13.png alt="Network Sonfiguration"></p><ol><li><p>Choose <strong>Configure network automatically</strong> and select <strong>Next</strong> to configure the network automatically.</p></li><li><p>To configure network automatically with the DHCP hostname, select <strong>Configure network automatically with a DHCP hostname</strong> and select <strong>Next</strong>. Enter the DHCP Hostname and select <strong>Next</strong>.
<img src=../../docs/installation-guide/images/dhcphostname14.png alt=../images/DHCP_hostname_for_your_system.png></p></li><li><p>To configure the network manually, select <strong>Configure Network manually</strong>. In the window that appears, enter the IP Address, Netmask, Gateway and Nameserver and select <strong>OK</strong>.
<img src=../../docs/images/Configure_Network_Manually.png alt=../images/Configure_Network_Manually.png></p></li><li><p>If your network interface is directly connected to the VLAN trunk port, choose <strong>YES</strong> on the Configure the network screen. Enter the VLAN ID and select <strong>Next</strong>.
<img src=../../docs/images/Configure_the_network.png alt="Configure the network">.</p></li></ol></li><li><p>Select the Linux Kernel</p><p>The installer prompts you to select the Linux kernel to install:</p><p><img src=../../docs/installation-guide/images/linuxflavor17.png alt="Linux kernel"></p><ul><li><strong>Hypervisor optimized</strong> means that any components that are not needed for running under a VMware hypervisor have been removed for faster boot times.</li><li><strong>Generic</strong> means that all components are included.</li></ul></li><li><p>Specify the Hostname</p><p>The installer prompts you for a hostname and suggest a randomly generated, unique hostname that you can change if you want.</p><p><img src=../../docs/installation-guide/images/hostname18.png alt=Hostname></p><p>Press the Enter key.</p></li><li><p>Specify the System root Password</p><p><em>Note: Photon OS will not permit commonly used dictionary words to be set as a root password.</em></p><p>The installer prompts you to enter the system root password. Type the password, and then press the Enter key.</p><p><img src=../../docs/installation-guide/images/rootpassword19.png alt=Password></p><p>Confirm the root password by typing it a second time.</p><p><img src=../../docs/installation-guide/images/confirmrootpassword20.png alt="Password confirmation"></p><p>Press the Enter key. The installer proceeds to install the software. Installation times will vary based on the system hardware and installation options you selected. Most installations complete in less than one minute.</p><p>Once finished, the installer displays a confirmation message (which includes how long it took to install Photon OS) and prompts you to press a key on your keyboard to boot the new VM.</p><p><img src=../../docs/installation-guide/images/installationcomplete22.png alt=Confirmation></p></li><li><p>Reboot the VM and Log In</p><p>Press any key on the keyboard and the virtual machine will reboot into Photon OS.</p><p><img src=../../docs/installation-guide/images/splashscreen23.png alt=Reboot></p><p>As the initial boot process begins, the installer displays the Photon splash screen, and then a login prompt.</p><p>At the login prompt, enter <strong>root</strong> as the username and provide the password chosen during the installation.</p><p><img src=../../docs/installation-guide/images/loginprompt24.png alt=Password></p></li></ol><p>You can now use your container runtime environment and deploy a containerized application.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-5a7a1ecb093e3902032d62824c159def>4.7 - Running Photon OS on Workstation</h1><p>You can use Photon OS as a virtual machine within VMware Workstation. You can download Photon OS, as an OVA or ISO file, and install the Photon OS distribution on vSphere. After you install Photon OS, you can deploy a containerized application in Docker with a single command.</p><p><strong>Note</strong>: If you want to upgrade an existing Photon 1.0 VM, refer to the instructions in the Upgrading to Photon OS 4.0 section.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-739bea0a866a6cf4a71dd605cf66a49f>4.7.1 - Prerequisites for Running Photon OS on Workstation</h1><p>Before you use Photon OS within Workstation, perform the following prerequisite tasks:</p><ol><li><p>Verify that you have the following resources:</p><table style=height:170px border=1 width=auto cellspacing=0 cellpadding=10><tbody><tr><td><b>Resource</b></td><td><b>Description</b></td></tr><tr><td>VMware Workstation</td><td>VMware Workstation must be installed (Workstation 10 or higher). The latest version is recommended.</p></td></tr><tr><td>Memory</td><td>2GB of free RAM (recommended)</td></tr><tr><td>Storage</td><td><b>Minimal Photon install</b>: 512MB of free space (minimum); <b>Full Photon install</b>: 4GB of free space (minimum); 8GB is recommended.</td></tr><tr><td>Distribution File</td><td>Photon OS ISO or OVA file downloaded from VMware (<a href=https://packages.vmware.com/photon/4.0/GA/>https://packages.vmware.com/photon/4.0/GA/</a>).</td></tr></tbody></table></br><p>Resource requirements and recommendations vary depending on several factors, including the host environment (for example, VMware Workstation and VMware vSphere), the distribution file used (ISO or OVA), and the selected installation settings (for example, full or basic installation).</p><p><strong>Note:</strong> The setup instructions in this guide use VMware Workstation Professional version 12.5.7.</p><p><img src=../../docs/installation-guide/images/ws_version.png alt="Workstation version"></p></li><li><p>Decide whether to use the OVA or ISO distribution to set up Photon OS.</p></li></ol><ul><li><p><strong>OVA import</strong> : Because of the nature of an OVA, you&rsquo;re getting a pre-installed version of Photon OS. You can choose the hardware version you want (OVA with hardware version 13 or 11). The OVA benefits from a simple import process and some kernel tuning for VMware environments. However, because it&rsquo;s a pre-installed version, the set of packages that are installed are predetermined. Any additional packages that you need can be installed using tdnf.</p></li><li><p><strong>ISO install</strong> : The ISO, on the other hand, allows for a more complete installation or automated installation via kickstart.</p></li></ul><p>To get Photon OS up and running quickly, use the OVA.</p><ol><li><p>Download Photon OS. Go to the following URL and download the latest release of Photon OS:</p><p><a href=https://packages.vmware.com/photon/4.0/GA/>https://packages.vmware.com/photon/4.0/GA/</a></p><p>For instructions, see <a href=../../docs/installation-guide/downloading-photon/>Downloading Photon OS</a>.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-3d45c79839e9d9488f2251ad6c2dea10>4.7.2 - Importing the OVA for Photon OS 4.0</h1><p>Using the OVA is the easiest way to create a Photon OS VM on VMware Workstation.</p><p>After you have downloaded the the OVA file (OVA with Hardware Version 11), perform the following steps:</p><ol><li><p>Start the Import Process</p><ul><li>Double-click it to start the import process, or</li><li>Start VMware Workstation and, from the File menu, choose <strong>Open</strong>.</li></ul><p><img src=../../docs/installation-guide/images/ws-ova-import.png alt="OVA file"></p></li><li><p>Specify the Name and Storage Location</p><p>Change the name and storage location, if you want.</p><p><img src=../../docs/installation-guide/images/ws-ova-path.png alt="Name and Storage Location"></p><p>Choose <strong>Import</strong>.</p><p><img src=../../docs/installation-guide/images/ws-ova-license.png alt=License></p><p>Review the License Agreement and choose <strong>Accept</strong>.</p></li><li><p>Configure VM Settings</p><p>Once the OVA is imported, Workstation displays a summary of the settings for your Photon OS VM.</p><p><img src=../../docs/installation-guide/images/ws-ova-settings.png alt=Settings></p><p>Choose <strong>Edit virtual machine settings</strong>. Workstation displays the Virtual Machine settings. You can either accept the defaults or change settings as needed.</p><p><img src=../../docs/installation-guide/images/ws-ova-settings-edit.png alt="OVA settings"></p><p>Select the Options tab.</p><p><img src=../../docs/installation-guide/images/ws-ova-settings-options.png alt=Options></p><p>Under Guest operating system, select <strong>Linux</strong>.</p><p>For Version, click the list and select <strong>VMWare Photon 64-bit</strong>.</p><p><img src=../../docs/installation-guide/images/ws-ova-os.png alt=Version></p><p><strong>Note:</strong> If you want to configure a secure boot for the Photon OS VM, select <strong>Advanced</strong> and select (check) <strong>Boot with EFI instead of BIOS</strong>. The EFI boot ensures that the ISO content is signed by VMware and that the entire stack is secure.</p><p><img src=../../docs/installation-guide/images/ws-ova-settings-efi.png alt="EFI boot"></p><p>Choose <strong>OK</strong>.</p></li><li><p>Power on the VM</p><p>From the tab, choose <strong>Power on this virtual machine</strong>.</p><p><img src=../../docs/installation-guide/images/splashscreen23.png alt="Login prompt"></p><p>After the splash screen, Workstation will prompt you to log in.</p></li><li><p>Update Login Credentials</p><p><strong>Note</strong> : Because of limitations within OVA support on Workstation, it was necessary to specify a default password for the OVA option. However, all Photon OS instances that are created by importing the OVA will require an immediate password change upon login. The default account credentials are:</p><ul><li>Username: <code>root</code></li><li>Password: <code>changeme</code></li></ul><p>After you provide these credentials, Workstation prompts you to create a new password and type it a second time to verify it. For security, Photon OS forbids common dictionary words for the root password. Once logged in, you will see the shell prompt.</p><p>Once complete, proceed to <a href=../../docs/installation-guide/deploying-a-containerized-application-in-photon-os/>Deploying a Containerized Application in Photon OS</a>.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-f539c9ffb01773e1b86948893a63693a>4.7.3 - Installing the ISO Image for Photon OS 4.0</h1><p>After you have downloaded the latest Photon OS ISO image into a folder of your choice, open VMware Workstation.</p><ol><li><p>Start the Installation Process</p><p>From the File menu, choose <strong>New Virtual Machine</strong> to create a new virtual machine.</p><p><img src=../../docs/installation-guide/images/ws-iso-new.png alt="New virtural machine"></p><p>Select <strong>Typical</strong> or <strong>Custom</strong>, and then choose <strong>Next</strong>. These instructions refer to a Typical installation.</p><p><img src=../../docs/installation-guide/images/ws-iso-typical.png alt="Typical installation"></p></li><li><p>Select the ISO Image</p><p>Select <strong>Installer disc image file (iso)</strong>, choose <strong>Browse</strong> and select the Photon OS ISO file.</p><p><img src=../../docs/installation-guide/images/ws-iso-selected.png alt="Photon ISO file"></p></li><li><p>Select the Operating System</p><p>Choose <strong>Next</strong>. Select the Guest operating system.</p><p>For the Guest operating system, select <strong>Linux</strong>.</p><p>Click the Version dropdown and select <strong>VMware Photon 64-bit</strong> from the list.</p><p><img src=../../docs/installation-guide/images/ws-iso-os.png alt="Operating System"></p></li><li><p>Specify the VM Name and Location</p><p>Choose <strong>Next</strong>. Specify a virtual machine name and location.</p><p><img src=../../docs/installation-guide/images/ws-iso-name.png alt="VM Name and Location"></p></li><li><p>Specify Disk Options</p><p>Choose <strong>Next</strong>. Specify the maximum disk size and whether you want to split the virtual disk into multiple files or store it as a single file.</p><p><img src=../../docs/installation-guide/images/ws-iso-disk.png alt="Disk options"></p></li><li><p>Configure VM Settings</p><p>Choose <strong>Next</strong>. Workstation displays a summary of your selections.</p><p><img src=../../docs/installation-guide/images/ws-iso-summary.png alt="Workstation settings"></p><p><strong>Important</strong> : <em>Before</em> you finish creating the Photon OS Virtual Machine, we strongly recommend that you customize the virtual machine and remove any unwanted devices that are not needed for a container run-time environment. To remove unnecessary devices, choose <strong>Customize hardware</strong>.</p><p><img src=../../docs/installation-guide/images/ws-iso-customize.png alt="Customize hardware"></p><p>Consider removing the following components, which are not used by Photon OS:</p><ul><li>Select <strong>Sound Card</strong>, un-tick the <strong>Connect at power on</strong> option. Confirm your action and choose <strong>Close</strong> to return to the VM Settings by .</li><li>Select <strong>USB Controller</strong> and ensure that the <strong>Share Bluetooth devices with the virtual machine</strong> setting is unchecked (it should be unchecked, by default) and then choose <strong>Close</strong>.</li><li>Select <strong>Display</strong> and ensure that the <strong>Accelerate 3D Graphics</strong> option is unchecked (it should be unchecked, by default) and then choose <strong>Close</strong>.</li><li>At this stage we have now made all the necessary customizations and you are ready to select the Photon OS ISO image to boot and begin the installation process.</li><li>Choose <strong>Finish</strong>.</li></ul><p>In Workstation, choose <strong>Edit virtual machine settings</strong>, select <strong>CD/DVD (IDE)</strong>, and verify that <strong>Connect at power on</strong> is selected.</p><p><img src=../../docs/installation-guide/images/ws-iso-cd.png alt=CD/DVD></p></li><li><p>Configure a Secure Boot (Optional)</p><p><strong>Note:</strong> If you want to configure a secure boot for the Photon OS VM, in Workstation, choose <strong>Edit virtual machine settings</strong>, select <strong>Options</strong>, choose <strong>Advanced</strong>, and select <strong>Boot with EFI instead of BIOS</strong>.</p><p><img src=../../docs/installation-guide/images/ws-iso-efi.png alt="Boot with EFI"></p><p>The EFI boot ensures that the ISO content is signed by VMware and that the entire stack is secure.</p><p>Choose <strong>OK</strong>.</p><p><img src=../../docs/installation-guide/images/ws-iso-settings.png alt="ISO settings"></p></li><li><p>Power On the VM</p><p>Choose <strong>Power on this virtual machine</strong>.</p><p>When you see the Photon Installer boot menu, press Enter on your keyboard to start installing.</p><p><img src=../../docs/installation-guide/images/bootscreen7.png alt=Installer></p><p>Review the license agreement.</p><p><img src=../../docs/installation-guide/images/license8.png alt="License agreement"></p><p>Choose <strong>Accept</strong> and press Enter.</p></li><li><p>Configure the Partition</p><p>The installer will detect one disk, which should be the 8GB volume configured as part of the virtual machine creation. Choose <strong>Auto</strong> to have the installer automatically allocate the partition, or choose <strong>Custom</strong> if you want to configure individual partitions, and then press the Enter key.</p><p><img src=../../docs/installation-guide/images/diskselection9.png alt=Partition></p><p><strong>Note:</strong> If you choose Custom, the installer displays the following screen.</p><p><img src=../../docs/installation-guide/images/manualpartition10.png alt="Custom Partition"></p><p>For each custom partition, choose <strong>Create New</strong> and specify the following information:</p><p><img src=../../docs/installation-guide/images/custompartitionsetting11.png alt="New Partition"></p><p><strong>Size</strong> - Preallocated size of this partition, in MB.</p><p><strong>Type</strong> - One of the following options:</p><ul><li><strong>ext3</strong> - ext3 file system</li><li><strong>ext4</strong> - ext4 file system</li><li><strong>swap</strong> - swap partition</li></ul><p><strong>Mountpoint</strong> - Mount point for this partition.</p><p>Choose <strong>OK</strong> and press the Enter key. When you are done defining custom partitions, choose <strong>Next</strong> and press the Enter key.</p><p>The installer prompts you to confirm that you want to erase the entire disk. Choose <strong>Yes</strong> and press the Enter key.</p><p><img src=../../docs/installation-guide/images/erasedisk21.png alt="Erase disk"></p></li><li><p>Select an Installation Option</p><p>After partitioning the disk, the installer will prompt you to select an installation option.</p><p><img src=../../docs/installation-guide/images/flavorselection12.png alt="Installation Option"></p><p>Each installation option provides a different run-time environment, depending on your requirements.</p><table style=height:170px border=1 width=auto cellspacing=0 cellpadding=10><tbody><tr><td><b>Option</b></td><td><b>Description</b></td></tr><tr><td><b>Photon Minimal</b></td><td>Photon Minimum is a very lightweight version of the container host runtime that is best suited for container management and hosting. There is sufficient packaging and functionality to allow most common operations around modifying existing containers, as well as being a highly performant and full-featured runtime.</p></td></tr><tr><td><b>Photon Full</b></td><td>Photon Full includes several additional packages to enhance the authoring and packaging of containerized applications and/or system customization. For simply running containers, Photon Full will be overkill. Use Photon Full for developing and packaging the application that will be run as a container, as well as authoring the container, itself. For testing and validation purposes, Photon Full will include all components necessary to run containers.</td></tr><tr><td><b>Photon OSTree Server<b></td><td>This installation profile will create the server instance that will host the filesystem tree and managed definitions for rpm-ostree managed hosts created with the "Photon OSTree Host" installation profile. Most environments should need only one Photon OSTree Server instance to manage the state of the Photon OSTree Hosts. Use Photon OSTree Server when you are establishing a new repository and management node for Photon OS hosts.</td></tr></tbody></table><p><strong>Note:</strong> The option you choose determines the disk and memory resources required for your installation.</p><p>Select the option you want and press the Enter key.</p></li><li><p>The <strong>Network Configuration</strong> screen appears, select one of the four options to configure your network.
<img src=../../docs/installation-guide/images/networkconfig13.png alt="Network Sonfiguration"></p><ol><li><p>Choose <strong>Configure network automatically</strong> and select <strong>Next</strong> to configure the network automatically.</p></li><li><p>To configure network automatically with the DHCP hostname, select <strong>Configure network automatically with a DHCP hostname</strong> and select <strong>Next</strong>. Enter the DHCP Hostname and select <strong>Next</strong>.
<img src=../../docs/installation-guide/images/dhcphostname14.png alt=../images/DHCP_hostname_for_your_system.png></p></li><li><p>To configure the network manually, select <strong>Configure Network manually</strong>. In the window that appears, enter the IP Address, Netmask, Gateway and Nameserver and select <strong>OK</strong>.
<img src=../../docs/images/Configure_Network_Manually.png alt=../images/Configure_Network_Manually.png></p></li><li><p>If your network interface is directly connected to the VLAN trunk port, choose <strong>YES</strong> on the Configure the network screen. Enter the VLAN ID and select <strong>Next</strong>.
<img src=../../docs/images/Configure_the_network.png alt="Configure the network">.</p></li></ol></li><li><p>Select the Linux Kernel</p><p>Select a Linux kernel to install.</p><p><img src=../../docs/installation-guide/images/linuxflavor17.png alt="Linux Kernel"></p><ul><li><strong>Hypervisor optimized</strong> means that any components that are not needed for running under a VMware hypervisor have been removed for faster boot times.</li><li><strong>Generic</strong> means that all components are included.</li></ul><p>Choose <strong>Next</strong> and press the Enter key.</p></li><li><p>Specify the Hostname</p><p>The installer prompts you for a hostname and suggest a randomly generated, unique hostname that you can change if you want.</p><p><img src=../../docs/installation-guide/images/hostname18.png alt=Hostname></p><p>Press the Enter key.</p></li><li><p>Specify the System root Password</p><p><strong><em>Note</em></strong> <em>: Photon OS will not permit commonly used dictionary words to be set as a root password.</em></p><p>The installer prompts you to enter the system root password. Type the password and press the Enter key.</p><p><img src=../../docs/installation-guide/images/rootpassword19.png alt="Root password"></p><p>The installer prompts you to confirm the root password by typing it a second time.</p><p><img src=../../docs/installation-guide/images/confirmrootpassword20.png alt="Password confirmation"></p><p>Press the Enter key. The installer proceeds to install the software. Installation times will vary based on the system hardware and installation options you selected. Most installations complete in less than one minute.</p></li><li><p>Reboot the VM and Log In</p><p>Once finished, the installer displays a confirmation message (which includes how long it took to install Photon OS) and prompts you to press a key on your keyboard to boot the new VM.</p><p><img src=../../docs/installation-guide/images/installationcomplete22.png alt="Boot VM"></p><p>Press any key on the keyboard and the virtual machine will reboot into Photon OS.</p><p>As the initial boot process begins, the installer displays the Photon splash screen, and then a login prompt.</p><p><img src=../../docs/installation-guide/images/splashscreen23.png alt="Login prompt"></p><p>At the login prompt, type <strong>root</strong> as the username and provide the password chosen during the installation.</p><p><img src=../../docs/installation-guide/images/loginprompt24.png alt=Password></p></li></ol><p>You can now use your container runtime environment and deploy a containerized application.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-535d80257a605affbcfa3cd7f4b405c7>4.8 - Running Photon OS on Amazon Elastic Cloud Compute</h1><p>You can set up Photon OS on Amazon Web Services Elastic Cloud Compute (EC2), customize it with cloud-init, connect to it with SSH.</p><p>After you set up Photon OS, you can run a containerized application.</p></div><div class=td-content><h1 id=pg-7e44b1d49947e5e0f228af5c2d22a820>4.8.1 - Prerequisites for Running Photon OS on AWS EC2</h1><p>Before you use Photon OS with Amazon Elastic Cloud Compute(AWS EC2), perform the following prerequisite tasks:</p><ol><li><p>Verify that you have the following resources:</p><ul><li><strong>AWS account</strong>. Working with EC2 requires an Amazon account for AWS with valid payment information. Keep in mind that, if you try the examples in this document, you will be charged by Amazon. See <a href=http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/get-set-up-for-amazon-ec2.html>Setting Up with Amazon EC2</a>.</li><li><strong>Amazon tools</strong>. The following examples also assume that you have installed and configured the Amazon AWS CLI and the EC2 CLI and AMI tools, including ec2-ami-tools.</li></ul><p>For more information, see <a href=http://docs.aws.amazon.com/cli/latest/userguide/installing.html>Installing the AWS Command Line Interface</a>, <a href=http://docs.aws.amazon.com/AWSEC2/latest/CommandLineReference/set-up-ec2-cli-linux.html>Setting Up the Amazon EC2 Command Line Interface Tools on Linux</a>, and <a href=http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html>Configuring AWS Command-Line Interface</a>. Also see <a href=http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/set-up-ami-tools.html>Setting Up the AMI Tools</a>.</p><p>The procedure in this section uses an Ubuntu 14.04 workstation to generate the keys and certificates that AWS requires.</p></li><li><p>Download the Photon OS image for Amazon.</p><p>VMware packages Photon OS as a cloud-ready Amazon machine image (AMI) that you can download for free from <a href=https://packages.vmware.com/photon/>https://packages.vmware.com/photon/</a>.</p><p>Download the Photon OS AMI and save it on your workstation. For more infromation, see <a href=../../downloading-photon/>Downloading Photon OS</a>.</p><p><strong>Note</strong>: The AMI version of Photon is a virtual appliance with the information and packages that Amazon needs to launch an instance of Photon in the cloud. To build the AMI version, VMware starts with the minimal version of Photon OS and adds the sudo and tar packages to it.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-13bdc4e2d439d9398ab01daeeb4bb1ec>4.8.2 - Set Up Photon OS on EC2</h1><p>To run Photon OS on EC2, you must use cloud-init with an EC2 data source. The cloud-init service configures the cloud instance of a Linux image. An <em>instance</em> is a virtual server in the Amazon cloud.</p><p>The examples in this section show how to generate SSH and RSA keys for your Photon instance, upload the Photon OS <code>.ami</code> image to the Amazon cloud, and configure it with cloud-init. In the examples, replace information with your own paths, account details, or other information from Amazon.</p><p>Perform the following steps to set up Photon OS on EC2</p><ol><li><p>Create a key pair.</p><p>Generate SSH keys on, for instance, an Ubuntu workstation:</p><pre><code>ssh-keygen -f ~/.ssh/mykeypair
</code></pre><p>The command generates a public key in the file with a <code>.pub</code> extension and a private key in a file with no extension. Keep the private key file and remember the name of your key pair. The name is the file name of the two files without an extension. You will need the name later to connect to the Photon instance.</p><p>Change the mode bits of the public key pair file to protect its security. In the command, include the path to the file if you need to.</p><pre><code>chmod 600 mykeypair.pub
</code></pre><p>Change the mode bits on your private key pair file so that only you can view it:</p><pre><code>chmod 400 mykeypair
</code></pre><p>To import your public key pair file, but not your private key pair file, connect to the EC2 console at <a href=https://console.aws.amazon.com/ec2/>https://console.aws.amazon.com/ec2/</a> and select the region for the key pair. A key pair works only in one region, and the instance of Photon OS that will be uploaded later must be in the same region as the key pair. Select <code>key pairs</code> under <code>Network & Security</code>, and then import the public key pair file that you generated earlier.</p><p>For more information, see <a href=http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html#how-to-generate-your-own-key-and-import-it-to-aws>Importing Your Own Key Pair to Amazon EC2</a>.</p></li><li><p>Generate a certificate.</p><p>When you bundle up an image for EC2, Amazon requires an RSA user signing certificate. You create the certificate by using openssl to first generate a private RSA key and then to generate the RSA certificate that references the private RSA key. Amazon uses the pairing of the private key and the user signing certificate for handshake verification.</p><ol><li><p>On Ubuntu 14.04 or another workstation that includes <code>openssl</code>, run the following command to generate a private key. If you change the name of the key, keep in mind that you will need to include the name of the key in the next command, which generates the certificate.</p><pre><code></code></pre></li></ol><p>openssl genrsa 2048 > myprivatersakey.pem</p><pre><code>  
    Make a note of your private key as you will need it again later. 
   
1. Run the following command to generate the certificate. The command prompts you to provide more information, but because you are generating a user signing certificate, not a server certificate, you can just type `Enter` for each prompt to leave all the fields blank.
       
    ```
</code></pre></li></ol><p>openssl req -new -x509 -nodes -sha256 -days 365 -key myprivatersakey.pem -outform PEM -out certificate.pem</p><pre><code>   
        For more information, see the Create a Private Key and the Create the User Signing Certificate sections of [Setting Up the AMI Tools](http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/set-up-ami-tools.html#ami-upload-bundle).
    
     1. Upload to AWS the certificate value from the `certificate.pem` file that you created in the previous command. Go to the Identity and Access Management console at https://console.aws.amazon.com/iam/, navigate to the name of your user, open the `Security Credentials` section, click `Manage Signing Certificates`, and then click `Upload Signing Certificate`. Open `certificate.pem` in a text editor, copy and paste the contents of the file into the `Certificate Body` field, and then click `Upload Signing Certificate`.
    
    For more information, see the Upload the User Signing Certificate section of [Setting Up the AMI Tools](http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/set-up-ami-tools.html#ami-upload-bundle).

1. Create a security group.

    Create a security group and set it to allow SSH, HTTP, and HTTPS connections over ports 22, 80, and 443, respectively.
    Connect to the EC2 command-line interface and run the following commands: 
    
    	aws ec2 create-security-group --group-name photon-sg --description &quot;My Photon security group&quot;
    	{
    	    &quot;GroupId&quot;: &quot;sg-d027efb4&quot;
    	}
    	aws ec2 authorize-security-group-ingress --group-name photon-sg --protocol tcp --port 22 --cidr 0.0.0.0/0
    
    Make a note of the `GroupId` that is returned by EC2 as you will need it again later.
    
    By using `0.0.0.0/0` for SSH ingress on Port 22, you open the port to all IP addresses--which is not a security best practice but a convenience for the examples in this article. For a production instance or other instances that are anything more than temporary machines, you must authorize only a specific IP address or range of addresses. For more information, see [Authorizing Inbound Traffic for Linux Instances](http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/authorizing-access-to-an-instance.html).
    
    Repeat the command to allow incoming traffic on Port 80 and on Port 443: 
    
    	aws ec2 authorize-security-group-ingress --group-name photon-sg --protocol tcp --port 80 --cidr 0.0.0.0/0
    
    	aws ec2 authorize-security-group-ingress --group-name photon-sg --protocol tcp --port 443 --cidr 0.0.0.0/0
    
    Check your update: 
    
    	aws ec2 describe-security-groups --group-names photon-sg

1. Extract the tarball.

    Make a directory to store the image and then extract the Photon OS image from its archive by running the following `tar` command. If required, change the file name to match the version you have.    
    
    	mkdir bundled
    	tar -zxvf ./photon-ami.tar.gz

1. Bundle the image.

    Run the `ec2-bundle-image` command to create an instance store-backed Linux AMI from the Photon OS image that you extracted in the previous step. The result of the `ec2-bundle-image` command is a manifest that describes the machine in an XML file. 
    
    The command uses the certificate path to your PEM-encoded RSA public key certificate file, the path to your PEM-encoded RSA private key file, your EC2 user account ID; the correct architecture for Photon OS, the path to the Photon OS AMI image extracted from its tar file, and the `bundled` directory from the previous step. 
    
    Replace the values of the certificate path, the private key, and the user account with your own values.
    
    	$ ec2-bundle-image --cert certificate.pem --privatekey myprivatersakey.pem --user &lt;EC2 account id&gt;  --arch x86_64 --image photon-ami.raw --destination ./bundled/

1. Put the bundle in a bucket.

    Make an S3 bucket, replacing `&lt;bucket-name&gt;` with the name that you want. The command creates the bucket in the region specified in your Amazon configuration file, which should be the same region in which you are using your key pair file: 
    
    	$ aws s3 mb s3://&lt;bucket-name&gt;
    
    Upload the bundle to the Amazon S3 cloud. The following command includes the path to the XML file containing the manifest for the Photon OS machine created during the previous step, though you might have to change the file name to match the version you have. The manifest file is typically located in the same directory as the bundle. 
    
    The command also includes the name of the Amazon S3 bucket in which the bundle is to be stored; your AWS access key ID; and your AWS secret access key.
    
    	$ ec2-upload-bundle --manifest ./bundled/photon-ami.manifest.xml --bucket &lt;bucket-name&gt; --access-key &lt;Account Access Key&gt; --secret-key &lt;Account Secret key&gt;

1. Register the Image

    Run the following command to register the image. The command includes a name for the AMI, its architecture, and its virtualization type. The virtualization type for Photon OS is `hvm`.
    
    	$ ec2-register &lt;bucket-name&gt;/photon-ami.manifest.xml --name photon-ami --architecture x86_64 --virtualization-type hvm
    
    Once the image is registered, you can launch as many new instances as you require.

1. Run an instance of the image with Cloud-Init.

    In the below command, the `user-data-file` option instructs cloud-init to import the cloud-config data in `user-data.txt`.  
    
    Before you run the command, change directories to the directory containing the `mykeypair` file and add the path to the `user-data.txt`. 
    
    	$ ec2-run-instances &lt;ami-ID&gt; --instance-type m3.medium -g photon-sg --key mykeypair --user-data-file user-data.txt
    
    The command also includes the ID of the AMI, which you can obtain by running `ec2-describe-images`. Replace the instance type of `m3.medium` and the name of key pair with your own values to be able to connect to the instance. 
    
    The following are the contents of the `user-data.txt` file that `cloud-init` applies to the machine the first time it boots up in the cloud.  
    
    	#cloud-config
    	hostname: photon-on-01
    	groups:
    	- cloud-admins
    	- cloud-users
    	users:
    	- default
    	- name: photonadmin
    	   gecos: photon test admin user
    	   primary-group: cloud-admins
    	   groups: cloud-users
    	   lock-passwd: false
    	   passwd: vmware
    	- name: photonuser
    	   gecos: photon test user
    	   primary-group: cloud-users
    	   groups: users
    	   passwd: vmware
    	packages:
    	- vim

1. Get the IP address of your image.

    Run the following command to check on the state of the instance that you launched: 
    
    	$ ec2-describe-instances
    
    Obtain the external IP address of the instance by running the following query: 
    
    	$ aws ec2 describe-instances --instance-ids &lt;instance-id&gt; --query 'Reservations[*].Instances[*].PublicIpAddress' --output=text
    
Optionally, check the cloud-init output log file on EC2 at `/var/log/cloud-init-output.log` to see how EC2 handles the settings in the cloud-init data file. 
    
For more information on using cloud-init user data on EC2, see [Running Commands on Your Linux Instance at Launch](http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html).</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-c217b6cbe163c7d25a8803f7e23c0069>4.8.3 - Deploy a Containerized Application in Photon OS</h1><p>Connect to the Photon instance by using SSH and to launch a web server by running it in Docker.</p><ol><li><p>Connect with SSH</p><p>Connect to the instance over SSH by specifying the private key (.pem) file and the user name for the Photon machine, which is <code>root</code>:</p><pre><code> ssh -i ~/.ssh/mykeypair root@&lt;public-ip-address-of-instance&gt;
</code></pre><p>For complete instructions, see <a href=http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstancesLinux.html>Connecting to Your Linux Instance Using SSH</a>.</p></li><li><p>Run Docker</p><p>On the minimal version of Photon OS, the docker engine is enabled and running by default, which you can see by running the following command:</p><pre><code> systemctl status docker
</code></pre></li><li><p>Start the web server</p><p><strong>Note</strong>: Please make sure that the proper security policies have been enabled on the Amazon AWS side to enable traffic to port 80 on the VM.</p><p>Since Docker is running, you can run an application in a container&ndash;for example, the Nginx Web Server. This example uses the popular open source web server Nginx. The Nginx application has a customized VMware package that the Docker engine can download directly from the Docker Hub.</p><p>To pull Nginx from its Docker Hub and start it, run the following command:</p><pre><code class=language-console data-lang=console>docker run -p 80:80 vmwarecna/nginx
</code></pre><p>The Nginx web server should be bound to the public DNS value for the instance of Photon OS, that is, the same address with which you connected over SSH.</p></li><li><p>Test the web server</p><p>On your local workstation, open a web browser and go to the the public address of the Photon OS instance running Docker. The following screen should appear, showing that the web server is active:</p><p><img src=../../docs/installation-guide/images/Nginx.jpg alt=Nginx></p><p>Stop the Docker container by typing <code>Ctrl+c</code> in the SSH console through which you are connected to EC2.</p></li></ol><p>You can now run other containerized applications from the Docker Hub or your own containerized application on Photon OS in the Amazon cloud.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6ee250fdb6cd3aa3b2089a643ebc99a1>4.8.4 - Launch the Web Server with Cloud-Init</h1><p>To eliminate the manual effort of running Docker, you can add <code>docker run</code> and its arguments to the cloud-init user data file by using <code>runcmd</code>:</p><pre><code>#cloud-config
hostname: photon-on-01
groups:
- cloud-admins
- cloud-users
users:
- default
- name: photonadmin
   gecos: photon test admin user
   primary-group: cloud-admins
   groups: cloud-users
   lock-passwd: false
   passwd: vmware
- name: photonuser
   gecos: photon test user
   primary-group: cloud-users
   groups: users
   passwd: vmware
packages:
- vim
runcmd:
- docker run -p 80:80 vmwarecna/nginx
</code></pre><p>To try this addition, run another instance with the new cloud-init data source and then get the public IP address of the instance to check that the Nginx web server is running.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-39b73afa8f1609a442a680b04297799e>4.8.5 - Terminate the AMI Instance</h1><p>Because Amazon charges you while the instance is running, you must shut it down when you have finsihed using it.</p><ol><li>Get the ID of the AMI so you can terminate it:</li></ol><pre><code>$ ec2-describe-instances
</code></pre><ol start=2><li>Terminate the Photon OS instance by running the following command:</li></ol><pre><code>$ ec2-terminate-instances &lt;instance-id&gt;
</code></pre><p>Replace the placeholder with the ID that the <code>ec2-describe-images</code> command returned. If you ran a second instance of Photon OS with the cloud-init file that runs docker, terminate that instance as well.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-82b942d068e235c58b388388bb1a4e4a>4.9 - Running Photon OS on Microsoft Azure</h1><p>You can use Photon OS as a run-time environment for Linux containers on Microsoft Azure. You can set up and run the cloud-ready version of Photon OS as an instance of a virtual machine in the Azure cloud. Once Photon OS is running, you can deploy a containerized application in Docker.</p><p><strong>Note:</strong> These instructions apply to Photon OS 2.0 and 3.0. There is no Photon OS 1.0 distribution image for Microsoft Azure.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ad1b426636b0abebe6331214188cbb7a>4.9.1 - Prerequisites for Running Photon OS on Azure</h1><p>Before you use Photon OS with Microsoft Azure, perform the following prerequisite tasks:</p><ol><li><p>Verify that you have a Microsoft Azure account. To create an account, see <a href=https://azure.microsoft.com>https://azure.microsoft.com</a></p></li><li><p>Install the latest version of Azure CLI. See <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Install Azure CLI</a> and <a href="https://docs.microsoft.com/en-us/cli/azure/get-started-with-azure-cli?view=azure-cli-latest">Get started with Azure CLI </a>.</p></li><li><p>Verify that that you have a pair of SSH public and private keys.</p></li><li><p>Download and extract the Photon OS VHD file.</p><p>VMware packages Photon OS as an Azure-ready virtual hard disk (VHD file) that you can download for free from the <a href=https://packages.vmware.com/photon/4.0/GA/azure/>VMware Photon Packages</a> site. This VHD file is a virtual appliance with the information and packages that Azure needs to launch an instance of Photon in the cloud. After you have downloaded the distribution archive, extract the VHD file from it. You will later need to upload this VHD file to Azure, where it will be stored in an Azure storage account. For more information, see <a href=../../downloading-photon/>Downloading Photon OS</a>.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-6033e80ea39d7d9d45cd24d672ef58f3>4.9.2 - Set Up Azure Storage and Uploading the VHD</h1><p>You can use either the Azure Portal or the Azure CLI to set up your Azure storage space, upload the Photon OS VHD file, and create the Photon OS VM.</p><h2 id=setting-up-using-the-azure-portal>Setting Up Using the Azure Portal</h2><p>You can use the Azure portal to set up Photon OS 4.0 in the Azure cloud. The following instructions are brief. Refer to the Azure documentation for details.</p><ol><li>Log in to the Azure portal at <a href=http://portal.azure.com/>http://portal.azure.com</a>.</li><li>Create a resource group. In the toolbar, choose Resource Groups, click <strong>+Add</strong> , fill in the resource group fields, and choose <strong>Create</strong>.</li><li>Create a storage account. In the toolbar, choose Storage Accounts, click <strong>+Add</strong> , fill in the storage account fields (and the resource group you just created), and choose <strong>Create</strong>.</li><li>Select the storage account.</li><li>Scroll down the storage account control bar, click Containers (below BLOB SERVICE), click <strong>+Container</strong> , fill in the container fields, and choose <strong>Create</strong>.</li><li>Select the container you just created.</li><li>Click <strong>Upload</strong> and upload the Photon OS VHD image file to this container.</li><li>Once the VHD file is uploaded, refer to the Azure documentation for instructions on how to create and manage your Photon OS VM.</li></ol><h2 id=setting-up-using-the-azure-cli>Setting Up Using the Azure CLI</h2><p>You can use the Azure CLI to set up Photon OS.</p><p><strong>Note:</strong> Except where overridden with parameter values, these commands create objects with default settings.</p><ol><li><p>Create a resource group.</p><p>From the Azure CLI, create a resource group.</p><pre><code class=language-console data-lang=console>az group create \
 --name &amp;lt;your_resource_group&amp;gt; \
 --location westus
</code></pre></li><li><p>Create a storage account</p><p>Create a storage account associated with this resource group.</p><pre><code class=language-console data-lang=console>az storage account create \
    --resource-group &amp;lt;your_resource_group&amp;gt; \
    --location westus \
    --name &amp;lt;your_account_name&amp;gt; \
    --kind Storage \
    --sku Standard_LRS
</code></pre></li><li><p>List the Keys for the Storage Account</p><p>Retrieve the keys associated with your newly created storage account.</p><pre><code class=language-console data-lang=console>az storage account keys list \
    --resource-group &amp;lt;your_resource_group&amp;gt; \
    --account-name &amp;lt;your_account_name&amp;gt;
</code></pre></li><li><p>Create the Storage Container</p><p>Create a storage container associated with your newly created storage account.</p><p><strong>Note:</strong> The sample create.sh script, described below, does this for you programmatically.</p><pre><code class=language-console data-lang=console>az storage container create \
    --account-name &amp;lt;your_account_name&amp;gt; \
    --name &amp;lt;your_container_name&amp;gt;
</code></pre></li><li><p>Verify Your Setup in the Azure Portal</p><ol><li>Log into the Azure portal using your account credentials.</li><li>From the left toolbar, click <strong>Storage Accounts</strong>. You should see your storage accounts.</li><li>Select the storage account.</li><li>Scroll down the storage account control bar and click <strong>Containers</strong> (below BLOB SERVICE). You should see the container you created.</li></ol></li><li><p>Upload the Photon OS Distribution to Your Storage Container</p><p>The Photon OS distribution for Azure is 16GB. You can download it locally or to a mounted, shared location.</p><pre><code>az storage blob upload \
    --account-name &amp;lt;your_account_name&amp;gt; \
    --account-key &amp;lt;your_account_key&amp;gt; \
    --container-name &amp;lt;your_container_name&amp;gt; \
    --type page \
    --file &amp;lt;vhd_path&amp;gt; \
    --name &amp;lt;vm_name&amp;gt;.vhd
</code></pre></li></ol><h3 id=example-setup-script>Example Setup Script</h3><p>You can use the following script (create.sh) to upload your VHD file programmatically and create the VM. Before you run it, specify the following settings:</p><ul><li>resource_group name</li><li>account_name</li><li>account_key (public or private)</li><li>container_name</li><li>public_key_file</li><li>vhd_path and and vm_name of the Photon OS VHD distribution file</li></ul><p>The following script returns the complete IP address of the newly created VM.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>vhd_path</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$1</span>
<span style=color:#000>vm_name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$2</span>
<span style=color:#204a87>export</span> <span style=color:#000>PATH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$PATH</span>:/root/azure_new/bin/az
<span style=color:#204a87>echo</span> <span style=color:#000>PATH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$PATH</span>
<span style=color:#000>resource_group</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;&amp;</span>quot<span style=color:#000;font-weight:700>;</span>
<span style=color:#000>account_name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;&amp;</span>quot<span style=color:#000;font-weight:700>;</span>
<span style=color:#000>account_key</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;&amp;</span>quot<span style=color:#000;font-weight:700>;</span>
<span style=color:#000>container_name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;</span>mydisks<span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;</span>
<span style=color:#000>url</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;</span>https://<span style=color:#4e9a06>${</span><span style=color:#000>account_name</span><span style=color:#4e9a06>}</span>.blob.core.windows.net/<span style=color:#4e9a06>${</span><span style=color:#000>container_name</span><span style=color:#4e9a06>}</span>/<span style=color:#4e9a06>${</span><span style=color:#000>vm_name</span><span style=color:#4e9a06>}</span>.vhd<span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;</span>
<span style=color:#000>public_key_file</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;</span>/root/azure_new/jenkins.pub<span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87>echo</span> <span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;</span><span style=color:#8f5902;font-style:italic>########################&amp;quot;</span>
<span style=color:#204a87>echo</span> <span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;</span><span style=color:#8f5902;font-style:italic>#   Create container   #&amp;quot;</span>
<span style=color:#204a87>echo</span> <span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;</span><span style=color:#8f5902;font-style:italic>########################&amp;quot;</span>
/root/azure_new/bin/az storage container create --account-name <span style=color:#4e9a06>${</span><span style=color:#000>account_name</span><span style=color:#4e9a06>}</span> --name <span style=color:#4e9a06>${</span><span style=color:#000>container_name</span><span style=color:#4e9a06>}</span>
<span style=color:#204a87>echo</span> <span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;</span><span style=color:#8f5902;font-style:italic>##################&amp;quot;</span>
<span style=color:#204a87>echo</span> <span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;</span><span style=color:#8f5902;font-style:italic>#   Upload vhd   #&amp;quot;</span>
<span style=color:#204a87>echo</span> <span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;</span><span style=color:#8f5902;font-style:italic>##################&amp;quot;</span>
/root/azure_new/bin/az storage blob upload --account-name <span style=color:#4e9a06>${</span><span style=color:#000>account_name</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>    --account-key <span style=color:#4e9a06>${</span><span style=color:#000>account_key</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>    --container-name <span style=color:#4e9a06>${</span><span style=color:#000>container_name</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>    --type page <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>    --file <span style=color:#4e9a06>${</span><span style=color:#000>vhd_path</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>    --name <span style=color:#4e9a06>${</span><span style=color:#000>vm_name</span><span style=color:#4e9a06>}</span>.vhd
<span style=color:#204a87>echo</span> <span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;</span><span style=color:#8f5902;font-style:italic>##################&amp;quot;</span>
<span style=color:#204a87>echo</span> <span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;</span><span style=color:#8f5902;font-style:italic>#   Create vm    #&amp;quot;</span>
<span style=color:#204a87>echo</span> <span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;</span><span style=color:#8f5902;font-style:italic>##################&amp;quot;</span>
<span style=color:#204a87>echo</span> <span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;</span>az vm create --resource-group <span style=color:#4e9a06>${</span><span style=color:#000>resource_group</span><span style=color:#4e9a06>}</span> --location westus --name <span style=color:#4e9a06>${</span><span style=color:#000>vm_name</span><span style=color:#4e9a06>}</span> --storage-account <span style=color:#4e9a06>${</span><span style=color:#000>account_name</span><span style=color:#4e9a06>}</span> --os-type linux --admin-username michellew --ssh-key-value <span style=color:#4e9a06>${</span><span style=color:#000>public_key_file</span><span style=color:#4e9a06>}</span> --image <span style=color:#4e9a06>${</span><span style=color:#000>url</span><span style=color:#4e9a06>}</span> --use-unmanaged-disk ... ...<span style=color:#000;font-weight:700>&amp;</span>quot<span style=color:#000;font-weight:700>;</span>
/root/azure_new/bin/az vm create --resource-group <span style=color:#4e9a06>${</span><span style=color:#000>resource_group</span><span style=color:#4e9a06>}</span> --location westus --name <span style=color:#4e9a06>${</span><span style=color:#000>vm_name</span><span style=color:#4e9a06>}</span> --storage-account <span style=color:#4e9a06>${</span><span style=color:#000>account_name</span><span style=color:#4e9a06>}</span> --os-type linux --admin-username michellew --ssh-key-value <span style=color:#4e9a06>${</span><span style=color:#000>public_key_file</span><span style=color:#4e9a06>}</span> --image <span style=color:#4e9a06>${</span><span style=color:#000>url</span><span style=color:#4e9a06>}</span> --use-unmanaged-disk
</code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-9a8d0861f63e4cbd91bcd0136f402e8b>4.9.3 - Remove Photon OS From Azure</h1><p>You can use the following delete.sh script to programmatically and silently remove the VM instance, VHD file, and container.</p><p>Consider deleting idle VMs so that you are not charged when not in use.</p><p>Before you run it, specify the following settings:</p><ul><li>resource_group name (from step 1, above)</li><li>account_name (from step 2, above)</li><li>account_key (public or private) (from step 3, above)</li><li>container_name (from step 4, above)</li><li>public_key_file</li><li>vm_name of the Photon OS VHD distribution file</li></ul><p><strong>delete.sh</strong></p><pre><code>#!/bin/bash
vm_name=$1
resource_group=&amp;quot;&amp;quot;
account_name=&amp;quot;&amp;quot;
account_key=&amp;quot;&amp;quot;
container_name=&amp;quot;mydisks&amp;quot;
url=&amp;quot;https://${account_name}.blob.core.windows.net/${container_name}/${vm_name}.vhd&amp;quot;
public_key_file=&amp;quot;/root/azure_new/jenkins.pub&amp;quot;
exit_code=0
echo &amp;quot;##################&amp;quot;
echo &amp;quot;#   Delete vm    #&amp;quot;
echo &amp;quot;##################&amp;quot;
echo &amp;quot;az vm list  --resource-group ${resource_group} ... ...&amp;quot;
/root/azure_new/bin/az vm list  --resource-group ${resource_group}
echo &amp;quot;az vm delete --resource-group ${resource_group} --name ${vm_name} --yes ... ...&amp;quot;
/root/azure_new/bin/az vm delete --resource-group ${resource_group} --name ${vm_name} --yes
if [$? -ne 0];then
   exit_code=1
fi
echo &amp;quot;az vm list  --resource-group ${resource_group} ... ...&amp;quot;
/root/azure_new/bin/az vm list  --resource-group ${resource_group}
echo &amp;quot;##############$####&amp;quot;
echo &amp;quot;#   Delete vhd    #&amp;quot;
echo &amp;quot;###############$###&amp;quot;
echo &amp;quot;az storage blob list --account-name ${account_name} --container-name ${container_name} ... ...&amp;quot;
/root/azure_new/bin/az storage blob list --account-name ${account_name} --container-name ${container_name}
echo &amp;quot;az storage blob delete --account-name ${account_name} --container-name ${container_name} --name ${vm_name}.vhd ... ...&amp;quot;
/root/azure_new/bin/az storage blob delete --account-name ${account_name} --container-name ${container_name} --name ${vm_name}.vhd
if [$? -ne 0];then
   exit_code=1
fi
echo &amp;quot;az storage blob list --account-name ${account_name} --container-name ${container_name} ... ...&amp;quot;
/root/azure_new/bin/az storage blob list --account-name ${account_name} --container-name ${container_name}
echo &amp;quot;########################&amp;quot;
echo &amp;quot;#   Delete container   #&amp;quot;
echo &amp;quot;########################&amp;quot;
/root/azure_new/bin/az storage container delete --account-name ${account_name} --name ${container_name}
/root/azure_new/bin/az storage container delete --account-name ${account_name} --name vhds
exit ${exit_code}
</code></pre><p>You can now proceed to <a href=../../deploying-a-containerized-application-in-photon-os/>Deploying a Containerized Application in Photon OS</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-afab1e848c12bf1991fdaa11793b3aec>4.10 - Running Photon OS on Google Compute Engine</h1><p>You can use Photon OS as a virtual machine on Google Compute Engine (GCE). You can download Photon OS, as an OVA or ISO file, and install the Photon OS distribution on vSphere. After you install Photon OS, you can deploy a containerized application in Docker with a single command.</p></div><div class=td-content><h1 id=pg-550dbc0b52c6260a1bd98c719abf40f2>4.10.1 - Prerequisites for Running Photon OS on GCE</h1><p>Before you use Photon OS within GCE, verify that you have the following resources:</p><ol><li><a href=#google-compute-engine-account>Google Compute Engine account</a></li><li><a href=#gce-tools>GCE tools</a></li><li><a href=#photon-os-image>Photon OS Image</a></li></ol><h2 id=google-compute-engine-account>Google Compute Engine Account</h2><p>Working with GCE requires a Google Compute Engine account with valid payment information. Keep in mind that, if you try the examples in this document, you will be charged by Google. The GCE-ready version of Photon OS is free to use.</p><h2 id=gce-tools>GCE Tools</h2><p>GCE is a service that lets you run virtual machines on Google&rsquo;s infrastructure. You can customize the virtual machine as much as you want, and you can even install your own custom operating system image. Or, you can adopt one of the public <a href=https://cloud.google.com/compute/docs/operating-systems/>images</a> provided by Google. For any operating system to work with GCE, it must match Google&rsquo;s infrastructure needs. Google provides tools that VM instances require to work correctly on GCE:</p><ul><li><strong><a href=https://cloud.google.com/compute/docs/startupscript>Google startup scripts</a></strong>: You can provide some startup script to configure your instances at startup.</li><li><strong><a href=https://cloud.google.com/compute/docs/metadata>Google Daemon</a></strong>: Google Daemon creates new accounts and configures ssh to accept public keys using the metadata server.</li><li><strong><a href=https://cloud.google.com/sdk/>Google Cloud SDK</a></strong>: Command line tools to manage your images, instances and other objects on GCE.</li></ul><p>Perform the following tasks to make Photon OS work on GCE:</p><ol><li>Install Google Compute Engine Image packages</li><li>Install Google Cloud SDK</li><li>Change GPT partition table to MBR</li><li>Update the Grub config for new MBR and serial console output</li><li>Update ssh configuration</li><li>Delete ssh host keys</li><li>Set the time zone to UTC</li><li>Use the Google NTP server</li><li>Delete the hostname file.</li><li>Add Google hosts /etc/hosts</li><li>Set MTU to 1460. SSH will not work without it.</li><li>Create <code>/etc/ssh/sshd_not_to_be_run</code> with just the contents “GOOGLE\n”.</li></ol><p>For more information see <a href=https://cloud.google.com/compute/docs/tutorials/building-images>Importing Boot Disk Images to Compute Engine</a>.</p><p>For information about upgrading the Photon OS Linux kernel see <a href=Upgrading-the-Kernel-Version-Requires-Grub-Changes-for-AWS-and-GCE-Images.md>Upgrading the Kernel Version Requires Grub Changes for AWS and GCE Images</a></p><h2 id=photon-os-image>Photon OS Image</h2><p>VMware recommends that administrators use the Photon OS image for Google Compute Engine (GCE) to create Photon OS instances on GCE. Photon OS bundles the Google startup scripts, daemon, and cloud SDK into a GCE-ready image that has been modified to meet the configuration requirements of GCE. You can download the Photon OS image for GCE from the following URL:
<a href=https://packages.vmware.com/photon/4.0/GA/gce/>https://packages.vmware.com/photon/4.0/GA/gce/</a></p><p>For instructions, see <a href=../../downloading-photon>Downloading Photon OS</a>.</p><p>Optionally you can customize Photon OS to work with GCE.</p><h3 id=creating-photon-image-for-gce>Creating Photon image for GCE</h3><p>Perform the following tasks:</p><ol><li><p>Prepare Photon Disk</p><ol><li>Install Photon Minimal on Fusion/Workstation and install some required packages.</li></ol><pre><code class=language-console data-lang=console>mount /dev/cdrom /media/cdrom
tdnf install python2-libs ntp sudo wget tar which gptfdisk sed findutils grep gzip -y
</code></pre></li><li><p>Convert GPT to MBR and update Grub</p><p>Photon installer installs GPT partition table by default but GCE only accepts an MBR (msdos) type partition table. So, you must convert GPT to MBR and update grub. Use the following commands to update the grub:</p><pre><code class=language-console data-lang=console># Change partition table to MBR from GPT
sgdisk -m 1:2 /dev/sda
grub2-install /dev/sda
   
# Enable serial console on grub for GCE.
cat &lt;&lt; EOF &gt;&gt; /etc/default/grub
GRUB_CMDLINE_LINUX=&quot;console=ttyS0,38400n8&quot;
GRUB_TERMINAL=serial
GRUB_SERIAL_COMMAND=&quot;serial --speed=38400 --unit=0 --word=8 --parity=no --stop=1&quot;
EOF
   
# Create new grub.cfg based on the settings in /etc/default/grub
grub2-mkconfig -o /boot/grub2/grub.cfg
</code></pre></li><li><p>Install Google Cloud SDK and GCE Packages</p><pre><code class=language-console data-lang=console>tdnf install -y google-compute-engine google-compute-engine-services
cp /usr/lib/systemd/system/google* /lib/systemd/system/
cd /lib/systemd/system/multi-user.target.wants/
   
# Create links in multi-user.target to auto-start these scripts and services.
for i in ../google*; do  ln -s $i `basename $i`; done
   
cd /tmp/; wget https://dl.google.com/dl/cloudsdk/release/google-cloud-sdk.tar.gz
tar -xf google-cloud-sdk.tar.gz
cd google-cloud-sdk
./install.sh
</code></pre></li><li><p>Update /etc/hosts file with GCE values as follows:</p><pre><code class=language-console data-lang=console>echo &quot;169.254.169.254 metadata.google.internal metadata&quot; &gt;&gt; /etc/hosts
</code></pre></li><li><p>Remove all servers from ntp.conf and add Google&rsquo;s ntp server.</p><pre><code class=language-console data-lang=console>sed -i -e &quot;/server/d&quot; /etc/ntp.conf
cat /etc/ntp.conf
echo &quot;server 169.254.169.254&quot; &gt;&gt; /etc/ntp.conf
# Create ntpd.service to auto starting ntp server.
cat &lt;&lt; EOF &gt;&gt; /lib/systemd/system/ntpd.service
[Unit]
Description=Network Time Service
After=network.target nss-lookup.target

[Service]
Type=forking
PrivateTmp=true
ExecStart=/usr/sbin/ntpd -g -u ntp:ntp
Restart=always
   
[Install]
WantedBy=multi-user.target
EOF
   
# Add link in multi-user.target.wants to auto start this service.
cd /lib/systemd/system/multi-user.target.wants/
ln -s ../ntpd.service ntpd.service
</code></pre></li><li><p>Set UTC timezone</p><pre><code class=language-console data-lang=console>ln -sf /usr/share/zoneinfo/UTC /etc/localtime
</code></pre></li><li><p>Update /etc/resolv.conf</p><pre><code class=language-console data-lang=console>echo &quot;nameserver 8.8.8.8&quot; &gt;&gt; /etc/resolv.conf
</code></pre></li><li><p>Remove ssh host keys and add script to regenerate them at boot time.</p><pre><code class=language-console data-lang=console>rm /etc/ssh/ssh_host_*
# Depending on the installation, you may need to purge the following keys
rm /etc/ssh/ssh_host_rsa_key*
rm /etc/ssh/ssh_host_dsa_key*
rm /etc/ssh/ssh_host_ecdsa_key*

sed -i -e &quot;/exit 0/d&quot; /etc/rc.local
echo &quot;[ -f /etc/ssh/ssh_host_key ] &amp;&amp; echo 'Keys found.' || ssh-keygen -A&quot; &gt;&gt; /etc/rc.local
echo &quot;exit 0&quot; &gt;&gt; /etc/rc.local
printf &quot;GOOGLE\n&quot; &gt; /etc/ssh/sshd_not_to_be_run
   
# Edit sshd_config and ssh_config as per instructions on [this link](https://cloud.google.com/compute/docs/tutorials/building-images).
</code></pre></li><li><p>Change MTU to 1460 for network interface.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini> <span style=color:#8f5902;font-style:italic># Create a startup service in systemd that will change MTU and then exit</span>

<span style=color:#c4a000>cat &lt;&lt; EOF &gt;&gt; /lib/systemd/system/eth0.service</span>
<span style=color:#204a87;font-weight:700>[Unit]</span>
<span style=color:#c4a000>Description</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>Network interface initialization</span>
<span style=color:#c4a000>After</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>local-fs.target network-online.target network.target</span>
<span style=color:#c4a000>Wants</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>local-fs.target network-online.target network.target</span>

<span style=color:#204a87;font-weight:700>[Service]</span>
<span style=color:#c4a000>ExecStart</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>/bin/ifconfig eth0 mtu 1460 up</span>
<span style=color:#c4a000>Type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>oneshot</span>

<span style=color:#204a87;font-weight:700>[Install]</span>
<span style=color:#c4a000>WantedBy</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>multi-user.target</span>
<span style=color:#c4a000>EOF</span>
<span style=color:#8f5902;font-style:italic># Make this service auto-start at boot.</span>
<span style=color:#c4a000>cd /lib/systemd/system/multi-user.target.wants/</span>
<span style=color:#c4a000>ln -s ../eth0.service eth0.service</span>
</code></pre></div></li><li><p>Pack and upload to GCE.</p><p>Shut down the Photon VM and copy its disk to THE <code>tmp</code> folder.</p><pre><code class=language-console data-lang=console># You will need to install Google Cloud SDK on host machine to upload the image and play with GCE.
           
cp Virtual\ Machines.localized/photon.vmwarevm/Virtual\ Disk.vmdk /tmp/disk.vmdk
cd /tmp
# GCE needs disk to be named as disk.raw with raw format.
qemu-img convert -f vmdk -O raw disk.vmdk disk.raw
   
# ONLY GNU tar will work to create acceptable tar.gz file for GCE. MAC's default tar is BSDTar which will not work. 
# On Mac OS X ensure that you have gtar &quot;GNU Tar&quot; installed. exmaple: gtar -Szcf photon.tar.gz disk.raw 

gtar -Szcf photon.tar.gz disk.raw 
   
# Upload
gsutil cp photon.tar.gz gs://photon-bucket
   
# Create image
gcloud compute --project &quot;&lt;project name&gt;&quot; images create &quot;photon-beta-vYYYYMMDD&quot; --description &quot;Photon Beta&quot; --source-uri https://storage.googleapis.com/photon-bucket/photon032315.tar.gz
   
# Create instance on GCE of photon image
gcloud compute --project &quot;photon&quot; instances create &quot;photon&quot; --zone &quot;us-central1-f&quot; --machine-type &quot;n1-standard-1&quot; --network &quot;default&quot; --maintenance-policy &quot;MIGRATE&quot; --scopes &quot;https://www.googleapis.com/auth/devstorage.read_only&quot; &quot;https://www.googleapis.com/auth/logging.write&quot; --image &quot;https://www.googleapis.com/compute/v1/projects/photon/global/images/photon&quot; --boot-disk-type &quot;pd-standard&quot; --boot-disk-device-name &quot;photon&quot;
   
</code></pre></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-05f30b7237da7a556f6587e7eafd1eed>4.10.2 - Installing Photon OS on Google Compute Engine</h1><p>After you download the Photon OS image for GCE, log into GCE and install Photon OS.</p><p>Perform the following steps:</p><ol><li><p>Create a New Bucket</p><p>Create a new bucket to store your Photon OS image for GCE.</p><p><img src=../../docs/installation-guide/images/gce1.jpg alt=gce1></p></li><li><p>Upload the Photon OS Image</p><p>While viewing the bucket that created, click the <code>Upload files</code> button, navigate to your Photon OS image and click the <code>Choose</code> button.</p><p>When the upload finishes, you can see the Photon OS compressed image in the file list for the bucket that you created.</p><p><img src=../../docs/installation-guide/images/gce2.jpg alt=gce2></p></li><li><p>Create a New Image</p><p>To create a new image, click on <code>Images</code> in the <code>Compute</code> category in the left panel and then click on the <code>New Image</code> button.</p><p>Enter a name for the image in the <code>Name</code> field and change the <code>Source</code> to <code>Cloud Storage file</code> using the pull-down menu. Then, in the <code>Cloud Storage file</code> field, enter the bucket name and filename as the path to the Photon OS image for GCE. In this example, where the bucket was named <code>photon_storage,</code> the path is as follows:</p><pre><code> `photon_storage/photon-gce-2.0-tar.gz`
</code></pre><p>The new image form autopopulates the <code>gs://</code> file path prefix.*</p><p>Click the <code>Create</code> button to create your image. You must be able to see the Images catalog and your Photon OS image at the top of the list.</p></li><li><p>Create a New Instance</p><p>To create an instance, check the box next to the Photon OS image and click the <code>Create Instance</code> button.</p><p>On the <code>Create a new instance</code> form, provide a name for this instance, confirm the zone into which this instance is to be deployed and, before clicking <code>Create,</code> check the <code>Allow HTTP traffic</code> and <code>Allow HTTPS traffic</code> options.</p><p><strong>Note</strong>: The firewall rules in this example are optional. You can configure the ports according to your requirements.</p><p><img src=../../docs/installation-guide/images/gce4.jpg alt=gce4></p><p>When the instance is created you will be returned to your list of VM instances. If you click on the instance, the status page for the instance will allow you to SSH into your Photon OS environment using the SSH button at the top of the panel.</p><p>At this point, your instance is running and you are ready to start the Docker engine and run a container workload. For more information, see <a href=../../docs/installation-guide/deploying-a-containerized-application-in-photon-os/>Deploying a Containerized Application in Photon OS</a>.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-eedc963d153cd71329bd6ec6858e74e3>4.11 - Running Photon OS on Raspberry Pi</h1><p>You can use Photon OS as a virtual machine on Raspberry Pi (RPi). You can download Photon OS and install the Photon OS distribution on vSphere.</p></div><div class=td-content><h1 id=pg-fd6c69e7b25eaa3c6701cf504027a315>4.11.1 - Prerequisites for Running Photon OS on Raspberry Pi</h1><p>Before you use Photon OS within RPi, perform the following prerequisite tasks:</p><ol><li><p>Verify that you have the following resources:</p><table style=height:170px border=1 width=auto cellspacing=0 cellpadding=10><tbody><tr><td><b>Resource</b></td><td><b>Description</b></td></tr><tr><td>Raspberry Pi 3</td><td>Raspberry Pi 3 Model B or Model B+ board. This will serve as the target of the installation.</td></tr><tr><td>Raspberry Pi 4</td><td>Raspberry Pi 4 Model B or Model B+ board. This will serve as the target of the installation.</td></tr><tr><td>Host computer</td><td><p>A computer equipped with the following:</p></li></ol><p>1. An SD card reader.<p>2. Software utilities to flash an image onto an SD-card (details and instructions provided below).</td></tr><tr><td>Distribution File</td><td>Photon OS RPi image downloaded from <a href=https://packages.vmware.com/photon/>URL</a><br><p><b>Note</b>: Photon OS RPi image is available only from Photon 3.0 onwards.</td></tr></tbody></table><ol><li><p>Download Photon OS.</p><p>To install Photon OS on a Raspberry Pi, you must download the Photon OS RPi image, which is distributed as a compressed raw disk image with the file extension <code>.raw.xz</code>.</p><p><strong>Note</strong>: You cannot use the Photon ISO to install on RPi.</p><p>Go to the following URL and download the latest release of Photon OS image for RPi: <a href=https://packages.vmware.com/photon/4.0/GA/rpi/rpi.tar.xz>https://packages.vmware.com/photon/4.0/GA/rpi/rpi.tar.xz</a>.</p><p>For instructions, see <a href=../../downloading-photon/>Downloading Photon OS</a>.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-78c035034a5ada974bce4b9c1670954e>4.11.2 - Installing Photon OS on Raspberry Pi</h1><p>You can get Photon OS up and running on an RPi board, by flashing the Photon RPi image onto the board&rsquo;s SD card.</p><h2 id=flash-photon-os-on-raspberry-pi>Flash Photon OS on Raspberry Pi</h2><p>After you have downloaded the Photon RPi image with the file extension <code>.raw.xz</code>, you can choose one of the methods below to flash it onto the RPi SD card.</p><ol><li>Flash Photon to RPi using Etcher</li><li>Flash Photon to RPi using Linux CLI</li></ol><h3 id=flash-photon-to-rpi-using-etcher>Flash Photon to RPi using Etcher</h3><ol><li>Install Etcher <a href=https://etcher.io/>https://etcher.io/</a>, which is a utility to flash SD cards attached to your host computer.</li><li>Plug the RPi SD card into your host computer&rsquo;s SD card reader.</li><li>Perform the following steps on the Etcher GUI: <strong>Select image</strong> -> <strong>Select drive</strong> -> <strong>Flash</strong>, by selecting the Photon OS RPi as image and the RPi SD card as drive.</li></ol><h3 id=flash-photon-to-rpi-using-linux-cli>Flash Photon to RPi using Linux CLI</h3><ol><li><p>If you have Linux running on your host computer, install the <code>xz</code> package, which provides the <code>xz</code> compression utility and related tools, from your distribution package manager.</p></li><li><p>Plug the RPi&rsquo;s SD card into your host computer&rsquo;s SD card reader.</p></li><li><p>Identify the device file under <code>/dev</code> that refers to the RPi SD card. For example, <code>/dev/sdc</code>. This file path is used to flash the Photon image onto the RPi in the next step.</p><p><strong>Note</strong>: Make sure that you are flashing to the device file that refers to your RPi3 SD card. Running the below command with an incorrect device file will overwrite that device without warning and might result in a corrupted disk. The device file &lsquo;/dev/sdc` is an example and might not be the device file in your case.</p></li><li><p>Run the following command to flash Photon onto the RPi SD card:</p><p><code>xzcat &lt;photon-rpi4-image.raw.xz> | sudo dd of=/dev/sdc bs=4M conv=fsync</code></p></li></ol><h2 id=boot-photon-os-on-raspberry-pi>Boot Photon OS on Raspberry Pi</h2><p>After you flash Photon OS successfully onto the RPi SD card, eject the card from your host computer and plug it back into the RPi board.</p><p>When you power on Raspberry Pi , it boots with Photon OS.</p><p>After the splash screen, Photon OS prompts you to log in.</p><h2 id=update-login-credentials>Update login credentials</h2><p>The Photon OS RPi image is configured with a default password. However, all Photon OS instances that are created using this image will require an immediate password change upon login. The default account credentials are:</p><ul><li>Username: <code>root</code></li><li>Password: <code>changeme</code></li></ul><p>After you provide these credentials, Photon OS prompts you to create a new password and type it a second time to verify it. Photon OS does not allow common dictionary words for the root password. When you are logged in, you will see the shell prompt.</p><p>You can now run <code>tdnf list</code> to view all the ARM packages that you can install on Photon OS.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f06c107c3d3441cf06142fa7233fa7f9>4.11.3 - Enabling Raspberry Pi Interfaces using Device Tree</h1><p>Photon OS RPI images from Photon 4.0 has Device Tree Overlay support. And these images have compiled Overlays to enable/disable Rpi Interface. Perform the following:</p><p><strong>SPI Interface</strong>:
Execute following commands to enable SPI Interface:</p><pre><code>mkdir /sys/kernel/config/device-tree/overlays/

cat /boot/efi/overlays/rpi-enable-spi0.dtbo &gt; /sys/kernel/config/device-tree/overlays/spi/dtbo
</code></pre><p><strong>Audio Interface</strong>:
Execute following commands to enable Audio Interface:</p><pre><code>mkdir  /sys/kernel/config/device-tree/overlays/audio

cat /boot/efi/overlays/rpi-enable-audio.dtbo &gt;  /sys/kernel/config/device-tree/overlays/audio/dtbo
</code></pre><p><strong>Note</strong>: Ensure that the <strong>linux-drivers-sound</strong> rpm is installed.</p><p><strong>I2C Interface</strong>:
Execute following command to enable I2C Interface:</p><pre><code>modprobe i2c-dev
</code></pre><p>#Customizing Device Tree Overlay</p><p>Photon OS also provides Device Tree Compilers (i.e. dtc), to compile <strong>Customised Device Tree Overlays</strong>. Execute following command to install dtc on Photon OS:</p><pre><code>tdnf install dtc
</code></pre><p>Execute following command to compile the overlay:</p><pre><code>dtc -@ -O dtb -o my_overlay_dt.dtbo my_overlay_dt.dts
</code></pre><p>For more information about format of Device Tree Overlay, see
<a href=https://www.kernel.org/doc/Documentation/devicetree/overlay-notes.txt>https://www.kernel.org/doc/Documentation/devicetree/overlay-notes.txt</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-801c34aa27a2a7bdc5b108048947dda6>4.12 - Deploying a Containerized Application in Photon OS</h1><p>Now that you have your container runtime environment up and running, you can easily deploy a containerized application. For this example, you will deploy the popular open source Web Server Nginx. The Nginx application has a customized VMware package that is published as a dockerfile and can be downloaded, directly, through the Docker module from the Docker Hub.</p><ol><li><p>Run Docker</p><p>To run Docker from the command prompt, enter the following command, which initializes the docker engine:</p><pre><code> systemctl start docker
</code></pre><p>To ensure Docker daemon service runs on every subsequent VM reboot, enter the following command:</p><pre><code> systemctl enable docker
</code></pre></li><li><p>Run the Nginx Web Server</p><p>Now the Docker daemon service is running, it is a simple task to &ldquo;pull&rdquo; and start the Nginx Web Server container from Docker Hub. To do this, type the following command:</p><pre><code> docker run -d -p 80:80 vmwarecna/nginx
</code></pre><p>This pulls the Nginx Web Server files and appropriate dependent container filesystem layers required for this containerized application to run.</p><p><img src=../../docs/installation-guide/images/vs-docker-run.png alt="Docker run"></p><p>After the <strong>docker run</strong> process completes, you return to the command prompt. You now have a fully active website up and running in a container!</p></li><li><p>Test the Web Server</p><p>To test that your Web Server is active, run the ifconfig command to get the IP address of the Photon OS Virtual Machine.</p><p><img src=../../docs/installation-guide/images/vs-docker-ifconfig.png alt="IP address"></p><p>The output displays a list of adapters that are connected to the virtual machine. Typically, the web server daemon will be bound on <strong>eth0</strong>.</p><p>Start a browser on your host machine and enter the IP address of your Photon OS Virtual Machine. You should see a screen similar to the following example as confirmation that your web server is active.</p><p><img src=../../docs/installation-guide/images/vs-docker-confirm.png alt="Docker confirmation"></p><p>You can now run any other containerized application from Docker Hub or your own containerized application within Photon OS.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-71272c24f261fdad461dadc21c3eeffb>4.13 - Compatible Cloud Images</h1><p>The <a href=https://packages.vmware.com/photon/>Vmware Photon Packages website</a> contains the following cloud-ready images of Photon OS:</p><ol><li><p>GCE - Google Compute Engine</p></li><li><p>AMI - Amazon Machine Image</p></li><li><p>OVA</p></li></ol><p>Because the cloud-ready images of Photon OS are built to be compatible with their corresponding cloud platform or format, you typically do not need to build a cloud image, you can just go to the <a href=https://packages.vmware.com/photon/>VMware Packages</a> repo and download the image for the platform that you are working on.</p><p>If, however, you want to build your <em>own</em> cloud image, perhaps because you seek to customize the code, see the next section on how to build cloud images.</p><h2 id=how-to-build-cloud-images>How to build cloud images</h2><pre><code>sudo make cloud-image IMG_NAME=image-name

image-name: gce/ami/azure/ova
</code></pre><p>The output of the build process produces the following file formats:</p><p>GCE - A tar file consisting of disk.raw as the raw disk file</p><p>AMI - A raw disk file</p><p>OVA - An ova file (vmdk + ovf)</p><p>If you want, you can build all the cloud images by running the following command:</p><pre><code>sudo make cloud-image-all 
</code></pre><h2 id=how-to-create-running-instances-in-the-cloud>How to create running instances in the cloud</h2><p>The following sections contain some high-level instructions on how to create instances of Photon OS in the Google Compute Engine (GCE) and Amazon Elastic Cloud Compute (EC2). For more information, see the Amazon or Google cloud documentation.</p><h3 id=gce>GCE</h3><p>The tar file can be uploaded to Google&rsquo;s cloud storage and an instance can be created after creating an image from the tar file. You will need the Google Cloud SDK on your host machine to upload the image and create instances.</p><p>####Install Google cloud SDK on host machine</p><pre><code>curl https://sdk.cloud.google.com | bash
</code></pre><p>####Upload the tar file</p><pre><code>gsutil cp photon-gce.tar.gz gs://bucket-name
</code></pre><p>####Create image</p><pre><code>gcloud compute --project project-id images create image-name --description description --source-uri https://storage.googleapis.com/bucket-name/photon-gce.tar.gz
</code></pre><p>####Create instance of GCE</p><pre><code>gcloud compute --project project-id instances create instance-name --zone &quot;us-central1-f&quot; --machine-type &quot;n1-standard-1&quot; other-options
</code></pre><p>(You can also create instances from the Google developer console.)</p><p>For more information, see <a href=../run-photon-on-gce/>Running a Photon OS Machine on GCE</a>.</p><h3 id=aws-ec2>AWS EC2</h3><p>Install the <a href=http://docs.aws.amazon.com/cli/latest/userguide/installing.html#install-bundle-other-os>AWS CLI</a> and <a href=http://docs.aws.amazon.com/AWSEC2/latest/CommandLineReference/set-up-ec2-cli-linux.html>EC2 CLI</a> tools.</p><p>####Bundle the image</p><pre><code>ec2-bundle-image -c cert.pem -k private-key.pem -u $AWS_USER_ID --arch x86_64 --image photon-ami.raw --destination directory-name
</code></pre><p>####Upload the bundle</p><pre><code>ec2-upload-bundle --manifest directory-name/photon-ami.raw.manifest.xml --bucket bucket-name --access-key $AWS_ACCESS_KEY --secret-key $AWS_SECRET_KEY
</code></pre><p>####Register the AMI</p><pre><code>ec2-register bucket-name/photon-ami.raw.manifest.xml --name name --architecture x86_64 --virtualization-type hvm
</code></pre><p>You can now launch instances using the AWS console.</p><p>For more information, see <a href=../run-photon-aws-ec2/>Customizing a Photon OS Machine on EC2</a>.</p><p>###OVA</p><p>The OVA image uses an optimized version of the 4.4.8 Linux kernel. Two ova files are generated from the build: photon-ova.ova, which is the full version of Photon OS, and photon-custom.ova, which is the minimal version of Photon OS. The password for photon-ova.ova should be changed using guest customization options when you upload it to VMware vCenter. Photon-custom.ova comes with the default password set to <code>changeme</code>; you must change it the first time you log in.</p><h4 id=ova-prerequisites>OVA Prerequisites</h4><p><a href=https://developercenter.vmware.com/web/sdk/60/vddk>VDDK 6.0</a></p><p>To utilize the VDDK libraries the following procedure may be used, this extracts the libraries and temporarily exports them to the LD_LIBRARY_PATH for the <em>current session</em>. (tested on Ubuntu 1404 & 1604) If you wish to make this permenant and system-wide then you may want to create a config file in /etc/ld.so.conf.d/.</p><pre><code>tar -zxf VMware-vix-disklib-6.0.2-3566099.x86_64.tar.gz
cp -r vmware-vix-disklib-distrib/include/* /usr/include/
mkdir /usr/lib/vmware
cp -a ~/vmware-vix-disklib-distrib/lib64/* /usr/lib/vmware/
rm /usr/lib/vmware/libstdc++.so.6
export LD_LIBRARY_PATH=/usr/lib/vmware
</code></pre><p><a href="https://my.vmware.com/group/vmware/details?downloadGroup=OVFTOOL410&productId=491">OVFTOOL</a></p><p>OVF Tool should be downloaded and installed on the host.</p><pre><code>sh VMware-ovftool-4.1.0-2459827-lin.x86_64.bundle --eulas-agreed --required
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-da713ae841dc4fb2318a7048de8be834>5 - Administration Guide</h1><p>The Photon OS <em>Administration Guide</em> describes the fundamentals of administering Photon OS.</p><p>The <em>Administration Guide</em> covers the basics of managing packages, controlling services with systemd, setting up networking, initializing Photon OS with cloud-init, running Docker containers, and working with other technologies, such as Kubernetes.</p><p><strong>Product version: 4.0</strong></p><p>This documentation applies to all 4.0.x releases.</p><h2 id=intended-audiences>Intended Audiences</h2><p>This information is intended for Photon OS administrators who install and set up Photon OS.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-a0565d71cffc68256f1eef73c83d610d>5.1 - Photon OS Packages</h1><p>The design of Photon OS simplifies life-cycle management and improves the security of packages. Photon reduces the burden and complexity of managing clusters of Linux machines by providing curated package repositories and by securing packages with GPG signatures.</p><p>Photon OS is available in a variety of pre-built packages in binary formats.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-5c060815eb25a8fdde3f32aa63e23ac2>5.1.1 - Examining the Packages in the SPECS Directory on Github</h1><p>The SPECS directory of the GitHub website for Photon OS contains all the packages that can appear in Photon OS repositories. The following is the path to the SPECS directory :</p><p><code>https://github.com/vmware/photon/tree/master/SPECS</code></p><p>To see the version of a package, in the SPECS directory, click the name of the subdirectory of the package that you want to examine, and then click the <code>.spec</code> filename in the subdirectory.</p><p>For example, the version of OpenJDK, which contains the openjre package that installs the Java class library and the javac Java compiler appears as follows:</p><pre><code>%define _use_internal_dependency_generator 0
Summary:	OpenJDK 
Name:		openjdk
Version:	1.8.0.72
Release:	1%{?dist}
License:	GNU GPL
URL:		https://openjdk.java.net
Group:		Development/Tools
Vendor:		VMware, Inc.
Distribution:   Photon
AutoReqProv: 	no
Source0:	http://anduin.linuxfromscratch.org/files/BLFS/OpenJDK-%{version}/OpenJDK-%{version}-x86_64-bin.tar.xz
%define sha1 OpenJDK=0c705d7b13f4e22611d2da654209f469a6297f26
%description
The OpenJDK package installs java class library and javac java compiler. 

%package	-n openjre
Summary:	Jave runtime environment
AutoReqProv: 	no
%description	-n openjre
It contains the libraries files for Java runtime environment
#%global __requires_exclude ^libgif.*$
#%filter_from_requires ^libgif.*$...
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-2ac7b05fa6cf7d20b74178c9da921230>5.1.2 - Looking at the Differences Between the Minimal and the Full Version</h1><p>The minimal version of Photon OS contains around 50 packages. As it is installed, the number of packages increases to nearly 100 to fulfill dependencies. The full version of Photon OS adds several hundred packages to those in the minimal version to deliver a more fully featured operating system.</p><p>You can view a list of the packages that appear in the minimal version by examining the following file:</p><p><a href=https://github.com/vmware/photon/blob/master/common/data/packages_minimal.json>https://github.com/vmware/photon/blob/master/common/data/packages_minimal.json</a></p><p>You can view a list of the packages that appear in the full (aka &ldquo;developer&rdquo;) version by examining the following file:</p><p><a href=https://github.com/vmware/photon/blob/master/common/data/packages_full.json>https://github.com/vmware/photon/blob/master/common/data/packages_full.json</a></p><p>If the minimal or the developer version of Photon OS does not contain a package that you want, you can install it with tdnf, which appears in both the minimal and full versions of Photon OS by default. In the full version of Photon OS, you can also install packages by using yum.</p><p>One notable difference between the two versions of Photon OS pertains to OpenJDK, the package that contains not only the Java runtime environment (<code>openjre</code>) but also the Java compiler (<code>javac</code>). The OpenJDK package appears in the full but not the minimal version of Photon OS.</p><p>To add support for Java programs to the minimal version of Photon OS, install the Java packages and their dependencies by using the following command:</p><pre><code>```console
tdnf install openjdk
Installing:
openjre 	x86_64    1.8.0.92-1.ph1    95.09 M
openjdk 	x86_64    1.8.0.92-1.ph1    37.63 M
```
</code></pre><p><strong>NOTE:</strong> <code>openjdk</code> and <code>openjre</code> are available as openjdk8 and openjre8 in Photon OS 3.0 and later.</p><p>For more information about <code>tdnf</code>, see <a href=../../managing-packages-with-tdnf/>Tiny DNF for Package Management</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-124e20efdc731b13cbd4b8db1880534f>5.1.3 - The Root Account and the 'sudo' and 'su' Commands</h1><p>The <em>Photon OS Administration Guide</em> assumes that you are logged in to Photon OS with the root account and running commands as root.</p><p>On the minimal version, you must install <code>sudo</code> with tdnf if you want to use it. As an alternative to installing <code>sudo</code>, to run commands that require root privileges you can switch users as needed with the <code>su</code> command.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-145afbb86032e888cc4af8fd6f202be5>5.1.4 - Examining Signed Packages</h1><p>Photon OS signs its packages and repositories with GPG signatures to enhance security. The GPG signature uses keyed-hash authentication method codes, typically the SHA1 algorithm and an RSA Data Security, Inc. MD5 Message Digest Algorithm, to simultaneously verify the integrity of a package. A keyed-hash message authentication code combines a cryptographic hash function with a secret cryptographic key.</p><p>In Photon OS, GPG signature verification automatically takes place when you install or update a package with the default package manager, <code>tdnf</code>. The default setting in the tdnf configuration file for checking the GPG is set to <code>1</code> for true:</p><pre><code>cat /etc/tdnf/tdnf.conf
[main]
gpgcheck=1
installonly_limit=3
clean_requirements_on_remove=true
repodir=/etc/yum.repos.d
cachedir=/var/cache/tdnf
</code></pre><p>On Photon OS, you can view the key with which VMware signs packages by running the following command:</p><pre><code>rpm -qa gpg-pubkey*
</code></pre><p>The command returns the GPG public key:</p><pre><code>gpg-pubkey-66fd4949-4803fe57
</code></pre><p>Once you have the name of the key, you can view information about the key with the <code>rpm -qi</code> command, as the following abridged output demonstrates:</p><pre><code>rpm -qi gpg-pubkey-66fd4949-4803fe57
Name        : gpg-pubkey
Version     : 66fd4949
Release     : 4803fe57
Architecture: (none)
Install Date: Thu Jun 16 11:51:39 2016
Group       : Public Keys
Size        : 0
License     : pubkey
Signature   : (none)
Source RPM  : (none)
Build Date  : Tue Apr 15 01:01:11 2008
Build Host  : localhost
Relocations : (not relocatable)
Packager    : VMware, Inc. -- Linux Packaging Key -- &lt;linux-packages@vmware.com&gt;
Summary     : gpg(VMware, Inc. -- Linux Packaging Key -- &lt;linux-packages@vmware.                        com&gt;)
Description :
-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: rpm-4.11.2 (NSS-3)
mI0ESAP+VwEEAMZylR8dOijUPNn3He3GdgM/kOXEhn3uQl+sRMNJUDm1qebi2D5b ...
</code></pre><p>If you have one of the RPMs from Photon OS on another Linux system, such as Ubuntu, you can use SHA and the RSA Data Security, Inc. MD5 Message Digest Algorithm for the package to verify that it has not been tampered with:</p><pre><code>rpm -K /home/steve/workspace/photon/stage/SRPMS/kubernetes-1.1.8-4.ph1.src.rpm
/home/steve/workspace/photon/stage/SRPMS/kubernetes-1.1.8-4.ph1.src.rpm: sha1 md5 OK
</code></pre><p>You can view the SHA1 digest and the RSA Data Security, Inc. MD5 Message Digest Algorithm by running the following command:</p><pre><code>rpm -Kv /home/steve/workspace/photon/stage/SRPMS/kubernetes-1.1.8-4.ph1.src.rpm
/home/steve/workspace/photon/stage/SRPMS/kubernetes-1.1.8-4.ph1.src.rpm:
Header SHA1 digest: OK (89b55443d4c9f67a61ae0c1ec9bf4ece2d6aa32b)
        MD5 digest: OK (51eee659a8730e25fd2a52aff9a6c2c2)
</code></pre><p>The above examples show that the Kubernetes package has not been tampered with.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-5becdc54572776a2fdbf1b9fa0f1b160>5.1.5 - Photon OS Package Repositories</h1><p>The default installation of Photon OS includes four yum-compatible repositories plus the repository on the Photon OS ISO when it is available in a CD-ROM drive:</p><pre><code>ls /etc/yum.repos.d/
photon-extras.repo
photon-iso.repo
photon-updates.repo
photon.repo 
</code></pre><p>The Photon ISO repository (<code>photon-iso.repo</code>) contains the installation packages for Photon OS. All the packages that Photon builds and publishes reside in the RPMs directory of the ISO when it is mounted. The RPMs directory contains metadata that lets it act as a yum repository. Mounting the ISO gives you all the packages corresponding to a Photon OS build. If, however, you built Photon OS yourself from the source code, the packages correspond only to your build, though they will typically be the latest. In contrast, the ISO that you obtain from the <a href=https://packages.vmware.com/photon>VMware Photon Packages</a> web site contains only the packages that are in the ISO at the point of publication. As a result, the packages may no longer match those on in the ISO, because they are updated more frequently.</p><p>The main Photon OS repository (<code>photon.repo</code>) contains all the packages that are built from the ISO or from another source. This repository points to a static batch of packages and spec files at the point of a release.</p><p>The updates repository (<code>photon-updates.repo</code>) is irrelevant to a major release until after the release is installed. Thereafter, the updates repository holds the updated packages for that release. The repository points to updates for the installed version, such as a version of Kubernetes that supersedes the version installed during the major release.</p><p>The Photon extras repository (<code>photon-extras.repo</code>) holds Likewise Open, an open source authentication engine, and other VMware software that you can add to Photon OS for free. Photon OS supports but does not build the packages in the extras repository.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-2f71ba1afee7ee244482d802b30ff4ee>5.1.6 - Building a Package from a Source RPM</h1><p>This section describes how to install and build a package on the full version of Photon OS from the package&rsquo;s source RPM. Obtain the source RPMs that Photon OS uses from the VMWare Packages repository: <a href=https://packages.vmware.com/photon>packages.vmware.com/photon</a></p><h2 id=prerequisites>Prerequisites</h2><ul><li><p>To build a package from its source RPM, or SRPM, Photon OS requires the following packages:</p><ul><li><p><code>rpmbuild</code>. This package is installed by default on the full version of Photon OS, so you should not have to install it.</p></li><li><p><code>gcc</code>. This package is also installed by default on the full version of Photon OS, so you should not have to install it.</p></li><li><p><code>make</code>, <code>Cmake</code>, <code>automake</code>, or another <code>make</code> package, depending on the package you are trying to install and build from its source RPM. Cmake is installed by default on Photon OS.</p><p>You can install other make packages by using tdnf or yum.</p></li></ul></li><li><p>A local unprivileged user account other than the root account. You should build RPMs as an unprivileged user. Do not build a package as <code>root</code> becau&ndash;building an RPM with the root account might damage your system.</p></li><li><p>Take a snapshot of your virtual machine before building the package if you are building a package on a virtual machine running Photon OS in VMware vSphere, VMware Workstation, or VMware Fusion.</p></li></ul><h2 id=procedure>Procedure</h2><p>VMware recommends that you install and build packages from their source RPMs on the full version of Photon OS. Do not use the minimal version to work with source RPMs.</p><p>Perfrom the following steps to install and build an example package- <code>sed</code> from its source RPM on Photon OS with an unprivileged account.</p><ol><li><p>check whether rpmbuild is installed by running the following command:</p><pre><code>rpmbuild --version
</code></pre><p>If it is not installed, install it by running the following command as root:</p><pre><code>tdnf install rpm-build
</code></pre></li><li><p>Create the directories for building RPMs under your local user account home directory and not under root:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mkdir -p ~/rpmbuild/<span style=color:#ce5c00;font-weight:700>{</span>BUILD,RPMS,SOURCES,SPECS,SRPMS<span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div></li><li><p>Create a <code>.rpmmacros</code> file under your home directory and override the default location of the RPM building tree with the new one. This command overwrites an existing <code>.rpmmacros</code> file. Before running the following command, make sure you do not already have a <code>.rpmmacros file</code>. If a <code>.rpmmacros</code> file exists, back it up under a new name in case you want to restore it later.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;%_topdir %(echo $HOME)/rpmbuild&#39;</span> &gt; ~/.rpmmacros
</code></pre></div></li><li><p>Place the source RPM file that you want to install and build in the <code>/tmp</code> directory.</p></li><li><p>Install the source file, run the following command with your unprivileged user account, replacing the sed example source RPM with the name of the one that you want to install:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>rpm -i /tmp/sed-4.2.2-2.ph1.src.rpm
</code></pre></div><p>The above command unpacks the source RPM and places its <code>.spec</code> file in your <code>~/rpmbuild/SPECS</code> directory. In the next step, the <code>rpmbuild</code> tool uses the <code>.spec</code> file to build the RPM.</p></li><li><p>Build the RPM, run the following commands with your unprivileged user account. Replace the <code>sed.spec</code> example file with the name of the <code>.spec</code> file that you want to build.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#204a87>cd</span> ~/rpmbuild/SPECS
rpmbuild -ba sed.spec
</code></pre></div><p>If successful, the rpmbuild -ba command builds the RPM and generates an RPM package file in your ~/rpmbuild/RPMS/x86_64 directory. For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ls RPMS/x86_64/
sed-4.2.2-2.x86_64.rpm  sed-debuginfo-4.2.2-2.x86_64.rpm  sed-lang-4.2.2-2.x86_64.rpm
</code></pre></div><p>The rpmbuild command also generates a new SRPM file and saves it in your ~/rpmbuild/SRPMS directory. For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ls SRPMS/
sed-4.2.2-2.src.rpm
</code></pre></div><p>If the rpmbuild command is unsuccessful with an error that it cannot find a library, you must install the RPMs for the library that your source RPM depends on before you can successfully build your source RPM. Iterate through installing the libraries that your source RPM relies on until you can successfully build it.</p></li><li><p>To install the RPM, run the following command with your unprivileged user account:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>rpm -i RPMS/x86_64/sed-4.2.2-2.x86_64.rpm
</code></pre></div></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-c3d21e7c9b262c639d62bccd74a99f6f>5.1.7 - Compiling C++ Code on the Minimal Version of Photon OS</h1><p>As a minimalist Linux run-time environment, the minimal version of Photon OS lacks the packages that you need to compile the code for a C++ program. For example, without the requisite packages, trying to compile the file containing the following code with the <code>gcc</code> command will generate errors:</p><pre><code>#include &lt;stdio.h&gt;
int main()
{
return 0;
}
</code></pre><p>The errors appear as follows:</p><pre><code>gcc test.c
-bash: gcc: command not found
tdnf install gcc -y
gcc test.c
test.c:1:19: fatal error: stdio.h: No such file or directory
compilation terminated.
</code></pre><p>To enable the minimal version of Photon OS to preprocess, compile, assemble, and link C++ code, you must install the following packages as root with tdnf:</p><ul><li><code>gcc</code></li><li><code>glibc-devel</code></li><li><code>binutils</code></li></ul><p>To install the packages, use the following the <code>tdnf</code> command:</p><pre><code>tdnf install gcc glibc-devel binutils</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-c8ae78810d3ae5754cbe6a65f8c5135f>5.2 - Package Management in Photon OS with 'tdnf'</h1><p>Photon OS manages packages with an open source, yum-compatible package manager called <code>tdnf</code>, for <a href=https://github.com/vmware/tdnf>Tiny Dandified Yum</a>. Tdnf keeps the operating system as small as possible while preserving yum&rsquo;s robust package-management capabilities.</p></div><div class=td-content><h1 id=pg-aeccf4f6e90eebd94ddf84852fb0d862>5.2.1 - Introduction to 'tdnf'</h1><p>On Photon OS, <code>tdnf</code> is the default package manager for installing new packages. It is a C implementation of the DNF package manager without Python dependencies.</p><p>Tdnf appears in the minimal and full versions of Photon OS.</p><p>Tdnf implements a subset of the <code>dnf</code> commands as listed in the <a href=http://dnf.readthedocs.org/en/latest/>dnf guide</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6be25b0c71d43e9d95b95caace1ff5ad>5.2.2 - Configuration Files and Repositories</h1><p>The main configuration files reside in /etc/tdnf/tdnf.conf. The configuration file appears as follows:</p><pre><code>cat /etc/tdnf/tdnf.conf
[main]
gpgcheck=1
installonly_limit=3
clean_requirements_on_remove=true
repodir=/etc/yum.repos.d
cachedir=/var/cache/tdnf
</code></pre><p>The cache files for data and metadata reside in /var/cache/tdnf.</p><p>The following repositories appear in /etc/yum.repos.d/ with <code>.repo</code> file extensions:</p><pre><code>ls /etc/yum.repos.d/
photon-extras.repo
photon-iso.repo
photon-updates.repo
photon.repo 
</code></pre><p>You can list the the repositories by using the <code>tdnf repolist</code> command. Tdnf filters the results with <code>enabled</code>, <code>disabled</code>, and <code>all</code>. Running the command without specifying an argument returns the enabled repositories:</p><pre><code>tdnf repolist
repo id             repo name                               status
photon-updates      VMware Photon Linux 2.0(x86_64)Updates  enabled
photon-extras       VMware Photon Extras 2.0(x86_64)        enabled
photon              VMware Photon Linux 2.0(x86_64)         enabled
</code></pre><p>The <code>photon-iso.repo</code>, however, does not appear in the list of repositories because it is unavailable on the virtual machine from which these examples are taken. The <code>photon-iso.repo</code> is the default repository and it points to /media/cdrom. The <code>photon-iso.repo</code> appears as follows:</p><pre><code>cat /etc/yum.repos.d/photon-iso.repo
[photon-iso]
name=VMWare Photon Linux 2.0(x86_64)
baseurl=file:///mnt/cdrom/RPMS
gpgkey=file:///etc/pki/rpm-gpg/VMWARE-RPM-GPG-KEY
gpgcheck=1
enabled=0
skip_if_unavailable=True
</code></pre><p>The local cache is populated with data from the repository:</p><pre><code>ls -l /var/cache/tdnf/photon
total 8
drwxr-xr-x 2 root root 4096 May 18 22:52 repodata
d-wxr----t 3 root root 4096 May  3 22:51 rpms
</code></pre><p>You can clear the cache to help troubleshoot a problem, but doing so might slow the performance of <code>tdnf</code> until the cache becomes repopulated with data. To clear the cache, use the following command:</p><pre><code>tdnf clean all
Cleaning repos: photon photon-extras photon-updates lightwave
Cleaning up everything
</code></pre><p>The command purges the repository data from the cache:</p><pre><code>ls -l /var/cache/tdnf/photon
total 4
d-wxr----t 3 root root 4096 May  3 22:51 rpms</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-8b0a5b9452d0d77879fd1eda17c6482e>5.2.3 - Adding a New Repository</h1><p>On Photon OS, you can add a new repository from which <code>tdnf</code> installs packages. To add a new repository, you create a repository configuration file with a <code>.repo</code> extension and place it in <code>/etc/yum.repos.d</code>. The repository can be on either the Internet or a local server containing your in-house applications.</p><p>Be careful if you add a repository that is on the Internet. Installing packages from untrusted or unverified sources might put the security, stability, or compatibility of your system at risk. It might also make your system harder to maintain.</p><p>On Photon OS, the existing repositories appear in the <code>/etc/yum.repos.d</code> directory:</p><pre><code>ls /etc/yum.repos.d/
photon-extras.repo
photon-iso.repo
photon-updates.repo
photon.repo 
</code></pre><p>To view the the format and information that a new repository configuration file should contain, see one of the <code>.repo</code> files. The following is an example:</p><pre><code>baseurl=https://https://packages.vmware.com/photon/
metalink=http://example.com/*username*/metalink/metalink
gpgkey=file:///etc/pki/rpm-gpg/VMWARE-RPM-GPG-KEY
gpgcheck=1
enabled=1
skip_if_unavailable=True
</code></pre><p>The repository settings details are as follows:</p><ul><li><p>The minimal information needed to establish a repository is an ID and human-readable name of the repository and its base URL. The ID, which appears in square brackets, must be one word that is unique amoung the system&rsquo;s repositories; `.</p></li><li><p>The <code>baseurl</code> is a URL for the repository&rsquo;s repodata directory. For a repository on a local server that can be accessed directly or mounted as a file system, the base URL can be a file referenced by <code>file://</code>. Example:</p><p>baseurl=file:///server/repo/</p></li><li><p>By using <code>metalink</code>, you can point to multiple URLs to download the <code>repomd.xml</code> file. A sample metalink file is as follows:</p><p><code>cat metalink</code></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
  
<span style=color:#204a87;font-weight:700>&lt;metalink</span> <span style=color:#c4a000>version=</span><span style=color:#4e9a06>&#34;3.0&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.metalinker.org/&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;dynamic&#34;</span> <span style=color:#c4a000>pubdate=</span><span style=color:#4e9a06>&#34;Wed, 05 Feb 2020 08:14:56 GMT&#34;</span> <span style=color:#c4a000>generator=</span><span style=color:#4e9a06>&#34;mirrormanager&#34;</span> <span style=color:#c4a000>xmlns:mm0=</span><span style=color:#4e9a06>&#34;http://fedorahosted.org/mirrormanager&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
  
 <span style=color:#204a87;font-weight:700>&lt;files&gt;</span>
  
  <span style=color:#204a87;font-weight:700>&lt;file</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;repomd.xml&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
  
   <span style=color:#204a87;font-weight:700>&lt;size&gt;</span>2035<span style=color:#204a87;font-weight:700>&lt;/size&gt;</span>
  
   <span style=color:#204a87;font-weight:700>&lt;verification&gt;</span>
  
<span style=color:#204a87;font-weight:700>&lt;hash</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;sha1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>478437547dac9f5a73fe905d2ed2a0a5b153ef46<span style=color:#204a87;font-weight:700>&lt;/hash&gt;</span>
  
<span style=color:#204a87;font-weight:700>&lt;hash</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;sha512&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>6c6fbfba288ec90905a8d2220a0bfd2a50e835b7faaefedb6978df6ca59c5bce25cc1ddd33023e305b20bcffc702ee2bd61d0855f4f1b2fd7c8f5109e428a764<span style=color:#204a87;font-weight:700>&lt;/hash&gt;</span>
  
   <span style=color:#204a87;font-weight:700>&lt;/verification&gt;</span>
  
   <span style=color:#204a87;font-weight:700>&lt;resources</span> <span style=color:#c4a000>maxconnections=</span><span style=color:#4e9a06>&#34;1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
  
<span style=color:#204a87;font-weight:700>&lt;url</span> <span style=color:#c4a000>protocol=</span><span style=color:#4e9a06>&#34;http&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;http&#34;</span> <span style=color:#c4a000>location=</span><span style=color:#4e9a06>&#34;IN&#34;</span> <span style=color:#c4a000>preference=</span><span style=color:#4e9a06>“100”</span><span style=color:#204a87;font-weight:700>&gt;</span>https://packages.vmware.com/photon/3.0/photon_updates_3.0_x86_64/repodata/repomd.xml<span style=color:#204a87;font-weight:700>&lt;/url&gt;</span>
   
   <span style=color:#204a87;font-weight:700>&lt;/resources&gt;</span>
  
  <span style=color:#204a87;font-weight:700>&lt;/file&gt;</span>
  
 <span style=color:#204a87;font-weight:700>&lt;/files&gt;</span>
  
<span style=color:#204a87;font-weight:700>&lt;/metalink&gt;</span>
</code></pre></div><p>In the metalink file, provide the preference for each url, so <code>tdnf</code> first tries to sync the repository data from the mirror which has the highest preference. If it fails due to any reason, <code>tdnf</code> will sync to the next mirror url with the lower preference than before one.</p><p>Note: Ensure that the shasum for <code>respomd.xml</code> in all the mirrors should be same</p></li><li><p>The <code>gpgcheck</code> setting specifies whether to check the GPG signature.</p></li><li><p>The <code>repo_gpgcheck</code> setting allows <code>tdnf</code> to verify the signature of a repository metadata before downloading the repository artifacts. When <code>repo_gpgcheck</code> is set to <code>1</code> in the tdnf.conf file, all repositories will be checked for the metadata signatures. The default value is <code>0</code>.
If a repository has <code>repo_gpgcheck</code> enabled,a <code>repomd.xml.asc</code> file is downloaded and the API equivalent of <code>gpg --verify repomd.xml.asc repomd.xml</code> is done. If <code>repomd.xml.asc</code> is missing, repository is disabled. If <code>repomd.xml.asc</code> fails to verify, the repository is disabled. The public key for verification must be manually installed for the initial implementation.</p><p>Note: Ensure that you have installed <code>libgcrypt</code> for this implementation.</p></li><li><p>The <code>gpgkey</code> setting furnishes the URL for the repository&rsquo;s ASCII-armored GPG key file. <code>tdnf</code> uses the GPG key to verify a package if its key has not been imported into the RPM database.</p><p>The repository configuration also supports public keys that are remote for the <code>gpgkey</code> option. So, the URLs starting with <code>http</code>, <code>https</code>, or <code>ftp</code> can be used for <code>gpgkey</code>.</p><p>For example:
gpgkey=http://build-squid.eng.vmware.com/build/mts/release/bora-16633979/publish/packages/keys/vmware.asc</p></li><li><p>The <code>enabled</code> setting tells <code>tdnf</code> whether to poll the repository. If <code>enabled</code> is set to <code>1</code>, <code>tdnf</code> polls it; if it is set to <code>0</code>, <code>tdnf</code> ignores it.</p></li><li><p>The <code>skip_if_unavailable</code> setting instructs <code>tdnf</code> to continue running if the repository goes offline.</p></li><li><p>The <code>retries</code> setting in the repository configuration specifies the number of retries when downloading a file throws an error. The default is <code>10</code>.</p></li><li><p>The <code>timeout</code> setting specifies the number of seconds that a download is allowed to take or <code>0</code> for no limit. Note that this is an absolute value and may interrupt large file downloads.</p></li><li><p>The <code>minrate</code> setting specifies the limit below which if the download rate falls, <code>tdnf</code> will abort the download. The default value is <code>0 </code>(<code>no limit</code>).</p></li><li><p>The <code>maxrate</code> setting specifies the maximum download rate (throttle). The default value is <code>0 </code>(<code>no limit</code>).</p></li><li><p>Other options and variables can appear in the repository file. The variables that are used with some of the options can reduce future changes to the repository configuration files. There are variables to replace the value of the version of the package and to replace the base architecture. For more information, see the man page for <code>yum.conf</code> on the full version of Photon OS: <code>man yum.conf</code></p></li></ul><p>The following is an example of how to add a new repository for a local server that <code>tdnf</code> polls for packages:</p><pre><code>cat &gt; /etc/yum.repos.d/apps.repo &lt;&lt; &quot;EOF&quot;
[localapps]
name=Local In-House Applications(x86_64)
baseurl=file:///appserver/apps
enabled=1
skip_if_unavailable=True
EOF
</code></pre><p>Because this new repository resides on a local server, make sure the Photon OS machine can connect to it by mounting it.</p><p>After establishing a new repository, you must run the following command to update the cached binary metadata for the repositories that <code>tdnf</code> polls:</p><pre><code>tdnf makecache
Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)Updates'
Refreshing metadata for: 'VMware Photon Extras 1.0(x86_64)'
Refreshing metadata for: 'Local In-House Applications(x86_64)'
Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)'
Metadata cache created.</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-22786583a3c44dee63ba82f7ee05def1>5.2.4 - Mount the Photon ISO Image for the Photon-ISO Repository</h1><p>Photon OS comes with a preconfigured repository called <code>photon-iso</code> that resides in <code>\etc\yum.repos.d.</code> If you receive an access error message when working with the <code>photon-iso</code> repository, it is probably because you do not have the Photon OS ISO mounted. Mount the ISO and the run the following command to update the metadata for all known repositories, including <code>photon-iso</code>:</p><pre><code>mount /dev/cdrom /media/cdrom
tdnf makecache

Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)Updates'
Refreshing metadata for: 'VMware Photon Extras 1.0(x86_64)'
Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)'
Metadata cache created.
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-2bc8840342a170e58fd10f1e939e9fa4>5.2.5 - Adding the Dev Repository to Get New Packages from the GitHub Dev Branch</h1><p>To try out new packages or the latest versions of existing packages as they are merged into the dev branch of the Photon OS GitHub site, add the <code>dev</code> repository to your repository list.</p><p>Perform th following steps:</p><ol><li>On your Photon OS machine, run the following command as root to create a repository configuration file named <code>photon-dev.repo</code>, place it in <code>/etc/yum.repos.d</code>, and concatenate the repository information into the file:</li></ol><pre><code>cat &gt; /etc/yum.repos.d/photon-dev.repo &lt;&lt; &quot;EOF&quot; 
    [photon-dev]
    name=VMware Photon Linux Dev(x86_64)
    baseurl=https://packages.vmware.com/photon/dev/photon_dev_$basearch
    gpgkey=file:///etc/pki/rpm-gpg/VMWARE-RPM-GPG-KEY
    gpgcheck=1
    enabled=1
    skip_if_unavailable=True
    EOF
    .
</code></pre><ol start=2><li>After establishing a new repository, run the following command to update the cached binary metadata for the repositories that <code>tdnf</code> polls:</li></ol><pre><code>tdnf makecache
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-444ec768f07dc7d65abd846e1d83ed06>5.2.6 - tdnf-automatic</h1><p><code>tdnf-automatic</code> is an alternative Command Line Interface (CLI) to <code>tdnf upgrade/tdnf update</code> with specific features so that it is suitable to be executed automatically and regularly from <code>systemd</code> timers, cron jobs, and so on.</p><p>The operation of the tool is usually controlled by the configuration file or the function-specific timer units. The command only accepts a single optional argument pointing to the config file, and some control arguments intended for use by the services that back the timer units. If no configuration file is passed from the command line,then <code>/etc/tdnf/automatic.conf</code> is used.</p><p>The tool synchronizes package metadata as needed and then checks for the updates available for the given system and then either exits or shows available updates or downloads and installs the packages.</p><p>The outcome of the operation is then reported through <code>stdio</code>.</p><p>The <code>systemd</code> timer unit <code>tdnf-automatic.timer</code> behaves as the configuration file specifies whether to download and apply updates. Some other timer units are provided which override the configuration file with some standard behaviors:</p><pre><code>* tdnf-automatic-notifyonly

* tdnf-automatic-install
</code></pre><p>Irrespective of the configuration file settings, the first only notifies of available updates. The second one downloads and installs the updates.</p><h3 id=run-tdnf-automatic>Run tdnf-automatic</h3><p>You can select one that most closely fits your needs, customize /etc/tdnf/automatic.conf for any specific behaviors, and enable the timer unit.</p><p>For example: systemctl enable &ndash;now tdnf-automatic-notifyonly.timer</p><h3 id=configuration-file-format>Configuration file format</h3><p>The configuration file is separated into two sections. This basically gives info on what can be put in /etc/tdnf/automatic.conf. &lsquo;automatic.conf&rsquo; is a configuration INI file.</p><h3 id=format>Format</h3><pre><code>tdnf-automatic help:

tdnf-automatic [{-c|--conf config-file}(optional)] [{-i|--install}] [{-n|--notify}] [{-h|--help}] [{-v|--version}]



-c, --conftdnf-automatic configuration file (Optional argument)

-i, --installOverride automatic.conf apply_updates and install updates

-n, --notifyShow available updates

-h, --helpShow this help message

-v, --versionShow tdnf-automatic version information
</code></pre><h3 id=commands>Commands</h3><p>To set the mode of the operation of the program:</p><ul><li><p><code>apply_updates (boolean, default: no)</code>
Whether packages comprising the available updates should be applied by tdnf-automatic.timer, i.e. installed via RPM. Note that the other timer units override this setting.</p></li><li><p><code>show_updates (boolean, default: yes)</code>
To just receive updates use tdnf-automatic-notifyonly.timer</p></li><li><p><code>network_online_timeout (time in seconds, default: 60)</code>
Maximum time tdnf-automatic will wait until the system is online. 0 means that network availability detection will be skipped.</p></li><li><p><code>random_sleep (time in seconds, default: 0)</code>
Maximum random delay before downloading. Note that, by default, the systemd timers also apply a random delay of up to 1 hour.</p></li><li><p><code>upgrade_type (either one of all or security. default: </code>all<code>)</code>
Looks at the kind of upgrades. <code>all</code> signals looking for all available updates. <code>security</code> indicates only those with an issued security advisory.</p></li><li><p><code>tdnf_conf (string, default: /etc/tdnf/tdnf.conf)</code>
Configurations to override default tdnf configuration.</p></li></ul><h3 id=reports>Reports</h3><p>To select how the results should be reported:</p><ul><li><p>emit_to_stdio (boolean, default: yes)
Report the results through stdio. If no, no report will be shown.</p></li><li><p>system_name (string, default: hostname of the given system)
How the system is called in the reports.</p></li><li><p>emit_to_file (string, absolute path of file)
If we want to capture the logs in a file</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-9d1ec0e86cc83f47a85563f817d4e446>5.2.7 - Install Packages from CLI</h1><p>You can install the packages from the command line. The package can be a file or a URL. The dependencies are installed automatically.</p><p>For example:</p><ul><li><p>Using a URL:</p><pre><code>  tdnf install https://packages.vmware.com/photon/4.0/photon_release_4.0_x86_64/x86_64/open-vm-tools-11.2.5-1.ph4.x86_64.rpm

  open-vm-tools-11.2.5-1.ph4.x86_64.rpm 763014   100%
    
  Installing:

  attrx86_642.4.48-1.ph4  photon  88.65k 90778

  nss x86_643.57-2.ph4photon  1.69M 1768005

  ...

  open-vm-tools   x86_6411.2.5-1.ph4  @cmdline2.65M 2779392


  Total installed size:  91.57M 96019175


  Upgrading:

  nss-libsx86_643.57-2.ph4photon  2.48M 2601790

  util-linux-libs x86_642.36-2.ph4photon752.75k 770816

  pcre-libs   x86_648.44-2.ph4photon275.60k 282216



  Total installed size:   3.49M 3654822

  Is this ok [y/N]: 
</code></pre></li><li><p>Using a file:</p><pre><code>  tdnf install ../lsof-4.91-1.ph4.x86_64.rpm 

   
  Installing:

  libtirpcx86_641.2.6-1.ph4   photon193.56k 198209

  lsofx86_644.91-1.ph4@cmdline  196.10k 200810

  Total installed size: 389.67k 399019</code></pre></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-3698094ce22ba1a521e28ad24f2a29a3>5.2.8 - SSL Options</h1><p>Photon OS offers support for the SSL Options.</p><p>You can set the following SSL options in the repository configuration file:</p><ul><li><p><code>sslverify</code>
When downloading using <code>https</code>, this option helps to verify the SSL certificate of the server. You can set it to <code>0</code> or <code>1</code>. The default is <code>1</code>.</p></li><li><p><code>sslcacert</code>
You can use this option to set the path to a certificate file to verify the server.</p></li><li><p><code>sslclientcert</code>
You can use this option to set the path to a client certificate file.</p></li><li><p><code>sslclientkey</code>
You can set this path to the client key file.</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-11b8159529e3f82cce563049b0388450>5.2.9 - Standard Syntax for tdnf Commands</h1><p>The standard syntax for <code>tdnf</code> commands is the same as that for DNF and is as follows:</p><pre><code>tdnf [options] &lt;command&gt; [&lt;arguments&gt;...]
</code></pre><p>You can view help information by using the following commands:</p><pre><code>tdnf --help
tdnf -h</code></pre></div><div class=td-content><h1 id=pg-71f32dc6708994c40c40019a3c250f21>5.2.9.1 - tdnf Commands</h1><p><strong>check</strong>: Checks for problems in installed and available packages for all enabled repositories. The command has no arguments. You can use <code>--enablerepo</code> and <code>--disablerepo</code> to control the repos used. Supported in Photon OS 2.0 (only).</p><p><strong>check-local</strong>: This command resolves dependencies by using the local RPMs to help check RPMs for quality assurance before publishing them. To check RPMs with this command, you must create a local directory and place your RPMs in it. The command, which includes no options, takes the path to the local directory containing the RPMs as its argument. The command does not recursively parse directories. It checks the RPMs only in the directory that you specify. For example, after creating a directory named <code>/tmp/myrpms</code> and placing your RPMs in it, you can run the following command to check them:</p><pre><code>tdnf check-local /tmp/myrpms
Checking all packages from: /tmp/myrpms
Found 10 packages
Check completed without issues
</code></pre><p><strong>check-update</strong>: This command checks for updates to packages. It takes no arguments. The <code>tdnf list updates</code> command performs the same function. Here is an example of the <code>check update</code> command:</p><pre><code>tdnf check-update
rpm-devel.x86_64 	4.11.2-8.ph1 	photon
yum.noarch      	3.4.3-3.ph1 	photon
</code></pre><p><strong>clean</strong>: This command cleans up temporary files, data, and metadata. It takes the argument <code>all</code>. Example:</p><pre><code>tdnf clean all
Cleaning repos: photon photon-extras photon-updates
Cleaning up everything
</code></pre><p><strong>distro-sync</strong>: This command synchronizes the machine&rsquo;s RPMs with the latest version of all the packages in the repository. The following is an abridged example:</p><pre><code>tdnf distro-sync

Upgrading:
zookeeper                             x86_64        3.4.8-2.ph1               3.38 M
yum                                   noarch        3.4.3-3.ph1               4.18 M

Total installed size: 113.01 M

Reinstalling:
zlib-devel                            x86_64        1.2.8-2.ph1             244.25 k
zlib                                  x86_64        1.2.8-2.ph1             103.93 k
yum-metadata-parser                   x86_64        1.1.4-1.ph1              57.10 k

Total installed size: 1.75 G

Obsoleting:
tftp                                  x86_64        5.2-3.ph1                32.99 k

Total installed size: 32.99 k
Is this ok [y/N]:
</code></pre><p><strong>downgrade</strong>: This command downgrades the package that you specify as an argument to the next lower package version. The following is an example:</p><pre><code>tdnf downgrade boost
Downgrading:
boost                                 x86_64        1.56.0-2.ph1              8.20 M
Total installed size: 8.20 M
Is this ok [y/N]:y
Downloading:
boost                                  2591470    100%
Testing transaction
Running transaction
Complete!
</code></pre><p>To downgrade to a version lower than the next one, you must specify it by name, epoch, version, and release, all properly hyphenated. The following is an example:</p><pre><code>tdnf downgrade boost-1.56.0-2.ph1 
</code></pre><p><strong>erase</strong>: This command removes the package that you specify as an argument.</p><p>To remove a package, run the following command:</p><pre><code>tdnf erase pkgname
</code></pre><p>The following is an example:</p><pre><code>tdnf erase vim
Removing:
vim                                   x86_64        7.4-4.ph1                 1.94 M
Total installed size: 1.94 M
Is this ok [y/N]:
</code></pre><p>You can also erase multiple packages:</p><pre><code>tdnf erase docker cloud-init
</code></pre><p><strong>info</strong>: This command displays information about packages. It can take the name of a package. Or it can take one of the following arguments: all, available, installed, extras, obsoletes, recent, upgrades. The following are examples:</p><pre><code>tdnf info ruby
tdnf info obsoletes
tdnf info upgrades
</code></pre><p><strong>install</strong>: This command takes the name of a package as its argument. It then installs the package and its dependencies.</p><p>To install a package, run the following command:</p><pre><code>tdnf install pkgname
</code></pre><p>The following are examples:</p><pre><code>tdnf install kubernetes
</code></pre><p>You can also install multiple packages:</p><pre><code>tdnf install python-curses lsof audit gettext chkconfig ntsysv bindutils 
     wget gawk irqbalance lvm2 cifs-utils c-ares distrib-compat
</code></pre><p><strong>list</strong>: This command lists the packages of the package that you specify as the argument. The command can take one of the following arguments: all, available, installed, extras, obsoletes, recent, upgrades.</p><pre><code>tdnf list updates
</code></pre><p>The list of packages might be long. To more easily view it, you can concatenate it into a text file, and then open the text file in a text editor:</p><pre><code>tdnf list all &gt; pkgs.txt
vi pkgs.txt
</code></pre><p>To list enabled repositories, run the following command:</p><pre><code>tdnf repolist
</code></pre><p><strong>makecache</strong>: This command updates the cached binary metadata for all known repositories. The following is an example:</p><pre><code>tdnf makecache
Refreshing metadata for: 'VMware Lightwave 1.0(x86_64)'
Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)Updates'
Refreshing metadata for: 'VMware Photon Extras 1.0(x86_64)'
Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)'
Metadata cache created.
</code></pre><p><strong>provides</strong>: This command finds the packages that provide the package that you supply as an argument. The following is an example:</p><pre><code>tdnf provides docker
docker-1.11.0-1.ph1.x86_64 : Docker
Repo     : photon
docker-1.11.0-1.ph1.x86_64 : Docker
Repo     : @System
</code></pre><p><strong>reinstall</strong>: This command reinstalls the packages that you specify. If some packages are unavailable or not installed, the command fails. The following is an example:</p><pre><code>tdnf reinstall docker kubernetes

Reinstalling:
kubernetes                            x86_64        1.1.8-1.ph1             152.95 M
docker                                x86_64        1.11.0-1.ph1             57.20 M

Total installed size: 210.15 M
</code></pre><p><strong>remove</strong>: This command removes a package. When removing a package, tdnf by default also removes dependencies that are no longer used if they were was installed by tdnf as a dependency without being explicitly requested by a user. You can modify the dependency removal by changing the <code>clean_requirements_on_remove</code> option in /etc/tdnf/tdnf.conf to <code>false</code>.</p><pre><code>tdnf remove packagename
</code></pre><p><strong>search</strong>: This command searches for the attributes of packages. The argument can be the names of packages. The following is an example:</p><pre><code>tdnf search docker kubernetes
docker : Docker
docker : Docker
docker-debuginfo : Debug information for package docker
docker : Docker
kubernetes : Kubernetes cluster management
kubernetes : Kubernetes cluster management
kubernetes-debuginfo : Debug information for package kubernetes
kubernetes : Kubernetes cluster management
</code></pre><p>The argument of the search command can also be a keyword or a combination of keywords and packages:</p><pre><code>tdnf search terminal bash
rubygem-terminal-table : Simple, feature rich ascii table generation library
ncurses : Libraries for terminal handling of character screens
mingetty : A minimal getty program for virtual terminals
ncurses : Libraries for terminal handling of character screens
ncurses : Libraries for terminal handling of character screens
bash : Bourne-Again SHell
bash-lang : Additional language files for bash
bash-lang : Additional language files for bash
bash : Bourne-Again SHell
bash-debuginfo : Debug information for package bash
bash : Bourne-Again SHell
bash-lang : Additional language files for bash
</code></pre><p><strong>updateinfo</strong>: This command displays security advisories about packages. The following is an example:</p><pre><code>tdnf updateinfo info

Name : unzip-6.0-15.ph3.x86_64.rpm
Update ID : patch:PHSA-2020-3.0-0083
Type : Security
Updated : Fri Apr 24 01:15:03 2020
Needs Reboot: 0
Description : Security fixes for {'CVE-2018-1000035'}
Name : runc-1.0.0.rc9-3.ph3.x86_64.rpm
Update ID : patch:PHSA-2020-3.0-0102
Type : Security
Updated : Tue Jun  9 06:01:28 2020
Needs Reboot: 0
Description : Security fixes for {'CVE-2019-19921'}
Name : ruby-2.5.8-2.ph3.x86_64.rpm
Update ID : patch:PHSA-2020-3.0-0163
Type : Security
Updated : Thu Nov 19 17:21:29 2020
Needs Reboot: 0
</code></pre><p><strong>upgrade</strong>: This command upgrades the package or packages that you specify to an available higher version that tdnf can resolve. If the package is already the latest version, the command returns <code>Nothing to do</code>. The following is an example:</p><pre><code>tdnf upgrade boost

Upgrading:
boost                                 x86_64        1.60.0-1.ph1              8.11 M

Total installed size: 8.11 M
Is this ok [y/N]:y

Downloading:
boost                                  2785950    100%
Testing transaction
Running transaction

Complete!
</code></pre><p>You can also run the <code>upgrade</code> command with the <code>refresh</code> option to update the cached metadata with the latest information from the repositories. The following example refreshes the metadata and then checks for a new version of tdnf but does not find one, so tdnf takes no action:</p><pre><code>tdnf upgrade tdnf --refresh
Refreshing metadata for: 'VMware Lightwave 1.0(x86_64)'
Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)Updates'
Refreshing metadata for: 'VMware Photon Extras 1.0(x86_64)'
Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)'
Nothing to do.
</code></pre><p><strong>upgrade-to</strong>: This command upgrades to the version of the package that you specify. The following is an example:</p><pre><code>tdnf upgrade-to ruby2.3
</code></pre><p>The commands and options of tdnf are a subset of those of dnf. For more help with <code>tdnf</code> commands, see the <a href=https://media.readthedocs.org/pdf/dnf/latest/dnf.pdf>DNF documentation</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-147b87d31129020a1635f26df1914a29>5.2.9.2 - tdnf Command Options</h1><p>You can add the following options to <code>tdnf</code> commands. If the option to override a configuration is unavailable in a command, you can add it to the <code>/etc/tdnf/tdnf.conf</code> configuration file.</p><pre><code>OPTION                     DESCRIPTION
--allowerasing             Allow erasing of installed packages to resolve dependencies
--assumeno                 Answer no for all questions
--best                     Try the best available package versions in transactions
--debugsolver              Dump data aiding in dependency solver debugging info.
--disablerepo=&lt;repoid&gt;     Disable specific repositories by an id or a glob.
--enablerepo=&lt;repoid&gt;      Enable specific repositories
-h, --help                 Display help
--refresh                  Set metadata as expired before running command
--nogpgcheck               Skip gpg check on packages
--rpmverbosity=&lt;debug level name&gt;
                           Debug level for rpm
--version                  Print version and exit
-y, --assumeyes            Answer yes to all questions
-q, --quiet                Quiet operation
--downloadonly             Enables you to download the packages and dependencies that are
                           not installed to the cache.
--downloaddir=dir          Downloads the packages to the specified directory 
</code></pre><p>The following is an example that adds the short form of the <code>assumeyes</code> option to the install command:</p><pre><code>tdnf -y install gcc
Upgrading:
gcc 	x86_64	5.3.0-1.ph1 	91.35 M
</code></pre><p>The following is an example for the <code>downloadonly</code> option with the install command:</p><pre><code>tdnf install --downloadonly less
    
Installing:
    
lessx86_64551-2.ph4 photon234.35k 239976
       
Total installed size: 234.35k 239976
  
tdnf will only download packages needed for the transaction
   
Is this ok [y/N]: y

Downloading:
   
less117650   100%
    
Complete!
   
Packages have been downloaded to cache.
</code></pre><p>The following is an example for the <code>downloaddir=dir</code> option with the install command:</p><pre><code>tdnf install --downloadonly --downloaddir=/tmp less
 
Installing:

lessx86_64551-2.ph4 photon234.35k 239976
        
Total installed size: 234.35k 239976

tdnf will only download packages needed for the transaction

Is this ok [y/N]: y

Downloading:

less117650   100%

    
Complete!

Packages have been downloaded to /tmp.

root [ /build/build ]# ls -l /tmp/less-551-2.ph4.x86_64.rpm 

-rw-r--r-- 1 root root 117650 Feb 22 18:43 /tmp/less-551-2.ph4.x86_64.rpm
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-e3d4bf08b8b5944ee1453e9ff5330375>5.3 - Managing Services with 'systemd'</h1><p>Photon OS manages services with <code>systemd</code>. By using <code>systemd</code>, Photon OS adopts a contemporary Linux standard to bootstrap the user space and concurrently start services. This is an architecture that differs from traditional Linux systems such as SUSE Linux Enterprise Server.</p><p>A traditional Linux system contains an initialization system called SysVinit. With SLES 11, for instance, the SysVinit-style init programs control how the system starts up and shuts down. Init implements system runlevels. A SysVinit runlevel defines a state in which a process or service runs.</p><p>In contrast to a SysVinit system, <code>systemd</code> defines no such runlevels. Instead, <code>systemd</code> uses a dependency tree of targets to determine which services to start when. Combined with the declarative nature of <code>systemd</code> commands, <code>systemd</code> targets reduce the amount of code needed to run a command, leaving you with code that is easier to maintain and probably faster to execute. For an overview of <code>systemd</code>, see <a href=https://www.freedesktop.org/wiki/Software/systemd/>systemd System and Service Manager</a> and the <a href=https://www.freedesktop.org/software/systemd/man/systemd.html>man page for systemd</a>.</p><p>On Photon OS, you must manage services with systemd and <code>systemctl</code>, its command-line utility for inspecting and controlling the system, and not the deprecated commands of <code>init.d</code>.</p><p>For more information, see the index of all the systemd man pages, including systemctl, at
<a href=https://www.freedesktop.org/software/systemd/man/>https://www.freedesktop.org/software/systemd/man/</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-5ccb448ef95f9f2329e6d403e088cea1>5.3.1 - Viewing Services</h1><p>To view a description of all the loaded and active units, run the <code>systemctl</code> command without any options or arguments:</p><pre><code>systemctl
</code></pre><p>To see all the loaded, active, and inactive units and their description, run the following command:</p><pre><code>systemctl --all
</code></pre><p>To see all the unit files and their current status but no description, run thie following command:</p><pre><code>systemctl list-unit-files
</code></pre><p>The <code>grep</code> command filters the services by a search term, a helpful tactic to recall the exact name of a unit file without looking through a long list of names. Example:</p><pre><code>systemctl list-unit-files | grep network
org.freedesktop.network1.busname           static
dbus-org.freedesktop.network1.service      enabled
systemd-networkd-wait-online.service       enabled
systemd-networkd.service                   enabled
systemd-networkd.socket                    enabled
network-online.target                      static
network-pre.target                         static
network.target                             static</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-66dba9f3a2f81395d9cc5c35c31646b9>5.3.2 - Controlling Services</h1><p>To control services on Photon OS, use <code>systemctl</code> command.</p><p>For example, instead of running the <code>/etc/init.d/ssh</code> script to stop and start the OpenSSH server on a init.d-based Linux system, run the following <code>systemctl</code> commands on Photon OS:</p><pre><code>systemctl stop sshd
systemctl start sshd
</code></pre><p>The systemctl tool includes a range of commands and options for inspecting and controlling the state of systemd and the service manager. For more information, see the <a href=https://www.freedesktop.org/software/systemd/man/systemctl.html>systemctl man page</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-84ec517b3c52f4a54ff9df18e89efcc4>5.3.3 - Creating a Startup Service</h1><p>Use <code>systemd</code> to create a startup service.</p><p>The following example shows you how to create a systemd startup service that changes the maximum transmission unit (MTU) of the default Ethernet connection, <code>eth0</code>.</p><ol><li>Concatenate the following block of code into a file:</li></ol><pre><code>cat &lt;&lt; EOF &gt;&gt; /lib/systemd/system/eth0.service
	[Unit]
	Description=Network interface initialization
	After=local-fs.target network-online.target network.target
	Wants=local-fs.target network-online.target network.target

	[Service]
	ExecStart=/usr/sbin/ifconfig eth0 mtu 1460 up
	Type=oneshot

	[Install]
	WantedBy=multi-user.target
	EOF
</code></pre><ol><li>Set the service to auto-start when the system boots:</li></ol><pre><code>cd /lib/systemd/system/multi-user.target.wants/
	ln -s ../eth0.service eth0.service
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-141a8337aedbb0fd60532447b3aa306b>5.3.4 - Disabling the Photon OS httpd.service</h1><p>If your application or appliance includes its own HTTP server, you must turn off and disable the HTTP server that comes with Photon OS so that it does not conflict with your own HTTP server.</p><p>To stop it and disable it, run the following commands as root:</p><pre><code>systemctl stop httpd.service
systemctl disable httpd.service
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-082bb917d85eb3624ea734a682a26df9>5.3.5 - Installing Sendmail</h1><p>Before you install Sendmail, you should set the fully qualified domain name (FQDN) of your Photon OS machine.</p><p>By default, Sendmail is not installed with either the minimal or full version of Photon OS. When you install Sendmail, it provides Photon OS with a <code>systemd</code> service file that typically enables Sendmail. If the service is not enabled after installation, you must enable it.</p><p>Sendmail resides in the Photon extras repository. You can install it with <code>tdnf</code> after setting the machine&rsquo;s FQDN.</p><h2 id=procedure>Procedure</h2><ol><li>Check whether the FQDN of the machine is set by running the <code>hostnamectl status</code> command:</li></ol><pre><code class=language-console data-lang=console>hostnamectl status
       Static hostname: photon-d9ee400e194e
             Icon name: computer-vm
               Chassis: vm
            Machine ID: a53b414142f944319bd0c8df6d811f36
               Boot ID: 1f75baca8cc249f79c3794978bd82977
        Virtualization: vmware
      Operating System: VMware Photon/Linux
                Kernel: Linux 4.4.8
          Architecture: x86-64
</code></pre><div class="alert alert-primary" role=alert><h4 class=alert-heading>Note</h4>In the results above, the FQDN is not set. The Photon OS machine only has a short name. If the FQDN were set, the hostname would be in its full form, typically with a domain name.</div><ol start=2><li><p>If the machine does not have an FQDN, set one by running <code>hostnamectl set-hostname new-name</code>, replacing <code>new-name</code> with the FQDN that you want. For example:</p><pre><code class=language-console data-lang=console>hostnamectl set-hostname photon-d9ee400e194e.corp.example.com
</code></pre><p>The <code>hostnamectl status</code> command now shows that the machine has an FQDN:</p><pre><code class=language-console data-lang=console>root@photon-d9ee400e194e [ ~ ]# hostnamectl status
    Static hostname: photon-d9ee400e194e.corp.example.com
            Icon name: computer-vm
            Chassis: vm
            Machine ID: a53b414142f944319bd0c8df6d811f36
            Boot ID: 1f75baca8cc249f79c3794978bd82977
        Virtualization: vmware
    Operating System: VMware Photon/Linux
                Kernel: Linux 4.4.8
        Architecture: x86-64
</code></pre></li><li><p>Install Sendmail:</p><pre><code class=language-console data-lang=console>tdnf install sendmail
</code></pre></li><li><p>Verify if Sendmail is enabled:</p><pre><code class=language-console data-lang=console>systemctl status sendmail
</code></pre></li><li><p>Enable Sendmail if it is disabled and then start it:</p><pre><code class=language-console data-lang=console>systemctl enable sendmail
systemctl start sendmail
</code></pre></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-483f2401135eb4c2ae692c7468e5aa2b>5.3.6 - Auditing System Events with auditd</h1><p>To manage security on Photon OS, the Linux auditing service <code>auditd</code> is enabled and active by default on the full version of Photon OS.</p><p>The folloiwng command shows the security status:</p><pre><code>systemctl status auditd
	* auditd.service - Security Auditing Service
	   Loaded: loaded (/usr/lib/systemd/system/auditd.service; enabled; vendor preset: enabled)
	   Active: active (running) since Fri 2016-04-29 15:08:50 UTC; 1 months 9 days ago
	 Main PID: 250 (auditd)
	   CGroup: /system.slice/auditd.service
	           `-250 /sbin/auditd -n
</code></pre><p>To help improve security, the <code>auditd</code> service can monitor file changes, system calls, executed commands, authentication events, and network access. After you implement an audit rule to monitor an event, the <code>aureport</code> tool generates reports to display information about the events.</p><p>You can use the auditctl utility to set a rule that monitors the <code>sudoers</code> file for changes:</p><pre><code>auditctl -w /etc/sudoers -p wa -k sudoers_changes
</code></pre><p>This rule specifies that the auditd service must watch (<code>-w</code>) the <code>/etc/sudoers</code> file to log permissions changes (<code>-p</code>) to the write access (<code>w</code>) or attributes (<code>a</code>) of the file and to identify them in logs as <code>sudoers_changes</code>. The auditing logs appear in <code>/var/log/audit/audit.log</code>. You can list the auditing rules as follows:</p><pre><code>auditctl -l
-w /etc/sudoers -p wa -k sudoers_changes
</code></pre><p>For more information on the Linux Audit Daemon, see the <code>auditd</code> man page:</p><pre><code>man auditd
</code></pre><p>For more information on setting auditing rules and options, see the <code>auditctl</code> man page:</p><pre><code>man auditctl
</code></pre><p>For more information on viewing reports on audited events, see the <code>aureport</code> man page:</p><pre><code>man aureport</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-4ad47e48a6306d7ff4ed44fc615b27cd>5.3.7 - Analyzing systemd Logs with journalctl</h1><p>The <code>journalctl</code> tool queries the contents of the <code>systemd</code> journal.</p><p>The following command displays the messages that <code>systemd</code> generated the last time the machine started:</p><pre><code class=language-console data-lang=console>journalctl -b
</code></pre><p>The following command reveals the messages for the systemd service unit specified by the <code>-u</code> option:</p><pre><code class=language-console data-lang=console>journalctl -u auditd
</code></pre><p>In the above example, <code>auditd</code> is the system service unit.</p><p>For more information, see the <code>journalctl</code> man page by running the following command on Photon OS:</p><pre><code class=language-console data-lang=console>man journalctl
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-b9f969e7b87cad20b3c6d3787094cbeb>5.3.8 - Migrating Scripts to systemd</h1><p>Although <code>systemd</code> maintains compatibility with <code>init.d</code> scripts, as a best practice, you must adapt the scripts that you want to run on Photon OS to <code>systemd</code> to avoid potential problems.</p><p>Such a conversion standardizes the scripts, reduces the footprint of your code, makes the scripts easier to read and maintain, and improves their robustness on a <code>systemd</code> system.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-4683813d869e45229ca84b5042671f7c>5.4 - Configure Wireless Networking</h1><p>You can configure wireless networking in Photon OS. Connect to an open network or a WPA2 protected network using <code>wpa_cli</code> and configure <code>systemd-networkd</code> to assign an IP address to the network.</p><ul><li><a href=#connect-using-wpa-cli>Connect using <code>wpa_cli</code></a></li><li><a href=#assign-ip-address-to-network>Assign IP address to network</a></li></ul><h2 id=connect-using-wpa_cli>Connect Using wpa_cli</h2><p>When you connect using <code>wpa_cli</code>, you can scan for available networks and associate the network with a network ID.</p><p>Perform the following steps:</p><ol><li><p>Ensure that the <code>wpa_supplicant service</code> is running on the WLAN interface:</p><p><code>Systemctl status wpa_supplicant@&lt;wlan-interface>.service</code></p></li><li><p>Connect to <code>wpa_cli</code>:</p><p><code>wpa_cli -i wlan0</code></p></li><li><p>Scan for available networks:</p><p><code>scan</code></p></li><li><p>To see the list of networks, use the following command:</p><p><code>scan_results</code></p></li><li><p>Add the network:</p><p><code>add_network</code></p><p>This command returns a network ID.</p></li><li><p>Associate the network with the network ID.</p><p><code>set_network &lt;network ID> ssid “&lt;ssid-name>”</code></p></li><li><p>For a WPA2 network, set the passphrase:</p><p><code>set_network &lt;network ID> psk “&lt;passphrase>”</code></p></li><li><p>Enable the network:</p><p><code>enable_network &lt;network ID></code></p></li><li><p>Save the configuration file:</p><p><code>save_config</code></p><p>To exit the <code>wpa_cli</code>, type &lsquo;quit`.</p></li></ol><h2 id=assign-ip-address-to-network>Assign IP Address To Network</h2><p>Configure <code>systemd-networkd</code> to assign IP address to network. Perform the following steps:</p><ol><li><p>Create a <code>/etc/systemd/network/98-dhcp-wlan.network</code> file with the following contents:</p><pre><code>[Match]
Name=wlan*
[Network]
DHCP=yes
IPv6AcceptRA=no
</code></pre></li><li><p>Restart <code>systemd-networkd</code> using:</p><p><code>Systemctl restart systemd-networkd</code></p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-fe179aab9393b273079ffe04e8fad7e0>5.5 - Managing the Network Configuration</h1><p>The network service, which is enabled by default, starts when the system boots.</p></div><div class=td-content><h1 id=pg-17b7fcb6d6f65ac49d6354d26e82fc87>5.5.1 - Commands to Manage Network Service</h1><p>You manage the network service by using systemd commands, such as <code>systemd-networkd</code>, <code>systemd-resolvd</code>, and <code>networkctl</code>.</p><p>To check the status of the network service, run the following command:</p><pre><code class=language-console data-lang=console>	systemctl status systemd-networkd
</code></pre><p><strong>Output</strong></p><pre><code class=language-console data-lang=console>	* systemd-networkd.service - Network Service
	   Loaded: loaded (/usr/lib/systemd/system/systemd-networkd.service; enabled; vendor preset: enabled)
	   Active: active (running) since Fri 2016-04-29 15:08:51 UTC; 6 days ago
	     Docs: man:systemd-networkd.service(8)
	 Main PID: 291 (systemd-network)
	   Status: &quot;Processing requests...&quot;
	   CGroup: /system.slice/systemd-networkd.service
	           `-291 /lib/systemd/systemd-networkd
</code></pre><p>Because Photon OS relies on systemd to manage services, you must use the <code>systemd</code> suite of commands and not the deprecated <code>init.d</code> commands or other deprecated commands to manage networking.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-19edb075ace34c2817b538b6c8928d9e>5.5.2 - Using the Network Configuration Manager</h1><p>The network-config-manager <code>nmctl</code> allows to configure and introspect the state of the network links as seen by <code>systemd-networkd</code>. <code>nmctl</code> can be used to query and configure links for Address, Routes, Gateways and also hostname, DNS, NTP or Domain. <code>nmctl</code> uses <code>sd-bus</code>, libudev APIs to interact with <code>systemd</code>, <code>systemd-networkd</code>, <code>systemd-resolved</code>, <code>systemd-hostnamed</code>, and <code>systemd-timesyncd</code> via dbus. <code>nmctl</code> uses networkd verbs to explain output. <code>nmctl</code> can generate configurations for required network links from YAML description. It also understands kernel command line specified in dracut network configuration format and can generate <code>systemd-networkd</code> configuration while the system boots and will persist between reboots.</p><p>Note: See <code>systemd.network</code> for more information.</p><p><code>nmctl</code> is used to configure:</p><ul><li>Static IPv4 and IPv6 Address, Routes, Gateway</li><li>DHCP type (IPv4/IPv6), DHCP4 Client Identifier, UseMTU/UseDNS/UseDomains/UseNTP/UseRoutes.
LLDP, Link Local Addressing, IPv4LLRoute, LLMNR</li><li>DNS, Domains and NTP</li><li>Link MAC, MTU</li><li>Create netdevs, vlan, vxlan, bridge, bond, veth, macvlan/macvtap, ipvlap/ipvtap, veth, tunnels(ipip, sit, gre, sit, vti), wireguard</li><li>Hostname</li><li>Can delete and view nftables table, chains and rules.</li></ul><p>You can use <code>nmctl</code> to generate network configurations from the following:</p><ul><li><p>YAML file: <code>nmctl</code> can generate configurations for required network links from YAML description. Configuration written to disk under <code>/etc/systemd/network</code> will persist between reboots. When <code>netmgr-yaml-generator.service</code> is enabled it reads YAML files from <code>/etc/network-config-manager/yaml</code> and generates <code>systemd-networkd</code> configuration files.</p><p><code>nmctl</code> uses similar format as defined by different YAML format.</p><p><code>nmctl</code> can generate WPA Supplicant configuration from YAML file. When a YAML file with wifi configuration is found, it generates a configuration file found in <code>/etc/network-config-manager/wpa_supplicant_photon_os.conf</code> which is understood by <code>wpa_supplicant</code>.</p></li><li><p>Dracut kernel command line network configuration: nmctl understands kernel command line specified in dracut&rsquo;s network configuration format and can generate systemd-networkd&rsquo;s configuration while the system boots and will persist between reboots.</p></li></ul><pre><code class=language-console data-lang=console>Network
       ip={dhcp|on|any|dhcp6|auto6}
           dhcp|on|any: get ip from dhcp server from all links. If root=dhcp, loop
           sequentially through all links (eth0, eth1, ...) and use the first with a valid
           DHCP root-path.

           auto6: IPv6 autoconfiguration

           dhcp6: IPv6 DHCP

       ip=&lt;link&gt;:{dhcp|on|any|dhcp6|auto6}
           dhcp|on|any|dhcp6: get ip from dhcp server on a specific link

           auto6: do IPv6 autoconfiguration

           This parameter can be specified multiple times.

       ip=&lt;client-IP&gt;:[ &lt;server-id&gt;]:&lt;gateway-IP&gt;:&lt;netmask&gt;:&lt;client_hostname&gt;:&lt;link&gt;:{none|off}
           explicit network configuration.

       ifname=&lt;link&gt;:&lt;MAC&gt;
           Assign network device name &lt;link&gt; (ie eth0) to the NIC with MAC &lt;MAC&gt;. Note
           letters in the MAC-address must be lowercase!  Note: If you use this option you must
           specify an ifname= argument for all links used in ip= or fcoe= arguments.  This
           parameter can be specified multiple times.

       nameserver=&lt;IP&gt;[nameserver=&lt;IP&gt; ...]
           specify nameserver(s) to use

      cat /proc/cmdline
       BOOT_IMAGE=/boot/vmlinuz-4.19.52-2.ph3-esx root=PARTUUID=ebf01b6d-7e9c-4345-93f4-122f44eb2726
       init=/lib/systemd/systemd rcupdate.rcu_expedited=1 rw systemd.show_status=0 quiet noreplace-smp
       cpu_init_udelay=0 net.ifnames=0 plymouth.enable=0 systemd.legacy_systemd_cgroup_controller=yes
       ip=dhcp
</code></pre><p><code>network-config-manager-generator.service</code> is a oneshot type systemd service unit which runs while the system boots. It parses the kernel command line and generates networkd config in <code>/etc/systemd/network</code>:</p><pre><code>systemctl enable network-config-manager-generator.service
</code></pre><p>It creates symlink <code>/etc/systemd/system/network.target.wants/network-config-manager-generator.service → /usr/lib/systemd/system/network-config-manager-generator.service</code>.</p><p>For more information, see:</p><ul><li><strong>CLI</strong> - see the <code>-net</code> commands in the <a href=../../docs/command-line-reference/command-line-interfaces/photon-management-daemon-cli/>Photon Management Daemon Command-line Interface (pmd-cli)</a></li><li><strong>C APIs</strong> - <a href=../../docs/administration-guide/managing-network-configuration/netmgr.c/>Network Configuration Manager - C API</a></li><li><strong>Python APIs</strong> - <a href=../../docs/administration-guide/managing-network-configuration/netmgr.python/>Network Configuration Manager - Python API</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-0d2237ec1d2245aa00e53d192972035f>5.5.3 - Use 'ip' and 'ss' Commands</h1><p>Use the <code>ip</code> and <code>ss</code> commands to view a list of network interfaces and information for IP addresses.</p><p>Although the <code>ifconfig</code> command and the <code>netstat</code> command work on Photon OS, VMware recommends that you use the <code>ip</code> or <code>ss</code> commands. The <code>ipconfig</code> and <code>netstat</code> commands are deprecated.</p><p>For example, to display a list of network interfaces, run the <code>ss</code> command instead of <code>netstat</code>. To display information for IP addresses, run the <code>ip addr</code> command instead of <code>ifconfig -a</code>.</p><p>Examples are as follows:</p><pre><code class=language-console data-lang=console>USE THIS IPROUTE COMMAND 	INSTEAD OF THIS NET-TOOL COMMAND
ip addr 					ifconfig -a
ss 							netstat
ip route 					route
ip maddr 					netstat -g
ip link set eth0 up 		ifconfig eth0 up
ip -s neigh					arp -v
ip link set eth0 mtu 9000	ifconfig eth0 mtu 9000
</code></pre><p>Using the <code>ip route</code> version of a command instead of the net-tools version often provides more complete and accurate information on Photon OS. Examples are as follows:</p><pre><code class=language-console data-lang=console>ip neigh
198.51.100.2 dev eth0 lladdr 00:50:56:e2:02:0f STALE
198.51.100.254 dev eth0 lladdr 00:50:56:e7:13:d9 STALE
198.51.100.1 dev eth0 lladdr 00:50:56:c0:00:08 DELAY

arp -a
? (198.51.100.2) at 00:50:56:e2:02:0f [ether] on eth0
? (198.51.100.254) at 00:50:56:e7:13:d9 [ether] on eth0
? (198.51.100.1) at 00:50:56:c0:00:08 [ether] on eth0
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-814aab1ca524fe8161cabbeb97b41245>5.5.4 - Configuring Network Interfaces</h1><p>Network configuration files for systemd-networkd reside in <code>/etc/systemd/network</code> and <code>/usr/lib/systemd/network</code>. Example:</p><pre><code class=language-console data-lang=console>root@photon-rc [ ~ ]# ls /etc/systemd/network/
99-dhcp-en.network
</code></pre><p>By default, when Photon OS starts, it creates a DHCP network configuration file, or rule, which appears in /etc/systemd/network, the highest priority directory for network configuration files with the lowest priority filename:</p><pre><code class=language-console data-lang=console>cat /etc/systemd/network/99-dhcp-en.network
[Match]
Name=e*

[Network]
DHCP=yes
</code></pre><p>Network configuration files can also appear in the system network directory, <code>/usr/lib/systemd/network</code>, as the results of the following search illustrate:</p><pre><code class=language-console data-lang=console>root@photon-rc [ ~ ]# updatedb
root@photon-rc [ ~ ]# locate systemd/network
/etc/systemd/network
/etc/systemd/network/99-dhcp-en.network
/usr/lib/systemd/network
/usr/lib/systemd/network/80-container-host0.network
/usr/lib/systemd/network/80-container-ve.network
/usr/lib/systemd/network/99-default.link
root@photon-rc [ ~ ]#
</code></pre><p>In the above search, the <code>/usr/lib/systemd/network</code> directory contains several network configuration files. Photon OS applies the configuration files in <a href=https://en.wikipedia.org/wiki/Lexicographical_order>lexicographical order</a> specified by the file names without regard for the network configuration directory in which the file resides unless the file name is the same. Photon OS processes files with identical names by giving precedence to files in the <code>/etc</code> directory over the other directory. Thus, the settings in <code>/etc/systemd/network</code> override those in <code>/usr/lib/systemd/network</code>. Once Photon OS matches an interface in a file, Photon OS ignores the interface if it appears in files processed later in the lexicographical order.</p><p>Each .network file contains a matching rule and a configuration that Photon OS applies when a device matches the rule. Set the matching rule and the configuration as sections containing vertical sets of key-value pairs according to the information in <a href=https://www.freedesktop.org/software/systemd/man/systemd.network.html>systemd network configuration</a>.</p><p>To configure Photon OS to handle a networking use case, such as setting a static IP address or adding a name server, create a configuration file with a <code>.network</code> extension and place it in the <code>/etc/systemd/network directory</code>.</p><p>After you create a network configuration file with a <code>.network</code> extension, you must run the <code>chmod</code> command to set the new file&rsquo;s mode bits to <code>644</code>.</p><p>Example:</p><pre><code class=language-console data-lang=console>chown systemd-network:systemd-network 10-static-en.network
</code></pre><p>For Photon OS to apply the new configuration, you must restart the <code>systemd-networkd</code> service by running the following command:</p><pre><code class=language-console data-lang=console>systemctl restart systemd-networkd
</code></pre><p>For information about network configuration files, their processing order, and their matching rules, sections, and keys, see <a href=https://www.freedesktop.org/software/systemd/man/systemd.network.html>https://www.freedesktop.org/software/systemd/man/systemd.network.html</a>.</p><p>For information about creating virtual network device files (<code>.netdev</code>), see <a href=https://www.freedesktop.org/software/systemd/man/systemd.netdev.html>https://www.freedesktop.org/software/systemd/man/systemd.netdev.html</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-dca0a6deea7101803fda13a748dac408>5.5.5 - Setting a Static IP Address</h1><p>Before you set a static IP address, obtain the name of your Ethernet link by running the following command:</p><pre><code class=language-console data-lang=console>networkctl
IDX LINK             TYPE               OPERATIONAL SETUP
	1 lo               loopback           carrier     unmanaged
	2 eth0             ether              routable    configured
</code></pre><p>In the results of the command, you can see the name of an Ethernet link, <code>eth0</code>.</p><p>To create a network configuration file that systemd-networkd uses to establish a static IP address for the eth0 network interface, execute the following command as root:</p><pre><code class=language-console data-lang=console>cat &gt; /etc/systemd/network/10-static-en.network &lt;&lt; &quot;EOF&quot;

[Match]
Name=eth0

[Network]
Address=198.51.0.2/24
Gateway=198.51.0.1
EOF
</code></pre><p>Change the new file&rsquo;s mode bits by running the <code>chmod</code> command:</p><pre><code class=language-console data-lang=console>chmod 644 10-static-en.network
</code></pre><p>Apply the configuration by running either the first or the second step:</p><ol><li><p><code>systemctl restart systemd-networkd</code></p></li><li><p><code>networkctl reload</code>
<code>networkctl reconfigure *interface_name/index_number*</code></p></li></ol><p>Note: The advantage of using reload and reconfigure is that the settings of other interfaces are not disturbed and only the settings of the specific interface are reloaded and reconfigured.</p><p>For more information, see the man page for systemd-networkd: <code>man systemd.network</code></p></div><div class=td-content style=page-break-before:always><h1 id=pg-bd9ce63678e73d1d44c65642730f1d78>5.5.6 - Turning Off DHCP</h1><p>By default, when Photon OS first starts, it creates a DHCP network configuration file or rule, which appears in <code>/etc/systemd/network</code>, the highest priority directory for network configuration files with the lowest priority filename:</p><pre><code class=language-console data-lang=console>cat /etc/systemd/network/99-dhcp-en.network
[Match]
Name=e*

[Network]
DHCP=yes
</code></pre><p>To turn off DHCP for all Ethernet interfaces, change the value of <code>DHCP</code> from <code>yes</code> to <code>no</code>, save the changes, and then restart the <code>systemd-networkd</code> service:</p><pre><code class=language-console data-lang=console>	systemctl restart systemd-networkd
</code></pre><p>Or you can reload and reconfigure the settings:</p><pre><code class=language-console data-lang=console>networkctl reload
networkctl reconfigure &lt;interface_name&gt;/&lt;index_number&gt;`
</code></pre><div class="alert alert-primary" role=alert><h4 class=alert-heading>Note:</h4><blockquote><p>The advantage of using reload and reconfigure is that the settings of other interfaces are not disturbed and only the settings of the specific interface are reloaded and reconfigured.</p></blockquote></div><p>If you create a configuration file with a higher priority filename (e.g. <code>10-static-en.network</code>), it is not necessary but still recommended to turn off DHCP.</p><p>You can also check the status of a specific interface:</p><pre><code class=language-console data-lang=console>networkctl status &lt;interface_name&gt;/&lt;index_number&gt;
</code></pre><p>(<code>ens33 </code>is an example)</p><pre><code class=language-console data-lang=console>    2: ens33
     Link File: /usr/lib/systemd/network/99-default.link  
      Network File: /usr/lib/systemd/network/10-eth.network   
      Type: ether 
     State: routable (configured)   
     Alternative Names: enp2s1
      Path: pci-0000:02:01.0  
    Driver: e1000 
    Vendor: Intel Corporation 
     Model: 82545EM Gigabit Ethernet Controller (Copper) (PRO/1000 MT Single Port Adapter)
    HW Address: 00:0c:29:5f:d1:39 (VMware, Inc.)  
       MTU: 1500 (min: 46, max: 16110)
     QDisc: fq_codel  
      IPv6 Address Generation Mode: eui64 
      Queue Length (Tx/Rx): 1/1   
      Auto negotiation: yes   
     Speed: 1Gbps 
    Duplex: full  
      Port: tp
       Address: 172.16.85.225 (DHCP4 via 172.16.85.254)   
    fe80::20c:29ff:fe5f:d139  
       Gateway: 172.16.85.2 (VMware, Inc.)
       DNS: 172.16.85.2   
       DHCP4 Client ID: IAID:0x2b9434c1/DUID  
     DHCP6 Client DUID: DUID-EN/Vendor:0000ab11d258482fc7eee6510000   
    Feb 26 10:19:44 fedora systemd-networkd[650]: ens33: Link UP
    Feb 26 10:19:44 fedora systemd-networkd[650]: ens33: Gained carrier
    Feb 26 10:19:45 fedora systemd-networkd[650]: ens33: DHCPv4 address 172.16.85.225/24 via 172.16.85.2
    Feb 26 10:19:46 fedora systemd-networkd[650]: ens33: Gained IPv6LL
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-35836b706928911e82d888ac98641d48>5.5.7 - Adding a DNS Server</h1><p>Photon OS uses <code>systemd-resolved</code> to resolve domain names, IP addresses, and network names for local applications. The <code>systemd-resolved</code> daemon automatically creates and maintains the <code>/etc/resolv.conf</code> file, into which systemd-resolved places the IP address of the DNS server. You must not modify the <code>/etc/resolv.conf</code> file.</p><p><strong>Note</strong>: If you want to implement a local resolver like <code>bind</code> instead of <code>systemd-resolved</code>, stop the <code>systemd-resolved</code> service and disable it.</p><p>If you open the default <code>/etc/resolv.conf</code> file after you deploy Photon OS, it looks like this:</p><pre><code>root@photon-rc [ ~ ]# cat /etc/resolv.conf
# This file is managed by systemd-resolved(8). Do not edit.
#
# Third party programs must not access this file directly, but
# only through the symlink at /etc/resolv.conf. To manage
# resolv.conf(5) in a different way, replace the symlink by a
# static file or a different symlink.

nameserver 198.51.100.2
</code></pre><p>To add a DNS server, insert a DNS key into the Network section of the static network configuration file, for example, <code>/etc/systemd/network/10-eth0-static.network</code> and set it to the IP address of your DNS server:</p><pre><code>[Match]
Name=e*

[Network]
Address=198.51.0.2/24
Gateway=198.51.0.1
DNS=198.51.0.1
</code></pre><p><strong>Note</strong>: To apply the changes made to <code>/etc/systemd/network/*.network</code> files, perform the following:</p><ul><li><p>Restart <code>systemd-networkd</code> and <code>systemd-resolved</code> services by running the following commands:</p><ul><li><code>systemctl restart systemd-networkd</code></li><li><code>systemctl restart systemd-resolved</code></li></ul></li><li><p>Or you can reload and reconfigure the settings by running the following commands:
<code>networkctl reload</code>
<code>networkctl reconfigure *interface_name/index_number*</code></p></li></ul><p>Note: The advantage of using reload and reconfigure is that the settings of other interfaces are not disturbed and only the settings of the specific interface are reloaded and reconfigured.</p><p>If your machine is working with DHCP, you can add a DNS server by modifying the <code>/etc/systemd/resolved.conf--a</code> method.</p><p>For more information, see <a href=https://www.freedesktop.org/software/systemd/man/resolved.conf.html>https://www.freedesktop.org/software/systemd/man/resolved.conf.html</a>.</p><p>You can optionally activate the local DNS stub resolver of systemd-resolved by adding <code>dns</code> and <code>resolve</code> to the <code>/etc/nsswitch.conf</code> file. To do so, make a backup copy of the <code>/etc/nsswitch.conf</code> file and then execute the following command as root:</p><pre><code>sed -i 's/^hosts.*$/hosts: files resolve dns/' /etc/nsswitch.conf
</code></pre><p>For more information about the <code>systemd-resolved</code> service, see <a href=https://www.freedesktop.org/software/systemd/man/systemd-resolved.service.html>https://www.freedesktop.org/software/systemd/man/systemd-resolved.service.html</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-917e3b297c548020673bd24fd16dd9b8>5.5.8 - Setting Up Networking for Multiple NICs</h1><p>If your machine contains multiple NICs, it is recommend that you create a <code>.network</code> configuration file for each network interface. The following scenario demonstrates how to set one wired network interface to use a static IP address and another wired network interface to use a dynamic IP address obtained through DHCP.</p><p><strong>Note</strong>: The following configurations are examples and you must change the IP addresses and other information to match your network and requirements.</p><p>First, create the <code>.network</code> file for the static Ethernet connection in <code>/etc/systemd/network</code>. A best practice is to match the exact name of the network interface, which is <code>eth0</code> in this example. This example file also includes a DNS server for the static IP address. As a result, the configuration sets the UseDNS key to false in the DHCP column so that Photon OS ignores the DHCP server for DNS for this interface.</p><pre><code>cat &gt; /etc/systemd/network/10-eth0-static-en.network &lt;&lt; &quot;EOF&quot;
[Match]
Name=eth0

[Network]
Address=10.137.20.11/19
Gateway=10.137.23.253
DNS=10.132.71.1

[DHCP]
UseDNS=false
EOF
</code></pre><p>Second, create the <code>.network</code> file for the second network interface, which is <code>eth1</code> in this example. This configuration file sets the eth1 interface to an IP address from DHCP and sets DHCP as the source for DNS lookups. Setting the DHCP key to <code>yes</code> acquires an IP address for IPv4 and IPv6. To acquire an IP address for IPv4 only, set the DHCP key to <code>ipv4</code>.</p><pre><code>cat &gt; /etc/systemd/network/50-eth1-dhcp-en.network &lt;&lt; &quot;EOF&quot;

[Match]
Name=eth1

[Network]
DHCP=yes  

[DHCP]
UseDNS=true
EOF
</code></pre><h2 id=how-to-configure-two-gateways-for-two-different-nic->How to configure two gateways for two different NIC ?</h2><p>This is an IP routing policy feature of kernel and is supported by <code>systemd-networkd</code>. You have to add two routes. One is for the subnet so that the IP address can find its gateway. The other route is for specifying the default gateway for that interface. Finally, we add policy route rules for that IP address that we want to use that table. This will not only ensure that the IP address you are trying to communicate with on that one interface can respond properly, but it will also ensure that you do not route information between subnets.</p><pre><code>[Match]
Name=eth2
 
[Network]
Address=192.168.60.70/24
DHCP=no
 
[Route]
PreferredSource=192.168.60.70
Destination=192.168.60.0/24
Table=10
 
 
[Route]
Gateway=192.168.60.1
Table=10
 
[RoutingPolicyRule]
Table=10
To=192.168.60.70/24
 
[RoutingPolicyRule]
Table=10
From=192.168.60.70/24</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-8b2539c60ae140a0c48f29f684251c19>5.5.8.1 - Combining DHCP and Static IP Addresses with IPv4 and IPv6</h1><p>You can combine DHCP and static IP addresses with both IPv4 and IPv6.</p><h2 id=examples>Examples</h2><p>The following example shows how to use DHCP to allocate both IPv4 and IPv6 addresses:</p><pre><code>[Network]
DHCP=yes
</code></pre><p>The following example shows how to use DHCP to allocate only IPv4 addresses:</p><pre><code>[Network]
DHCP=ipv4
</code></pre><p>The following example shows how to use DHCP to allocate only IPv6 addresses:</p><pre><code>[Network]
DHCP=ipv6
</code></pre><p>The following example shows how to use DHCP for IPv4 addresses and static IP addresses for IPv6 addresses:</p><pre><code>[Network]
DHCP=ipv4
Address=fd00::1/48
Gateway=fd00::252
</code></pre><p>The following example shows how to use DHCP for IPv6 addresses and static IP addresses for IPv4:</p><pre><code>[Network]
DHCP=ipv6
Address=10.10.10.1/24
Gateway=10.10.10.253
</code></pre><p>The following example shows how to use static IP addresses for both IPv4 and IPv6:</p><pre><code>[Network]
DHCP=ipv6
Address=10.10.10.1/24
Gateway=10.10.10.253
Address=fd00::1/48
Gateway=fd00::252</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-3d98de3abe5f5da1ebfc410dc1a2248d>5.5.9 - Clearing the Machine ID of a Cloned Instance for DHCP</h1><p>Photon OS uses the contents of <code>/etc/machine-id</code> to determine the DHCP unique identifier (duid) that is used for DHCP requests. If you use a Photon OS instance as the base system for cloning, to create additional Photon OS instances, you must clear the <code>machine-id</code> with this command:</p><pre><code class=language-console data-lang=console>echo -n &gt; /etc/machine-id
</code></pre><p>When the value is cleared, <code>machine-id</code> can be regenerated by calling <code>systemd-machine-id-setup</code>.</p><pre><code class=language-console data-lang=console>systemd-machine-id-setup
</code></pre><p>This command initializes the machine ID stored in <code>/etc/machine-id</code> during installation. For more information on this command, see <a href=https://www.freedesktop.org/software/systemd/man/systemd-machine-id-setup.html>https://www.freedesktop.org/software/systemd/man/systemd-machine-id-setup.html</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-5e27003890310835c92e92f35843ab6a>5.5.10 - Using Predictable Network Interface Names</h1><p>When you run Photon OS on a virtual machine or a bare-metal machine, the Ethernet network interface name might shift from one device to another if you add or remove a card and reboot the machine. For example, a device named <code>eth2</code> might become <code>eth1</code> after you remove a NIC and restart the machine.</p><p>You can prevent interface names from reordering by turning on <a href=https://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/>predictable network interface names</a>. The naming schemes that Photon OS uses can then assign fixed, predictable names to network interfaces even after you add or remove cards or other firmware and the restart the system.</p><p>When you enable predictable network interface names, you can use one of the following options to assign persistent names to network interfaces:</p><ul><li>Apply the <code>slot</code> name policy to set the name of networking devices in the <code>ens</code> format with a statically assigned PCI slot number.</li><li>Apply the <code>mac</code> name policy to set the name of networking devices in the <code>enx</code> format a unique MAC address.</li><li>Apply the <code>path</code> name policy to set the name of networking devices in the <code>enpXsY</code> format derived from a device connector&rsquo;s physical location.</li></ul><p>Though Photon OS supports the <code>onboard</code> name policy to set the name of networking devices from index numbers given by the firmware in the <code>eno</code> format, the policy might result in nonpersistent names.</p><p>The option to choose depends on your use case and your unique networking requirements. For example, when you clone virtual machines and require the MAC addresses to be different from one another but the interface name to be the same, consider using <code>ens</code> to keep the slot the same after system reboots.</p><p>Alternatively, if the cloning function supports <code>enx</code>, you can use it to set a MAC address which persists after reboots.</p><p>Perform the following steps to turn on predictable network interface names:</p><ol><li>Make a backup copy of the following file in case you need to restore it later:</li></ol><pre><code class=language-console data-lang=console>cp /boot/grub/grub.cfg /boot/grub/grub.cfg.original
</code></pre><ol start=2><li>To turn on predictable network interface names, edit <code>/boot/grub/grub.cfg</code> to remove the following string:</li></ol><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#c4a000>net.ifnames</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>0Item</span>
</code></pre></div><p>The string appears near the bottom of the file in the <code>menuentry</code> section:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#c4a000>menuentry &#34;Photon&#34; {</span>
    <span style=color:#c4a000>linux &#34;/boot/&#34;$photon_linux root</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>$rootpartition net.ifnames=0 $photon_cmdline
</span><span style=color:#4e9a06>    if [ &#34;$photon_initrd&#34; ]; then
</span><span style=color:#4e9a06>        initrd &#34;/boot/&#34;$photon_initrd
</span><span style=color:#4e9a06>    fi</span>
<span style=color:#c4a000>}</span>
<span style=color:#8f5902;font-style:italic># End /boot/grub2/grub.cfg</span>
</code></pre></div><p>Edit out <code>net.ifnames=0</code>, but make no other changes to the file, and then save it.</p><ol><li>Specify the types of policies that you want to use for predictable interface names by modifying the <code>NamePolicy</code> option in <code>/lib/systemd/network/99-default.link</code>. The file contents are as follows:</li></ol><pre><code class=language-console data-lang=console>cat /lib/systemd/network/99-default.link
[Link]
NamePolicy=kernel database
MACAddressPolicy=persistent

</code></pre><p>To use the <code>ens</code> or <code>enx</code> option, the <code>slot</code> policy or the <code>mac</code> policy can be added to the space-separated list of policies that follow the <code>NamePolicy</code> option in the default link file, <code>/lib/systemd/network/99-default.link</code>. The order of the policies matters. Photon OS applies the policy listed first before proceeding to the next policy if the first one fails.</p><p>For example:</p><pre><code class=language-console data-lang=console>/lib/systemd/network/99-default.link
    [Link]
    NamePolicy=slot mac kernel database
    MACAddressPolicy=persistent
</code></pre><p>With the name policy specified in the above example, you might still have an Ethernet-style interface name if the two previous policies, <code>slot</code> and <code>mac</code>, fail.</p><p>For information on setting name policies, see <a href=https://www.freedesktop.org/software/systemd/man/systemd.link.html>systemd.link&ndash;network device configuration</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-4ea08cc28e5e5f522fa95c3c72090442>5.5.11 - Inspecting the Status of Network Links with 'networkctl'</h1><p>You can inspect information about network connections by using the <code>networkctl</code> command. This can help you configure networking services and troubleshoot networking problems.</p><p>You can progressively add options and arguments to the <code>networkctl</code> command to move from general information about network connections to specific information about a network connection.</p><h1 id=networkctl-command-without-options>networkctl Command Without Options</h1><p>Run the <code>networkctl</code> command without options to default to the list command:</p><pre><code class=language-console data-lang=console>networkctl
IDX LINK             TYPE               OPERATIONAL SETUP
  1 lo               loopback           carrier     unmanaged
  2 eth0             ether              routable    configured
  3 docker0          ether              routable    unmanaged
  11 vethb0aa7a6      ether              degraded    unmanaged
  4 links listed.
</code></pre><h2 id=networkctl-status-command>&lsquo;networkctl status&rsquo; Command</h2><p>Run <code>networkctl</code> with the status command to display the following information:</p><pre><code class=language-console data-lang=console>root@photon-rc [ ~ ]# &gt; networkctl status
   State: routable
  Address: 10.197.103.56 on eno1
           172.17.0.1 on docker0
           fe80::20c:29ff:fe44:f92c on eno1
  Gateway: 10.197.103.253 (Cisco Systems, Inc) on eno1
      DNS: 10.142.7.1
           10.132.7.1
           10.166.17.90
      NTP: 10.128.152.81
           10.166.1.120
           10.188.26.119
           10.84.55.42

</code></pre><p>You can see that there are active network links with IP addresses for not only the Ethernet connection but also a Docker container.</p><h3 id=networkctl-status-command-with-network-link-option>&lsquo;networkctl status&rsquo; Command With Network Link Option</h3><p>You can add a network link, such as the Ethernet connection, as the argument of the <code>status</code> command to show specific information about the link:</p><pre><code class=language-console data-lang=console>	root@photon-rc [ ~ ]# networkctl status ens33
	* 2: ens33
	         Link File: /usr/lib/systemd/network/99-default.link                                      
                  Network File: /usr/lib/systemd/network/10-eth.network                                       
                          Type: ether                                                                         
                         State: routable (configured)                               
             Alternative Names: enp2s1                                                                        
                          Path: pci-0000:02:01.0                                                              
                        Driver: e1000                                                                         
                        Vendor: Intel Corporation                                                             
                         Model: 82545EM Gigabit Ethernet Controller (Copper) (PRO/1000 MT Single Port Adapter)
                    HW Address: 00:0c:29:5f:d1:39 (VMware, Inc.)                                              
                           MTU: 1500 (min: 46, max: 16110)                                                    
                         QDisc: fq_codel                                                                      
  IPv6 Address Generation Mode: eui64                                                                         
          Queue Length (Tx/Rx): 1/1                                                                           
              Auto negotiation: yes                                                                           
                         Speed: 1Gbps                                                                         
                        Duplex: full                                                                          
                          Port: tp                                                                            
                       Address: 172.16.85.225 (DHCP4 via 172.16.85.254)                                       
                                fe80::20c:29ff:fe5f:d139                                                      
                       Gateway: 172.16.85.2 (VMware, Inc.)                                                    
                           DNS: 172.16.85.2                                                                   
               DHCP4 Client ID: IAID:0x2b9434c1/DUID                                                          
             DHCP6 Client DUID: DUID-EN/Vendor:0000ab11d258482fc7eee6510000                                   
Feb 26 10:19:44 fedora systemd-networkd[650]: ens33: Link UP
Feb 26 10:19:44 fedora systemd-networkd[650]: ens33: Gained carrier
Feb 26 10:19:45 fedora systemd-networkd[650]: ens33: DHCPv4 address 172.16.85.225/24 via 172.16.85.2
Feb 26 10:19:46 fedora systemd-networkd[650]: ens33: Gained IPv6LL
</code></pre><h3 id=networkctl-status-command-with-docker-option>&lsquo;networkctl status&rsquo; Command With Docker Option</h3><p>You can add a Docker container as the argument of the <code>status</code> command to show specific information about the container:</p><pre><code class=language-console data-lang=console>networkctl status docker0
	* 3: docker0
	       Link File: /usr/lib/systemd/network/99-default.link
	    Network File: n/a
	            Type: ether
	           State: routable (unmanaged)
	          Driver: bridge
	      HW Address: 02:42:f0:f7:bd:81
	             MTU: 1500
	         Address: 172.17.0.1
	                  fe80::42:f0ff:fef7:bd81
</code></pre><p>In the example above, the state of the Docker container is unmanaged because Docker handles managing the networking for the containers without using systemd-resolved or systemd-networkd. Docker manages the container connection by using its bridge drive.</p><p>For more information about <code>networkctl</code> commands and options, see <a href=https://www.freedesktop.org/software/systemd/man/networkctl.html>https://www.freedesktop.org/software/systemd/man/networkctl.html</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-a00cc124cdf4736e59e993eeaa08ee44>5.5.12 - Turning On Network Debugging</h1><p>You can set <code>systemd-networkd</code> to work in debug mode so that you can analyze log files with debugging information to help troubleshoot networking problems.</p><p>You can turn on network debugging by adding a drop-in file in <code>/etc/systemd</code> to customize the default systemd configuration in <code>/usr/lib/systemd</code>.</p><p><strong>Procedure</strong></p><ol><li><p>Run the following command as root to create a directory with the name <code>systemd-networkd.service.d</code>, including the <code>.d</code> extension:</p><pre><code class=language-console data-lang=console>mkdir -p /etc/systemd/system/systemd-networkd.service.d/
</code></pre><p>``</p></li><li><p>Run the following command as root to establish a <code>systemd</code> drop-in unit with a debugging configuration for the network service:</p><pre><code class=language-console data-lang=console>cat &gt; /etc/systemd/system/systemd-networkd.service.d/override.conf
    [Service]
    Environment=SYSTEMD_LOG_LEVEL=debug
    EOF
</code></pre><p>``</p></li><li><p>Reload the <code>systemctl</code> daemon and restart the <code>systemd-networkd</code> service for the changes to take effect:</p><pre><code class=language-console data-lang=console>systemctl daemon-reload
systemctl restart systemd-networkd
</code></pre><p>``</p></li><li><p>Verify your changes:</p><pre><code class=language-console data-lang=console>systemd-delta --type=extended
</code></pre><p>``</p></li><li><p>View the log files by running this command:</p><pre><code class=language-console data-lang=console>journalctl -u systemd-networkd
</code></pre><p>``</p></li><li><p>After debugging the network connections, turn debugging off by deleting the drop-in file:</p><pre><code class=language-console data-lang=console>rm /etc/systemd/system/systemd-networkd.service.d/10-loglevel-debug.conf
</code></pre><p>``</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-479bf00c311a853d785a6dc9305907f7>5.5.13 - Installing packgages for 'tcpdump' and 'netcat'</h1><p>Photon OS includes the following networking tools:</p><ul><li><p><strong>tcpdump</strong>. A networking tool that captures and analyzes packets on a network interface. <code>tcpdump</code> is not available with the minimal version of Photon OS but available in the repository. The minimal version includes the <code>iproute2</code> tools by default.</p><p>You can install <code>tcpdump</code> and its accompanying package <code>libpcap</code>, a C/C++ library for capturing network traffic, by using <code>tdnf</code>:</p></li></ul><pre><code class=language-console data-lang=console>tdnf install tcpdump
</code></pre><ul><li><strong>netcat</strong>. A tool to send data over network connections with TCP or UDP. This tool is not included in either the minimal or the full version of Photon OS. But since <code>netcat</code> furnishes powerful options for analyzing, troubleshooting, and debugging network connections, you might want to install it. To install `netcat', run the following command:</li></ul><pre><code class=language-console data-lang=console>tdnf install netcat
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-b7601ca8c4e5e39041eccbb4999f7acf>5.5.14 - Mounting a Network File System</h1><p>To mount a network file system, Photon OS requires <code>nfs-utils</code>. The <code>nfs-utils</code> package contains the daemon, userspace server, and client tools for the kernel Network File System (NFS). The tools include <code>mount.nfs</code>, <code>umount.nfs</code>, and <code>showmount</code>.</p><p>The <code>nfs-utils</code> package is installed by default in the full version of Photon OS but not in the minimal version. To install <code>nfs-utils</code> in the minimal version, run the following command as root:</p><pre><code>tdnf install nfs-utils
</code></pre><p>For instructions on how to use <code>nfs-utils</code> to share files over a network, see <a href=../../../user-guide/mounting-remote-file-systems/>Photon OS nfs-utils</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-828a2d1bdd0ecad85958910a1b9be255>5.5.15 - Network Configuration Manager - C API</h1><p>Photon OS provides a C API for the Network Configuration Manager.</p><ul><li><a href=#about-the-network-configuration-manager-c-api>About the Network Configuration Manager C API</a></li><li><a href=#interface-configuration-apis>Interface Configuration APIs</a></li><li><a href=#ip-address-configuration-apis>IP Address Configuration APIs</a></li><li><a href=#route-configuration-apis>Route Configuration APIs</a></li><li><a href=#dns-configuration-apis>DNS Configuration APIs</a></li><li><a href=#dhcp-options-duid-and-iaid-configuration-apis>DHCP Options DUID and IAID Configuration APIs</a></li><li><a href=#ntp-configuration-apis>NTP Configuration APIs</a></li><li><a href=#service-management-apis>Service Management APIs</a></li></ul><h1 id=about-the-network-configuration-manager-c-api>About the Network Configuration Manager C API</h1><p>Use the Network Configuration Manager C API to simplify common network configuration tasks for:</p><ul><li>interfaces</li><li>IP addresses (IPv4 and IPv6 addresses)</li><li>routes</li><li>DNS server and domain settings</li><li>DHCP DUID and IAID settings</li><li>NTP server settings</li><li>service management</li><li>object parameters (interfaces and files)</li></ul><h2 id=header-file>Header File</h2><p>Header files for all the C APIs are defined in the following location:</p><p><a href=https://github.com/vmware/pmd/tree/master/include>https://github.com/</a> <a href=https://github.com/vmware/pmd/tree/master/include>vmware</a> <a href=https://github.com/vmware/pmd/tree/master/include>/pmd/tree/master/include</a></p><p>To install the Network Configuration Manager header file, run the following command:</p><p><code>tdnf install netmgmt-devel</code>
n
Once installed, you can reference the header file in the following location:</p><p><code>/usr/include/netmgmt/network-config-manager.h</code></p><h2 id=freeing-memory>Freeing Memory</h2><p>For all get APIs that take a pointer-to-pointer parameter, the caller has the responsibility to free the memory upon successful response from API by calling free().</p><h2 id=error-codes>Error Codes</h2><p>All C API calls return 0 for success, or one of the following error codes for failure.</p><ul><li>4097 - NM_ERR_INVALID_PARAMETER</li><li>4098 - NM_ERR_NOT_SUPPORTED</li><li>4099 - NM_ERR_OUT_OF_MEMORY</li><li>4100 - NM_ERR_VALUE_NOT_FOUND</li><li>4101 - NM_ERR_VALUE_EXISTS</li><li>4102 - NM_ERR_INVALID_INTERFACE</li><li>4103 - NM_ERR_INVALID_ADDRESS</li><li>4104 - NM_ERR_INVALID_MODE</li><li>4105 - NM_ERR_BAD_CONFIG_FILE</li><li>4106 - NM_ERR_WRITE_FAILED</li><li>4107 - NM_ERR_TIME_OUT</li><li>4108 - NM_ERR_DHCP_TIME_OUT</li></ul><p>Use nm_get_error_info to retrieve information about an error code.</p><pre><code> const char \*
 nm_get_error_info(
     uint32_t nmErrCode
 );``
</code></pre><h1 id=interface-configuration-apis>Interface Configuration APIs</h1><p>The Photon OS network manager C API enables you to manage network interfaces.</p><h2 id=structure-declarations>Structure Declarations</h2><h3 id=link-mode>Link Mode</h3><p><strong>Description</strong></p><p>Link mode. Available settings:</p><ul><li><code>LINK_AUTO</code> - the specified interface is managed and configured by systemd network manager</li><li><code>LINK_MANUAL</code> - systemd will not bring up or configure the specified interface</li><li><code>LINK_MODE_UNKNOWN</code> - the link mode is unknown</li></ul><p><strong>Declaration</strong></p><pre><code> typedef enum _NET_LINK_MODE
 {
     LINK_AUTO = 0,
     LINK_MANUAL,
     LINK_MODE_UNKNOWN
 } NET_LINK_MODE;``
</code></pre><h3 id=link-state>Link State</h3><p><strong>Description</strong></p><p>Link state. Available settings:</p><ul><li><code>LINK_DOWN</code> - the link is being administratively down or has no carrier signal</li><li><code>LINK_UP</code> - the link is configured up and has carrier signal</li><li><code>LINK_STATE_UNKNOWN</code> - link state is unknown</li></ul><p><strong>Declaration</strong></p><pre><code> typedef enum _NET_LINK_STATE
 {
     LINK_DOWN = 0,
     LINK_UP,
     LINK_STATE_UNKNOWN,
 } NET_LINK_STATE;
</code></pre><h3 id=link-information>Link Information</h3><p><strong>Description</strong></p><p>Link information. Includes the following information:</p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pszMacAddress</code> - interface hardware address specified in a colon-separated format (for example: &ldquo;00:0c:29:99:a5:7b&rdquo;)</li><li><code>mtu</code> - maximum transmission unit (MTU)</li><li><code>mode</code> - link mode (see above)</li><li><code>state</code> - link state (see above)</li></ul><p><strong>Declaration</strong></p><pre><code> typedef struct _NET_LINK_INFO
 {
     struct _NET_LINK_INFO \*pNext;
     char \*pszInterfaceName;
     char \*pszMacAddress;
     uint32_t mtu;
     NET_LINK_MODE mode;
     NET_LINK_STATE state;
 } NET_LINK_INFO, \*PNET_LINK_INFO;
</code></pre><h2 id=nm_set_link_mac_addr>nm_set_link_mac_addr</h2><p><strong>Description</strong></p><p>Set the MAC address of the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t

nm_set_link_mac_addr(

     const char \*pszInterfaceName,
     const char \*pszMacAddress
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pszMacAddress</code> - interface hardware address specified in a colon-separated format (for example: &ldquo;00:0c:29:99:a5:7b&rdquo;)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_link_mac_addr>nm_get_link_mac_addr</h2><p><strong>Description</strong></p><p>Get the MAC address of the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_link_mac_addr(
     const char \*pszInterfaceName,
     char \*\*ppszMacAddress
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>ppszMacAddress</code> - interface hardware address specified in a colon-separated format (for example: &ldquo;00:0c:29:99:a5:7b&rdquo;)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_set_link_mode>nm_set_link_mode</h2><p><strong>Description</strong></p><p>Set the mode of the interface (auto or manual).</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_set_link_mode(
     const char \*pszInterfaceName,
     NET_LINK_MODE mode
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>mode</code> - link mode. One of the following values:<ul><li><code>LINK_AUTO</code> - the specified interface is managed and configured by systemd network manager</li><li><code>LINK_MANUAL</code> - systemd will not bring up or configure the specified interface</li><li><code>LINK_MODE_UNKNOWN</code> - the link mode is unknown</li></ul></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_link_mode>nm_get_link_mode</h2><p><strong>Description</strong></p><p>Get the mode of the interface (auto or manual).</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_link_mode(
     const char \*pszInterfaceName,
     NET_LINK_MODE \*pLinkMode
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pLinkMode</code> - link mode. One of the following values:<ul><li><code>LINK_AUTO</code> - the specified interface is managed and configured by systemd network manager</li><li><code>LINK_MANUAL</code> - systemd will not bring up or configure the specified interface</li><li><code>LINK_MODE_UNKNOWN</code> - the link mode is unknown</li></ul></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_set_link_mtu>nm_set_link_mtu</h2><p><strong>Description</strong></p><p>Set the maximum transmission unit (MTU) of the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_set_link_mtu(
     const char \*pszInterfaceName,
     uint32_t mtu
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>mtu</code> - maximum transmission unit (MTU)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_link_mtu>nm_get_link_mtu</h2><p><strong>Description</strong></p><p>Get the maximum transmission unit (MTU) of the interface.</p><p><strong>Declaration</strong></p><pre><code>nm_get_link_mtu
 uint32_t
 nm_get_link_mtu(
     const char \*pszInterfaceName,
     uint32_t \*pMtu
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pMtu</code> - maximum transmission unit (MTU)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_set_link_state>nm_set_link_state</h2><p><strong>Description</strong></p><p>Set the link state of the interface (up or down).</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_set_link_state(
     const char \*pszInterfaceName,
     NET_LINK_STATE state
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>state</code> - link state. One of the following values:<ul><li><code>LINK_DOWN</code> - the link is being administratively down or has no carrier signal.</li><li><code>LINK_UP</code> - the link is configured up and has carrier signal.</li><li><code>LINK_STATE_UNKNOWN</code> - the link state is unknown</li></ul></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_link_state>nm_get_link_state</h2><p><strong>Description</strong></p><p>Get the link state of the interface (up or down).</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_link_state(
     const char \*pszInterfaceName,
     NET_LINK_STATE \*pLinkState
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pLinkState</code> - link state. One of the following values:<ul><li><code>LINK_DOWN</code> - the link is being administratively down or has no carrier signal</li><li><code>LINK_UP</code> - the link is configured up and has carrier signal</li><li><code>LINK_STATE_UNKNOWN</code> - the link state is unknown</li></ul></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_ifup>nm_ifup</h2><p><strong>Description</strong></p><p>Set the specified interface state to UP. Additionally, if the interface is configured to have an IP address, it waits for the interface to acquire the IP address, and then updates neighbors of its IP address via the address resolution protocol (ARP) messages.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_ifup(
     const char \*pszInterfaceName
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_ifdown>nm_ifdown</h2><p><strong>Description</strong></p><p>Set the specified interface state to DOWN.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_ifdown(
     const char \*pszInterfaceName
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_link_info>nm_get_link_info</h2><p><strong>Description</strong></p><p>Get link information for the interface. The caller is responsible for freeing ppLinkInfo by calling nm_free_link_info.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_link_info(
     const char \*pszInterfaceName,
     NET_LINK_INFO \*\*ppLinkInfo
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>ppLinkInfo</code>, which includes the following information:<ul><li>*<code>pszInterfaceName</code> - interface name</li><li>*<code>pszMacAddress</code> - interface hardware address specified in a colon-separated format (for example: &ldquo;00:0c:29:99:a5:7b&rdquo;)</li><li><code>mtu</code> - maximum transmission unit (MTU)</li><li><code>mode</code> - One of the following values:<ul><li><code>LINK_AUTO</code> - the specified interface is managed and configured by systemd network manager</li><li><code>LINK_MANUAL</code> - systemd will not bring up or configure the specified interface</li><li><code>LINK_MODE_UNKNOWN</code> - the link mode is unknown</li></ul></li><li><code>state</code> - One of the following values:<ul><li><code>LINK_DOWN</code> - the link is being administratively down or has no carrier signal</li><li><code>LINK_UP</code> - the link is configured up and has carrier signal</li><li><code>LINK_STATE_UNKNOWN</code> - the link state is unknown</li></ul></li></ul></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_free_link_info>nm_free_link_info</h2><p><strong>Description</strong></p><p>Frees the NET_LINK_INFO structure returned by a successful nm_get_link_info call.</p><p><strong>Declaration</strong></p><pre><code>void
 nm_free_link_info(
     NET_LINK_INFO \*pNetLinkInfo
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pNetLinkInfo</code>, which includes the following information:<ul><li>*<code>pszInterfaceName</code> - interface name</li><li>*<code>pszMacAddress</code> - interface hardware address specified in a colon-separated format (for example: &ldquo;00:0c:29:99:a5:7b&rdquo;)</li><li><code>mtu</code> - maximum transmission unit (MTU)</li><li><code>mode</code> - One of the following values:<ul><li><code>LINK_AUTO</code> - the specified interface is managed and configured by systemd network manager</li><li><code>LINK_MANUAL</code> - systemd will not bring up or configure the specified interface</li><li><code>LINK_MODE_UNKNOWN</code> - the link mode is unknown</li></ul></li><li><code>state</code> - One of the following values:<ul><li><code>LINK_DOWN</code> - the link is being administratively down or has no carrier signal</li><li><code>LINK_UP</code> - the link is configured up and has carrier signal</li><li><code>LINK_STATE_UNKNOWN</code> - the link state is unknown</li></ul></li></ul></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h1 id=ip-address-configuration-apis>IP Address Configuration APIs</h1><p>The Photon OS network manager C API enables you to manage IP addresses for interfaces that are managed by systemd network manager.</p><h2 id=structure-declarations-1>Structure Declarations</h2><h3 id=ip-address-mode>IP Address Mode</h3><p><strong>Description</strong></p><p>Defines the IP address mode. One of the following values:</p><ul><li><code>IPV4_ADDR_MODE_NONE</code> - no IPv4 address configured on the interface</li><li><code>IPV4_ADDR_MODE_STATIC</code> - the interface is configured with a static IPv4 address</li><li><code>IPV4_ADDR_MODE_DHCP</code> - the interface is configured with a DHCP IPv4 address</li></ul><p><strong>Declaration</strong></p><pre><code> typedef enum _NET_IPV4_ADDR_MODE
 {
     IPV4_ADDR_MODE_NONE = 0,
     IPV4_ADDR_MODE_STATIC,
     IPV4_ADDR_MODE_DHCP,
     IPV4_ADDR_MODE_MAX
 } NET_IPV4_ADDR_MODE;
</code></pre><h3 id=address-type>Address Type</h3><p><strong>Description</strong></p><p>Defines the type of IP address. One of the following options:</p><ul><li><code>STATIC_IPV4</code> - static IPv4 address</li><li><code>STATIC_IPV6</code> - static IPv6 address</li><li><code>DHCP_IPV4</code> - DHCP IPv4 address</li><li><code>DHCP_IPV6</code> - DHCP IPv6 address</li><li><code>AUTO_IPV6</code> - stateless dynamic IPv6 address</li><li><code>LINK_LOCAL_IPV6</code> - link local IPv6 address</li></ul><p><strong>Declaration</strong></p><pre><code> typedef enum _NET_ADDR_TYPE
 {
     STATIC_IPV4        =  0x00000001,
     STATIC_IPV6        =  0x00000002,
     DHCP_IPV4          =  0x00000010,
     DHCP_IPV6          =  0x00000020,
     AUTO_IPV6          =  0x00000040,
     LINK_LOCAL_IPV6    =  0x00000080,
 } NET_ADDR_TYPE;
</code></pre><h3 id=ip-addresses>IP Addresses</h3><p><strong>Description</strong></p><p>Defines IP addresses.</p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>type</code> - address type</li><li><code>pszIPAddrPrefix</code> - IP address</li></ul><p><strong>Declarations</strong></p><pre><code> typedef struct _NET_IP_ADDR
 {
     char \*pszInterfaceName;
     NET_ADDR_TYPE type;
     char \*pszIPAddrPrefix;
 } NET_IP_ADDR, \*PNET_IP_ADDR;
</code></pre><h2 id=nm_set_ipv4_addr_gateway>nm_set_ipv4_addr_gateway</h2><p><strong>Description</strong></p><p>Set the IPv4 address and (optionally) the default gateway address for the interface.</p><p><strong>Declaration</strong></p><pre><code> uint32_t

 nm_set_ipv4_addr_gateway(

     const char \*pszInterfaceName,
     NET_IPV4_ADDR_MODE mode,
     const char \*pszIPv4AddrPrefix,
     const char \*pszIPv4Gateway
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>mode</code> - IP address mode; one of the following values:<ul><li><code>IPV4_ADDR_MODE_NONE</code></li><li><code>IPV4_ADDR_MODE_STATIC</code></li><li><code>IPV4_ADDR_MODE_DHCP</code></li></ul></li><li><code>pszIPv4AddrPrefix</code> - IPv4 address specified in dot-decimal / prefix notation (for example, 10.10.10.101/23). If the prefix is not specified, then a /32 prefix is assumed.</li><li><code>pszIPv4Gateway</code> - IPv4 gateway (optional) specified in the dot-decimal format (for example,10.10.20.30).</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_ipv4_addr_gateway>nm_get_ipv4_addr_gateway</h2><p><strong>Description</strong></p><p>Get the IPv4 address and the default gateway address for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_ipv4_addr_gateway(
     const char \*pszInterfaceName,
     NET_IPV4_ADDR_MODE \*pMode,
     char \*\*ppszIPv4AddrPrefix,
     char \*\*ppszIPv4Gateway
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pmode</code> - IP mode; one of the following values:<ul><li><code>IPV4_ADDR_MODE_NONE</code></li><li><code>IPV4_ADDR_MODE_STATIC</code></li><li><code>IPV4_ADDR_MODE_DHCP</code></li></ul></li><li><code>ppszIPv4AddrPrefix</code> - IPv4 address returned in dot-decimal / prefix notation (for example, 10.10.10.101/23). If the prefix is not specified, then a /32 prefix is assumed.</li><li><code>ppszIPv4Gateway</code> - IPv4 gateway (optional) returned in the dot-decimal format (for example,10.10.10.250).</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_add_static_ipv6_addr>nm_add_static_ipv6_addr</h2><p><strong>Description</strong></p><p>Add an IPv6 address to the specified interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_add_static_ipv6_addr(
     const char \*pszInterfaceName,
     const char \*pszIPv6AddrPrefix
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pszIPv6AddrPrefix</code> - IPv6 address specified in the standard colon-separated IPv6 address format followed by the prefix (for example, 2010:a1:b2::25/64). If the not prefix is specified, then a /128 prefix is assumed.</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_delete_static_ipv6_addr>nm_delete_static_ipv6_addr</h2><p><strong>Description</strong></p><p>Delete a static IPv6 address from the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_delete_static_ipv6_addr(
     const char \*pszInterfaceName,
     const char \*pszIPv6AddrPrefix
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pszIPv6AddrPrefix</code> - IPv6 address specified in the standard colon-separated IPv6 address format followed by the prefix (for example, 2010:a1:b2::25/64). If the not prefix is specified, then a /128 prefix is assumed.</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_set_ipv6_addr_mode>nm_set_ipv6_addr_mode</h2><p><strong>Description</strong></p><p>Set the mode for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_set_ipv6_addr_mode(
     const char \*pszInterfaceName,
     uint32_t enableDhcp,
     uint32_t enableAutoconf
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>enableDhcp</code> - enable (1) or disable (0) DHCP; enabling configures the interface to acquire a DHCP IPv6 address.</li><li><code>enableAutoconf</code> - enable (1) or disable (0) autoconf; enabling configures the interface to acquire a stateless autoconfiguration IPv6 address.</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_ipv6_addr_mode>nm_get_ipv6_addr_mode</h2><p><strong>Description</strong></p><p>Get the mode for the interface.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_get_ipv6_addr_mode(
     const char \*pszInterfaceName,
     uint32_t \*pDhcpEnabled,
     uint32_t \*pAutoconfEnabled
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pDhcpEnabled</code> - returns whether IPv6 DHCP is enabled (1) or disabled (0).</li><li><code>pAutoconfEnabled</code> - returns whether IPv6 stateless autoconfiguration is enabled (1) or disabled (0).</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_ip_addr>nm_get_ip_addr</h2><p><strong>Description</strong></p><p>Get the IP address for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_ip_addr(
     const char \*pszInterfaceName,
     uint32_t addrTypes,
     size_t \*pCount,
     NET_IP_ADDR \*\*\*pppIpAddrList
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>addrTypes</code> - type of IP address; one of the following values:<ul><li><code>STATIC_IPV4</code></li><li><code>STATIC_IPV6</code></li><li><code>DHCP_IPV4</code></li><li><code>DHCP_IPV6</code></li><li><code>AUTO_IPV6</code></li><li><code>LINK_LOCAL_IPV6</code></li></ul></li><li><code>pCount</code> - number of IP address structures in the pppIpAddrList array returned by the API call.</li><li><code>pppIpAddrList</code> - array of NET_IP_ADDR elements that includes the following:<ul><li><code>pszInterfaceName</code></li><li><code>type</code></li><li><code>pszIPAddrPrefix</code></li></ul></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_set_ipv6_gateway>nm_set_ipv6_gateway</h2><p><strong>Description</strong></p><p>Set the default IPv6 gateway for the interface.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_set_ipv6_gateway(
     const char \*pszInterfaceName,
     const char \*pszIPv6Gateway
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pszIPv6Gateway</code> - IPv6 gateway specified in the standard colon-separated IPv6 address format (for example, 2010:125::100)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_ipv6_gateway>nm_get_ipv6_gateway</h2><p><strong>Description</strong></p><p>Get the default IPv6 gateway for the interface.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_get_ipv6_gateway(
     const char \*pszInterfaceName,
     char \*\*ppszIPv6Gateway
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>ppszIPv6Gateway</code> - IPv6 gateway specified in the standard colon-separated IPv6 address format (for example, 2010:125::100)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h1 id=route-configuration-apis>Route Configuration APIs</h1><p>The Photon OS network manager C API enables you to manage static IP routes configuration.</p><h2 id=structure-declarations-2>Structure Declarations</h2><h3 id=route-scope>Route Scope</h3><p><strong>Description</strong></p><p>Defines the scope of a route. One of the following options.</p><ul><li><code>GLOBAL_ROUTE</code> - route to a destination one or more hops away</li><li><code>LINK_ROUTE</code> - route to a destination on the local network</li><li><code>HOST_ROUTE</code> - route to a destination address on the local host</li></ul><p><strong>Declaration</strong></p><pre><code> typedef enum _NET_ROUTE_SCOPE
 {
     GLOBAL_ROUTE = 0,
     LINK_ROUTE,
     HOST_ROUTE,
     NET_ROUTE_SCOPE_MAX
 } NET_ROUTE_SCOPE;
</code></pre><h3 id=ip-route>IP Route</h3><p><strong>Description</strong></p><p>Defines an IP route. Includes the following information:</p><ul><li><code>pszInterfaceName</code> - interface through which the specified destination network can be reached</li><li><code>pszDestNetwork</code> - destination IP network reached by the specified route</li><li><code>pszSourceNetwork</code> - source network for the specified route</li><li><code>pszGateway</code> - IP gateway through which the specified destination network can be reached</li><li><code>scope</code> - scope of this route entry; one of the following values: GLOBAL_ROUTE, LINK_ROUTE, or HOST_ROUTE as defined above</li><li><code>metric</code> - metric of this route, an unsigned integer</li><li><code>table</code> - identifier for the route table to which this route belongs.</li></ul><p><strong>Declaration</strong></p><pre><code> typedef struct _NET_IP_ROUTE
 {
     char \*pszInterfaceName;
     char \*pszDestNetwork;
     char \*pszSourceNetwork;
     char \*pszGateway;
     NET_ROUTE_SCOPE scope;
     uint32_t metric;
     uint32_t table;
 } NET_IP_ROUTE, \*PNET_IP_ROUTE;
</code></pre><h2 id=nm_add_static_ip_route>nm_add_static_ip_route</h2><p><strong>Description</strong></p><p>Add a static IP route.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_add_static_ip_route(
     NET_IP_ROUTE \*pRoute
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pRoute</code> - static IP route</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_delete_static_ip_route>nm_delete_static_ip_route</h2><p><strong>Description</strong></p><p>Delete a static IP route.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_delete_static_ip_route(
     NET_IP_ROUTE \*pRoute
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pRoute</code> - static IP route</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_static_ip_routes>nm_get_static_ip_routes</h2><p><strong>Description</strong></p><p>Get the static IP routes for an interface.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_get_static_ip_routes(
     const char \*pszInterfaceName,
     size_t \*pCount,
     NET_IP_ROUTE \*\*\*pppRouteList
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pCount</code> - number of NET_IP_ROUTE elements returned in the pppRouteList array by the API call upon success</li><li><code>pppRouteList</code> - array of static IP routes</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h1 id=dns-configuration-apis>DNS Configuration APIs</h1><p>The Photon OS network manager C API enables you to manage the DNS and Domains configuration.</p><h2 id=structure-declarations-3>Structure Declarations</h2><h3 id=dns-mode>DNS Mode</h3><p><strong>Description</strong></p><p>DNS mode. Any of the following values:</p><ul><li><code>DNS_MODE_INVALID</code> - DNS mode is unknown</li><li><code>STATIC_DNS</code> - DNS servers are statically configured</li><li><code>DHCP_DNS</code> - DNS servers configuration is acquired from DHCP protocol.</li></ul><p><strong>Declaration</strong></p><pre><code> typedef enum _NET_DNS_MODE
 {
     DNS_MODE_INVALID = 0,
     STATIC_DNS,
     DHCP_DNS,
     DNS_MODE_MAX,
 } NET_DNS_MODE;
</code></pre><h2 id=nm_set_dns_servers>nm_set_dns_servers</h2><p><strong>Description</strong></p><p>Set the DNS servers list for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_set_dns_servers(
     const char \*pszInterfaceName,
     NET_DNS_MODE mode,
     size_t count,
     const char \*\*ppszDnsServers
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, can be NULL)</li><li><code>mode</code> - DNS mode. One of the following values:<ul><li><code>DNS_MODE_INVALID</code> = 0</li><li><code>DNS_MODE_MA</code></li><li><code>DHCP_DNS</code></li><li><code>STATIC_DNS</code></li></ul></li><li><code>count</code> - number of NUL terminated DNS server entries passed in the ppszDnsServers array to the API call (for example, 10.10.10.200 or 2020::40)</li><li><code>ppszDnsServers</code> - array of DNS servers</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_add_dns_server>nm_add_dns_server</h2><p><strong>Description</strong></p><p>Add a server to the DNS servers list associated with an interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_add_dns_server(
     const char \*pszInterfaceName,
     const char \*pszDnsServer
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, can be NULL)</li><li><code>ppszDnsServer</code> - server to add to the DNS server list</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_delete_dns_server>nm_delete_dns_server</h2><p><strong>Description</strong></p><p>Delete a server from the DNS servers list associated with an interface.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_delete_dns_server(
     const char \*pszInterfaceName,
     const char \*pszDnsServer
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, can be NULL)</li><li><code>ppszDnsServer</code> - server to remove from the DNS server list</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_dns_servers>nm_get_dns_servers</h2><p><strong>Description</strong></p><p>Get the the DNS servers list for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_dns_servers(
     const char \*pszInterfaceName,
     NET_DNS_MODE \*pMode,
     size_t \*pCount,
     char \*\*\*pppszDnsServers
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, can be NULL)</li><li><code>pMode</code> - DNS mode. One of the following values:<ul><li><code>DNS_MODE_INVALID</code></li><li><code>DHCP_DNS</code></li><li><code>STATIC_DNS</code></li></ul></li><li><code>pCount</code> - number of NUL terminated DNS server entries in the pppszDnsServers array returned by the API call (for example, 10.10.10.200 or 2020::40)</li><li><code>pppszDnsServers</code> - array of DNS servers</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_set_dns_domains>nm_set_dns_domains</h2><p><strong>Description</strong></p><p>Set the DNS domain list.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_set_dns_domains(
     const char \*pszInterfaceName,
     size_t count,
     const char \*\*ppszDnsDomains
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, can be NULL)</li><li><code>count</code> - number of DNS domains specified in the ppszDnsDomains array to the API call (for example, if count = 2, then there are two elements: ppszDnsDomains[0] and ppszDnsDomains[1])</li><li><code>ppszDnsDomains</code> - array of DNS domains</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_add_dns_domain>nm_add_dns_domain</h2><p><strong>Description</strong></p><p>Add a DNS domain to the DNS domain list.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_add_dns_domain(
     const char \*pszInterfaceName,
     const char \*pszDnsDomain
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, can be NULL)</li><li><code>pszDnsDomain</code> - DNS domain to add to the list</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_delete_dns_domain>nm_delete_dns_domain</h2><p><strong>Description</strong></p><p>Delete a DNS domain from the DNS domain list.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_delete_dns_domain(
     const char \*pszInterfaceName,
     const char \*pszDnsDomain
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, can be NULL)</li><li><code>pszDnsDomain</code> - DNS domain to remove from the list</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_dns_domains>nm_get_dns_domains</h2><p><strong>Description</strong></p><p>Get the list of DNS domains.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_dns_domains(
     const char \*pszInterfaceName,
     size_t \*pCount,
     char \*\*\*pppszDnsDomains
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, can be NULL)</li><li><code>pCount</code> - number of DNS domains returned in the pppszDnsDomains from the API call (for example, if count = 2, then there are two elements: ppszDnsDomains[0] and ppszDnsDomains[1])</li><li><code>pppszDnsDomains</code> - array of DNS domains</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h1 id=dhcp-options-duid-and-iaid-configuration-apis>DHCP Options DUID and IAID Configuration APIs</h1><p>The Photon OS network manager C API enables you to manage DHCP DUID and Interface IAID.</p><h2 id=nm_set_iaid>nm_set_iaid</h2><p><strong>Description</strong></p><p>Set the IAID for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_set_iaid(
     const char \*pszInterfaceName,
     uint32_t iaid
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>iaid</code> - interface association identifier (IAID)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_iaid>nm_get_iaid</h2><p><strong>Description</strong></p><p>Get the IAID for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_iaid(
     const char \*pszInterfaceName,
     uint32_t \*pIaid
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>pIaid</code> - interface association identifier (IAID)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_set_duid>nm_set_duid</h2><p><strong>Description</strong></p><p>Set the DUID for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_set_duid(
     const char \*pszInterfaceName,
     const char \*pszDuid
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, specify NULL to set system global DUID configuration)</li><li><code>pszDuid</code> - DHCP unique identifier (DUID)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_duid>nm_get_duid</h2><p><strong>Description</strong></p><p>Get the DUID for the interface.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_get_duid(
     const char \*pszInterfaceName,
     char \*\*ppszDuid
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name (optional, specify NULL to query system global DUID configuration)</li><li><code>ppszDuid</code> - DHCP unique identifier (DUID)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h1 id=ntp-configuration-apis>NTP Configuration APIs</h1><p>The Photon OS network manager C API enables you to manage NTP servers configured for the system.</p><h2 id=nm_set_ntp_servers>nm_set_ntp_servers</h2><p><strong>Description</strong></p><p>Set the list of NTP servers.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_set_ntp_servers(
     size_t count,
     const char \*\*ppszNtpServers
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>count</code> - number of NTP servers in the ppszNtpServers array passed to the API call.</li><li><code>ppszNtpServers</code> - array of NTP servers</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_add_ntp_servers>nm_add_ntp_servers</h2><p><strong>Description</strong></p><p>Add a server to the NTP servers list.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_add_ntp_servers(
     size_t count,
     const char \*\*ppszNtpServers
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>count</code> - number of NTP servers to add (specified in the ppszNtpServers array) passed to the API call.</li><li><code>ppszNtpServers</code> - array of NTP servers to add</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_delete_ntp_servers>nm_delete_ntp_servers</h2><p><strong>Description</strong></p><p>Delete a server from the NTP servers list.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_delete_ntp_servers(
     size_t count,
     const char \*\*ppszNtpServers
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>count</code> - number of NTP servers to delete (specified in the ppszNtpServers array) passed to the API call</li><li><code>ppszNtpServers</code> - array of NTP servers to delete</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_ntp_servers>nm_get_ntp_servers</h2><p><strong>Description</strong></p><p>Get the NTP servers list.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_get_ntp_servers(
     size_t \*pCount,
     char \*\*\*pppszNtpServers
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pCount</code> - number of NTP servers in the pppszNtpServers array returned from the API call</li><li><code>pppszNtpServers</code> - array of NTP servers</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><p>Other APIs</p><h2 id=nm_set_hostname>nm_set_hostname</h2><p><strong>Description</strong></p><p>Set the host name for the system.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_set_hostname(
     const char \*pszHostname
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszHostname</code> - host name</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_hostname>nm_get_hostname</h2><p><strong>Description</strong></p><p>Get the host name for the system.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_get_hostname(
     char \*\*ppszHostname
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>ppszHostname</code> - host name</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_wait_for_link_up>nm_wait_for_link_up</h2><p><strong>Description</strong></p><p>Wait for the specified interface to come up.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_wait_for_link_up(
     const char \*pszInterfaceName,
     uint32_t timeout
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>timeout</code> - maximum time (in seconds) to wait (until the link is up) before timing out of the request; specify 0 for no timeout (wait indefinitely)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_wait_for_ip>nm_wait_for_ip</h2><p><strong>Description</strong></p><p>Wait for the interface to acquire an IP address of the specified IP address type.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_wait_for_ip(
     const char \*pszInterfaceName,
     uint32_t timeout,
     NET_ADDR_TYPE addrTypes
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszInterfaceName</code> - interface name</li><li><code>timeout</code> - maximum time (in seconds) to wait (until the link has an IP address of the specified address type) before timing out of the request; specify 0 for no timeout (wait indefinitely)</li><li><code>addrTypes</code> - type of IP address; one of the following values:<ul><li><code>STATIC_IPV4</code></li><li><code>STATIC_IPV6</code></li><li><code>DHCP_IPV4</code></li><li><code>DHCP_IPV6</code></li><li><code>AUTO_IPV6</code></li><li><code>LINK_LOCAL_IPV6</code></li></ul></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_set_network_param>nm_set_network_param</h2><p><strong>Description</strong></p><p>Set the value of a network parameter for an object.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_set_network_param(
     const char \*pszObjectName,
     const char \*pszParamName,
     const char \*pszParamValue
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszObjectName</code> - an interface name (for example, &ldquo;eth0&rdquo;) or a file name (for example, /etc/systemd/resolved.conf)</li><li><code>pszParamName</code> - name of a parameter associated with the object; specified in the format SectionName_KeyName (for example, Link_MTUBytes represents the MtuBytes key in [Link] section in <a href=https://www.freedesktop.org/software/systemd/man/systemd.network.html>https://www.freedesktop.org/software/systemd/man/systemd.network.html</a>)</li><li><code>pszParamValue</code> - points to the parameter value to set; you can add (+) or remove (-) a parameter by prepending the parameter name with + or -. For example:</li></ul><p>netmgr net_info &ndash;set &ndash;object eth1 &ndash;paramname +Network_Address &ndash;paramvalue &ldquo;10.10.10.1/24&rdquo;</p><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_get_network_param>nm_get_network_param</h2><p><strong>Description</strong></p><p>Get the value of a network parameter associated with an object.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_get_network_param(
     const char \*pszObjectName,
     const char \*pszParamName,
     char \*\*ppszParamValue
 );
</code></pre><p><strong>Arguments</strong></p><ul><li><code>pszObjectName</code> - an interface name (for example, &ldquo;eth0&rdquo;) or a file name (for example, /etc/systemd/resolved.conf)</li><li><code>pszParamName</code> - name of a parameter associated with the object; returned in the format SectionName_KeyName (for example, Link_MTUBytes represents the MtuBytes key in [Link] section in <a href=https://www.freedesktop.org/software/systemd/man/systemd.network.html>https://www.freedesktop.org/software/systemd/man/systemd.network.html</a>)</li><li><code>ppszParamValue</code> - parameter value</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h1 id=service-management-apis>Service Management APIs</h1><h2 id=nm_stop_network_service>nm_stop_network_service</h2><p><strong>Description</strong></p><p>Stop the network service.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_stop_network_service();
</code></pre><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_restart_network_service>nm_restart_network_service</h2><p><strong>Description</strong></p><p>Restart the network service.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_restart_network_service();
</code></pre><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><p>nm_stop_dns_service</p><p><strong>Description</strong></p><p>Stop the DNS service.</p><p><strong>Declaration</strong></p><pre><code>uint32_t
 nm_stop_dns_service();
</code></pre><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_restart_dns_service>nm_restart_dns_service</h2><p><strong>Description</strong></p><p>Restart the DNS service.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_restart_dns_service();
</code></pre><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_stop_ntp_service>nm_stop_ntp_service</h2><p><strong>Description</strong></p><p>Stop the NTP service.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_stop_ntp_service();
</code></pre><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul><h2 id=nm_restart_ntp_service>nm_restart_ntp_service</h2><p><strong>Description</strong></p><p>Restart the NTP service.</p><p><strong>Declaration</strong></p><pre><code> uint32_t
 nm_restart_ntp_service();
</code></pre><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: error code</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-4299bb3fa9afcfaa59c358ed5e38b45c>5.5.16 - Network Configuration Manager - Python API</h1><p>Photon OS provides a Python API for the Network Configuration Manager.</p><ul><li><a href=#setup-instructions>Setup Instructions</a></li><li><a href=#initialization-steps>Initialization Steps</a></li><li><a href=#get-online-help>Get Online Help</a></li><li><a href=#basic-information>Basic Information</a></li><li><a href=#interface-configuration>Interface Configuration</a></li><li><a href=#ip-address-configuration>IP Address Configuration</a></li><li><a href=#dns-configuration>DNS Configuration</a></li><li><a href=#dhcp-options-duid-and-iaid-configuration>DHCP Options, DUID, and IAID Configuration</a></li><li><a href=#ntp-servers>NTP Servers</a></li></ul><h2 id=setup-instructions>Setup Instructions</h2><p>To set up and run the latest version of the Network Manager API for Python:</p><pre><code class=language-console data-lang=console># tdnf install pmd pmd-python3
# systemctl start pmd
</code></pre><h2 id=initialization-steps>Initialization Steps</h2><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#8f5902;font-style:italic># python3</span>
<span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>pmd</span>
<span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>net</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>pmd</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>server</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>net</span>
</code></pre></div><h2 id=get-online-help>Get Online Help</h2><p>Get help for all commands.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>help</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>net</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p>Get help for a specific command.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>help</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add_ntp_servers</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#ce5c00;font-weight:700>-</span><span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>function</span> <span style=color:#000>add_ntp_servers</span><span style=color:#000;font-weight:700>:</span>
<span style=color:#000>add_ntp_servers</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>method</span> <span style=color:#000>of</span>  <span style=color:#000;font-weight:700>[</span><span style=color:#000>server</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>net</span><span style=color:#000;font-weight:700>](</span><span style=color:#000>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>//</span><span style=color:#000>server</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>instance</span>
    <span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add_ntp_servers</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ntpservers</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;20.20.20.20&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;25.30.40.70&#34;</span><span style=color:#000;font-weight:700>])</span>
    <span style=color:#000>adds</span> <span style=color:#000>ntp</span> <span style=color:#000>servers</span><span style=color:#ce5c00;font-weight:700>.</span> <span style=color:#000>returns</span> <span style=color:#000>success</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>failure</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>exception</span><span style=color:#ce5c00;font-weight:700>.</span>
<span style=color:#000;font-weight:700>(</span><span style=color:#000>END</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><h2 id=basic-information>Basic Information</h2><h3 id=get_system_network_info>get_system_network_info</h3><p>Get network information details that are common to the entire system.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_system_network_info</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p><strong>Returns</strong></p><ul><li>details about the system network (DUID, DNS mode, DNS server list, DNS domain list, NTP server list)</li></ul><p><strong>Example</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>system_network_info</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>netmgmt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_system_network_info</span><span style=color:#000;font-weight:700>()</span>

<span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#204a87;font-weight:700>print</span> <span style=color:#000;font-weight:700>(</span> <span style=color:#000>system_network_info</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#000;font-weight:700>[{</span><span style=color:#000>DUID</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>00</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>02</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>11</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>44</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>55</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>66</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>77</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>DNS</span> <span style=color:#000>Mode</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>null</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000>DNS</span> <span style=color:#000>ServerList</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;10.10.100.100&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;20.20.200.10&#39;</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>DNS</span> <span style=color:#000>domain</span> <span style=color:#204a87>list</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39; [abcd.com](http://abcd.com)&#39;</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>NTP</span> <span style=color:#000>ServerList</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>null</span><span style=color:#000;font-weight:700>)}]</span>
</code></pre></div><h3 id=get_err_info>get_err_info</h3><p>Get information about the specified error number.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_err_info</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>error</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>error_number</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li>error - error number</li></ul><p>Here is the list of error numbers:</p><ul><li>4097 - invalid parameter</li><li>4098 - not supported</li><li>4099 - out of memory</li><li>4100 - value not found</li><li>4101 - value exists</li><li>4102 - invalid interface</li><li>4103 - invalid mode</li><li>4104 - bad configuration file</li><li>4105 - write failed</li><li>4106 - timout</li><li>4107 - DCHP timeout</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><p>Example</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#ce5c00;font-weight:700>&gt;&gt;</span> <span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_err_info</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>error</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4097</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#4e9a06>&#39;invalid parameter&#39;</span>
</code></pre></div><h2 id=interface-configuration>Interface Configuration</h2><p>Use these commands to manage the configuration for a network interface.</p><h3 id=get_link_info>get_link_info</h3><p>Get the link info for the specified interface or for all interfaces (if no interface is specified).</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_link_info</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name (optional)</li></ul><p><strong>Returns</strong></p><ul><li>success: link info</li><li>failure: exception</li></ul><h3 id=get_link_macaddr>get_link_macaddr</h3><p>Get the MAC address for the specified interface or for all interfaces (if no interface is specified).</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_link_macaddr</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name (optional)</li></ul><p><strong>Returns</strong></p><ul><li>success: MAC address</li><li>failure: exception</li></ul><h3 id=get_link_mode>get_link_mode</h3><p>Get the link mode for the specified interface (auto or manual), or for all interfaces (if no interface is specified).</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_link_mode</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name (optional)</li></ul><p><strong>Returns</strong></p><ul><li>success: link mode (auto, manual, or unknown)</li><li>failure: exception</li></ul><h3 id=get_link_mtu>get_link_mtu</h3><p>Get the MTU of the specified interface or for all interfaces (if no interface is specified).</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_link_mtu</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name (optional)</li></ul><p><strong>Returns</strong></p><ul><li>success: link MTU</li><li>failure: exception</li></ul><h3 id=get_link_state>get_link_state</h3><p>Get the link state of the specified interface or for all interfaces (if no interface is specified).</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_link_state</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name (optional)</li></ul><p><strong>Returns</strong></p><ul><li>success: link state (up, down, unknown)</li><li>failure: exception</li></ul><h3 id=set_link_down>set_link_down</h3><p>Bring down the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set_link_down</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_link_macaddr>set_link_macaddr</h3><p>Set the MAC address of the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set_link_macaddr</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>macaddr</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>mac_address</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>macaddr</code> = MAC address</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_link_mode>set_link_mode</h3><p>Set the mode (auto or manual) of the specifed interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set_link_mode</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>link_mode</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>auto</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>manual</span><span style=color:#000;font-weight:700>])</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>link_mode</code> - auto or manual</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_link_mtu>set_link_mtu</h3><p>Set the MTU for the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set_link_mtu</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>mtu</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>mtu</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>mtu</code> - <code>mtu</code></li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_link_state>set_link_state</h3><p>Set the state (up or down) of the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set_link_state</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>link_state</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>down</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>up</span><span style=color:#000;font-weight:700>])</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>link_state</code> - down or up</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_link_up>set_link_up</h3><p>Brings up the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set_link_up</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>link_state</code> - down or up</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h2 id=ip-address-configuration>IP Address Configuration</h2><p>Use these commands to manage IP address configuration for a network interface.</p><h3 id=add_static_ipv6_addr>add_static_ipv6_addr</h3><p>Add a static IPv6 address to the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add_static_ipv6_addr</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addr_prefix</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ipv6address_prefix</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>addr_prefix</code> - IPv6 address prefix</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=del_static_ipv6_addr>del_static_ipv6_addr</h3><p>Delete a static IPv6 address from the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>del_static_ipv6_addr</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addr_prefix</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ipv6address_prefix</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>addr_prefix</code> - IPv6 address prefix</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=get_ipv4_addr_gateway>get_ipv4_addr_gateway</h3><p>Get the IPv4 address with the prefix and gateway for the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_ipv4_addr_gateway</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: IPv4 address with the prefix and gateway</li><li>failure: exception</li></ul><h3 id=get_ipv6_addr>get_ipv6_addr</h3><p>Get the list of IPv6 addresses for the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_ipv6_addr</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: IPv6 address list</li><li>failure: exception</li></ul><h3 id=get_ipv6_addr_mode>get_ipv6_addr_mode</h3><p>Get the address mode for the specified interface to determine whether DHCPv6, autoconf are enabled or disabled.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_ipv6_addr_mode</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>Status for DHCPv6, autoconf (True=enabled, False=disabled)</li><li>failure: exception</li></ul><h3 id=get_ipv6_gateway>get_ipv6_gateway</h3><p>Get the IPv6 gateway for the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_ipv6_gateway</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: IPv6 gateway</li><li>failure: exception</li></ul><h3 id=set_ipv4_addr_gateway>set_ipv4_addr_gateway</h3><p>Set the IPv4 address with the prefix and gateway for the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_ipv4_addr_gateway</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addr_mode</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>dhcp</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>static</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>none</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>addr_prefix</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ipv4addressprefix</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gateway</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ipv4gateway</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>addr_mode</code> - address mode - dhcp, static, or none</li><li><code>addr_prefix</code> - IPv4 address or prefix</li><li><code>gateway</code> - IPv4 gateway</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_ipv6_addr_mode>set_ipv6_addr_mode</h3><p>Set the address mode for the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set_ipv6_addr_mode</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>enable_dhcp</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#3465a4>True</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>False</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>enable_autoconf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#3465a4>True</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>False</span><span style=color:#000;font-weight:700>])</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>enable_dhcp</code> - True to enable, False to disable</li><li><code>enable_autoconf</code> - True to enable, False to disable</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_ipv6_gateway>set_ipv6_gateway</h3><p>Set the IPv6 gateway for the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set_ipv6_gateway</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>gateway</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ipv6gateway</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>gateway</code> - IPv6 gateway</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h2 id=dns-configuration>DNS Configuration</h2><p>Use these commands to manage DNS domains and servers for a network interface.</p><h3 id=get_dns_domains>get_dns_domains</h3><p>Get the list of DNS domains for the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_dns_domains</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: list of DNS domains</li><li>failure: exception</li></ul><h3 id=get_dns_servers>get_dns_servers</h3><p>Get the list of DNS servers and the mode for the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_dns_servers</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: list of DNS servers and mode</li><li>failure: exception</li></ul><h3 id=set_dns_domains>set_dns_domains</h3><p>Set the list of DNS domains for the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set_dns_domains</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>domains</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;domain1&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;domain2&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>domains</code> - comma-separated list of one or more domains</li><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_dns_servers>set_dns_servers</h3><p>Set the list of DNS servers for the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set_dns_servers</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dns_mode</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>dhcp</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>static</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>servers</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;server1&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;server2&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>dns_mode</code> - dhcp or static</li><li><code>servers</code> - comma-separate list of one or more servers</li><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h2 id=dhcp-options-duid-and-iaid-configuration>DHCP Options DUID and IAID Configuration</h2><h3 id=get_link_iaid>get_link_iaid</h3><p>Get the IAID for the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_link_iaid</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li></ul><p><strong>Returns</strong></p><ul><li>success: IAID</li><li>failure: exception</li></ul><h3 id=set_link_iaid>set_link_iaid</h3><p>Set the IAID for the specified interface.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set_link_iaid</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>iaid</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>iaid</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li>iaid - IAID</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=get_dhcp_duid>get_dhcp_duid</h3><p>Get the DCHP DUID.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_dhcp_duid</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name (optional)</li></ul><p><strong>Returns</strong></p><ul><li>success: DUID</li><li>failure: exception</li></ul><h3 id=set_dhcp_duid>set_dhcp_duid</h3><p>Set the DCHP DUID.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set_dhcp_duid</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span> <span style=color:#000>duid</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>duid</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name (optional)</li><li><code>duid</code> - DUID to set</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h2 id=ntp-servers>NTP Servers</h2><p>Use these commands to manage the NTP servers list.</p><h3 id=add_ntp_servers>add_ntp_servers</h3><p>Add one or more NTP servers to the NTP servers list.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add_ntp_servers</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ntpservers</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;server1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;server2&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000;font-weight:700>])</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ntpservers</code> - Comma-separated list of NTP servers to add to the list.</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=del_ntp_servers>del_ntp_servers</h3><p>Remove one or more NTP servers from the NTP servers list.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>del_ntp_servers</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ntpservers</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;server1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;server2&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000;font-weight:700>])</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ntpservers</code> - Comma-separated list of NTP servers to remove from the list.</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=get_ntp_servers>get_ntp_servers</h3><p>Get the NTP servers list.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_ntp_servers</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p><strong>Returns</strong></p><ul><li>success: NTP servers list</li><li>failure: exception</li></ul><h3 id=set_ntp_servers>set_ntp_servers</h3><p>Set the NTP servers list.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set_ntp_servers</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ntpservers</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;server1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;server2&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000;font-weight:700>])</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ntpservers</code> - Comma-separated list of NTP servers to set in the list.</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=get_hostname>get_hostname</h3><p>Get the host name.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_hostname</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p><strong>Returns</strong></p><ul><li>success: host name</li><li>failure: exception</li></ul><h3 id=set_hostname>set_hostname</h3><p>Set the host name.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set_hostname</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>hostname</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>hostname</code> - name to assign to the host</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=wait_for_ip>wait_for_ip</h3><p>Wait for the specified interface to acquire a valid IP address of the specified IP address type.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>wait_for_ip</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>timeout</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>timeout</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>addrtypes</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>ipv4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ipv6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>static_ipv4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>static_ipv6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dhcp_ipv4</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>dhcp_ipv6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>auto_ipv6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>link_local_ipv6</span><span style=color:#000;font-weight:700>])</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>timeout</code> - maximum time (in seconds) to wait (until the link is up) before timing out of the request; specify 0 for no timeout (wait indefinitely)</li><li><code>addrtypes</code> - one of the following address types: ipv4, ipv6, static_ipv4, static_ipv6, dhcp_ipv4, dhcp_ipv6, auto_ipv6, or link_local_ipv6</li></ul><p><strong>Returns</strong></p><ul><li>success: 0 (when the link has an IP of the specified type)</li><li>failure: exception (for example, timeout expired)</li></ul><h3 id=wait_for_link_up>wait_for_link_up</h3><p>Wait for the specified interface to come up.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>wait_for_link_up</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ifname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>timeout</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>timeout</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>ifname</code> - interface name</li><li><code>timeout</code> - maximum time (in seconds) to wait (until the link is up) before timing out of the request; specify 0 for no timeout (wait indefinitely)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0 (when link is up)</li><li>failure: exception (for example, timeout expired)</li></ul><h3 id=get_network_param>get_network_param</h3><p>Get the specified network configuration parameter for the specified interface or filename.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_network_param</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>object</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>IfName</span> <span style=color:#204a87;font-weight:700>or</span> <span style=color:#000>Filename</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>paramname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>SectionName_KeyName</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>object</code> - an interface name (for example, "eth0") or a file name (for example, /etc/systemd/resolved.conf)</li><li><code>paramname</code> - name of a parameter associated with the object; specified in the format SectionName_KeyName (for example, Link_MTUBytes represents the MtuBytes key in [Link] section in <a href=https://www.freedesktop.org/software/systemd/man/systemd.network.html>https://www.freedesktop.org/software/systemd/man/systemd.network.html</a>)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul><h3 id=set_network_param>set_network_param</h3><p>Set the value of a network configuration parameter for the specified interface or filename.</p><p><strong>Syntax</strong></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>net</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set_network_param</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>object</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>interface_name</span> <span style=color:#204a87;font-weight:700>or</span> <span style=color:#000>filename</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>paramname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>SectionName_KeyName</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>paramvalue</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>key_value</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><strong>Parameters</strong></p><ul><li><code>object</code> - an interface name (for example, "eth0") or a file name (for example, /etc/systemd/resolved.conf)</li><li><code>paramname</code> - name of a parameter associated with the object; specified in the format SectionName_KeyName (for example, Link_MTUBytes represents the MtuBytes key in [Link] section in <a href=https://www.freedesktop.org/software/systemd/man/systemd.network.html>https://www.freedesktop.org/software/systemd/man/systemd.network.html</a>)</li></ul><p><strong>Returns</strong></p><ul><li>success: 0</li><li>failure: exception</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-0bfcc1b7d9a91fb1d816496988d37f11>5.6 - Prioritize eth0 Route Over WLAN</h1><p>You can prioritise the eth0 route over the WLAN route. Perform the following steps:</p><ol><li><p>Modify the <code>/etc/systemd/network/99-dhcp-en.network</code> file and add the following content:</p><pre><code>[DHCP]
RouteMetric=512
</code></pre></li><li><p>Restart <code>systemd-networkd</code>.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-cb030bcd5f415cc6eeb046d6275d154a>5.7 - Configuring Photon Real-Time Operating System for Real-Time Applications</h1><p>Photon Real-Time (RT) Operating System (OS) (and the Linux kernel <code>PREEMPT_RT</code> patchset that it is based on) is optimized to support low-latency real-time scheduling and minimize the OS jitter as observed by real-time applications. However, to get the most out of Photon RT OS, it is must to have a proper system configuration. To run low-latency real time applications effectively, the sources of jitter have to be identified and eliminated across all layers of the underlying system, spanning the BIOS / firmware, the hypervisor, and the guest operating system (Photon RT).</p><h2 id=biosfirmware>BIOS/Firmware</h2><p>Tuning a system for real time operation starts from the lowest layers of the software stack, namely the System BIOS or Platform Firmware. The goal is to configure the settings for the following functions:</p><ul><li><p>Maximize Performance
Ex: Set CPU, memory and device power management modes to maximum performance, disable CPU idle states</p></li><li><p>Minimize Computational Jitter
Ex: Disable Turbo Boost, disable Hyper-Threading</p></li><li><p>Minimize System Management Interrupts
Ex: Disable options such as Processor Power and Utilization Monitoring, memory Pre-Failure Notification, and so on</p></li></ul><p>Platform vendors often publish low-latency tuning guides for their BIOS/firmware. Refer documentation to learn about the recommended low-latency settings specific to your platform.</p><h2 id=deploying-real-time-applications-on-photon-real-time-operating-system>Deploying Real-Time Applications on Photon Real-Time Operating System</h2><p>A general strategy to deploy real-time applications on Photon RT is described as follows:</p><ul><li><p>Partition CPUs between the OS and the RT workload:
Among the available CPUs in the system, isolate a subset of CPUs, designated to run the RT workload. By default, the Linux scheduler will only run tasks on non-isolated CPUs, leaving the isolated CPUs to those tasks that are explicitly bound to them. Thus, all the housekeeping tasks of the OS will execute on non-isolated CPUs (with a few exceptions, such as per-CPU kernel threads). Then bind the RT workload to the isolated CPUs.</p></li><li><p>Steer unrelated interrupts away from the CPUs running the RT workload:
Linux supports the ability to affine most interrupts to specific CPUs in the system. By using this mechanism, interrupts that are not relevant to the real-time workload can be affined to non-isolated CPUs, thus avoiding the jitter caused by interrupt handling latency on the isolated CPUs.</p></li></ul><p>This strategy provides two important benefits:</p><ol><li><p>It limits OS interference with the RT workload.</p></li><li><p>It protects the OS services from getting starved by the CPU-intensive RT tasks.</p></li></ol><p>This configuration can be achieved using a combination of kernel command-line options, and user space packages, as discussed in the following sections.</p><h3 id=kernel-command-line-parameters>Kernel Command-Line Parameters</h3><ul><li><p>CPU isolation</p><p><code>isolcpus=X,Y-Z (Ex: isolcpus=2,4-5)</code></p></li><li><p>Interrupt affinity</p><p><code>irqaffinity=X,Y-Z (Ex: irqaffinity=0-1,3)</code> [ Usually it is the inverse of <code>isolcpus</code>.]</p></li><li><p>RCU callbacks</p></li></ul><p><code>rcu_nocbs=X,Y-Z</code> [ Usually it is same as <code>isolcpus</code>. ]
<code>rcu_nocb_poll=1</code></p><ul><li><p>NOHZ (Eliminating the periodic timer)</p><p><code>nohz=on</code>
<code>nohz_full=X,Y-Z</code> [ Usually it is same as <code>isolcpus</code>. ]</p></li><li><p>CPU idle</p><p><code>idle=halt or idle=poll</code>
<code>intel_idle.max_cstate=0 cpuidle.off=1</code></p></li><li><p>CPU frequency</p><p><code>intel_pstate=disable</code></p></li><li><p>Lockup detectors</p><p><code>nosoftlockup nowatchdog nmi_watchdog=0</code></p></li><li><p>Timer skew detection</p><pre><code>  skew_tick=1
  clocksource=tsc
  tsc=reliable
</code></pre></li></ul><p>The full list of kernel command-line parameters and their descriptions are available at <a href=https://www.kernel.org/doc/html/v5.10/admin-guide/kernel-parameters.html>https://www.kernel.org/doc/html/v5.10/admin-guide/kernel-parameters.html</a></p><h3 id=tuned-configuration>Tuned configuration</h3><p>Tuned is a system tuning daemon that offers several profiles to tailor the OS to various usecases, including a &lsquo;realtime&rsquo; profile for low-latency workloads.</p><p>The realtime tuned profile can be applied as shown below:</p><ul><li><p><code>tdnf install tuned</code></p></li><li><p><code>systemctl enable tuned</code></p></li><li><p><code>systemctl start tuned</code></p></li></ul><p>Add <code>isolcpus</code> to <code>/etc/tuned/realtime-variables.conf</code> (by uncommenting the isolated_cores= parameter):</p><p><code>$ cat /etc/tuned/realtime-variables.conf</code></p><pre><code>Examples:
</code></pre><p><code># isolated_cores=2,4-7</code></p><p>Note: The cores configured as isolated in tuned should be consistent with isolcpus in the kernel command-line.</p><pre><code>tuned-adm profile realtime
</code></pre><h3 id=stalld-configuration>Stalld configuration</h3><p>The stalld daemon monitors the system for starved tasks and revives them by giving them a temporary boost using the <code>SCHED_DEADLINE</code> policy. <code>stalld</code> offers fine-grained controls to give starved tasks a user-specified amount of CPU time.</p><p>The stalld configuration file is <code>/etc/sysconfig/stalld</code>.</p><p>The key parameters are Starving Threshold (THRESH), Boost Period (BP), Boost Runtime (BR), and Boost Duration (BD).</p><p>The mode of operation is as follows:</p><p>If a task is starved for at least <code>THRESH</code> seconds, it is scheduled using <code>SCHED_DEADLINE</code> scheduling policy, so that it will run at least <code>BR</code> nanoseconds in every <code>BP</code> nanoseconds time period, and this repeats up to <code>BD</code> seconds, after which the task gets back its original scheduler policy/priority settings.</p><h3 id=real-time-scheduling-policies>Real Time Scheduling Policies</h3><p>The Linux kernel offers several scheduling policies to support various applications, among which the real time policies are highlighted below:</p><ul><li><p>SCHED_OTHER (default policy), SCHED_BATCH, SCHED_IDLE (non real-time policies)</p></li><li><p>SCHED_FIFO (First-In First-Out Real Time Scheduling)</p></li></ul><ol><li><p>Priority Range: 1 to 99 (highest)</p></li><li><p>Algorithm: The scheduler runs the highest-priority runnable task in the SCHED_FIFO scheduling class, until it yields (blocks/waits) the CPU voluntarily.</p></li></ol><ul><li>SCHED_RR (Round-Robin Real Time Scheduling)</li></ul><ol><li><p>Priority Range: 1 to 99 (highest)</p></li><li><p>Algorithm: The scheduler runs the highest-priority SCHED_RR task, and time-slices between equal-priority SCHED_RR tasks in configurable intervals.</p></li></ol><ul><li>SCHED_DEADLINE ( Earliest Deadline First Real Time Scheduling)</li></ul><ol><li><p>Key parameters: Runtime, Period and Deadline, which can be configured on a per-task basis.</p></li><li><p>Algorithm: The scheduler gives a SCHED_DEADLINE task at least <code>Runtime</code> amount of time on the CPU in every <code>Period</code> time period, before <code>Deadline</code> time is up.</p></li></ol><h3 id=real-time-throttling>Real Time Throttling</h3><p>The Linux kernel offers proc file system (procfs) controls to influence real-time task scheduling and throttling.</p><p>The RT throttling algorithm is as follows:</p><ul><li><p>All real-time tasks are throttled to run up to <code>runtime</code> microseconds, in every <code>period</code> microseconds. The remaining time in <code>period</code> microseconds is used to run non-RT tasks in the system.</p></li><li><p><code>runtime</code> and <code>period</code> values can be configured by writing to the files listed as follows:</p></li></ul><ol><li><p><code>/proc/sys/kernel/sched_rt_runtime_us</code>
Default: 95% (950000)
Range: -1 to (INT_MAX -1) [ -1 implies no limit, i.e., no throttling ]</p></li><li><p><code>/proc/sys/kernel/sched_rt_period_us</code>
Default: 1s (1000000)
Range: 1 to INT_MAX</p></li></ol><p>Note: See Command Line Reference for the commands for manipulating real-time properties of processes.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c39deeb962197c0195d8085996a492b2>5.8 - Containers</h1><p>A container is a process that runs on the Photon OS host with its own isolated application, file system, and networking.</p><p>Photon OS includes the open source version of Docker. With Docker, Photon OS becomes a Linux run-time host for containers, that is, a Linux cloud container.</p><p>The full version of Photon OS includes Kubernetes so you can manage clusters of containers.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-3c85173b7e03660b8116a574fecbe1a6>5.8.1 - Docker Containers</h1><p>On Photon OS, the Docker daemon is enabled by default. To view the status of the daemon, run the following command:</p><pre><code>systemctl status docker
</code></pre><p>Docker is loaded and running by default on the full version of Photon OS. On the minimal version, it is loaded but not running by default. To start it, run the following command:</p><pre><code>systemctl start docker
</code></pre><p>To obtain information about Docker, run the following command as root:</p><pre><code>docker info
</code></pre><p>After Docker is enabled and started, you can create a container. For example, run the following docker command as root to create a container running Ubuntu 14.04 with an interactive terminal shell:</p><pre><code>docker run -i -t ubuntu:14.04 /bin/bash
</code></pre><p>Photon OS also enables you to run a docker container that runs Photon OS:</p><pre><code>docker run -i -t photon /bin/bash
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-cd77c6cfde6cdc9255067f5244f24828>5.8.2 - Kubernetes</h1><p>The Kubernetes package provides several services: kube-apiserver, kube-scheduler, kube-controller-manager, kubelet, kube-proxy. These services are managed by <code>systemd</code>. Their configuration resides in a central location: <code>/etc/kubernetes</code>.</p><p>For more information, see <a href=../../docs/user-guide/kubernetes-on-photon-os/>Running Kubernetes on Photon OS</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-12d91d44b04a8488753e0a3b7821c033>5.8.3 - Support for distributed builds using Kubernetes</h1><p>The distributed system using Kubernetes allows the build system to utilize the maximum CPU power across a kubernetes cluster (pods) for faster build process.</p><p>Prerequisites</p><ul><li>Ensure that the NFS server is running</li><li>Ensure that you have the Kubernetes cluster ready that has access to the NFS server</li><li>Esure that you have installed Kubernetes package and have <code>kubeconfig</code> accessible in the build VM.</li></ul><h2 id=triggering-distributed-photon-builds>Triggering Distributed Photon Builds</h2><p>Perform the following steps in the Photon OS repository:</p><ol><li>Update the <code>'common/data/distributed_build_options.json'</code> configuration file . The following parameters need to be filled:</li></ol><ul><li><p>command→ target to run like <code>'make packages'</code> or <code>'make packages-minimal'</code> or <code>'make toolchain-stage-1'</code> or so on.
Note: Keep the <code>command</code> with flag <code>'SCHEDULER_SERVER=enable'</code>.</p></li><li><p>nfs-server-ip→ IP address of the nfs server</p></li><li><p>pods→ number of builder/worker pods you want such as 10 or 20. The default value is 1.</p></li><li><p>nfs-server-path-> path of the nfs mount. For example,<code>/mnt/NFS_PATH/MY_DIR</code></p></li></ul><ol start=2><li>Run <code>make distributed-build</code>.</li></ol><p>Note:</p><ul><li>This process will make use of the <code>kubeconfig</code> file present under the home directory and start building packages over the specified cluster.</li><li>It creates one Master pod and multiple worker pods (numbers defined in config.json).</li><li>The master pod runs the scheduler while the worker or the builder pods build the packages.</li><li>Distributed Builder monitors the build mob and deletes everything when build has either completed successfully or failed.</li></ul><p>The master starts the scheduler server to schedule the packages that have to be built.
The worker makes REST calls to scheduler server.get package and notify after the build.</p><p>The distributed build also builds cloud images.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6f374aedcb0c4dd758aa1c4ab8c53097>5.9 - Changing the Locale</h1><p>You can change the locale if the default locale does not meet your requirements.</p><p>To find the locale, run the the <code>localectl</code> command:</p><pre><code>localectl
System Locale: LANG=en_US.UTF-8
   VC Keymap: n/a
  X11 Layout: n/a
</code></pre><p>To change the locale, choose the languages that you want from <code>/usr/share/locale/locale.alias</code>, add them to <code>/etc/locale-gen.conf</code>, and then regenerate the locale list by running the following command as root:</p><pre><code>locale-gen.sh
</code></pre><p>Finally, run the following command to set the new locale, replacing the example (<code>en_US.UTF-8</code>) with the locale that you require:</p><pre><code>localectl set-locale LANG=&quot;de_CH.UTF-8&quot; LC_CTYPE=&quot;de_CH.UTF-8&quot;
</code></pre><h1 id=changing-the-keyboard-layout>Changing the keyboard layout</h1><p>See which keymaps are currently available on your system:</p><pre><code>localectl list-keymaps
</code></pre><p>If the response to that command is the all-too-common <code>Couldn't find any console keymaps</code>, install the key tables files and utilities:</p><pre><code>tdnf install kbd
</code></pre><p>You should now be able to find a keymap matching your keyboard. As an example, here I&rsquo;m searching for the German keyboard layout (so I&rsquo;m expecting something with <code>de</code> in the name) used in Switzerland:</p><pre><code>localectl list-keymaps | grep de
</code></pre><pre><code class=language-console data-lang=console>    ...
    de-latin1
    de-latin1-nodeadkeys
    de-mobii
    de_CH-latin1
    de_alt_UTF-8
    ...
</code></pre><p><code>de_CH-latin1</code> seems to be what we&rsquo;re looking for, so change your current layout to that keymap:</p><pre><code>localectl set-keymap de_CH-latin1
</code></pre><p>and confirm that the change has been made:</p><pre><code>localectl
System Locale: LANG=de_CH.UTF-8
   VC Keymap: de_CH-latin1
  X11 Layout: n/a
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-351873e35b3210b1fd2c75ee59aae9b9>5.10 - Cloud-Init on Photon OS</h1><p>The minimal and full versions of Photon OS include the cloud-init service as a built-in component. Cloud-init is a set of Python scripts that initialize cloud instances of Linux machines. The cloud-init scripts configure SSH keys and run commands to customize the machine without user interaction. The commands can set the root password, create a hostname, configure networking, write files to disk, upgrade packages, run custom scripts, and restart the system.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-45a9071d4b2303ca5bee1814357045fa>5.10.1 - Cloud-Init Overview</h1><p><code>cloud-init</code> is a multi-distribution package that handles early initialization of a cloud instance.</p><p>In-depth documentation for cloud-init is available here:</p><p><a href=https://cloudinit.readthedocs.org/en/latest/>https://cloudinit.readthedocs.org/en/latest/</a></p><h1 id=supported-installations>Supported installations</h1><p>Both the full version of and the minimal version of Photon OS support cloud-init.</p><h1 id=supported-capabilities>Supported capabilities</h1><p>Photon OS supports the following cloud-init capabilities:</p><ul><li>run commands: execute a list of commands with output to console.</li><li>configure ssh keys: add an entry to ~/.ssh/authorized_keys for the configured user.</li><li>install package: install additional packages on first boot.</li><li>configure networking: update /etc/hosts, hostname, etc.</li><li>write files: write arbitrary files to disk.</li><li>add yum repository: add a yum repository to /etc/yum.repos.d.</li><li>create groups and users: add groups and users to the system and set properties for them.</li><li>run yum upgrade: upgrade all packages.</li><li>reboot: reboot or power off when done with cloud-init.</li></ul><h1 id=getting-started>Getting Started</h1><p>The Amazon Machine Image of Photon OS has an <code>ec2 datasource</code> turned on by default so an <code>ec2</code> configuration is accepted.
However, for testing, the following methods provide ways to do <code>cloud-init</code> with a standalone instance of Photon OS.</p><h2 id=using-a-seed-iso>Using a Seed ISO</h2><p>This will be using the <code>nocloud</code> data source. In order to initialize the system in this way, an ISO file needs to be created with a meta-data file and an user-data file as shown below:</p><pre><code>$ { echo instance-id: iid-local01; echo local-hostname: cloudimg; } &gt; meta-data
$ printf &quot;#cloud-config\nhostname: testhost\n&quot; &gt; user-data
$ genisoimage  -output seed.iso -volid cidata -joliet -rock user-data meta-data
</code></pre><p>Attach the <code>seed.iso</code> generated above to your machine and reboot for the init to take effect.
In this case, the hostname is set to <code>testhost</code>.</p><h2 id=using-a-seed-disk-file>Using a Seed Disk File</h2><p>To init using local disk files, do the following:</p><pre><code>mkdir /var/lib/cloud/seed/nocloud
cd /var/lib/cloud/seed/nocloud
$ { echo instance-id: iid-local01; echo local-hostname: cloudimg; } &gt; meta-data
$ printf &quot;#cloud-config\nhostname: testhost\n&quot; &gt; user-data
</code></pre><p>Reboot the machine and the hostname will be set to <code>testhost</code>.</p><h2 id=frequencies>Frequencies</h2><p>Cloud-init modules have predetermined frequencies. Based on the frequency setting, multiple runs will yield different results. For the scripts to always run, remove the <code>instances</code> directory before rebooting.</p><pre><code>rm -rf /var/lib/cloud/instances
</code></pre><h2 id=module-frequency-info>Module Frequency Info</h2><table><thead><tr><th>Name</th><th>Frequency</th></tr></thead><tbody><tr><td>disable_ec2_metadata</td><td>Always</td></tr><tr><td>users_groups</td><td>Instance</td></tr><tr><td>write_files</td><td>Instance</td></tr><tr><td>update_hostname</td><td>Always</td></tr><tr><td>final_message</td><td>Always</td></tr><tr><td>resolv_conf</td><td>Instance</td></tr><tr><td>growpart</td><td>Always</td></tr><tr><td>update_etc_hosts</td><td>Always</td></tr><tr><td>power_state_change</td><td>Instance</td></tr><tr><td>phone_home</td><td>Instance</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-fc5006c88c80971acbca7940e17b0725>5.10.2 - Deploy Photon OS With 'cloud-init'</h1><p>You can deploy Photon OS with <code>cloud-init</code> in the following ways:</p><ul><li>As a stand-alone Photon machine</li><li>In Amazon Elastic Compute Cloud, called EC2</li><li>In the Google cloud through the Google Compute Engine, or GCE</li><li>In a VMware Vsphere private cloud</li></ul><p>When a cloud instance of Photon OS starts, <code>cloud-init</code> requires a data source. The data source can be an EC2 file for Amazon&rsquo;s cloud platform, a <code>seed.iso</code> file for a stand-alone instance of Photon OS, or the internal capabilities of a system for managing virtual machines, such as VMware vSphere or vCenter. Cloud-init also includes data sources for OpenStack, Apache CloudStack, and OVF. The data source comprises two parts:</p><ol><li>Metadata</li><li>User data</li></ol><p>The metadata gives the cloud service provider instructions on how to implement the Photon OS machine in the cloud infrastructure. Metadata typically includes the instance ID and the local host name.</p><p>The user data contains the commands and scripts that Photon OS executes when it starts in the cloud. The user data commonly takes the form of a shell script or a YAML file containing a cloud configuration. The <a href=https://launchpad.net/cloud-init>cloud-init overview</a> and <a href=https://cloudinit.readthedocs.org/en/latest/>cloud-init documentation</a> contains information about the types of data sources and the formats for metadata and user data.</p><p>On Photon OS, <code>cloud-init</code> is enabled and running by default. You can use the following command to check the status:</p><pre><code>systemctl status cloud-init 
</code></pre><p>The Photon OS directory that contains the local data and other resources for cloud-init is <code>/var/lib/cloud</code>.</p><p>Photon OS stores the logs for cloud-init in the <code>/var/log/cloud-init.log</code> file.</p><p>The following sections demonstrate how to use cloud-init to customize a stand-alone Photon OS machine, instantiate a Photon OS machine in the Amazon EC2 cloud, and deploy a virtual machine running Photon OS in vSphere. Each section uses a different combination of the available options for the metadata and the user data that make up the data source. Specifications, additional options, and examples appear in the cloud-init documentation.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-fa7d64bfcbea74033841042b4fd4e18d>5.10.3 - Customizing Guest OS using Cloud-Init</h1><p>A guest operating system is an operating system that runs inside a virtual machine. You can install a guest operating system in a virtual machine and control guest operating system customization for virtual machines created from vApp templates.</p><p>When you customize your guest OS you can set up a virtual machine with the operating system that you want.</p><h3 id=procedure>Procedure</h3><ol><li>Perform the following steps before cloning or customizing the guest operating system:</li><li>Ensure that <code>disable_vmware_customization</code> is set to false in the <code>/etc/cloud/cloud.cfg</code> file.</li><li>Set <code>manage_etc_hosts: true</code> in the <code>/etc/cloud/cloud.cfg</code> file.</li><li>Make a backup of the <code>99-disable-networking-config.cfg</code> file and delete the file from <code>/etc/cloud/cloud.cfg.d</code> folder after backup.</li><li>Clone the VM or customize the guest operating system.</li><li>After you clone your VM or customize the guest operating system, perform the following steps:</li><li>Ensure that <code>disable_vmware_customization</code> is set to true in the <code>/etc/cloud/cloud.cfg</code> file in the newly created VM and the VM from where cloning was initiated.</li><li>Remove <code>manage_etc_hosts: true</code> from the <code>/etc/cloud/cloud.cfg</code> file in the newly created VM and the VM from where cloning was initiated.</li><li>Add a copy of the backed up file <code>99-disable-networking-config.cfg</code> to its original folder <code>/etc/cloud/cloud.cfg.d</code> in the newly created VM and the VM from where cloning was initiated.</li></ol><p><strong>Note</strong>:</p><ol><li>The <code>disable_vmware_customization</code> flag in <code>/etc/cloud/cloud.cfg.d</code> file decides which customization workflow to be initiated.</li></ol><ul><li>Setting this to <strong>false</strong> invokes the Cloud-Init GOS customization workflow.</li><li>Setting this to <strong>true</strong> invokes the traditional GOSC script based customization workflow.</li></ul><ol><li><p>When the <code>manage_etc_hosts</code> flag is set to <strong>true</strong>, Cloud-Init can edit the <code>/etc/hosts</code> file with the updated values.</p><p>When the flag is set to <strong>true</strong> Cloud-Init edits the <code>/etc/hosts</code> file, even when there is no cloud config metadata available. Remove this entry once the Cloud-Init GOS customization is done, to stop Cloud-Init from editing <code>/etc/hosts</code> file and set a fallback configuration.</p></li><li><p>The <code>99-disable-networking-config.cfg</code> file is packaged as part of Cloud-Init RPM in photon and it prevents Cloud-Init from configuring the network. Delete this file before starting the Cloud-Init customization and then paste the backup of the file in the <code>/etc/cloud/cloud.cfg.d/</code> folder once the cloud-init workflow is complete. It is important to replace this file after Cloud-Init customization to avoid removal of network configuration in the Cloud-Init instance.</p></li></ol><h3 id=result>Result</h3><p>Cloud-Init guest OS customization is now enabled.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-90768e3143907dab9e81d5e71765b0d5>5.10.4 - Creating a Stand-Alone Photon Machine With cloud-init</h1><p>Cloud-init can customize a Photon OS virtual machine by using the <code>nocloud</code> data source. The <code>nocloud</code> data source bundles the <code>cloud-init</code> metadata and user data into an ISO that acts as a seed when you boot the machine. The <code>seed.iso</code> delivers the metadata and the user data without requiring a network connection.</p><p><strong>Procedure</strong></p><ol><li><p>Create the metadata file with the following lines in the <a href=http://www.yaml.org/start.html>YAML</a> format and name it <code>meta-data</code>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>instance-id</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>iid-local01</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>local-hostname</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cloudimg</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div></li><li><p>Create the user data file with the following lines in <a href=http://www.yaml.org/start.html>YAML</a> and name it <code>user-data</code>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>#cloud-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>hostname</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testhost</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>   </span>- <span style=color:#000>vim</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div></li><li><p>Generate the ISO that will serve as the seed. The ISO must have the volume ID set to <code>cidata</code>. In the following example, the ISO is generated on an Ubuntu 14.04 computer containing the files named <code>meta-data</code> and <code>user-data</code> in the local directory:</p><pre><code class=language-console data-lang=console>genisoimage -output seed.iso -volid cidata -joliet -rock user-data meta-data
</code></pre><p>The ISO now appears in the current directory:</p><pre><code class=language-console data-lang=console>steve@ubuntu:~$ ls
meta-data seed.iso user-data
</code></pre></li><li><p>Optionally, check the ISO that you generated on Ubuntu by transferring the ISO to the root directory of your Photon OS machine and then running the following command:</p><pre><code class=language-console data-lang=console>cloud-init --file seed.iso --debug init
</code></pre><p>After running the <code>cloud-init</code> command above, check the <code>cloud-init</code> log file:</p><pre><code class=language-console data-lang=console>more /var/log/cloud-init.log
</code></pre></li><li><p>Attach the ISO to the Photon OS virtual machine as a CD-ROM and reboot it so that the changes specified by seed.iso take effect. In this case, <code>cloud-init</code> sets the <code>hostname</code> and adds the <code>vim</code> package.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-5c9391c3710ae2d40436be84cf9345c3>5.10.5 - Customizing a Photon OS Machine on EC2</h1><p>You can upload an <code>ami</code> image of Photon OS to Amazon Elastic Compute Cloud (EC2) and customize the Photon OS machine by using <code>cloud-init</code> with an EC2 data source. The Amazon machine image version of Photon OS is available as a free download at the location <a href=https://packages.vmware.com/photon>packages.vmware.com/photon</a>.</p><p>The <code>cloud-init</code> service is commonly used on EC2 to configure the cloud instance of a Linux image. On EC2, <code>cloud-init</code> sets the <code>.ssh/authorized_keys</code> file to let you log in with a private key from another computer, that is, a computer besides the workstation that you are already using to connect with the Amazon cloud.</p><h2 id=example>Example</h2><p>The cloud-config user-data file that appears in the following example contains abridged SSH authorized keys to show you how to set them.</p><h3 id=prerequisites>Prerequisites</h3><ul><li>To work with EC2, obtain Amazon accounts for both AWS and EC2 with valid payment information. If you execute the below examples, you will be charged by Amazon. You must replace the <code>&lt;placeholders></code> for access keys and other account information in the examples with your account information.</li><li>Install and set up the Amazon AWS CLI and the EC2 CLI tools, including <code>ec2-ami-tools</code>.
For more information, see <a href=http://docs.aws.amazon.com/cli/latest/userguide/installing.html>Installing the AWS Command Line Interface</a>, <a href=http://docs.aws.amazon.com/AWSEC2/latest/CommandLineReference/set-up-ec2-cli-linux.html>Setting Up the Amazon EC2 Command Line Interface Tools on Linux</a> and <a href=http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/set-up-ami-tools.html>Setting Up the AMI Tools</a>.</li><li>Create SSH keys and an RSA user signing certificate and its corresponding private RSA key file.</li></ul><h3 id=procedure>Procedure</h3><ol><li>Upload the Photon OS <code>.ami</code> image to the Amazon cloud and configure it with cloud-init. The correct virtualization type for Photon OS is <code>hvm</code>.</li></ol><pre><code>$ mkdir bundled
	$ tar -zxvf ./photon-ami.tar.gz 
	$ ec2-bundle-image -c ec2-certificate.pem -k ec2-privatekey.pem -u &lt;EC2 account id&gt;  --arch x86_64 --image photon-ami.raw --destination ./bundled/
	$ aws s3 mb s3://&lt;bucket-name&gt;
	$ ec2-upload-bundle --manifest ./bundled/photon-ami.manifest.xml --bucket &lt;bucket-name&gt; --access-key &lt;Account Access Key&gt; --secret-key &lt;Account Secret key&gt;
	$ ec2-register &lt;bucket-name&gt;/photon-ami.manifest.xml --name photon-ami --architecture x86_64 --virtualization-type hvm
</code></pre><ol><li>Import the cloud-config data. In the following command, the <code>--user-data-file</code> option instructs cloud-init to import the cloud-config data in <code>user-data.txt</code>. The command assumes you have uploaded the <code>user-data.txt file</code> and created the keypair <code>mykeypair</code> and the security group <code>photon-sg</code>.</li></ol><pre><code> $ ec2-run-instances &lt;ami-ID&gt; --instance-type m3.medium -g photon-sg --key mykeypair --user-data-file user-data.txt
</code></pre><p>Describe the instance to see its ID:</p><pre><code>$ ec2-describe-instances
</code></pre><ol><li>Run the following command to obtain its public IP address, which you can use to connect to the instance with SSH:</li></ol><pre><code>$ aws ec2 describe-instances --instance-ids &lt;instance-id&gt; --query 'Reservations[*].Instances[*].PublicIpAddress' --output=text
$ ec2-describe-images
</code></pre><ol><li>Run the following commands to terminate the machine. It is important to shut down the machine because Amazon charges you while the host is running down.</li></ol><pre><code>$ ec2-deregister &lt;ami-image-identifier&gt;
$ ec2-terminate-instances &lt;instance-id&gt;
</code></pre><h3 id=result>Result</h3><p>The following are the contents of the <code>user-data.txt</code> file that <code>cloud-init</code> applies to the machine the first time that it boots up in the cloud:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#8f5902;font-style:italic>#cloud-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>hostname</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>photon-on-01</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>cloud-admins</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>cloud-users</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>photonadmin</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>gecos</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>photon test admin user</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>primary-group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cloud-admins</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cloud-users</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>lock-passwd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>passwd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>vmware</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>photonuser</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>gecos</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>photon test user</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>primary-group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cloud-users</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>groups</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>users</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>       </span><span style=color:#204a87;font-weight:700>passwd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>vmware</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>vim</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>ssh_authorized_keys</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>	 </span>- <span style=color:#000>ssh-rsa MIIEogIBAAKCAQEAuvHKAjBhpwuomcUTpIzJWRJAe71JyBgAWrwqyN1Mk5N+c9X5</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>Ru2fazFA7WxQSD1KyTEvcuf8JzdBfrEJ0v3/nT2x63pvJ8fCl6HRkZtHo8zRu8vY</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>KYTZS/sdvM/ruubHfq1ldRpgtYSqbkykoe6PCQIDAQABAoIBAEgveQtjVzHDhLTr</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>rmwJmO316ERfkQ/chLaElhi9qwYJG/jqlNIISWFyztqD1b3fxU6m5MOBIujh7Xpg</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>... ec3test@example.com </span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><p>You can view the cloud-init output log file on EC2 at <code>/var/log/cloud-init-output.log</code>.</p><p>For more information on using cloud-init user data on EC2, see <a href=http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html>Running Commands on Your Linux Instance at Launch</a>.</p><p>For more information on how to get Photon OS up and running on EC2 and run a containerized application in the Docker engine, see <a href=../../../installation-guide/run-photon-aws-ec2/>Running Photon OS on Amazon Elastic Cloud Compute</a>.</p><p>With Photon OS, you can also build cloud images on Google Compute Engine and other cloud providers. For more information, see <a href=../../../installation-guide/cloud-images/>Compatible Cloud Images</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9f61c6c264d1df7b73b27626ea4f116b>5.10.6 - Running a Photon OS Machine on GCE</h1><p>Photon OS comes in a preconfigured image ready for Google Cloud Engine.</p><h2 id=example>Example</h2><p>The example in this section shows how to create a Photon OS instance on Google Cloud Engine with and without cloud-init user data.</p><h3 id=prerequisites>Prerequisites</h3><ul><li><p>You must have set up a GCE account and are ready to pay Google for its cloud services. The GCE-ready version of Photon OS is a free image and is free. You can download Photon OS for GCE from <a href=https://packages.vmware.com/photon/4.0/GA/gce/>https://packages.vmware.com/photon/4.0/GA/gce/</a>.</p><p>The GCE-ready image of Photon OS contains packages and scripts that prepare it for the Google cloud to save you time as you implement a compute cluster or develop cloud applications. The GCE-ready version of Photon OS adds the following packages to the <a href=https://github.com/vmware/photon/blob/master/common/data/packages_minimal.json>packages installed with the minimal version</a>:</p><pre><code>sudo, tar, which, google-daemon, google-startup-scripts, kubernetes, perl-DBD-SQLite, perl-DBIx-Simple, perl, ntp
</code></pre></li><li><p>Verify that you have the <code>gcloud command-line tool</code>.
For more information see, <a href=https://cloud.google.com/compute/docs/gcloud-compute>https://cloud.google.com/compute/docs/gcloud-compute</a>.</p></li></ul><h3 id=procedure>Procedure</h3><ol><li><p>Use the following commands to create an instance of Photon OS from the Photon GCE image without using cloud-init. In the commands, you must replace <code>&lt;bucket-name></code> with the name of your bucket and the path to the Photon GCE tar file.</p><pre><code class=language-console data-lang=console>$ gcloud compute instances list
$ gcloud compute images list
$ gcloud config list
$ gsutil mb gs://&lt;bucket-name&gt;
$ gsutil cp &lt;path-to-photon-gce-image.tar.gz&gt; gs://&lt;bucket-name&gt;/photon-gce.tar.gz
$ gcloud compute images create photon-gce-image --source-uri gs://&lt;bucket-name&gt;/photon-gce.tar.gz 
$ gcloud compute instances create photon-gce-vm --machine-type &quot;n1-standard-1&quot; --image photon-gce-image
$ gcloud compute instances describe photon-gce-vm
</code></pre></li><li><p>To create a new instance of a Photon OS machine and configure it with a cloud-init user data file, replace the <code>gcloud compute instances create</code> command in the example above with the following command. Before running this command, you must upload your user-data file to Google&rsquo;s cloud infrastructure and replace <code>&lt;path-to-userdata-file></code> with its path and file name.</p><pre><code class=language-console data-lang=console>gcloud compute instances create photon-gce-vm --machine-type &quot;n1-standard-1&quot; --image photon-gce-vm --metadata-from-file=user-data=&lt;path-to-userdata-file&gt;
</code></pre><p>You can also add a cloud-init user-data file to an existing instance of a Photon OS machine on GCE:</p><pre><code class=language-console data-lang=console>gcloud compute instances add-metadata photon-gce-vm --metadata-from-file=user-data=&lt;path-to-userdata-file&gt;
</code></pre></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-16ff02d147dd57523646b981a1952802>5.11 - Security Policy</h1><p>This section describes the security policy of Photon OS.</p></div><div class=td-content><h1 id=pg-21b4f8060fb157189e39cf89b75a12de>5.11.1 - Default Firewall Settings</h1><p>The design of Photon OS emphasizes security. On the minimal and full versions of Photon OS, the default security policy turns on the firewall and drops packets from external interfaces and applications. As a result, you might need to add rules to iptables to permit forwarding, allow protocols like HTTP, and open ports. You must configure the firewall for your applications and requirements.</p><p>The default iptables on the full version have the following settings:</p><pre><code class=language-console data-lang=console>iptables --list
Chain INPUT (policy DROP)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:ssh

Chain FORWARD (policy DROP)
target     prot opt source               destination

Chain OUTPUT (policy DROP)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
</code></pre><p>For more information on how to change the settings, see the man page for iptables.</p><p>Although the default iptables policy accepts SSH connections, the <code>sshd</code> configuration file on the full version of Photon OS is set to reject SSH connections. See <a href=../../docs/troubleshooting-guide/solutions-to-common-problems/permitting-root-login-with-ssh/>Permitting Root Login with SSH</a>.</p><p>If you are unable to ping a Photon OS machine, check the firewall rules. To verify if the rules allow connectivity for the port and protocol, change the <code>iptables</code> commands by using <code>lsof</code> commands to see the processes listening on ports:</p><pre><code class=language-console data-lang=console>    lsof -i -P -n
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-c3f7621bce00345c0b7fcade70c90aa4>5.11.2 - Default Permissions and umask</h1><p>The <code>umask</code> on Photon OS is set to <code>0027</code>.</p><p>When you create a new file with the <code>touch</code> command as root, the default on Photon OS is to set the permissions to <code>0640</code>&ndash;which translates to <code>read-write</code> for user, <code>read</code> for group, and no access for others. Here&rsquo;s an example:</p><pre><code>touch newfile.md
stat newfile.md
  File: 'newfile.md'
  Size: 0               Blocks: 0          IO Block: 4096   regular empty file
Device: 801h/2049d      Inode: 316454      Links: 1
Access: (0640/-rw-r-----)  Uid: (    0/    root)   Gid: (    0/    root)
</code></pre><p>When you create a directory as root, Photon OS sets the permissions to <code>0750</code>:</p><pre><code>mkdir newdir
stat newdir
  File: 'newdir'
  Size: 4096            Blocks: 8          IO Block: 4096   directory
Device: 801h/2049d      Inode: 316455      Links: 2
Access: (0750/drwxr-x---)  Uid: (    0/    root)   Gid: (    0/    root)
</code></pre><p>Because the <code>mkdir</code> command uses the umask to modify the permissions placed on newly created files or directories, you can see <code>umask</code> at work in the permissions of the new directory. Its default permissions are set at <code>0750</code> after the umask subtracts <code>0027</code> from the full set of open permissions, <code>0777</code>.</p><p>Similarly, a new file begins as <code>0666</code> if you were to set umask to <code>0000</code>. But because umask is set by default to <code>0027</code>, a new file&rsquo;s permissions are set to <code>0640</code>.</p><p>So be aware of the default permissions on the directories and files that you create. Some system services and applications might require permissions other than the default. The <code>systemd</code> network service, for example, requires user-defined configuration files to be set to <code>644</code>, not the default of <code>640</code>. Thus, after you create a network configuration file with a <code>.network</code> extension, you must run the <code>chmod</code> command to set the new file&rsquo;s mode bits to <code>644</code>. For example:</p><pre><code>chmod 644 10-static-en.network 
</code></pre><p>For more information on permissions, see the man pages for <code>stat</code>, <code>umask</code>, and <code>acl</code>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e1086d06bb0107dfdf9b62e051f61061>5.11.3 - Disabling TLS 1.0 to Improve Transport Layer Security</h1><p>Photon OS includes GnuTLS to help secure the transport layer. <a href=http://www.gnutls.org/>GnuTLS</a> is a library that implements the SSL and TLS protocols to secure communications.</p><p>On Photon OS, SSL 3.0, which contains a known vulnerability, is disabled by default.</p><p>However, TLS 1.0, which also contains known vulnerabilities, is enabled by default.</p><p>To turn off TLS 1.0, perform the following steps:</p><ol><li>Create a directory named <code>/etc/gnutls</code>.</li><li>In <code>/etc/gnutls</code> create a file named <code>default-priorities</code>.</li><li>In the <code>default-priorities</code> file, specify GnuTLS priority strings that remove TLS 1.0 and SSL 3.0 but retain TLS 1.1 and TLS 1.2.</li><li>After adding a new <code>default-priorities</code> file or after modifying it, you must restart all applications, including SSH, with an open TLS session for the changes to take effect.</li></ol><p>The following is an example of a <code>default-priorities</code> file that contains GnuTLS priorities to disable TLS 1.0 and SSL 3.0:<br><code>console cat /etc/gnutls/default-priorities SYSTEM=NONE:!VERS-SSL3.0:!VERS-TLS1.0:+VERS-TLS1.1:+VERS-TLS1.2:+AES-128-CBC:+RSA:+SHA1:+COMP-NULL</code></p><p>In this example, the priority string imposes system-specific policies. The <code>NONE</code> keyword means that no algorithms, protocols, or compression methods are enabled, so that you can enable specific versions individually later in the string. The priority string then specifies that SSL version 3.0 and TLS version 1.0 be removed, as marked by the exclamation point. The priority string then enables, as marked by the plus sign, versions 1.1 and 1.2 of TLS. The cypher is AES-128-CBC. The key exchange is RSA. The MAC is SHA1. And the compression algorithm is COMP-NULL.</p><p>On Photon OS, you can verify the system-specific policies in the <code>default-priorities</code> file as follows:</p><ol><li>Concatenate the <code>default-priorities</code> file to check its contents:</li></ol><pre><code class=language-console data-lang=console>root@photon-rc [ ~ ]# cat /etc/gnutls/default-priorities
SYSTEM=NONE:!VERS-SSL3.0:!VERS-TLS1.0:+VERS-TLS1.1:+VERS-TLS1.2:+AES-128-CBC:+RSA:+SHA1:+COMP-NULL
</code></pre><ol><li>Run the following command to check the protocols that are enabled for the system:</li></ol><pre><code class=language-console data-lang=console>root@photon-rc [ /etc/gnutls ]# gnutls-cli --priority @SYSTEM -l
Cipher suites for @SYSTEM
TLS_RSA_AES_128_CBC_SHA1                                0x00, 0x2f      SSL3.0

Certificate types: none
Protocols: VERS-TLS1.1, VERS-TLS1.2
Compression: COMP-NULL
Elliptic curves: none
PK-signatures: none
</code></pre><p>For information about the GnuTLS priority strings, see <a href=https://gnutls.org/manual/html_node/Priority-Strings.html>https://gnutls.org/manual/html_node/Priority-Strings.html</a>.</p><p>For information about the vulnerability in SSL 3.0, see <a href=https://www.us-cert.gov/ncas/alerts/TA14-290A>SSL 3.0 Protocol Vulnerability and POODLE Attack</a>.</p><p>For information about the vulnerabilities in TLS 1.0, see <a href=http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-52r1.pdf>Guidelines for the Selection, Configuration, and Use of Transport Layer Security (TLS) Implementations</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-13106be5fcb8287185875884ee4a7512>5.12 - Support for zstd Compression</h1><p>Zstandard (zstd) is a fast compression algorithm that provides high compression ratios. Photon OS offers support for the zstd compression and allows you to define which compression algorithm you want.</p><p>By using the zstd compression, the following benefits are seen:</p><ul><li><p>Faster installation of RPMs and the overall system</p></li><li><p>Faster builds</p></li><li><p>Reduction in the size of artifacts created</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-899c827da6c0f512d273c2430de59fa2>5.13 - Photon RPM OSTree: a simple guide</h1></div><div class=td-content><h1 id=pg-8f7f63a7d25766bd5b0ef616451b55bb>5.13.1 - Introduction</h1><h2 id=rpm-ostree-overview>RPM-OSTree Overview</h2><p>OSTree is a tool to manage bootable, immutable, versioned filesystem trees. Unlike traditional package managers like rpm or dpkg that know how to install, uninstall, configure packages, OSTree has no knowledge of the relationship between files. But when you add rpm capabilities on top of OSTree, it becomes RPM-OSTree, meaning a filetree replication system that is also package-aware.</p><p>The idea behind it is to use a client/server architecture to keep your Linux installed machines (physical or VM) in sync with the latest bits, in a predictable and reliable manner. To achieve that, OSTree uses a git-like repository that records the changes to any file and replicate them to any subscriber.</p><p>A system administrator or an image builder developer takes a base Linux image, prepares the packages and other configuration on a server box, executes a command to compose a filetree that the host machines will download and then incrementally upgrade whenever a new change has been committed.
You may read more about OSTree <a href=https://ostree.readthedocs.org/en/latest/>here</a>.</p><h2 id=why-use-rpm-ostree-in-photon>Why use RPM-OSTree in Photon?</h2><p>There are several important benefits:</p><ul><li>Reliable, efficient: The filetree replication is simple, reliable and efficient. It will only transfer deltas over the network. If you have deployed two almost identical bootable images on same box (differing just by several files), it will not take twice the space. The new tree will have a set of hardlinks to the old tree and only the different files will have a separate copy stored to disk.</li><li>Atomic: the filetree replication is atomic. At the end of a deployment, you are either booting from one deployment, or the other. There is no &ldquo;partial deployed bootable image&rdquo;. If anything bad happens during replication or deployment- power loss, network failure, your machine boots from the old image. There is even a tool option to cleanup old deployed (successfully or not) image.</li><li>Manageable: You are provided simple tools to figure out exactly what packages have been installed, to compare files, configuration and package changes between versions.</li><li>Predictable, repeatable: A big headache for a system administrator is to maintain a farm of computers with different packages, files and configuration installed in different order, that will result in exponential set of test cases. With RPM-OStree, you get identical, predictable installed systems.</li></ul><p>As drawbacks, I would mention:</p><ul><li>Some applications configured by user on host may have compatibility issues if they save configuration or download into read only directories like /usr.</li><li>People not used with &ldquo;read only&rdquo; file systems will be disappointed that they could no longer use RPM, yum, tdnf to install whatever they want. Think of this as an &ldquo;enterprise policy&rdquo;. They may circumvent this by customizing the target directory to a writable directory like /var or using rpm to install packages and record them using a new RPM repository in a writable place.</li><li>Administrators need to be aware about the directories re-mapping specific to OSTree and plan accordingly.</li></ul><h2 id=photon-with-rpm-ostree-installation-profiles>Photon with RPM-OSTree installation profiles</h2><p>Photon takes advantage of RPM-OSTree and offers several installation choices:</p><ul><li>Photon RPM-OSTree server - used to compose customized Photon OS installations and to prepare updates. I will call it for short &lsquo;server&rsquo;.</li><li>Photon RPM-OSTree host connected to a default online server repository via http or https, maintained by VMware Photon OS team, where future updates will be published. This will create a minimal installation profile, but with the option to self-upgrade. I will call it for short &lsquo;default host&rsquo;.</li><li>Photon RPM-OSTree host connected to a custom server repository. It requires a Photon RPM-OSTree Server installed in advance. I will call it for short &lsquo;custom host&rsquo;.</li></ul><h2 id=terminology>Terminology</h2><p>In this section, the term <em>OSTree</em> refers to the general use of this technology, the format of the repository or replication protocol.</p><p>The term <em>RPM-OSTree</em> emphasizes the layer that adds RedHat Package Manager compatibility on both ends - at server and at host. However, since Photon OS is an RPM-based Linux, there are places in the documentation and even in the installer menus where <em>OSTree</em> may be used instead of <em>RPM-OSTree</em> when the distinction is not obvious or does not matter in that context.</p><p>When <code>ostree</code> and <code>rpm-ostree</code> are encountered, they refer to the usage of the specific Unix commands.</p><p>Finally, <em>Photon RPM-OSTree</em> is the application or implementation of the RPM-OStree system into Photon OS, materialized into two options: Photon Server and Photon Host (or client). <em>Server</em> or <em>Host</em> may be used with or without the <em>Photon</em> and/or <em>RPM-OStree</em> qualifier, but it means the same thing.</p><h2 id=sample-code>Sample code</h2><p>Codes samples used throughout the book are small commands that can be typed at shell command prompt and do not require downloading additional files. As an alternative, one can remote connect via ssh, so cut & paste sample code from outside sources or copy files via scp will work. See the Photon Administration guide to learn <a href=../../docs/troubleshooting-guide/solutions-to-common-problems/permitting-root-login-with-ssh/>how to enable ssh</a>.
The samples assume that the following VMs have been installed - see the steps in the next chapters:</p><ul><li>A default host VM named <strong>photon-host-def</strong>.</li><li>Two server VMs named <strong>photon-srv1</strong> and <strong>photon-srv2</strong>.</li><li>Two custom host VMs named <strong>photon-host-cus1</strong> and <strong>photon-host-cus2</strong>, connected each to the corresponding server during install.</li></ul><h2 id=how-to-read-this-document>How to read this document</h2><p>The RPM OSTree guide is structured to be used both as a sequential read and as a reference documentation.<br>If you are just interested in deploying a host system and keeping it up to date, then read <a href=../../docs/administration-guide/photon-rpm-ostree/installing-a-host-against-default-server-repository/>Installing a Photon RPM-OSTree host against default server repository</a> and <a href=../../docs/administration-guide/photon-rpm-ostree/host-updating-operations/>Host updating operations</a>.</p><p>If you want to install your own server and experiment with customizing packages for your Photon hosts, then read <a href=../../docs/administration-guide/photon-rpm-ostree/creating-a-rpm-ostree-server/>Installing a Photon RPM-OSTree server</a> onwards. There are references to the concepts discussed throughout the book, if you need to understand them better.</p><h2 id=rpm-ostree-in-photon-os-40>RPM OSTree in Photon OS 4.0</h2><p>This section is relevant to RPM OSTree in Photon OS 4.0.</p><p>Version 4.0 supports the following features:</p><ul><li>Upgrade</li><li>Rollback</li><li>Remote, compose, and rebase server</li><li>Installation and uninstallation of packages with URL</li><li>Installation and uninstallation of packages from default repos</li><li>Automatic updates</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-ec749f9f7439e85434ec839477fa69dd>5.13.2 - Installing a host against default server repository</h1><p>RPM-OSTree Host default server repo installation option in Photon OS will setup a profile similar to Photon Minimal, with the added benefit of being able to self-upgrade.</p><h2 id=who-is-this-for>Who is this for?</h2><p>The RPM-OSTree &lsquo;default host&rsquo; is the easiest way to deploy a Photon RPM-OSTree host from ISO/cdrom, without the need to deploy and maintain an RPM-OSTree server. It is targeted at the user who relies on VMware Photon OS team to keep his or her system up-to-date, configured to get its updates from the official Photon OSTree repository.</p><p>This is also the fastest way to install a host, as we&rsquo;ve included in the ISO/cdrom an identical copy of the Photon &ldquo;starter&rdquo; RPM-OSTree repository that is published online by VMware Photon OS team. So rather than pulling from the online repository, the installer pulls the repo from cdrom, which saves bandwidth and also reduces to zero the chances of failing due to a networking problem. After successful installation, any updates are going to be pulled from the official online repository, when Photon OS team will make them available.</p><p><strong>Note</strong>: It is also possible to install an RPM-OSTree host against the official online repo via PXE boot, without the benefit of fast, local pull from cdrom. This will be covered in the PXE boot/kickstart chapter, as it requires additional configuration.</p><h2 id=installing-the-iso>Installing the ISO</h2><p>User will first download <a href=https://github.com/vmware/photon/wiki/Downloading-Photon-OS>Photon OS ISO file</a> that contains the installer, which is able to deploy any of the supported Photon installation profiles.</p><p>There are some steps common to all Photon installation profiles, starting with adding a VM in VMware Fusion, Workstation or ESXi, selecting the OS family, then customizing for disk size, CPU, memory size, network interface etc. (or leaving the defaults) and selecting the ISO image as cdrom. The installer will launch, that will go through disk partitioning and accepting the license agreement screens, followed by selecting an installation profile.
These steps are described at the page linked below, so I won&rsquo;t repeat them, just that instead of setting up a Photon Minimal profile, we will install a Photon OSTree host:</p><p><a href=../../docs/installation-guide/run-photon-on-fusion/>Running Project Photon on Fusion</a>.</p><p>Select the <strong>Photon OSTree Host</strong> option.</p><p><img src=../../docs/images/rpmostree-install-options.png alt=PhotonChooseHost></p><p>Continue with setting up a host name like <strong>photon1-def</strong> and a root password, re-confirm.
Then, select &ldquo;Default OSTree Server&rdquo; and continue.</p><p><img src=../../docs/images/rpmostree-default.png alt=PhotonChooseHostDefault></p><p><img src=../../docs/images/photon-os-finish.png alt=PhotonHostDefaultFinish></p><p>When installation is over, the VM will reboot and will show in grub VMWare Photon/Linux 4.0_minimal (ostree), which will reassure that it&rsquo;s booting from an OSTree image!</p><p><img src=../../docs/images/rpmostree-grub.png alt=PhotonHostFirstRebootGrub></p><p>Boot, login and you are ready to use it.</p><p>To upgrade your host, see <a href=../../docs/administration-guide/photon-rpm-ostree/host-updating-operations/>Host updating operations</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-63adc650f4a841f3597922787528f17c>5.13.3 - Concepts in Action</h1><p>Now that we have a fresh installed host (either as <a href=../../docs/administration-guide/photon-rpm-ostree/Installing-a-host-against-default-server-repository>default</a> or <a href=../../docs/administration-guide/photon-rpm-ostree/Photon-RPM-OSTree:-7-Installing-a-host-against-a-custom-server-repository>custom</a>, we can better explain the OStree concepts and see them in action.</p><h2 id=querying-the-deployed-filetrees>Querying the deployed filetrees</h2><p>The first thing to do is to run a command that tells us what is installed on the machine and when. Since it&rsquo;s a fresh install from the CD, there is only one bootable filetree image deployed.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# rpm-ostree status 
State: idle
Deployments:
● ostree://photon:photon/4.0/x86_64/minimal
    Version: 4.0_minimal (2021-02-20T07:15:43Z)
Commit: 965c1abeb048e1a8ff77e9cd34ffccc5e3356176cda3332b4ff0e7a6c66b661f
</code></pre><h2 id=bootable-filetree-version>Bootable filetree version</h2><p><strong>4.0_minimal</strong> is not the Linux Photon OS release version, nor daily build, but rather a human readable, self-incrementing version associated with every commit that brings file/package updates. Think of this as version 0. The following versions are going to be 4.0_minimal.1, 4.0_minimal.2, 4.0_minimal.3 and so on.</p><h2 id=commit-id>Commit ID</h2><p>The ID listed is actually the first 5 bytes (10 hex digits) of the commit hash. If you want to see the verbose mode, use the <code>-v</code> option.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# rpm-ostree status -v
State: idle
AutomaticUpdates: disabled
Deployments:
● ostree://photon:photon/4.0/x86_64/minimal
    Version: 4.0_minimal (2021-02-20T07:15:43Z)
Commit: 965c1abeb048e1a8ff77e9cd34ffccc5e3356176cda3332b4ff0e7a6c66b661f
└─ photon (2021-02-20T07:11:24Z)
Staged: no
    StateRoot: photon
</code></pre><h3 id=rpm-ostree-options>RPM OStree Options</h3><p>To see the list of options available with the rpm-ostree command, use the -h option.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# rpm-ostree -h
Usage:
    rpm-ostree [OPTION…] COMMAND

Builtin Commands:
    compose  Commands to compose a tree
    cleanup  Clear cached/pending data
    db   Commands to query the RPM database
    deploy   Deploy a specific commit
    rebase   Switch to a different tree
    rollback Revert to the previously booted tree
    status   Get the version of the booted system
    upgrade  Perform a system upgrade
    reload   Reload configuration
    usroverlay   Apply a transient overlayfs to /usr
    cancel   Cancel an active transaction
    initramfsEnable or disable local initramfs regeneration
    install  Overlay additional packages
    uninstallRemove overlayed additional packages
    override Manage base package overrides
    resetRemove all mutations
    refresh-md   Generate rpm repo metadata
    kargsQuery or modify kernel arguments

Help Options:
    -h, --help   Show help options

Application Options:
    --versionPrint version information and exit
</code></pre><h2 id=osname>OSname</h2><p>The OS Name identifies the operating system installed. All bootable filetrees for the same OS will share the /var directory, in other words applications installed in one booted image into this directory will be available in all other images.<br>If a new set of images are created for a different OS, they will receive a fresh copy of /var that is not shared with the previous OS images for the initial OS. In other words, if a machine is dual boot for different operating systems, they will not share each other&rsquo;s /var content, however they will still merge 3-way /etc.</p><h2 id=refspec>Refspec</h2><p>The <strong>Refspec</strong> is a branch inside the repo, expressed in a hierarchical way. In this case, it&rsquo;s the default branch that will receive package updates for the Photon OS 1.0 Minimal installation profile on Intel platforms. There could be other branches in the future, for example photon/3.0/x86_64/full that will match the Full installation profile (full set of packages installed).<br>Think of Refspec as the head of the minimal branch (just like in git) at the origin repo. On the replicated, local repo at the host, <strong>minimal</strong> is a file that contains the latest commit ID known for that branch.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# cat /ostree/repo/refs/remotes/photon/photon/4.0/x86_64/minimal
820b584a6f90bf6b9b8cb6aad8c093064b88d0ab686be8130baa03d68917ad88
</code></pre><p>Why are there two &lsquo;photon&rsquo; directory levels in the remotes path? The <strong>photon:</strong> prefix in the Refspec listed by <code>rpm-ostree status</code> corresponds to the first <strong>photon</strong> directory in the remotes path and is actually the name given to the remote that the host is connected to, which points to an http or https URL. We&rsquo;ll talk about remotes later, but for now think of it as a namespace qualifier. The second <strong>photon</strong> is part of the Refspec path itself.</p><h2 id=deployments>Deployments</h2><p>We&rsquo;ve used so far <code>rpm-ostree</code>. The same information can be obtained running an <code>ostree</code> command:</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree admin status
* photon 965c1abeb048e1a8ff77e9cd34ffccc5e3356176cda3332b4ff0e7a6c66b661f.0
Version: 4.0_minimal
origin refspec: photon:photon/4.0/x86_64/minimal
</code></pre><p>But where is this information stored? As you may have guessed, the local repo stores the heads of the deployed trees - the most recent commitment ID, just like Git does:</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# cat /ostree/repo/refs/heads/ostree/0/1/0 
965c1abeb048e1a8ff77e9cd34ffccc5e3356176cda3332b4ff0e7a6c66b661f
</code></pre><p>This also where this command that lists the references (local heads and remotes) takes its data from:</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree refs
photon:photon/4.0/x86_64/minimal
ostree/0/1/0
</code></pre><p>Based on that, it could find the root of the deployment that it boots from. The actual filetree is deployed right here:</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ls -l /ostree/deploy/photon/deploy/965c1abeb048e1a8ff77e9cd34ffccc5e3356176cda3332b4ff0e7a6c66b661f.0
total 36
lrwxrwxrwx  2 root root7 Feb 23 05:43 bin -&gt; usr/bin
drwxr-xr-x  2 root root 4096 Jan  1  1970 boot
drwxr-xr-x  2 root root 4096 Jan  1  1970 dev
drwxr-xr-x 45 root root 4096 Feb 23 06:08 etc
lrwxrwxrwx  2 root root8 Feb 23 05:43 home -&gt; var/home
lrwxrwxrwx  3 root root7 Feb 23 05:43 lib -&gt; usr/lib
lrwxrwxrwx  3 root root7 Feb 23 05:43 lib64 -&gt; usr/lib
lrwxrwxrwx  2 root root9 Feb 23 05:43 media -&gt; run/media
lrwxrwxrwx  2 root root7 Feb 23 05:43 mnt -&gt; var/mnt
lrwxrwxrwx  2 root root7 Feb 23 05:43 opt -&gt; var/opt
lrwxrwxrwx  2 root root   14 Feb 23 05:43 ostree -&gt; sysroot/ostree
drwxr-xr-x  2 root root 4096 Jan  1  1970 proc
lrwxrwxrwx  2 root root   12 Feb 23 05:43 root -&gt; var/roothome
drwxr-xr-x  2 root root 4096 Jan  1  1970 run
lrwxrwxrwx  2 root root8 Feb 23 05:43 sbin -&gt; usr/sbin
lrwxrwxrwx  2 root root7 Feb 23 05:43 srv -&gt; var/srv
drwxr-xr-x  2 root root 4096 Jan  1  1970 sys
drwxr-xr-x  4 root root 4096 Feb 23 05:44 sysroot
lrwxrwxrwx  2 root root   11 Feb 23 05:43 tmp -&gt; sysroot/tmp
drwxr-xr-x 10 root root 4096 Jan  1  1970 usr
drwxr-xr-x  8 root root 4096 Feb 23 05:44 var
</code></pre><p>So how is a deployment linked to a specific branch, originating from a remote repo? Well, there is a file next to the deployed filetree root directory with the same name and <strong>.origin</strong> suffix, that contains exactly this info:</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# cat /ostree/deploy/photon/deploy/965c1abeb048e1a8ff77e9cd34ffccc5e3356176cda3332b4ff0e7a6c66b661f.0.origin 
[origin]
refspec=photon:photon/4.0/x86_64/minimal
</code></pre><p>Fast forwarding a bit, if there is a new deployment due to an upgrade or rebase, a new filetree will be added at the same level, and a new .origin file will tie it to the remote branch it originated from.</p><p>The <strong>photon</strong> directory in the path is the actual OSname. Multiple deployments of same OS will share a writable /var folder.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ls -l /ostree/deploy/photon/var/
total 52
drwxr-xr-x   5 root root 4096 Feb 23 05:44 cache
drwxr-xr-x   2 root root 4096 Feb 23 05:44 home
drwxr-xr-x. 17 root root 4096 Feb 23 05:44 lib
drwxr-xr-x   2 root root 4096 Feb 23 05:44 local
lrwxrwxrwx.  1 root root   11 Feb 23 05:44 lock -&gt; ../run/lock
drwxr-xr-x.  4 root root 4096 Feb 23 05:44 log
drwxr-xr-x   2 root root 4096 Feb 23 05:44 mail
drwxr-xr-x   2 root root 4096 Feb 23 05:44 mnt
drwxr-xr-x   4 root root 4096 Feb 23 05:44 opt
drwx------   4 root root 4096 Feb 23 06:09 roothome
lrwxrwxrwx.  1 root root6 Feb 23 05:44 run -&gt; ../run
drwxr-xr-x   3 root root 4096 Feb 23 05:44 spool
drwxr-xr-x   2 root root 4096 Feb 23 05:44 srv
drwxrwxrwt.  5 root root 4096 Feb 23 06:08 tmp
drwxr-xr-x  11 root root 4096 Feb 23 05:44 usrlocal
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-b62b64295450ca65a5186142fd9f1603>5.13.4 - Querying For Commit File and Package Metadata</h1><p>There are several ostree and rpm-ostree commands that list file or package data based on either the Commit ID, or Refspec. If Refspec is passed as a parameter, it&rsquo;s the same as passing the most recent commit ID (head) for that branch.</p><h2 id=commit-history>Commit history</h2><p>For a host that is freshly installed, there is only one commit in the history for the only branch.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree log photon/4.0/x86_64/minimal
commit 820b584a6f90bf6b9b8cb6aad8c093064b88d0ab686be8130baa03d68917ad88
ContentChecksum:  c7956cedc5c1b8c07a06e10789c17364a5b7a4b970daab64f3398b7c42bd97d9
Date:  2020-11-04 02:21:47 +0000
Version: 4.0_minimal
(no subject)
</code></pre><p>This commit has no parent; if there was an older commit, it would have been listed too. We can get the same listing (either nicely formatted or raw variant data) by passing the Commit ID. Just the first several hex digits will suffice to identify the commit ID. We can either request to be displayed in a pretty format, or raw - the actual C struct.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree log 820b
commit 820b584a6f90bf6b9b8cb6aad8c093064b88d0ab686be8130baa03d68917ad88
ContentChecksum:  c7956cedc5c1b8c07a06e10789c17364a5b7a4b970daab64f3398b7c42bd97d9
Date:  2020-11-04 02:21:47 +0000
Version: 4.0_minimal
(no subject)
</code></pre><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree log 820b --raw
commit 820b584a6f90bf6b9b8cb6aad8c093064b88d0ab686be8130baa03d68917ad88
({'rpmostree.inputhash': &lt;'1ce3f6d518ec2cbaebc2de2ccb01888e59fc7efb482caba590bc96a604e54f82'&gt;, 'rpmostree.rpmmd-repos': &lt;[{'id': &lt;'photon'&gt;, 'timestamp': &lt;uint64 1604456423&gt;}]&gt;, 'version': &lt;'4.0_minimal'&gt;, 'rpmostree.rpmdb.pkglist': &lt;[('Linux-PAM', '0', '1.4.0', '2.ph4', 'x86_64'), ('attr', '0', '2.4.48', '1.ph4', 'x86_64'), ('audit', '0', '2.8.5', '3.ph4', 'x86_64'), ('autogen-libopts', '0', '5.18.16', '3.ph4', 'x86_64'), ('bash', '0', '5.0', '1.ph4', 'x86_64'), ('bc', '0', '1.07.1', '4.ph4', 'x86_64'), ('bridge-utils', '0', '1.6', '1.ph4', 'x86_64'), ('bubblewrap', '0', '0.4.1', '1.ph4', 'x86_64'), ('bzip2', '0', '1.0.8', '3.ph4', 'x86_64'), ('bzip2-libs', '0', '1.0.8', '3.ph4', 'x86_64'), ('ca-certificates', '0', '20201001', '1.ph4', 'x86_64'), ('ca-certificates-pki', '0', '20201001', '1.ph4', 'x86_64'), ('cloud-init', '0', '20.3', '2.ph4', 'noarch'), ('coreutils-selinux', '0', '8.32', '2.ph4', 'x86_64'), ('cpio', '0', '2.13', '1.ph4', 'x86_64'), ('cracklib', '0', '2.9.7', '1.ph4', 'x86_64'), ('cracklib-dicts', '0', '2.9.7', '1.ph4', 'x86_64'), ('curl', '0', '7.72.0', '2.ph4', 'x86_64'), ('curl-libs', '0', '7.72.0', '2.ph4', 'x86_64'), ('cyrus-sasl', '0', '2.1.27', '3.ph4', 'x86_64'), ('dbus', '0', '1.13.18', '1.ph4', 'x86_64'), ('device-mapper', '0', '2.03.10', '2.ph4', 'x86_64'), ('device-mapper-libs', '0', '2.03.10', '2.ph4', 'x86_64'), ('dhcp-client', '0', '4.4.2', '1.ph4', 'x86_64'), ('dhcp-libs', '0', '4.4.2', '1.ph4', 'x86_64'), ('dracut', '0', '050', '5.ph4', 'x86_64'), ('dracut-tools', '0', '050', '5.ph4', 'x86_64'), ('e2fsprogs', '0', '1.45.6', '2.ph4', 'x86_64'), ('e2fsprogs-libs', '0', '1.45.6', '2.ph4', 'x86_64'), ('elfutils', '0', '0.181', '2.ph4', 'x86_64'), ('elfutils-libelf', '0', '0.181', '2.ph4', 'x86_64'), ('expat', '0', '2.2.9', '2.ph4', 'x86_64'), ('expat-libs', '0', '2.2.9', '2.ph4', 'x86_64'), ('file', '0', '5.39', '1.ph4', 'x86_64'), ('file-libs', '0', '5.39', '1.ph4', 'x86_64'), ('filesystem', '0', '1.1', '4.ph4', 'x86_64'), ('findutils', '0', '4.7.0', '1.ph4', 'x86_64'), ('finger', '0', '0.17', '3.ph4', 'x86_64'), ('flex', '0', '2.6.4', '3.ph4', 'x86_64'), ('fuse', '0', '2.9.9', '1.ph4', 'x86_64'), ('gawk', '0', '5.1.0', '1.ph4', 'x86_64'), ('gc', '0', '8.0.4', '1.ph4', 'x86_64'), ('gdbm', '0', '1.18.1', '1.ph4', 'x86_64'), ('glib', '0', '2.66.1', '1.ph4', 'x86_64'), ('glib-networking', '0', '2.66.0', '1.ph4', 'x86_64'), ('glibc', '0', '2.32', '1.ph4', 'x86_64'), ('glibc-iconv', '0', '2.32', '1.ph4', 'x86_64'), ('gmp', '0', '6.2.0', '1.ph4', 'x86_64'), ('gnupg', '0', '2.2.23', '1.ph4', 'x86_64'), ('gnutls', '0', '3.6.15', '3.ph4', 'x86_64'), ('gobject-introspection', '0', '1.66.0', '1.ph4', 'x86_64'), ('gpgme', '0', '1.14.0', '1.ph4', 'x86_64'), ('grep', '0', '3.4', '1.ph4', 'x86_64'), ('grub2', '0', '2.04', '2.ph4', 'x86_64'), ('grub2-efi', '0', '2.04', '2.ph4', 'x86_64'), ('grub2-efi-image', '0', '2.04', '2.ph4', 'x86_64'), ('grub2-pc', '0', '2.04', '2.ph4', 'x86_64'), ('grub2-theme', '0', '4.0', '1.ph4', 'noarch'), ('grub2-theme-ostree', '0', '4.0', '1.ph4', 'noarch'), ('guile', '0', '2.0.13', '3.ph4', 'x86_64'), ('gzip', '0', '1.10', '1.ph4', 'x86_64'), ('iana-etc', '0', '2.30', '2.ph4', 'noarch'), ('icu', '0', '67.1', '1.ph4', 'x86_64'), ('iproute2', '0', '5.8.0', '1.ph4', 'x86_64'), ('iptables', '0', '1.8.4', '1.ph4', 'x86_64'), ('iputils', '0', '20200821', '1.ph4', 'x86_64'), ('json-c', '0', '0.15', '2.ph4', 'x86_64'), ('json-glib', '0', '1.6.0', '1.ph4', 'x86_64'), ('kmod', '0', '27', '1.ph4', 'x86_64'), ('krb5', '0', '1.17', '4.ph4', 'x86_64'), ('libacl', '0', '2.2.53', '1.ph4', 'x86_64'), ('libarchive', '0', '3.4.3', '3.ph4', 'x86_64'), ('libassuan', '0', '2.5.3', '1.ph4', 'x86_64'), ('libcap', '0', '2.43', '1.ph4', 'x86_64'), ('libcap-ng', '0', '0.8', '1.ph4', 'x86_64'), ('libdb', '0', '5.3.28', '2.ph4', 'x86_64'), ('libdnet', '0', '1.11', '7.ph4', 'x86_64'), ('libffi', '0', '3.3', '1.ph4', 'x86_64'), ('libgcc', '0', '8.4.0', '1.ph4', 'x86_64'), ('libgcrypt', '0', '1.8.6', '2.ph4', 'x86_64'), ('libgpg-error', '0', '1.39', '1.ph4', 'x86_64'), ('libgpg-error-devel', '0', '1.39', '1.ph4', 'x86_64'), ('libksba', '0', '1.4.0', '1.ph4', 'x86_64'), ('libltdl', '0', '2.4.6', '3.ph4', 'x86_64'), ('libmetalink', '0', '0.1.3', '2.ph4', 'x86_64'), ('libmicrohttpd', '0', '0.9.71', '2.ph4', 'x86_64'), ('libmodulemd', '0', '2.9.4', '1.ph4', 'x86_64'), ('libmspack', '0', '0.10.1alpha', '1.ph4', 'x86_64'), ('libnsl', '0', '1.3.0', '1.ph4', 'x86_64'), ('libpsl', '0', '0.21.1', '1.ph4', 'x86_64'), ('libpwquality', '0', '1.4.2', '1.ph4', 'x86_64'), ('librepo', '0', '1.12.1', '3.ph4', 'x86_64'), ('libseccomp', '0', '2.5.0', '2.ph4', 'x86_64'), ('libselinux', '0', '3.1', '1.ph4', 'x86_64'), ('libsemanage', '0', '3.1', '1.ph4', 'x86_64'), ('libsepol', '0', '3.1', '1.ph4', 'x86_64'), ('libsolv', '0', '0.6.35', '5.ph4', 'x86_64'), ('libsoup', '0', '2.72.0', '1.ph4', 'x86_64'), ('libssh2', '0', '1.9.0', '2.ph4', 'x86_64'), ('libstdc++', '0', '8.4.0', '1.ph4', 'x86_64'), ('libtasn1', '0', '4.14', '1.ph4', 'x86_64'), ('libtirpc', '0', '1.2.6', '1.ph4', 'x86_64'), ('libtool', '0', '2.4.6', '3.ph4', 'x86_64'), ('libunistring', '0', '0.9.10', '1.ph4', 'x86_64'), ('libxml2', '0', '2.9.10', '3.ph4', 'x86_64'), ('libxml2-devel', '0', '2.9.10', '3.ph4', 'x86_64'), ('libxslt', '0', '1.1.34', '1.ph4', 'x86_64'), ('libyaml', '0', '0.2.5', '1.ph4', 'x86_64'), ('linux', '0', '5.9.0', '3.ph4', 'x86_64'), ('lua', '0', '5.3.5', '1.ph4', 'x86_64'), ('lz4', '0', '1.9.2', '1.ph4', 'x86_64'), ('m4', '0', '1.4.18', '3.ph4', 'x86_64'), ('motd', '0', '0.1.3', '6.ph4', 'noarch'), ('mozjs', '0', '78.3.1', '1.ph4', 'x86_64'), ('mpfr', '0', '4.1.0', '1.ph4', 'x86_64'), ('ncurses', '0', '6.2', '2.ph4', 'x86_64'), ('ncurses-libs', '0', '6.2', '2.ph4', 'x86_64'), ('ncurses-terminfo', '0', '6.2', '2.ph4', 'x86_64'), ('net-tools', '0', '1.60', '12.ph4', 'x86_64'), ('nettle', '0', '3.6', '1.ph4', 'x86_64'), ('npth', '0', '1.6', '1.ph4', 'x86_64'), ('nspr', '0', '4.29', '1.ph4', 'x86_64'), ('nss', '0', '3.57', '1.ph4', 'x86_64'), ('nss-altfiles', '0', '2.23.0', '1.ph4', 'x86_64'), ('nss-libs', '0', '3.57', '1.ph4', 'x86_64'), ('open-vm-tools', '0', '11.1.5', '4.ph4', 'x86_64'), ('openldap', '0', '2.4.53', '2.ph4', 'x86_64'), ('openssh', '0', '8.4p1', '2.ph4', 'x86_64'), ('openssh-clients', '0', '8.4p1', '2.ph4', 'x86_64'), ('openssh-server', '0', '8.4p1', '2.ph4', 'x86_64'), ('openssl', '0', '1.1.1g', '3.ph4', 'x86_64'), ('ostree', '0', '2020.6', '1.ph4', 'x86_64'), ('ostree-grub2', '0', '2020.6', '1.ph4', 'x86_64'), ('ostree-libs', '0', '2020.6', '1.ph4', 'x86_64'), ('pcre', '0', '8.44', '1.ph4', 'x86_64'), ('pcre-libs', '0', '8.44', '1.ph4', 'x86_64'), ('photon-release', '0', '4.0', '1.ph4', 'noarch'), ('photon-repos', '0', '4.0', '1.ph4', 'noarch'), ('pinentry', '0', '1.1.0', '1.ph4', 'x86_64'), ('pkg-config', '0', '0.29.2', '3.ph4', 'x86_64'), ('policycoreutils', '0', '3.1', '1.ph4', 'x86_64'), ('polkit', '0', '0.118', '1.ph4', 'x86_64'), ('popt', '0', '1.16', '5.ph4', 'x86_64'), ('procps-ng', '0', '3.3.16', '1.ph4', 'x86_64'), ('python3', '0', '3.8.6', '1.ph4', 'x86_64'), ('python3-PyYAML', '0', '5.3.1', '1.ph4', 'x86_64'), ('python3-asn1crypto', '0', '1.4.0', '1.ph4', 'noarch'), ('python3-attrs', '0', '20.2.0', '2.ph4', 'noarch'), ('python3-certifi', '0', '2020.6.20', '1.ph4', 'noarch'), ('python3-cffi', '0', '1.14.3', '2.ph4', 'x86_64'), ('python3-chardet', '0', '3.0.4', '2.ph4', 'noarch'), ('python3-configobj', '0', '5.0.6', '5.ph4', 'noarch'), ('python3-cryptography', '0', '3.1.1', '2.ph4', 'x86_64'), ('python3-gobject-introspection', '0', '1.66.0', '1.ph4', 'x86_64'), ('python3-idna', '0', '2.10', '1.ph4', 'noarch'), ('python3-jinja2', '0', '2.11.2', '1.ph4', 'noarch'), ('python3-jsonpatch', '0', '1.26', '1.ph4', 'noarch'), ('python3-jsonpointer', '0', '2.0', '2.ph4', 'noarch'), ('python3-jsonschema', '0', '3.2.0', '1.ph4', 'noarch'), ('python3-libs', '0', '3.8.6', '1.ph4', 'x86_64'), ('python3-markupsafe', '0', '1.1.1', '1.ph4', 'x86_64'), ('python3-netifaces', '0', '0.10.9', '2.ph4', 'x86_64'), ('python3-oauthlib', '0', '3.1.0', '1.ph4', 'noarch'), ('python3-packaging', '0', '20.4', '2.ph4', 'noarch'), ('python3-prettytable', '0', '0.7.2', '7.ph4', 'noarch'), ('python3-pyOpenSSL', '0', '19.1.0', '2.ph4', 'noarch'), ('python3-pyasn1', '0', '0.4.8', '1.ph4', 'noarch'), ('python3-pycparser', '0', '2.20', '1.ph4', 'noarch'), ('python3-pyparsing', '0', '2.4.7', '1.ph4', 'noarch'), ('python3-pyrsistent', '0', '0.17.3', '1.ph4', 'x86_64'), ('python3-requests', '0', '2.24.0', '1.ph4', 'noarch'), ('python3-setuptools', '0', '3.8.6', '1.ph4', 'noarch'), ('python3-six', '0', '1.15.0', '2.ph4', 'noarch'), ('python3-urllib3', '0', '1.25.10', '2.ph4', 'noarch'), ('python3-xml', '0', '3.8.6', '1.ph4', 'x86_64'), ('readline', '0', '7.0', '3.ph4', 'x86_64'), ('rpcsvc-proto', '0', '1.4.2', '1.ph4', 'x86_64'), ('rpm', '0', '4.14.2', '11.ph4', 'x86_64'), ('rpm-libs', '0', '4.14.2', '11.ph4', 'x86_64'), ('rpm-ostree', '0', '2020.5', '4.ph4', 'x86_64'), ('sed', '0', '4.8', '1.ph4', 'x86_64'), ('selinux-policy', '0', '3.14.7', '1.ph4', 'noarch'), ('shadow', '0', '4.8.1', '2.ph4', 'x86_64'), ('shadow-tools', '0', '4.8.1', '2.ph4', 'x86_64'), ('shim-signed', '0', '15', '1.ph4', 'x86_64'), ('sqlite-libs', '0', '3.33.0', '1.ph4', 'x86_64'), ('sudo', '0', '1.8.30', '2.ph4', 'x86_64'), ('systemd', '0', '245.5', '3.ph4', 'x86_64'), ('tcp_wrappers', '0', '7.6', '7.ph4', 'x86_64'), ('tzdata', '0', '2020a', '1.ph4', 'noarch'), ('util-linux', '0', '2.36', '1.ph4', 'x86_64'), ('util-linux-libs', '0', '2.36', '1.ph4', 'x86_64'), ('vim', '0', '8.2.1361', '1.ph4', 'x86_64'), ('which', '0', '2.21', '6.ph4', 'x86_64'), ('xmlsec1', '0', '1.2.30', '3.ph4', 'x86_64'), ('xz', '0', '5.2.5', '1.ph4', 'x86_64'), ('xz-libs', '0', '5.2.5', '1.ph4', 'x86_64'), ('zchunk', '0', '1.1.7', '1.ph4', 'x86_64'), ('zchunk-libs', '0', '1.1.7', '1.ph4', 'x86_64'), ('zlib', '0', '1.2.11', '2.ph4', 'x86_64'), ('zstd', '0', '1.4.5', '2.ph4', 'x86_64'), ('zstd-libs', '0', '1.4.5', '2.ph4', 'x86_64')]&gt;}, @ay [], @a(say) [], '', '', uint64 1604456507, [byte 0xca, 0x99, 0x35, 0xe5, 0xaa, 0xc6, 0xbd, 0xb3, 0x52, 0xb4, 0x81, 0x62, 0xbb, 0x3f, 0xba, 0x44, 0x0e, 0x3c, 0xa0, 0x00, 0xc8, 0x6f, 0x7c, 0x32, 0xa0, 0xa0, 0x8b, 0xc6, 0xf0, 0xd5, 0x06, 0x0e], [byte 0x44, 0x6a, 0x0e, 0xf1, 0x1b, 0x7c, 0xc1, 0x67, 0xf3, 0xb6, 0x03, 0xe5, 0x85, 0xc7, 0xee, 0xee, 0xb6, 0x75, 0xfa, 0xa4, 0x12, 0xd5, 0xec, 0x73, 0xf6, 0x29, 0x88, 0xeb, 0x0b, 0x6c, 0x54, 0x88])
</code></pre><h2 id=listing-file-mappings>Listing file mappings</h2><p>This command lists the file relations between the original source Linux Photon filetree and the deployed filetree. The normal columns include file type type (regular file, directory, link), permissions in chmod octal format, userID, groupID, file size, file name.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree ls photon/4.0/x86_64/minimal
d00755 0 0  0 /
l00777 0 0  0 /bin -&gt; usr/bin
l00777 0 0  0 /home -&gt; var/home
l00777 0 0  0 /lib -&gt; usr/lib
l00777 0 0  0 /lib64 -&gt; usr/lib
l00777 0 0  0 /media -&gt; run/media
l00777 0 0  0 /mnt -&gt; var/mnt
l00777 0 0  0 /opt -&gt; var/opt
l00777 0 0  0 /ostree -&gt; sysroot/ostree
l00777 0 0  0 /root -&gt; var/roothome
l00777 0 0  0 /sbin -&gt; usr/sbin
l00777 0 0  0 /srv -&gt; var/srv
l00777 0 0  0 /tmp -&gt; sysroot/tmp
d00755 0 0  0 /boot
d00755 0 0  0 /dev
d00755 0 0  0 /proc
d00755 0 0  0 /run
d00755 0 0  0 /sys
d00755 0 0  0 /sysroot
d00755 0 0  0 /usr
d00755 0 0  0 /var
</code></pre><p>Extra columns can be added like checksum (-C) and extended attributes (-X).</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree ls photon/4.0/x86_64/minimal -C
d00755 0 0  0 ca9935e5aac6bdb352b48162bb3fba440e3ca000c86f7c32a0a08bc6f0d5060e 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /
l00777 0 0  0 389846c2702216e1367c8dfb68326a6b93ccf5703c89c93979052a9bf359608e /bin -&gt; usr/bin
l00777 0 0  0 4344c10bf4931483f918496534f12ed9b50dc6a2cead35e3cd9dd898d6ac9414 /home -&gt; var/home
l00777 0 0  0 f11902ca9d69a80df33918534a3e443251fd0aa7f94b76301e1f55e52aed29dd /lib -&gt; usr/lib
l00777 0 0  0 f11902ca9d69a80df33918534a3e443251fd0aa7f94b76301e1f55e52aed29dd /lib64 -&gt; usr/lib
l00777 0 0  0 75317a3df11447c470ffdd63dde045450ca97dfb2a97a0f3f6a21a5da66f737c /media -&gt; run/media
l00777 0 0  0 97c55dbe24e8f3aecfd3f3e5b3f44646fccbb39799807d37a217e9c871da108b /mnt -&gt; var/mnt
l00777 0 0  0 46b1abbd27a846a9257a8d8c9fc4b384ac0888bdb8ac0d6a2d5de72715bd5092 /opt -&gt; var/opt
l00777 0 0  0 d37269e3f46023fd0275212473e07011894cdf4148cbf3fb5758a7e9471dad8e /ostree -&gt; sysroot/ostree
l00777 0 0  0 6f800e74eed172661278d1e1f09e389a6504dcd3358618e1c1618f91f9d33601 /root -&gt; var/roothome
l00777 0 0  0 e0bead7be9323b06bea05cb9b66eb151839989e3a4e5d1a93e09a36919e91818 /sbin -&gt; usr/sbin
l00777 0 0  0 5d4250bba1ed300f793fa9769474351ee5cebd71e8339078af7ebfbe6256d9b5 /srv -&gt; var/srv
l00777 0 0  0 364fbd62f91ca1e06eb7dbd50c93de8976f2cea633658e2dbe803ce6f7490c09 /tmp -&gt; sysroot/tmp
d00755 0 0  0 6e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /boot
d00755 0 0  0 6e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /dev
d00755 0 0  0 6e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /proc
d00755 0 0  0 6e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /run
d00755 0 0  0 6e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /sys
d00755 0 0  0 6e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /sysroot
d00755 0 0  0 83902b1171980665a74c9ea4d3817add50e9fd3279d3ee92381fb2c0098f7ab0 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /usr
d00755 0 0  0 a3a987e053ea5a116f1e75a31cd7557fc6e57a3ae09e64171d7fea17ef71ec3e 446a0ef11b7cc167f3b603e585c7eeeeb675faa412d5ec73f62988eb0b6c5488 /var
</code></pre><p>By default, only the top folders are listed, but -R will list recursively. Instead of listing over 10,000 files, let&rsquo;s filter to just all files that contain &lsquo;rpm-ostree&rsquo;, &lsquo;rpmostree&rsquo; or &lsquo;RpmOstree&rsquo;, that must belong to <strong>rpm-ostree</strong> package itself.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree ls photon/4.0/x86_64/minimal -R | grep -e '[Rr]pm-\?[Oo]stree'
-00755 0 0 787208 /usr/bin/rpm-ostree
d00755 0 0  0 /usr/bin/rpm-ostree-host
-00644 0 0   1069 /usr/bin/rpm-ostree-host/function.inc
-00755 0 0  10507 /usr/bin/rpm-ostree-host/mk-ostree-host.sh
d00755 0 0  0 /usr/bin/rpm-ostree-server
-00755 0 0   6452 /usr/bin/rpm-ostree-server/mkostreerepo
-00644 0 0209 /usr/etc/rpm-ostreed.conf
l00777 0 0  0 /usr/lib/librpmostree-1.so.1 -&gt; librpmostree-1.so.1.0.0
-00755 0 0 9878248 /usr/lib/librpmostree-1.so.1.0.0
-00644 0 0   2312 /usr/lib/girepository-1.0/RpmOstree-1.0.typelib
-00755 0 0 22 /usr/lib/kernel/install.d/00-rpmostree-skip.install
d00755 0 0  0 /usr/lib/rpm-ostree
-00755 0 0 1846216 /usr/lib/rpm-ostree/libdnf.so.2
-00644 0 0622 /usr/lib/rpm-ostree/rpm-ostree-0-integration.conf
d00755 0 0  0 /usr/lib/sysimage/rpm-ostree-base-db
-00644 0 0 1069056 /usr/lib/sysimage/rpm-ostree-base-db/Basenames
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Conflictname
-00644 0 0 159744 /usr/lib/sysimage/rpm-ostree-base-db/Dirnames
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Enhancename
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Filetriggername
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Group
-00644 0 0  12288 /usr/lib/sysimage/rpm-ostree-base-db/Installtid
-00644 0 0  16384 /usr/lib/sysimage/rpm-ostree-base-db/Name
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Obsoletename
-00644 0 0 4313088 /usr/lib/sysimage/rpm-ostree-base-db/Packages
-00644 0 0 102400 /usr/lib/sysimage/rpm-ostree-base-db/Providename
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Recommendname
-00644 0 0 106496 /usr/lib/sysimage/rpm-ostree-base-db/Requirename
-00644 0 0  24576 /usr/lib/sysimage/rpm-ostree-base-db/Sha1header
-00644 0 0  16384 /usr/lib/sysimage/rpm-ostree-base-db/Sigmd5
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Suggestname
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Supplementname
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Transfiletriggername
-00644 0 0   8192 /usr/lib/sysimage/rpm-ostree-base-db/Triggername
-00644 0 0263 /usr/lib/systemd/system/rpm-ostree-bootstatus.service
-00644 0 0257 /usr/lib/systemd/system/rpm-ostreed-automatic.service
-00644 0 0227 /usr/lib/systemd/system/rpm-ostreed-automatic.timer
-00644 0 0325 /usr/lib/systemd/system/rpm-ostreed.service
-00644 0 0102 /usr/lib/systemd/system-preset/40-rpm-ostree-auto.preset
-00644 0 0622 /usr/lib/tmpfiles.d/rpm-ostree-0-integration.conf
-00644 0 0   1572 /usr/lib/tmpfiles.d/rpm-ostree-1-autovar.conf
-00755 0 0 53 /usr/libexec/rpm-ostreed
-00644 0 0   3049 /usr/share/bash-completion/completions/rpm-ostree
-00644 0 0  17210 /usr/share/dbus-1/interfaces/org.projectatomic.rpmostree1.xml
-00644 0 0133 /usr/share/dbus-1/system-services/org.projectatomic.rpmostree1.service
-00644 0 0   1530 /usr/share/dbus-1/system.d/org.projectatomic.rpmostree1.conf
-00644 0 0   6593 /usr/share/polkit-1/actions/org.projectatomic.rpmostree1.policy
d00755 0 0  0 /usr/share/rpm-ostree
-00644 0 0   1199 /usr/share/rpm-ostree/treefile.json
</code></pre><p><strong>atomic</strong> is really an alias for rpm-ostree command. The last file <strong>treefile.json</strong> is not installed by the rpm-ostree package, it is actually downloaded from the server, as we will see in the next chapter. For now, let us notice <strong>&ldquo;osname&rdquo; : &ldquo;photon&rdquo;, &ldquo;ref&rdquo; : &ldquo;photon/1.0/x86_64/minimal&rdquo;, &ldquo;automatic_version_prefix&rdquo; : &ldquo;1.0_minimal&rdquo;</strong>, that matches what we have known so far, and also the <strong>&ldquo;documentation&rdquo; : false</strong> setting, that explains why there are no manual files installed for rpm-ostree, and in fact for any package.</p><pre><code class=language-console data-lang=console>root@photon-host [ /usr/share/rpm-ostree ]# ls -l /usr/share/man/man1 
total 0
</code></pre><h2 id=listing-configuration-changes>Listing configuration changes</h2><p>To diff the current /etc configuration versus default /etc (from the base image), this command will show the <strong>M</strong>odified, <strong>A</strong>dded and <strong>D</strong>eleted files:</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree admin config-diff
M  ssh/sshd_config
M  udev/hwdb.bin
M  fstab
M  machine-id
M  gshadow
M  hosts
M  shadow
A  ssh/ssh_host_rsa_key
A  ssh/ssh_host_rsa_key.pub
A  ssh/ssh_host_dsa_key
A  ssh/ssh_host_dsa_key.pub
A  ssh/ssh_host_ecdsa_key
A  ssh/ssh_host_ecdsa_key.pub
A  ssh/ssh_host_ed25519_key
A  ssh/ssh_host_ed25519_key.pub
A  hostname
A  group-
A  locale.conf
A  .pwd.lock
A  gshadow-
A  shadow-
A  resolv.conf
A  .updated
</code></pre><h2 id=listing-packages>Listing packages</h2><p>The following is the rpm-ostree command that lists all the packages for that branch, extracted from RPM database.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# rpm-ostree db list photon/4.0/x86_64/minimal
    ostree commit: photon/4.0/x86_64/minimal (820b584a6f90bf6b9b8cb6aad8c093064b88d0ab686be8130baa03d68917ad88)
     Linux-PAM-1.4.0-2.ph4.x86_64
     attr-2.4.48-1.ph4.x86_64
     audit-2.8.5-3.ph4.x86_64
     autogen-libopts-5.18.16-3.ph4.x86_64
     bash-5.0-1.ph4.x86_64
     bc-1.07.1-4.ph4.x86_64
     bridge-utils-1.6-1.ph4.x86_64
     bubblewrap-0.4.1-1.ph4.x86_64
     bzip2-1.0.8-3.ph4.x86_64
     bzip2-libs-1.0.8-3.ph4.x86_64
     ca-certificates-20201001-1.ph4.x86_64
     ca-certificates-pki-20201001-1.ph4.x86_64
     cloud-init-20.3-2.ph4.noarch
     coreutils-selinux-8.32-2.ph4.x86_64
     cpio-2.13-1.ph4.x86_64
     cracklib-2.9.7-1.ph4.x86_64
     cracklib-dicts-2.9.7-1.ph4.x86_64
     curl-7.72.0-2.ph4.x86_64
     curl-libs-7.72.0-2.ph4.x86_64
     cyrus-sasl-2.1.27-3.ph4.x86_64
     dbus-1.13.18-1.ph4.x86_64
     device-mapper-2.03.10-2.ph4.x86_64
     device-mapper-libs-2.03.10-2.ph4.x86_64
     dhcp-client-4.4.2-1.ph4.x86_64
     dhcp-libs-4.4.2-1.ph4.x86_64
     dracut-050-5.ph4.x86_64
     dracut-tools-050-5.ph4.x86_64
     e2fsprogs-1.45.6-2.ph4.x86_64
     e2fsprogs-libs-1.45.6-2.ph4.x86_64
     elfutils-0.181-2.ph4.x86_64
     elfutils-libelf-0.181-2.ph4.x86_64
     expat-2.2.9-2.ph4.x86_64
     expat-libs-2.2.9-2.ph4.x86_64
     file-5.39-1.ph4.x86_64
     file-libs-5.39-1.ph4.x86_64
     filesystem-1.1-4.ph4.x86_64
     findutils-4.7.0-1.ph4.x86_64
     finger-0.17-3.ph4.x86_64
     flex-2.6.4-3.ph4.x86_64
     fuse-2.9.9-1.ph4.x86_64
     gawk-5.1.0-1.ph4.x86_64
     gc-8.0.4-1.ph4.x86_64
     gdbm-1.18.1-1.ph4.x86_64
     glib-2.66.1-1.ph4.x86_64
     glib-networking-2.66.0-1.ph4.x86_64
     glibc-2.32-1.ph4.x86_64
     glibc-iconv-2.32-1.ph4.x86_64
     gmp-6.2.0-1.ph4.x86_64
     gnupg-2.2.23-1.ph4.x86_64
     gnutls-3.6.15-3.ph4.x86_64
     gobject-introspection-1.66.0-1.ph4.x86_64
     gpgme-1.14.0-1.ph4.x86_64
     grep-3.4-1.ph4.x86_64
     grub2-2.04-2.ph4.x86_64
     grub2-efi-2.04-2.ph4.x86_64
     grub2-efi-image-2.04-2.ph4.x86_64
     grub2-pc-2.04-2.ph4.x86_64
     grub2-theme-4.0-1.ph4.noarch
     grub2-theme-ostree-4.0-1.ph4.noarch
     guile-2.0.13-3.ph4.x86_64
     gzip-1.10-1.ph4.x86_64
     iana-etc-2.30-2.ph4.noarch
     icu-67.1-1.ph4.x86_64
     iproute2-5.8.0-1.ph4.x86_64
     iptables-1.8.4-1.ph4.x86_64
     iputils-20200821-1.ph4.x86_64
     json-c-0.15-2.ph4.x86_64
     json-glib-1.6.0-1.ph4.x86_64
     kmod-27-1.ph4.x86_64
     krb5-1.17-4.ph4.x86_64
     libacl-2.2.53-1.ph4.x86_64
     libarchive-3.4.3-3.ph4.x86_64
     libassuan-2.5.3-1.ph4.x86_64
     libcap-2.43-1.ph4.x86_64
     libcap-ng-0.8-1.ph4.x86_64
     libdb-5.3.28-2.ph4.x86_64
     libdnet-1.11-7.ph4.x86_64
     libffi-3.3-1.ph4.x86_64
     libgcc-8.4.0-1.ph4.x86_64
     libgcrypt-1.8.6-2.ph4.x86_64
     libgpg-error-1.39-1.ph4.x86_64
     libgpg-error-devel-1.39-1.ph4.x86_64
     libksba-1.4.0-1.ph4.x86_64
     libltdl-2.4.6-3.ph4.x86_64
     libmetalink-0.1.3-2.ph4.x86_64
     libmicrohttpd-0.9.71-2.ph4.x86_64
     libmodulemd-2.9.4-1.ph4.x86_64
     libmspack-0.10.1alpha-1.ph4.x86_64
     libnsl-1.3.0-1.ph4.x86_64
     libpsl-0.21.1-1.ph4.x86_64
     libpwquality-1.4.2-1.ph4.x86_64
     librepo-1.12.1-3.ph4.x86_64
     libseccomp-2.5.0-2.ph4.x86_64
     libselinux-3.1-1.ph4.x86_64
     libsemanage-3.1-1.ph4.x86_64
     libsepol-3.1-1.ph4.x86_64
     libsolv-0.6.35-5.ph4.x86_64
     libsoup-2.72.0-1.ph4.x86_64
     libssh2-1.9.0-2.ph4.x86_64
     libstdc++-8.4.0-1.ph4.x86_64
     libtasn1-4.14-1.ph4.x86_64
     libtirpc-1.2.6-1.ph4.x86_64
     libtool-2.4.6-3.ph4.x86_64
     libunistring-0.9.10-1.ph4.x86_64
     libxml2-2.9.10-3.ph4.x86_64
     libxml2-devel-2.9.10-3.ph4.x86_64
     libxslt-1.1.34-1.ph4.x86_64
     libyaml-0.2.5-1.ph4.x86_64
     linux-5.9.0-3.ph4.x86_64
     lua-5.3.5-1.ph4.x86_64
     lz4-1.9.2-1.ph4.x86_64
     m4-1.4.18-3.ph4.x86_64
     motd-0.1.3-6.ph4.noarch
     mozjs-78.3.1-1.ph4.x86_64
     mpfr-4.1.0-1.ph4.x86_64
     ncurses-6.2-2.ph4.x86_64
     ncurses-libs-6.2-2.ph4.x86_64
     ncurses-terminfo-6.2-2.ph4.x86_64
     net-tools-1.60-12.ph4.x86_64
     nettle-3.6-1.ph4.x86_64
     npth-1.6-1.ph4.x86_64
     nspr-4.29-1.ph4.x86_64
     nss-3.57-1.ph4.x86_64
     nss-altfiles-2.23.0-1.ph4.x86_64
     nss-libs-3.57-1.ph4.x86_64
     open-vm-tools-11.1.5-4.ph4.x86_64
     openldap-2.4.53-2.ph4.x86_64
     openssh-8.4p1-2.ph4.x86_64
     openssh-clients-8.4p1-2.ph4.x86_64
     openssh-server-8.4p1-2.ph4.x86_64
     openssl-1.1.1g-3.ph4.x86_64
     ostree-2020.6-1.ph4.x86_64
     ostree-grub2-2020.6-1.ph4.x86_64
     ostree-libs-2020.6-1.ph4.x86_64
     pcre-8.44-1.ph4.x86_64
     pcre-libs-8.44-1.ph4.x86_64
     photon-release-4.0-1.ph4.noarch
     photon-repos-4.0-1.ph4.noarch
     pinentry-1.1.0-1.ph4.x86_64
     pkg-config-0.29.2-3.ph4.x86_64
     policycoreutils-3.1-1.ph4.x86_64
     polkit-0.118-1.ph4.x86_64
     popt-1.16-5.ph4.x86_64
     procps-ng-3.3.16-1.ph4.x86_64
     python3-3.8.6-1.ph4.x86_64
     python3-PyYAML-5.3.1-1.ph4.x86_64
     python3-asn1crypto-1.4.0-1.ph4.noarch
     python3-attrs-20.2.0-2.ph4.noarch
     python3-certifi-2020.6.20-1.ph4.noarch
     python3-cffi-1.14.3-2.ph4.x86_64
     python3-chardet-3.0.4-2.ph4.noarch
     python3-configobj-5.0.6-5.ph4.noarch
     python3-cryptography-3.1.1-2.ph4.x86_64
     python3-gobject-introspection-1.66.0-1.ph4.x86_64
     python3-idna-2.10-1.ph4.noarch
     python3-jinja2-2.11.2-1.ph4.noarch
     python3-jsonpatch-1.26-1.ph4.noarch
     python3-jsonpointer-2.0-2.ph4.noarch
     python3-jsonschema-3.2.0-1.ph4.noarch
     python3-libs-3.8.6-1.ph4.x86_64
     python3-markupsafe-1.1.1-1.ph4.x86_64
     python3-netifaces-0.10.9-2.ph4.x86_64
     python3-oauthlib-3.1.0-1.ph4.noarch
     python3-packaging-20.4-2.ph4.noarch
     python3-prettytable-0.7.2-7.ph4.noarch
     python3-pyOpenSSL-19.1.0-2.ph4.noarch
     python3-pyasn1-0.4.8-1.ph4.noarch
     python3-pycparser-2.20-1.ph4.noarch
     python3-pyparsing-2.4.7-1.ph4.noarch
     python3-pyrsistent-0.17.3-1.ph4.x86_64
     python3-requests-2.24.0-1.ph4.noarch
     python3-setuptools-3.8.6-1.ph4.noarch
     python3-six-1.15.0-2.ph4.noarch
     python3-urllib3-1.25.10-2.ph4.noarch
     python3-xml-3.8.6-1.ph4.x86_64
     readline-7.0-3.ph4.x86_64
     rpcsvc-proto-1.4.2-1.ph4.x86_64
     rpm-4.14.2-11.ph4.x86_64
     rpm-libs-4.14.2-11.ph4.x86_64
     rpm-ostree-2020.5-4.ph4.x86_64
     sed-4.8-1.ph4.x86_64
     selinux-policy-3.14.7-1.ph4.noarch
     shadow-4.8.1-2.ph4.x86_64
     shadow-tools-4.8.1-2.ph4.x86_64
     shim-signed-15-1.ph4.x86_64
     sqlite-libs-3.33.0-1.ph4.x86_64
     sudo-1.8.30-2.ph4.x86_64
     systemd-245.5-3.ph4.x86_64
     tcp_wrappers-7.6-7.ph4.x86_64
     tzdata-2020a-1.ph4.noarch
     util-linux-2.36-1.ph4.x86_64
     util-linux-libs-2.36-1.ph4.x86_64
     vim-8.2.1361-1.ph4.x86_64
     which-2.21-6.ph4.x86_64
     xmlsec1-1.2.30-3.ph4.x86_64
     xz-5.2.5-1.ph4.x86_64
     xz-libs-5.2.5-1.ph4.x86_64
     zchunk-1.1.7-1.ph4.x86_64
     zchunk-libs-1.1.7-1.ph4.x86_64
     zlib-1.2.11-2.ph4.x86_64
     zstd-1.4.5-2.ph4.x86_64
     zstd-libs-1.4.5-2.ph4.x86_64
</code></pre><h2 id=querying-for-package-details>Querying for package details</h2><p>We are able to use the query option of rpm to make sure any package have been installed properly. The files list should match the previous file mappings in 4.2, so let&rsquo;s check package <strong>rpm-ostree</strong>. As we&rsquo;ve seen, manual files listed here are actually missing, they were not installed.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# rpm -ql  rpm-ostree
    /etc/rpm-ostreed.conf
    /usr/bin/rpm-ostree
    /usr/bin/rpm-ostree-host
    /usr/bin/rpm-ostree-host/function.inc
    /usr/bin/rpm-ostree-host/mk-ostree-host.sh
    /usr/bin/rpm-ostree-server
    /usr/bin/rpm-ostree-server/mkostreerepo
    /usr/lib/girepository-1.0/RpmOstree-1.0.typelib
    /usr/lib/librpmostree-1.so.1
    /usr/lib/librpmostree-1.so.1.0.0
    /usr/lib/rpm-ostree
    /usr/lib/rpm-ostree/libdnf.so.2
    /usr/lib/rpm-ostree/rpm-ostree-0-integration.conf
    /usr/lib/systemd/system/rpm-ostree-bootstatus.service
    /usr/lib/systemd/system/rpm-ostreed-automatic.service
    /usr/lib/systemd/system/rpm-ostreed-automatic.timer
    /usr/lib/systemd/system/rpm-ostreed.service
    /usr/libexec/rpm-ostreed
    /usr/share/bash-completion/completions/rpm-ostree
    /usr/share/dbus-1/interfaces/org.projectatomic.rpmostree1.xml
    /usr/share/dbus-1/system-services/org.projectatomic.rpmostree1.service
    /usr/share/dbus-1/system.d/org.projectatomic.rpmostree1.conf
    /usr/share/man/man1/rpm-ostree.1.gz
    /usr/share/man/man5/rpm-ostreed.conf.5.gz
    /usr/share/man/man8/rpm-ostreed-automatic.service.8.gz
    /usr/share/man/man8/rpm-ostreed-automatic.timer.8.gz
    /usr/share/polkit-1/actions/org.projectatomic.rpmostree1.policy
</code></pre><h2 id=why-am-i-unable-to-install-upgrade-or-uninstall-packages>Why am I unable to install, upgrade or uninstall packages?</h2><p>The OSTree host installer needs the server URL or the server repository.</p><p>When you perform the installation using the repo, the install packages are located under the layer package. When you install with the URL, the packages are located under the local packages.</p><p>You can use the <code>rpm-ostree uninstall</code> command to uninstall only the layered and local packages but not the base packages. To modify the base packages, you can use the <code>rpm-ostree override</code> command.</p><p>When you run <code>rpm-ostree upgrade</code>, the command will only upgrade packages based on the commit available in the server.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6b453783bf3141d3bc03b2e2732f3afc>5.13.5 - Host Updating Operations</h1><ul><li><a href=#upgrade-overview>Upgrade Overview</a></li><li><a href=#incremental-upgrade>Incremental upgrade</a></li><li><a href=#listing-file-differences>Listing file differences</a></li><li><a href=#listing-package-differences>Listing package differences</a></li><li><a href=#rollback>Rollback</a></li><li><a href=#installing-packages>Installing Packages</a></li><li><a href=#uninstalling-packages>Uninstalling Packages</a></li><li><a href=#deleting-a-deployed-filetree>Deleting a deployed filetree</a></li><li><a href=#version-skipping-upgrade>Version skipping upgrade</a></li><li><a href=#tracking-parent-commits>Tracking parent commits</a></li><li><a href=#resetting-a-branch-to-a-previous-commit>Resetting a branch to a previous commit</a></li></ul><h2 id=upgrade-overview>Upgrade overview</h2><p>If you&rsquo;ve used yum, dnf (and now tdnf for Photon) in RPM systems or apt-get in Debian based Unix, you understand what &ldquo;install&rdquo; is for packages and the subtle difference between &ldquo;update&rdquo; and &ldquo;upgrade&rdquo;.</p><p>OSTree and RPM-OSTree don&rsquo;t distinguish between them and the term &ldquo;upgrade&rdquo; has a slightly different meaning - to bring the system in sync with the remote repo, to the top of the Refspec (branch), just like in Git, by pulling the latest changes.</p><p>In fact, ostree and rpm-ostree commands support a single &ldquo;upgrade&rdquo; verb for a file image tree and a package list in the same refspec (branch). <code>rpm-ostree upgrade</code> will install a package if it doesn&rsquo;t exist, will not touch it if it has same version in the new image, will upgrade it if the version number is higher and it may actually downgrade it, if the package has been downgraded in the new image. I wish this operation had a different name, to avoid any confusion.</p><p>The reverse operation of an upgrade is a &ldquo;rollback&rdquo; and fortunately it&rsquo;s not named &ldquo;downgrade&rdquo; because it may upgrade packages in the last case describe above.</p><p>As we&rsquo;ll see in a future chapter, a jump to a different Refspec (branch) is also supported and it&rsquo;s named &ldquo;rebase&rdquo;.</p><h2 id=incremental-upgrade>Incremental upgrade</h2><p>To check if there are any updates available, one would execute:</p><pre><code class=language-console data-lang=console>root@photon-host-def [ ~ ]# rpm-ostree upgrade
Updating from: photon:photon/4.0/x86_64/minimal

No upgrade available.
</code></pre><p>It is good idea to check periodically for updates.</p><p>To check if there are any new updates without actually applying them, we will pass the &ndash;check-diff flag, that would list the different packages as added, modified or deleted - if such operations were to happen.</p><pre><code class=language-console data-lang=console>root@photon-host [ ~ ]# rpm-ostree upgrade --check-diff
Updating from: photon:photon/4.0/x86_64/minimal

8 metadata, 13 content objects fetched; 1026 KiB transferred in 0 seconds
+gawk-4.1.3-2.ph1.x86_64
+sudo-1.8.15-3.ph1.x86_64
+wget-1.17.1-2.ph1.x86_64
</code></pre><p>We like what we see and now let&rsquo;s upgrade for real. This command will deploy a new bootable filetree.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# rpm-ostree upgrade --allow-downgrade
⠂ Receiving metadata objects: 0/(estimating) -/s 0 bytes... 
Receiving metadata objects: 0/(estimating) -/s 0 bytes... done
Staging deployment... done
Downgraded:
  audit 2.8.5-6.ph4 -&gt; 2.8.5-3.ph4
  cloud-init 20.4.1-1.ph4 -&gt; 20.3-2.ph4
  cpio 2.13-3.ph4 -&gt; 2.13-1.ph4
  curl 7.74.0-1.ph4 -&gt; 7.72.0-2.ph4
  curl-libs 7.74.0-1.ph4 -&gt; 7.72.0-2.ph4
  cyrus-sasl 2.1.27-4.ph4 -&gt; 2.1.27-3.ph4
  dhcp-client 4.4.2-2.ph4 -&gt; 4.4.2-1.ph4
  dhcp-libs 4.4.2-2.ph4 -&gt; 4.4.2-1.ph4
  dracut 050-7.ph4 -&gt; 050-5.ph4
  dracut-tools 050-7.ph4 -&gt; 050-5.ph4
  file 5.39-2.ph4 -&gt; 5.39-1.ph4
  file-libs 5.39-2.ph4 -&gt; 5.39-1.ph4
  gdbm 1.19-1.ph4 -&gt; 1.18.1-1.ph4
  glibc 2.32-2.ph4 -&gt; 2.32-1.ph4
  glibc-iconv 2.32-2.ph4 -&gt; 2.32-1.ph4
  gobject-introspection 1.66.0-3.ph4 -&gt; 1.66.0-1.ph4
  grub2-theme 4.0-2.ph4 -&gt; 4.0-1.ph4
  grub2-theme-ostree 4.0-2.ph4 -&gt; 4.0-1.ph4
  iproute2 5.10.0-1.ph4 -&gt; 5.8.0-1.ph4
  iptables 1.8.7-1.ph4 -&gt; 1.8.4-1.ph4
  json-c 0.15-3.ph4 -&gt; 0.15-2.ph4
  libgcc 10.2.0-1.ph4 -&gt; 8.4.0-1.ph4
  libmetalink 0.1.3-3.ph4 -&gt; 0.1.3-2.ph4
  libmodulemd 2.11.0-1.ph4 -&gt; 2.9.4-1.ph4
  librepo 1.12.1-4.ph4 -&gt; 1.12.1-3.ph4
  libsepol 3.1-2.ph4 -&gt; 3.1-1.ph4
  libsolv 0.6.35-7.ph4 -&gt; 0.6.35-5.ph4
  libssh2 1.9.0-3.ph4 -&gt; 1.9.0-2.ph4
  libstdc++ 10.2.0-1.ph4 -&gt; 8.4.0-1.ph4
  libxml2 2.9.10-6.ph4 -&gt; 2.9.10-3.ph4
  libxml2-devel 2.9.10-6.ph4 -&gt; 2.9.10-3.ph4
  libxslt 1.1.34-2.ph4 -&gt; 1.1.34-1.ph4
  linux 5.10.4-15.ph4 -&gt; 5.9.0-3.ph4
  ncurses 6.2-3.ph4 -&gt; 6.2-2.ph4
  ncurses-libs 6.2-3.ph4 -&gt; 6.2-2.ph4
  ncurses-terminfo 6.2-3.ph4 -&gt; 6.2-2.ph4
  nss 3.57-2.ph4 -&gt; 3.57-1.ph4
  nss-libs 3.57-2.ph4 -&gt; 3.57-1.ph4
  open-vm-tools 11.2.5-1.ph4 -&gt; 11.1.5-4.ph4
  openldap 2.4.53-3.ph4 -&gt; 2.4.53-2.ph4
  openssl 1.1.1i-2.ph4 -&gt; 1.1.1g-3.ph4
  pcre 8.44-2.ph4 -&gt; 8.44-1.ph4
  pcre-libs 8.44-2.ph4 -&gt; 8.44-1.ph4
  python3 3.9.1-2.ph4 -&gt; 3.8.6-1.ph4
  python3-PyYAML 5.4.1-1.ph4 -&gt; 5.3.1-1.ph4
  python3-attrs 20.3.0-2.ph4 -&gt; 20.2.0-2.ph4
  python3-cryptography 3.2.1-1.ph4 -&gt; 3.1.1-2.ph4
  python3-gobject-introspection 1.66.0-3.ph4 -&gt; 1.66.0-1.ph4
  python3-libs 3.9.1-2.ph4 -&gt; 3.8.6-1.ph4
  python3-packaging 20.4-3.ph4 -&gt; 20.4-2.ph4
  python3-pyrsistent 0.17.3-2.ph4 -&gt; 0.17.3-1.ph4
  python3-setuptools 3.9.1-2.ph4 -&gt; 3.8.6-1.ph4
  python3-urllib3 1.25.11-1.ph4 -&gt; 1.25.10-2.ph4
  python3-xml 3.9.1-2.ph4 -&gt; 3.8.6-1.ph4
  rpm 4.16.1.2-1.ph4 -&gt; 4.14.2-11.ph4
  rpm-libs 4.16.1.2-1.ph4 -&gt; 4.14.2-11.ph4
  rpm-ostree 2020.5-5.ph4 -&gt; 2020.5-4.ph4
  shadow 4.8.1-3.ph4 -&gt; 4.8.1-2.ph4
  shadow-tools 4.8.1-3.ph4 -&gt; 4.8.1-2.ph4
  sudo 1.9.5-1.ph4 -&gt; 1.8.30-2.ph4
  systemd 247.3-1.ph4 -&gt; 245.5-3.ph4
  util-linux 2.36-2.ph4 -&gt; 2.36-1.ph4
  util-linux-libs 2.36-2.ph4 -&gt; 2.36-1.ph4
Removed:
  libpcap-1.10.0-1.ph4.x86_64
  python3-Pygments-2.7.2-2.ph4.noarch
  python3-alabaster-0.7.12-1.ph4.noarch
  python3-babel-2.8.0-3.ph4.noarch
  python3-docutils-0.16-1.ph4.noarch
  python3-imagesize-1.2.0-2.ph4.noarch
  python3-pytz-2020.4-2.ph4.noarch
  python3-snowballstemmer-2.0.0-1.ph4.noarch
  python3-sphinx-3.3.0-2.ph4.noarch
  python3-sphinxcontrib-applehelp-1.0.2-1.ph4.noarch
  python3-sphinxcontrib-devhelp-1.0.2-1.ph4.noarch
  python3-sphinxcontrib-htmlhelp-1.0.3-1.ph4.noarch
  python3-sphinxcontrib-jsmath-1.0.1-1.ph4.noarch
  python3-sphinxcontrib-qthelp-1.0.3-1.ph4.noarch
  python3-sphinxcontrib-serializinghtml-1.1.4-1.ph4.noarch
  python3-typing-3.7.4.3-1.ph4.noarch
  systemd-libs-247.3-1.ph4.x86_64
  systemd-pam-247.3-1.ph4.x86_64
  systemd-rpm-macros-247.3-1.ph4.noarch
  systemd-udev-247.3-1.ph4.x86_64
Run &quot;systemctl reboot&quot; to start a reboot
</code></pre><p>By looking at the commit history, notice that the new commit has the original commit as parent.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree log photon/4.0/x86_64/minimal
commit 820b584a6f90bf6b9b8cb6aad8c093064b88d0ab686be8130baa03d68917ad88
ContentChecksum:  c7956cedc5c1b8c07a06e10789c17364a5b7a4b970daab64f3398b7c42bd97d9
Date:  2020-11-04 02:21:47 +0000
Version: 4.0_minimal
(no subject)
</code></pre><p>Notice that now we have a new reference, that corresponds to the newly deployed image.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree refs
ostree/0/1/1
photon:photon/4.0/x86_64/minimal
ostree/0/1/0
</code></pre><p>Let us look at the status. The new filetree version .1 has the expected Commit ID and a newer timestamp, that is actually the server date/time when the image has been generated, not the time/date when it was downloaded or installed at the host. The old image has a star next to it, showing that&rsquo;s the image the system is booted currently into.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# rpm-ostree status
State: idle
Deployments:
  ostree://photon:photon/4.0/x86_64/minimal
    Version: 4.0_minimal (2020-11-04T02:21:47Z)
Commit: 820b584a6f90bf6b9b8cb6aad8c093064b88d0ab686be8130baa03d68917ad88
  Diff: 63 downgraded, 20 removed

● ostree://photon:photon/4.0/x86_64/minimal
    Version: 4.0_minimal (2021-02-20T07:15:43Z)
Commit: 965c1abeb048e1a8ff77e9cd34ffccc5e3356176cda3332b4ff0e7a6c66b661f
</code></pre><p>Now let&rsquo;s type <code>reboot</code>. Grub will list the new filetree as the first image, marked with a star, as the default bootable image. If the keyboard is not touched and order is not changed, grub will timeout and will boot into that image.</p><p><img src=../../docs/images/rpmostree-grub.png alt=Grub-dual-boot-1-0></p><p>Let&rsquo;s look again at the status. It&rsquo;s identical, just that the star is next to the newer image, to show it&rsquo;s the current image it has booted from.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# rpm-ostree status
State: idle
Deployments:
● ostree://photon:photon/4.0/x86_64/minimal
    Version: 4.0_minimal (2020-11-04T02:21:47Z)
Commit: 820b584a6f90bf6b9b8cb6aad8c093064b88d0ab686be8130baa03d68917ad88
  Diff: 63 downgraded, 20 removed

  ostree://photon:photon/4.0/x86_64/minimal
    Version: 4.0_minimal (2021-02-20T07:15:43Z)
Commit: 965c1abeb048e1a8ff77e9cd34ffccc5e3356176cda3332b4ff0e7a6c66b661f
</code></pre><p>Also, the current deployment directory is based on the new commit:</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree admin config-diff --print-current-dir
/ostree/deploy/photon/deploy/820b584a6f90bf6b9b8cb6aad8c093064b88d0ab686be8130baa03d68917ad88.0
</code></pre><p>A fresh upgrade for a new version will delete the older, original image and bring a new one, that will become the new default image. The previous &lsquo;default&rsquo; image will move down one position as the backup image.</p><h2 id=listing-file-differences>Listing file differences</h2><p>Now we can look at what files have been <strong>A</strong>dded, <strong>M</strong>odified, <strong>D</strong>eleted due to the addition of those three packages and switching of the boot directories, by comparing the two commits.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree diff 820b 965c
M    /usr/bin/VGAuthService
M    /usr/bin/[
M    /usr/bin/asn1Coding
M    /usr/bin/asn1Decoding
M    /usr/bin/asn1Parser
M    /usr/bin/attr
M    /usr/bin/aulast
M    /usr/bin/aulastlog
M    /usr/bin/ausyscall
M    /usr/bin/auvirt
M    /usr/bin/b2sum
M    /usr/bin/base32
M    /usr/bin/base64
M    /usr/bin/basename
M    /usr/bin/basenc
M    /usr/bin/bash
M    /usr/bin/bc
M    /usr/bin/bootctl
M    /usr/bin/bsdcat
M    /usr/bin/bsdcpio
M    /usr/bin/bsdtar
M    /usr/bin/busctl
M    /usr/bin/bwrap
M    /usr/bin/bzip2
M    /usr/bin/bzip2recover
M    /usr/bin/cal
M    /usr/bin/captest
M    /usr/bin/cat
M    /usr/bin/certtool
M    /usr/bin/certutil
M    /usr/bin/chage
M    /usr/bin/chattr
M    /usr/bin/chcon
M    /usr/bin/chfn
M    /usr/bin/chgrp
M    /usr/bin/chmem
M    /usr/bin/chmod
M    /usr/bin/choom
M    /usr/bin/chown
M    /usr/bin/chrt
M    /usr/bin/chsh
M    /usr/bin/cksum
M    /usr/bin/clear
M    /usr/bin/cloud-id
M    /usr/bin/cloud-init
M    /usr/bin/col
M    /usr/bin/colcrt
M    /usr/bin/colrm
M    /usr/bin/column
M    /usr/bin/comm
M    /usr/bin/coredumpctl
M    /usr/bin/cp
M    /usr/bin/cpio
M    /usr/bin/csplit
M    /usr/bin/curl
M    /usr/bin/curl-config
M    /usr/bin/cut
M    /usr/bin/cvtsudoers
M    /usr/bin/date
M    /usr/bin/dbus-cleanup-sockets
M    /usr/bin/dbus-daemon
M    /usr/bin/dbus-launch
M    /usr/bin/dbus-monitor
M    /usr/bin/dbus-run-session
M    /usr/bin/dbus-send
M    /usr/bin/dbus-test-tool
M    /usr/bin/dbus-update-activation-environment
M    /usr/bin/dbus-uuidgen
M    /usr/bin/dc
M    /usr/bin/dd
M    /usr/bin/debuginfod
M    /usr/bin/debuginfod-find
M    /usr/bin/deltainfoxml2solv
M    /usr/bin/derb
M    /usr/bin/df
M    /usr/bin/dir
M    /usr/bin/dircolors
M    /usr/bin/dirmngr
M    /usr/bin/dirmngr-client
M    /usr/bin/dirname
M    /usr/bin/dmesg
M    /usr/bin/du
M    /usr/bin/dumpsexp
M    /usr/bin/dumpsolv
M    /usr/bin/echo
M    /usr/bin/eject
M    /usr/bin/env
M    /usr/bin/eu-addr2line
M    /usr/bin/eu-ar
M    /usr/bin/eu-elfclassify
M    /usr/bin/eu-elfcmp
M    /usr/bin/eu-elfcompress
M    /usr/bin/eu-elflint
M    /usr/bin/eu-findtextrel
M    /usr/bin/eu-nm
M    /usr/bin/eu-objdump
M    /usr/bin/eu-ranlib
M    /usr/bin/eu-readelf
M    /usr/bin/eu-size
M    /usr/bin/eu-stack
M    /usr/bin/eu-strings
M    /usr/bin/eu-strip
M    /usr/bin/eu-unstrip
M    /usr/bin/expand
M    /usr/bin/expiry
M    /usr/bin/expr
M    /usr/bin/factor
M    /usr/bin/faillog
M    /usr/bin/fallocate
M    /usr/bin/false
M    /usr/bin/file
M    /usr/bin/filecap
M    /usr/bin/fincore
M    /usr/bin/find
M    /usr/bin/findmnt
M    /usr/bin/finger
M    /usr/bin/flex
M    /usr/bin/flock
M    /usr/bin/fmt
M    /usr/bin/fold
M    /usr/bin/free
M    /usr/bin/fusermount
M    /usr/bin/gawk
M    /usr/bin/gawk-5.1.0
M    /usr/bin/gdbm_dump
M    /usr/bin/gdbm_load
M    /usr/bin/gdbmtool
M    /usr/bin/genbrk
M    /usr/bin/gencat
M    /usr/bin/gencfu
M    /usr/bin/gencnval
M    /usr/bin/gendict
M    /usr/bin/gendiff
M    /usr/bin/genrb
M    /usr/bin/getconf
M    /usr/bin/getent
M    /usr/bin/getfattr
M    /usr/bin/getopt
M    /usr/bin/gnutls-cli
M    /usr/bin/gnutls-cli-debug
M    /usr/bin/gnutls-serv
M    /usr/bin/gpasswd
M    /usr/bin/gpg
M    /usr/bin/gpg-agent
M    /usr/bin/gpg-connect-agent
M    /usr/bin/gpg-error
M    /usr/bin/gpg-wks-server
M    /usr/bin/gpgconf
M    /usr/bin/gpgparsemail
M    /usr/bin/gpgscm
M    /usr/bin/gpgsm
M    /usr/bin/gpgsplit
M    /usr/bin/gpgtar
M    /usr/bin/gpgv
M    /usr/bin/grep
M    /usr/bin/groups
M    /usr/bin/grub2-editenv
M    /usr/bin/grub2-file
M    /usr/bin/grub2-fstest
M    /usr/bin/grub2-glue-efi
M    /usr/bin/grub2-menulst2cfg
M    /usr/bin/grub2-mkimage
M    /usr/bin/grub2-mklayout
M    /usr/bin/grub2-mknetdir
M    /usr/bin/grub2-mkpasswd-pbkdf2
M    /usr/bin/grub2-mkrelpath
M    /usr/bin/grub2-mkrescue
M    /usr/bin/grub2-mkstandalone
M    /usr/bin/grub2-render-label
M    /usr/bin/grub2-script-check
M    /usr/bin/grub2-syslinux2cfg
M    /usr/bin/gss-client
M    /usr/bin/guile
M    /usr/bin/gzip
M    /usr/bin/hardlink
M    /usr/bin/head
M    /usr/bin/hexdump
M    /usr/bin/hmac256
M    /usr/bin/hostid
M    /usr/bin/hostname
M    /usr/bin/hostnamectl
M    /usr/bin/iconv
M    /usr/bin/icuinfo
M    /usr/bin/id
M    /usr/bin/infocmp
M    /usr/bin/install
M    /usr/bin/installcheck
M    /usr/bin/ionice
M    /usr/bin/ipcmk
M    /usr/bin/ipcrm
M    /usr/bin/ipcs
M    /usr/bin/irqtop
M    /usr/bin/isosize
M    /usr/bin/join
M    /usr/bin/journalctl
M    /usr/bin/js78
M    /usr/bin/json-glib-format
M    /usr/bin/json-glib-validate
M    /usr/bin/kadmin
M    /usr/bin/kbxutil
M    /usr/bin/kdestroy
M    /usr/bin/kernel-install
M    /usr/bin/kill
M    /usr/bin/kinit
M    /usr/bin/klist
M    /usr/bin/kmod
M    /usr/bin/kpasswd
M    /usr/bin/kswitch
M    /usr/bin/ktutil
M    /usr/bin/kvno
M    /usr/bin/last
M    /usr/bin/lastlog
M    /usr/bin/ldapcompare
M    /usr/bin/ldapdelete
M    /usr/bin/ldapexop
M    /usr/bin/ldapmodify
M    /usr/bin/ldapmodrdn
M    /usr/bin/ldappasswd
M    /usr/bin/ldapsearch
M    /usr/bin/ldapurl
M    /usr/bin/ldapwhoami
M    /usr/bin/libtool
M    /usr/bin/link
M    /usr/bin/ln
M    /usr/bin/locale
M    /usr/bin/localectl
M    /usr/bin/localedef
M    /usr/bin/locate
M    /usr/bin/logger
M    /usr/bin/login
M    /usr/bin/loginctl
M    /usr/bin/logname
M    /usr/bin/look
M    /usr/bin/ls
M    /usr/bin/lsattr
M    /usr/bin/lsblk
M    /usr/bin/lscpu
M    /usr/bin/lsipc
M    /usr/bin/lsirq
M    /usr/bin/lslocks
M    /usr/bin/lslogins
M    /usr/bin/lsmem
M    /usr/bin/lsns
M    /usr/bin/lua
M    /usr/bin/luac
M    /usr/bin/lz4
M    /usr/bin/lzmadec
M    /usr/bin/lzmainfo
M    /usr/bin/m4
M    /usr/bin/makeconv
M    /usr/bin/makedb
M    /usr/bin/mcookie
M    /usr/bin/md5sum
M    /usr/bin/mergesolv
M    /usr/bin/mesg
M    /usr/bin/mkdir
M    /usr/bin/mkfifo
M    /usr/bin/mkinitrd
M    /usr/bin/mknod
M    /usr/bin/mktemp
M    /usr/bin/modulemd-validator
M    /usr/bin/more
M    /usr/bin/mount
M    /usr/bin/mountpoint
M    /usr/bin/mpicalc
M    /usr/bin/mt
M    /usr/bin/mv
M    /usr/bin/namei
M    /usr/bin/netcap
M    /usr/bin/netstat
M    /usr/bin/nettle-hash
M    /usr/bin/nettle-lfib-stream
M    /usr/bin/nettle-pbkdf2
M    /usr/bin/networkctl
M    /usr/bin/newgidmap
M    /usr/bin/newgrp
M    /usr/bin/newrole
M    /usr/bin/newuidmap
M    /usr/bin/nice
M    /usr/bin/nl
M    /usr/bin/nohup
M    /usr/bin/nproc
M    /usr/bin/nsenter
M    /usr/bin/numfmt
M    /usr/bin/ocsptool
M    /usr/bin/od
M    /usr/bin/openssl
M    /usr/bin/ostree
M    /usr/bin/passwd
M    /usr/bin/paste
M    /usr/bin/pathchk
M    /usr/bin/pcregrep
M    /usr/bin/pcretest
M    /usr/bin/pgrep
M    /usr/bin/pidof
M    /usr/bin/pinentry-curses
M    /usr/bin/pinentry-tty
M    /usr/bin/ping
M    /usr/bin/pinky
M    /usr/bin/pk-example-frobnicate
M    /usr/bin/pk12util
M    /usr/bin/pkaction
M    /usr/bin/pkcheck
M    /usr/bin/pkcs1-conv
M    /usr/bin/pkexec
M    /usr/bin/pkg-config
M    /usr/bin/pkgdata
M    /usr/bin/pkill
M    /usr/bin/pkttyagent
M    /usr/bin/pmap
M    /usr/bin/portablectl
M    /usr/bin/pr
M    /usr/bin/printenv
M    /usr/bin/printf
M    /usr/bin/prlimit
M    /usr/bin/ps
M    /usr/bin/pscap
M    /usr/bin/psktool
M    /usr/bin/ptx
M    /usr/bin/pwd
M    /usr/bin/pwdx
M    /usr/bin/pwmake
M    /usr/bin/pwscore
M    /usr/bin/pydoc3
M    /usr/bin/python3
M    /usr/bin/readlink
M    /usr/bin/realpath
M    /usr/bin/rename
M    /usr/bin/renice
M    /usr/bin/repo2solv
M    /usr/bin/repomdxml2solv
M    /usr/bin/resolvectl
M    /usr/bin/rev
M    /usr/bin/rm
M    /usr/bin/rmdir
M    /usr/bin/rofiles-fuse
M    /usr/bin/rpcgen
M    /usr/bin/rpm
M    /usr/bin/rpm-ostree
M    /usr/bin/rpm2archive
M    /usr/bin/rpm2cpio
M    /usr/bin/rpmdb
M    /usr/bin/rpmdb2solv
M    /usr/bin/rpmgraph
M    /usr/bin/rpmkeys
M    /usr/bin/rpmmd2solv
M    /usr/bin/rpms2solv
M    /usr/bin/runcon
M    /usr/bin/sclient
M    /usr/bin/scp
M    /usr/bin/script
M    /usr/bin/scriptlive
M    /usr/bin/scriptreplay
M    /usr/bin/secon
M    /usr/bin/sed
M    /usr/bin/seq
M    /usr/bin/setarch
M    /usr/bin/setfattr
M    /usr/bin/setsid
M    /usr/bin/setterm
M    /usr/bin/sexp-conv
M    /usr/bin/sftp
M    /usr/bin/sha1sum
M    /usr/bin/sha224sum
M    /usr/bin/sha256sum
M    /usr/bin/sha384sum
M    /usr/bin/sha512sum
M    /usr/bin/shred
M    /usr/bin/shuf
M    /usr/bin/sim_client
M    /usr/bin/slabtop
M    /usr/bin/sleep
M    /usr/bin/sort
M    /usr/bin/split
M    /usr/bin/srptool
M    /usr/bin/ssh
M    /usr/bin/ssh-add
M    /usr/bin/ssh-agent
M    /usr/bin/ssh-keygen
M    /usr/bin/ssh-keyscan
M    /usr/bin/stat
M    /usr/bin/stdbuf
M    /usr/bin/stty
M    /usr/bin/su
M    /usr/bin/sudo
M    /usr/bin/sudoreplay
M    /usr/bin/sum
M    /usr/bin/sync
M    /usr/bin/systemctl
M    /usr/bin/systemd-analyze
M    /usr/bin/systemd-ask-password
M    /usr/bin/systemd-cat
M    /usr/bin/systemd-cgls
M    /usr/bin/systemd-cgtop
M    /usr/bin/systemd-delta
M    /usr/bin/systemd-detect-virt
M    /usr/bin/systemd-escape
M    /usr/bin/systemd-hwdb
M    /usr/bin/systemd-id128
M    /usr/bin/systemd-inhibit
M    /usr/bin/systemd-machine-id-setup
M    /usr/bin/systemd-mount
M    /usr/bin/systemd-notify
M    /usr/bin/systemd-path
M    /usr/bin/systemd-repart
M    /usr/bin/systemd-run
M    /usr/bin/systemd-socket-activate
M    /usr/bin/systemd-stdio-bridge
M    /usr/bin/systemd-tmpfiles
M    /usr/bin/systemd-tty-ask-password-agent
M    /usr/bin/tabs
M    /usr/bin/tac
M    /usr/bin/tail
M    /usr/bin/taskset
M    /usr/bin/tee
M    /usr/bin/test
M    /usr/bin/testsolv
M    /usr/bin/tic
M    /usr/bin/timedatectl
M    /usr/bin/timeout
M    /usr/bin/tload
M    /usr/bin/toe
M    /usr/bin/top
M    /usr/bin/touch
M    /usr/bin/tput
M    /usr/bin/tr
M    /usr/bin/tracepath
M    /usr/bin/traceroute6
M    /usr/bin/true
M    /usr/bin/truncate
M    /usr/bin/tset
M    /usr/bin/tsort
M    /usr/bin/tty
M    /usr/bin/uconv
M    /usr/bin/udevadm
M    /usr/bin/ul
M    /usr/bin/ulockmgr_server
M    /usr/bin/umount
M    /usr/bin/uname
M    /usr/bin/unexpand
M    /usr/bin/uniq
M    /usr/bin/unlink
M    /usr/bin/unshare
M    /usr/bin/unzck
M    /usr/bin/updateinfoxml2solv
M    /usr/bin/uptime
M    /usr/bin/userdbctl
M    /usr/bin/users
M    /usr/bin/utmpdump
M    /usr/bin/uuclient
M    /usr/bin/uuidgen
M    /usr/bin/uuidparse
M    /usr/bin/vdir
M    /usr/bin/vim
M    /usr/bin/vmhgfs-fuse
M    /usr/bin/vmstat
M    /usr/bin/vmtoolsd
M    /usr/bin/vmware-checkvm
M    /usr/bin/vmware-hgfsclient
M    /usr/bin/vmware-namespace-cmd
M    /usr/bin/vmware-rpctool
M    /usr/bin/vmware-toolbox-cmd
M    /usr/bin/vmware-vgauth-cmd
M    /usr/bin/vmware-vgauth-smoketest
M    /usr/bin/vmware-vmblock-fuse
M    /usr/bin/vmware-xferlogs
M    /usr/bin/w
M    /usr/bin/wall
M    /usr/bin/watch
M    /usr/bin/watchgnupg
M    /usr/bin/wc
M    /usr/bin/wdctl
M    /usr/bin/whereis
M    /usr/bin/which
M    /usr/bin/who
M    /usr/bin/whoami
M    /usr/bin/xargs
M    /usr/bin/xmlcatalog
M    /usr/bin/xmllint
M    /usr/bin/xmlsec1
M    /usr/bin/xmlwf
M    /usr/bin/xsltproc
M    /usr/bin/xz
M    /usr/bin/xzdec
M    /usr/bin/yat2m
M    /usr/bin/yes
M    /usr/bin/zck
M    /usr/bin/zck_delta_size
M    /usr/bin/zck_gen_zdict
M    /usr/bin/zck_read_header
M    /usr/bin/zckdl
M    /usr/bin/zstd
M    /usr/bin/rpm-ostree-server/mkostreerepo
M    /usr/etc/ld.so.cache
M    /usr/etc/photon-release
M    /usr/etc/shadow
M    /usr/etc/sudoers
M    /usr/etc/cloud/cloud.cfg
M    /usr/etc/iproute2/rt_protos
M    /usr/etc/pam.d/vmtoolsd
M    /usr/etc/systemd/journald.conf
M    /usr/etc/systemd/logind.conf
M    /usr/etc/systemd/networkd.conf
M    /usr/etc/systemd/resolved.conf
M    /usr/etc/systemd/system.conf
M    /usr/etc/systemd/user.conf
M    /usr/etc/udev/hwdb.bin
M    /usr/etc/udev/udev.conf
M    /usr/etc/udev/rules.d/99-vmware-hotplug.rules
M    /usr/etc/vmware-tools/tools.conf.example
M    /usr/etc/vmware-tools/vgauth.conf
M    /usr/include/sudo_plugin.h
M    /usr/lib/e2initrd_helper
M    /usr/lib/ld-2.32.so
M    /usr/lib/libBrokenLocale-2.32.so
M    /usr/lib/libDeployPkg.so.0.0.0
M    /usr/lib/libSegFault.so
M    /usr/lib/libacl.so.1.1.2253
M    /usr/lib/libanl-2.32.so
M    /usr/lib/libarchive.so.13.4.3
M    /usr/lib/libasm-0.181.so
M    /usr/lib/libassuan.so.0.8.3
M    /usr/lib/libattr.so.1.1.2448
M    /usr/lib/libaudit.so.1.0.0
M    /usr/lib/libauparse.so.0.0.0
M    /usr/lib/libblkid.so.1.1.0
M    /usr/lib/libbz2.so.1.0.8
M    /usr/lib/libc-2.32.so
M    /usr/lib/libcap-ng.so.0.0.0
M    /usr/lib/libcap.so.2.43
M    /usr/lib/libcom_err.so.2.1
M    /usr/lib/libcord.so.1.4.0
M    /usr/lib/libcrack.so.2.9.0
M    /usr/lib/libcrypt-2.32.so
M    /usr/lib/libcrypto.so.1.1
M    /usr/lib/libcurl.so.4
M    /usr/lib/libdb-5.3.so
M    /usr/lib/libdbus-1.so.3.29.0
M    /usr/lib/libdebuginfod-0.181.so
M    /usr/lib/libdevmapper.so.1.02
M    /usr/lib/libdhcp.a
M    /usr/lib/libdhcpctl.a
M    /usr/lib/libdl-2.32.so
M    /usr/lib/libdnet.1.0.1
M    /usr/lib/libdw-0.181.so
M    /usr/lib/libe2p.so.2.3
M    /usr/lib/libelf-0.181.so
M    /usr/lib/libexpat.so.1.6.11
M    /usr/lib/libexslt.so.0.8.20
M    /usr/lib/libext2fs.so.2.4
M    /usr/lib/libfdisk.so.1.1.0
M    /usr/lib/libffi.so.7.1.0
M    /usr/lib/libfl.so.2.0.0
M    /usr/lib/libformw.so.6.2
M    /usr/lib/libfreebl3.chk
M    /usr/lib/libfreebl3.so
M    /usr/lib/libfreeblpriv3.chk
M    /usr/lib/libfreeblpriv3.so
M    /usr/lib/libfuse.so.2.9.9
M    /usr/lib/libgc.so.1.4.3
M    /usr/lib/libgcc_s.so.1
M    /usr/lib/libgccpp.so.1.4.0
M    /usr/lib/libgcrypt.so.20.2.6
M    /usr/lib/libgdbm.so.6.0.0
M    /usr/lib/libgdbm_compat.so.4.0.0
M    /usr/lib/libgio-2.0.so.0.6600.1
M    /usr/lib/libgirepository-1.0.so.1.0.0
M    /usr/lib/libglib-2.0.so.0.6600.1
M    /usr/lib/libgmodule-2.0.so.0.6600.1
M    /usr/lib/libgmp.so.10.4.0
M    /usr/lib/libgnutls.so.30.28.1
M    /usr/lib/libgnutlsxx.so.28.1.0
M    /usr/lib/libgobject-2.0.so.0.6600.1
M    /usr/lib/libgpg-error.so.0.30.0
M    /usr/lib/libgpgme.so.11.23.0
M    /usr/lib/libgssapi_krb5.so.2.2
M    /usr/lib/libgssrpc.so.4.2
M    /usr/lib/libgthread-2.0.so.0.6600.1
M    /usr/lib/libguestlib.so.0.0.0
M    /usr/lib/libguile-2.0.so.22.8.1
M    /usr/lib/libguilereadline-v-18.so.18.0.0
M    /usr/lib/libhgfs.so.0.0.0
M    /usr/lib/libhistory.so.7.0
M    /usr/lib/libhogweed.so.6.0
M    /usr/lib/libicui18n.so.67.1
M    /usr/lib/libicuio.so.67.1
M    /usr/lib/libicutest.so.67.1
M    /usr/lib/libicutu.so.67.1
M    /usr/lib/libicuuc.so.67.1
M    /usr/lib/libip4tc.so.2.0.0
M    /usr/lib/libip6tc.so.2.0.0
M    /usr/lib/libipq.so.0.0.0
M    /usr/lib/libjson-c.so.5.1.0
M    /usr/lib/libjson-glib-1.0.so.0.600.0
M    /usr/lib/libk5crypto.so.3.1
M    /usr/lib/libkadm5clnt_mit.so.11.0
M    /usr/lib/libkadm5srv_mit.so.11.0
M    /usr/lib/libkdb5.so.9.0
M    /usr/lib/libkmod.so.2.3.5
M    /usr/lib/libkrad.so.0.0
M    /usr/lib/libkrb5.so.3.3
M    /usr/lib/libkrb5support.so.0.1
M    /usr/lib/libksba.so.8.12.0
M    /usr/lib/liblber-2.4.so.2.11.1
M    /usr/lib/libldap-2.4.so.2.11.1
M    /usr/lib/libldap_r-2.4.so.2.11.1
M    /usr/lib/libltdl.so.7.3.1
M    /usr/lib/liblua.so.5.3.4
M    /usr/lib/liblz4.so.1.9.2
M    /usr/lib/liblzma.so.5.2.5
M    /usr/lib/libm-2.32.so
M    /usr/lib/libmagic.so.1.0.0
M    /usr/lib/libmemusage.so
M    /usr/lib/libmenuw.so.6.2
M    /usr/lib/libmetalink.so.3.1.0
M    /usr/lib/libmicrohttpd.so.12.56.0
M    /usr/lib/libmodulemd.so.2
M    /usr/lib/libmount.so.1.1.0
M    /usr/lib/libmozjs-78.so
M    /usr/lib/libmpfr.so.6.1.0
M    /usr/lib/libmspack.so.0.1.0
M    /usr/lib/libmvec-2.32.so
M    /usr/lib/libncursesw.so.6.2
M    /usr/lib/libnettle.so.8.0
M    /usr/lib/libnpth.so.0.1.2
M    /usr/lib/libnsl-2.32.so
M    /usr/lib/libnsl.so.2.0.1
M    /usr/lib/libnspr4.so
M    /usr/lib/libnss3.so
M    /usr/lib/libnss_altfiles.so.2
M    /usr/lib/libnss_compat-2.32.so
M    /usr/lib/libnss_db-2.32.so
M    /usr/lib/libnss_dns-2.32.so
M    /usr/lib/libnss_files-2.32.so
M    /usr/lib/libnss_hesiod-2.32.so
M    /usr/lib/libnss_myhostname.so.2
M    /usr/lib/libnss_mymachines.so.2
M    /usr/lib/libnss_resolve.so.2
M    /usr/lib/libnss_systemd.so.2
M    /usr/lib/libnssckbi-testlib.so
M    /usr/lib/libnssckbi.so
M    /usr/lib/libnssdbm3.chk
M    /usr/lib/libnssdbm3.so
M    /usr/lib/libnsssysinit.so
M    /usr/lib/libnssutil3.so
M    /usr/lib/libomapi.a
M    /usr/lib/libopts.so.25.17.1
M    /usr/lib/libostree-1.so.1.0.0
M    /usr/lib/libpam.so.0.85.1
M    /usr/lib/libpam_misc.so.0.82.1
M    /usr/lib/libpamc.so.0.82.1
M    /usr/lib/libpanelw.so.6.2
M    /usr/lib/libpcre.so.1.2.12
M    /usr/lib/libpcre16.so.0.2.12
M    /usr/lib/libpcre32.so.0.0.12
M    /usr/lib/libpcrecpp.so.0.0.2
M    /usr/lib/libpcreposix.so.0.0.7
M    /usr/lib/libpkcs11testmodule.so
M    /usr/lib/libplc4.so
M    /usr/lib/libplds4.so
M    /usr/lib/libpolkit-agent-1.so.0.0.0
M    /usr/lib/libpolkit-gobject-1.so.0.0.0
M    /usr/lib/libpopt.so.0.0.0
M    /usr/lib/libprocps.so.8.0.2
M    /usr/lib/libpsl.so.5.3.3
M    /usr/lib/libpthread-2.32.so
M    /usr/lib/libpwquality.so.1.0.2
M    /usr/lib/libpython3.so
M    /usr/lib/libreadline.so.7.0
M    /usr/lib/librepo.so.0
M    /usr/lib/libresolv-2.32.so
M    /usr/lib/librpmostree-1.so.1.0.0
M    /usr/lib/librt-2.32.so
M    /usr/lib/libsasl2.so.3.0.0
M    /usr/lib/libseccomp.so.2.5.0
M    /usr/lib/libselinux.so.1
M    /usr/lib/libsemanage.so.1
M    /usr/lib/libsepol.so.1
M    /usr/lib/libsmartcols.so.1.1.0
M    /usr/lib/libsmime3.so
M    /usr/lib/libsoftokn3.chk
M    /usr/lib/libsoftokn3.so
M    /usr/lib/libsolv.so.0
M    /usr/lib/libsolvext.so.0
M    /usr/lib/libsoup-2.4.so.1.11.0
M    /usr/lib/libsoup-gnome-2.4.so.1.11.0
M    /usr/lib/libsqlite3.so.0.8.6
M    /usr/lib/libss.so.2.0
M    /usr/lib/libssh2.so.1.0.1
M    /usr/lib/libssl.so.1.1
M    /usr/lib/libssl3.so
M    /usr/lib/libstdc++.so.6
M    /usr/lib/libsystemd.so.0
M    /usr/lib/libtasn1.so.6.5.6
M    /usr/lib/libthread_db-1.0.so
M    /usr/lib/libtirpc.so.3.0.0
M    /usr/lib/libudev.so.1
M    /usr/lib/libulockmgr.so.1.0.1
M    /usr/lib/libunistring.a
M    /usr/lib/libunistring.so.2.1.0
M    /usr/lib/libutil-2.32.so
M    /usr/lib/libuuid.so.1.3.0
M    /usr/lib/libverto.so.0.0
M    /usr/lib/libvgauth.so.0.0.0
M    /usr/lib/libvmtools.so.0.0.0
M    /usr/lib/libwrap.a
M    /usr/lib/libwrap.so.0.7.6
M    /usr/lib/libxml2.so.2.9.10
M    /usr/lib/libxmlsec1-nss.so.1.2.30
M    /usr/lib/libxmlsec1-openssl.so.1.2.30
M    /usr/lib/libxmlsec1.so.1.2.30
M    /usr/lib/libxslt.so.1.1.34
M    /usr/lib/libxtables.so.12
M    /usr/lib/libyaml-0.so.2.0.9
M    /usr/lib/libz.so.1.2.11
M    /usr/lib/libzck.so.1.1.7
M    /usr/lib/libzstd.so.1.4.5
M    /usr/lib/bash/basename
M    /usr/lib/bash/dirname
M    /usr/lib/bash/fdflags
M    /usr/lib/bash/finfo
M    /usr/lib/bash/head
M    /usr/lib/bash/id
M    /usr/lib/bash/ln
M    /usr/lib/bash/logname
M    /usr/lib/bash/mkdir
M    /usr/lib/bash/mypid
M    /usr/lib/bash/pathchk
M    /usr/lib/bash/print
M    /usr/lib/bash/printenv
M    /usr/lib/bash/push
M    /usr/lib/bash/realpath
M    /usr/lib/bash/rmdir
M    /usr/lib/bash/seq
M    /usr/lib/bash/setpgid
M    /usr/lib/bash/sleep
M    /usr/lib/bash/strftime
M    /usr/lib/bash/sync
M    /usr/lib/bash/tee
M    /usr/lib/bash/truefalse
M    /usr/lib/bash/tty
M    /usr/lib/bash/uname
M    /usr/lib/bash/unlink
M    /usr/lib/bash/whoami
M    /usr/lib/cloud-init/ds-identify
M    /usr/lib/dracut/dracut-install
M    /usr/lib/dracut/dracut-version.sh
M    /usr/lib/dracut/skipcpio
M    /usr/lib/engines-1.1/afalg.so
M    /usr/lib/engines-1.1/capi.so
M    /usr/lib/engines-1.1/padlock.so
M    /usr/lib/gawk/filefuncs.so
M    /usr/lib/gawk/fnmatch.so
M    /usr/lib/gawk/fork.so
M    /usr/lib/gawk/inplace.so
M    /usr/lib/gawk/intdiv.so
M    /usr/lib/gawk/ordchr.so
M    /usr/lib/gawk/readdir.so
M    /usr/lib/gawk/readfile.so
M    /usr/lib/gawk/revoutput.so
M    /usr/lib/gawk/revtwoway.so
M    /usr/lib/gawk/rwarray.so
M    /usr/lib/gawk/time.so
M    /usr/lib/gconv/ANSI_X3.110.so
M    /usr/lib/gconv/ARMSCII-8.so
M    /usr/lib/gconv/ASMO_449.so
M    /usr/lib/gconv/BIG5.so
M    /usr/lib/gconv/BIG5HKSCS.so
M    /usr/lib/gconv/BRF.so
M    /usr/lib/gconv/CP10007.so
M    /usr/lib/gconv/CP1125.so
M    /usr/lib/gconv/CP1250.so
M    /usr/lib/gconv/CP1251.so
M    /usr/lib/gconv/CP1252.so
M    /usr/lib/gconv/CP1253.so
M    /usr/lib/gconv/CP1254.so
M    /usr/lib/gconv/CP1255.so
M    /usr/lib/gconv/CP1256.so
M    /usr/lib/gconv/CP1257.so
M    /usr/lib/gconv/CP1258.so
M    /usr/lib/gconv/CP737.so
M    /usr/lib/gconv/CP770.so
M    /usr/lib/gconv/CP771.so
M    /usr/lib/gconv/CP772.so
M    /usr/lib/gconv/CP773.so
M    /usr/lib/gconv/CP774.so
M    /usr/lib/gconv/CP775.so
M    /usr/lib/gconv/CP932.so
M    /usr/lib/gconv/CSN_369103.so
M    /usr/lib/gconv/CWI.so
M    /usr/lib/gconv/DEC-MCS.so
M    /usr/lib/gconv/EBCDIC-AT-DE-A.so
M    /usr/lib/gconv/EBCDIC-AT-DE.so
M    /usr/lib/gconv/EBCDIC-CA-FR.so
M    /usr/lib/gconv/EBCDIC-DK-NO-A.so
M    /usr/lib/gconv/EBCDIC-DK-NO.so
M    /usr/lib/gconv/EBCDIC-ES-A.so
M    /usr/lib/gconv/EBCDIC-ES-S.so
M    /usr/lib/gconv/EBCDIC-ES.so
M    /usr/lib/gconv/EBCDIC-FI-SE-A.so
M    /usr/lib/gconv/EBCDIC-FI-SE.so
M    /usr/lib/gconv/EBCDIC-FR.so
M    /usr/lib/gconv/EBCDIC-IS-FRISS.so
M    /usr/lib/gconv/EBCDIC-IT.so
M    /usr/lib/gconv/EBCDIC-PT.so
M    /usr/lib/gconv/EBCDIC-UK.so
M    /usr/lib/gconv/EBCDIC-US.so
M    /usr/lib/gconv/ECMA-CYRILLIC.so
M    /usr/lib/gconv/EUC-CN.so
M    /usr/lib/gconv/EUC-JISX0213.so
M    /usr/lib/gconv/EUC-JP-MS.so
M    /usr/lib/gconv/EUC-JP.so
M    /usr/lib/gconv/EUC-KR.so
M    /usr/lib/gconv/EUC-TW.so
M    /usr/lib/gconv/GB18030.so
M    /usr/lib/gconv/GBBIG5.so
M    /usr/lib/gconv/GBGBK.so
M    /usr/lib/gconv/GBK.so
M    /usr/lib/gconv/GEORGIAN-ACADEMY.so
M    /usr/lib/gconv/GEORGIAN-PS.so
M    /usr/lib/gconv/GOST_19768-74.so
M    /usr/lib/gconv/GREEK-CCITT.so
M    /usr/lib/gconv/GREEK7-OLD.so
M    /usr/lib/gconv/GREEK7.so
M    /usr/lib/gconv/HP-GREEK8.so
M    /usr/lib/gconv/HP-ROMAN8.so
M    /usr/lib/gconv/HP-ROMAN9.so
M    /usr/lib/gconv/HP-THAI8.so
M    /usr/lib/gconv/HP-TURKISH8.so
M    /usr/lib/gconv/IBM037.so
M    /usr/lib/gconv/IBM038.so
M    /usr/lib/gconv/IBM1004.so
M    /usr/lib/gconv/IBM1008.so
M    /usr/lib/gconv/IBM1008_420.so
M    /usr/lib/gconv/IBM1025.so
M    /usr/lib/gconv/IBM1026.so
M    /usr/lib/gconv/IBM1046.so
M    /usr/lib/gconv/IBM1047.so
M    /usr/lib/gconv/IBM1097.so
M    /usr/lib/gconv/IBM1112.so
M    /usr/lib/gconv/IBM1122.so
M    /usr/lib/gconv/IBM1123.so
M    /usr/lib/gconv/IBM1124.so
M    /usr/lib/gconv/IBM1129.so
M    /usr/lib/gconv/IBM1130.so
M    /usr/lib/gconv/IBM1132.so
M    /usr/lib/gconv/IBM1133.so
M    /usr/lib/gconv/IBM1137.so
M    /usr/lib/gconv/IBM1140.so
M    /usr/lib/gconv/IBM1141.so
M    /usr/lib/gconv/IBM1142.so
M    /usr/lib/gconv/IBM1143.so
M    /usr/lib/gconv/IBM1144.so
M    /usr/lib/gconv/IBM1145.so
M    /usr/lib/gconv/IBM1146.so
M    /usr/lib/gconv/IBM1147.so
M    /usr/lib/gconv/IBM1148.so
M    /usr/lib/gconv/IBM1149.so
M    /usr/lib/gconv/IBM1153.so
M    /usr/lib/gconv/IBM1154.so
M    /usr/lib/gconv/IBM1155.so
M    /usr/lib/gconv/IBM1156.so
M    /usr/lib/gconv/IBM1157.so
M    /usr/lib/gconv/IBM1158.so
M    /usr/lib/gconv/IBM1160.so
M    /usr/lib/gconv/IBM1161.so
M    /usr/lib/gconv/IBM1162.so
M    /usr/lib/gconv/IBM1163.so
M    /usr/lib/gconv/IBM1164.so
M    /usr/lib/gconv/IBM1166.so
M    /usr/lib/gconv/IBM1167.so
M    /usr/lib/gconv/IBM12712.so
M    /usr/lib/gconv/IBM1364.so
M    /usr/lib/gconv/IBM1371.so
M    /usr/lib/gconv/IBM1388.so
M    /usr/lib/gconv/IBM1390.so
M    /usr/lib/gconv/IBM1399.so
M    /usr/lib/gconv/IBM16804.so
M    /usr/lib/gconv/IBM256.so
M    /usr/lib/gconv/IBM273.so
M    /usr/lib/gconv/IBM274.so
M    /usr/lib/gconv/IBM275.so
M    /usr/lib/gconv/IBM277.so
M    /usr/lib/gconv/IBM278.so
M    /usr/lib/gconv/IBM280.so
M    /usr/lib/gconv/IBM281.so
M    /usr/lib/gconv/IBM284.so
M    /usr/lib/gconv/IBM285.so
M    /usr/lib/gconv/IBM290.so
M    /usr/lib/gconv/IBM297.so
M    /usr/lib/gconv/IBM420.so
M    /usr/lib/gconv/IBM423.so
M    /usr/lib/gconv/IBM424.so
M    /usr/lib/gconv/IBM437.so
M    /usr/lib/gconv/IBM4517.so
M    /usr/lib/gconv/IBM4899.so
M    /usr/lib/gconv/IBM4909.so
M    /usr/lib/gconv/IBM4971.so
M    /usr/lib/gconv/IBM500.so
M    /usr/lib/gconv/IBM5347.so
M    /usr/lib/gconv/IBM803.so
M    /usr/lib/gconv/IBM850.so
M    /usr/lib/gconv/IBM851.so
M    /usr/lib/gconv/IBM852.so
M    /usr/lib/gconv/IBM855.so
M    /usr/lib/gconv/IBM856.so
M    /usr/lib/gconv/IBM857.so
M    /usr/lib/gconv/IBM858.so
M    /usr/lib/gconv/IBM860.so
M    /usr/lib/gconv/IBM861.so
M    /usr/lib/gconv/IBM862.so
M    /usr/lib/gconv/IBM863.so
M    /usr/lib/gconv/IBM864.so
M    /usr/lib/gconv/IBM865.so
M    /usr/lib/gconv/IBM866.so
M    /usr/lib/gconv/IBM866NAV.so
M    /usr/lib/gconv/IBM868.so
M    /usr/lib/gconv/IBM869.so
M    /usr/lib/gconv/IBM870.so
M    /usr/lib/gconv/IBM871.so
M    /usr/lib/gconv/IBM874.so
M    /usr/lib/gconv/IBM875.so
M    /usr/lib/gconv/IBM880.so
M    /usr/lib/gconv/IBM891.so
M    /usr/lib/gconv/IBM901.so
M    /usr/lib/gconv/IBM902.so
M    /usr/lib/gconv/IBM903.so
M    /usr/lib/gconv/IBM9030.so
M    /usr/lib/gconv/IBM904.so
M    /usr/lib/gconv/IBM905.so
M    /usr/lib/gconv/IBM9066.so
M    /usr/lib/gconv/IBM918.so
M    /usr/lib/gconv/IBM921.so
M    /usr/lib/gconv/IBM922.so
M    /usr/lib/gconv/IBM930.so
M    /usr/lib/gconv/IBM932.so
M    /usr/lib/gconv/IBM933.so
M    /usr/lib/gconv/IBM935.so
M    /usr/lib/gconv/IBM937.so
M    /usr/lib/gconv/IBM939.so
M    /usr/lib/gconv/IBM943.so
M    /usr/lib/gconv/IBM9448.so
M    /usr/lib/gconv/IEC_P27-1.so
</code></pre><h2 id=listing-package-differences>Listing package differences</h2><p>We can also look at package differences, as you expect, using the right tool for the job.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# rpm-ostree db diff 820b 965c
ostree diff commit from: 820b (820b584a6f90bf6b9b8cb6aad8c093064b88d0ab686be8130baa03d68917ad88)
ostree diff commit to:   965c (965c1abeb048e1a8ff77e9cd34ffccc5e3356176cda3332b4ff0e7a6c66b661f)
Upgraded:
audit 2.8.5-3.ph4 -&gt; 2.8.5-6.ph4
cloud-init 20.3-2.ph4 -&gt; 20.4.1-1.ph4
cpio 2.13-1.ph4 -&gt; 2.13-3.ph4
curl 7.72.0-2.ph4 -&gt; 7.74.0-1.ph4
curl-libs 7.72.0-2.ph4 -&gt; 7.74.0-1.ph4
cyrus-sasl 2.1.27-3.ph4 -&gt; 2.1.27-4.ph4
dhcp-client 4.4.2-1.ph4 -&gt; 4.4.2-2.ph4
dhcp-libs 4.4.2-1.ph4 -&gt; 4.4.2-2.ph4
dracut 050-5.ph4 -&gt; 050-7.ph4
dracut-tools 050-5.ph4 -&gt; 050-7.ph4
file 5.39-1.ph4 -&gt; 5.39-2.ph4
file-libs 5.39-1.ph4 -&gt; 5.39-2.ph4
gdbm 1.18.1-1.ph4 -&gt; 1.19-1.ph4
glibc 2.32-1.ph4 -&gt; 2.32-2.ph4
glibc-iconv 2.32-1.ph4 -&gt; 2.32-2.ph4
gobject-introspection 1.66.0-1.ph4 -&gt; 1.66.0-3.ph4
grub2-theme 4.0-1.ph4 -&gt; 4.0-2.ph4
grub2-theme-ostree 4.0-1.ph4 -&gt; 4.0-2.ph4
iproute2 5.8.0-1.ph4 -&gt; 5.10.0-1.ph4
iptables 1.8.4-1.ph4 -&gt; 1.8.7-1.ph4
json-c 0.15-2.ph4 -&gt; 0.15-3.ph4
libgcc 8.4.0-1.ph4 -&gt; 10.2.0-1.ph4
libmetalink 0.1.3-2.ph4 -&gt; 0.1.3-3.ph4
libmodulemd 2.9.4-1.ph4 -&gt; 2.11.0-1.ph4
librepo 1.12.1-3.ph4 -&gt; 1.12.1-4.ph4
libsepol 3.1-1.ph4 -&gt; 3.1-2.ph4
libsolv 0.6.35-5.ph4 -&gt; 0.6.35-7.ph4
libssh2 1.9.0-2.ph4 -&gt; 1.9.0-3.ph4
libstdc++ 8.4.0-1.ph4 -&gt; 10.2.0-1.ph4
libxml2 2.9.10-3.ph4 -&gt; 2.9.10-6.ph4
libxml2-devel 2.9.10-3.ph4 -&gt; 2.9.10-6.ph4
libxslt 1.1.34-1.ph4 -&gt; 1.1.34-2.ph4
linux 5.9.0-3.ph4 -&gt; 5.10.4-15.ph4
ncurses 6.2-2.ph4 -&gt; 6.2-3.ph4
ncurses-libs 6.2-2.ph4 -&gt; 6.2-3.ph4
ncurses-terminfo 6.2-2.ph4 -&gt; 6.2-3.ph4
nss 3.57-1.ph4 -&gt; 3.57-2.ph4
nss-libs 3.57-1.ph4 -&gt; 3.57-2.ph4
open-vm-tools 11.1.5-4.ph4 -&gt; 11.2.5-1.ph4
openldap 2.4.53-2.ph4 -&gt; 2.4.53-3.ph4
openssl 1.1.1g-3.ph4 -&gt; 1.1.1i-2.ph4
pcre 8.44-1.ph4 -&gt; 8.44-2.ph4
pcre-libs 8.44-1.ph4 -&gt; 8.44-2.ph4
python3 3.8.6-1.ph4 -&gt; 3.9.1-2.ph4
python3-PyYAML 5.3.1-1.ph4 -&gt; 5.4.1-1.ph4
python3-attrs 20.2.0-2.ph4 -&gt; 20.3.0-2.ph4
python3-cryptography 3.1.1-2.ph4 -&gt; 3.2.1-1.ph4
python3-gobject-introspection 1.66.0-1.ph4 -&gt; 1.66.0-3.ph4
python3-libs 3.8.6-1.ph4 -&gt; 3.9.1-2.ph4
python3-packaging 20.4-2.ph4 -&gt; 20.4-3.ph4
python3-pyrsistent 0.17.3-1.ph4 -&gt; 0.17.3-2.ph4
python3-setuptools 3.8.6-1.ph4 -&gt; 3.9.1-2.ph4
python3-urllib3 1.25.10-2.ph4 -&gt; 1.25.11-1.ph4
python3-xml 3.8.6-1.ph4 -&gt; 3.9.1-2.ph4
rpm 4.14.2-11.ph4 -&gt; 4.16.1.2-1.ph4
rpm-libs 4.14.2-11.ph4 -&gt; 4.16.1.2-1.ph4
rpm-ostree 2020.5-4.ph4 -&gt; 2020.5-5.ph4
shadow 4.8.1-2.ph4 -&gt; 4.8.1-3.ph4
shadow-tools 4.8.1-2.ph4 -&gt; 4.8.1-3.ph4
sudo 1.8.30-2.ph4 -&gt; 1.9.5-1.ph4
systemd 245.5-3.ph4 -&gt; 247.3-1.ph4
util-linux 2.36-1.ph4 -&gt; 2.36-2.ph4
util-linux-libs 2.36-1.ph4 -&gt; 2.36-2.ph4
Added:
libpcap-1.10.0-1.ph4.x86_64
python3-Pygments-2.7.2-2.ph4.noarch
python3-alabaster-0.7.12-1.ph4.noarch
python3-babel-2.8.0-3.ph4.noarch
python3-docutils-0.16-1.ph4.noarch
python3-imagesize-1.2.0-2.ph4.noarch
python3-pytz-2020.4-2.ph4.noarch
python3-snowballstemmer-2.0.0-1.ph4.noarch
python3-sphinx-3.3.0-2.ph4.noarch
python3-sphinxcontrib-applehelp-1.0.2-1.ph4.noarch
python3-sphinxcontrib-devhelp-1.0.2-1.ph4.noarch
python3-sphinxcontrib-htmlhelp-1.0.3-1.ph4.noarch
python3-sphinxcontrib-jsmath-1.0.1-1.ph4.noarch
python3-sphinxcontrib-qthelp-1.0.3-1.ph4.noarch
python3-sphinxcontrib-serializinghtml-1.1.4-1.ph4.noarch
python3-typing-3.7.4.3-1.ph4.noarch
systemd-libs-247.3-1.ph4.x86_64
systemd-pam-247.3-1.ph4.x86_64
systemd-rpm-macros-247.3-1.ph4.noarch
systemd-udev-247.3-1.ph4.x86_64
</code></pre><h2 id=rollback>Rollback</h2><p>If we want to go back to the previous image, we can rollback. The order of the images will be changed, so the old filetree will become the default bootable image. If -r option is passed, the rollback will continue with a reboot.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# rpm-ostree rollback
Moving '965c1abeb048e1a8ff77e9cd34ffccc5e3356176cda3332b4ff0e7a6c66b661f.0' to be first deployment
Transaction complete; bootconfig swap: yes; deployment count change: 0
Upgraded:
  audit 2.8.5-3.ph4 -&gt; 2.8.5-6.ph4
  cloud-init 20.3-2.ph4 -&gt; 20.4.1-1.ph4
  cpio 2.13-1.ph4 -&gt; 2.13-3.ph4
  curl 7.72.0-2.ph4 -&gt; 7.74.0-1.ph4
  curl-libs 7.72.0-2.ph4 -&gt; 7.74.0-1.ph4
  cyrus-sasl 2.1.27-3.ph4 -&gt; 2.1.27-4.ph4
  dhcp-client 4.4.2-1.ph4 -&gt; 4.4.2-2.ph4
  dhcp-libs 4.4.2-1.ph4 -&gt; 4.4.2-2.ph4
  dracut 050-5.ph4 -&gt; 050-7.ph4
  dracut-tools 050-5.ph4 -&gt; 050-7.ph4
  file 5.39-1.ph4 -&gt; 5.39-2.ph4
  file-libs 5.39-1.ph4 -&gt; 5.39-2.ph4
  gdbm 1.18.1-1.ph4 -&gt; 1.19-1.ph4
  glibc 2.32-1.ph4 -&gt; 2.32-2.ph4
  glibc-iconv 2.32-1.ph4 -&gt; 2.32-2.ph4
  gobject-introspection 1.66.0-1.ph4 -&gt; 1.66.0-3.ph4
  grub2-theme 4.0-1.ph4 -&gt; 4.0-2.ph4
  grub2-theme-ostree 4.0-1.ph4 -&gt; 4.0-2.ph4
  iproute2 5.8.0-1.ph4 -&gt; 5.10.0-1.ph4
  iptables 1.8.4-1.ph4 -&gt; 1.8.7-1.ph4
  json-c 0.15-2.ph4 -&gt; 0.15-3.ph4
  libgcc 8.4.0-1.ph4 -&gt; 10.2.0-1.ph4
  libmetalink 0.1.3-2.ph4 -&gt; 0.1.3-3.ph4
  libmodulemd 2.9.4-1.ph4 -&gt; 2.11.0-1.ph4
  librepo 1.12.1-3.ph4 -&gt; 1.12.1-4.ph4
  libsepol 3.1-1.ph4 -&gt; 3.1-2.ph4
  libsolv 0.6.35-5.ph4 -&gt; 0.6.35-7.ph4
  libssh2 1.9.0-2.ph4 -&gt; 1.9.0-3.ph4
  libstdc++ 8.4.0-1.ph4 -&gt; 10.2.0-1.ph4
  libxml2 2.9.10-3.ph4 -&gt; 2.9.10-6.ph4
  libxml2-devel 2.9.10-3.ph4 -&gt; 2.9.10-6.ph4
  libxslt 1.1.34-1.ph4 -&gt; 1.1.34-2.ph4
  linux 5.9.0-3.ph4 -&gt; 5.10.4-15.ph4
  ncurses 6.2-2.ph4 -&gt; 6.2-3.ph4
  ncurses-libs 6.2-2.ph4 -&gt; 6.2-3.ph4
  ncurses-terminfo 6.2-2.ph4 -&gt; 6.2-3.ph4
  nss 3.57-1.ph4 -&gt; 3.57-2.ph4
  nss-libs 3.57-1.ph4 -&gt; 3.57-2.ph4
  open-vm-tools 11.1.5-4.ph4 -&gt; 11.2.5-1.ph4
  openldap 2.4.53-2.ph4 -&gt; 2.4.53-3.ph4
  openssl 1.1.1g-3.ph4 -&gt; 1.1.1i-2.ph4
  pcre 8.44-1.ph4 -&gt; 8.44-2.ph4
  pcre-libs 8.44-1.ph4 -&gt; 8.44-2.ph4
  python3 3.8.6-1.ph4 -&gt; 3.9.1-2.ph4
  python3-PyYAML 5.3.1-1.ph4 -&gt; 5.4.1-1.ph4
  python3-attrs 20.2.0-2.ph4 -&gt; 20.3.0-2.ph4
  python3-cryptography 3.1.1-2.ph4 -&gt; 3.2.1-1.ph4
  python3-gobject-introspection 1.66.0-1.ph4 -&gt; 1.66.0-3.ph4
  python3-libs 3.8.6-1.ph4 -&gt; 3.9.1-2.ph4
  python3-packaging 20.4-2.ph4 -&gt; 20.4-3.ph4
  python3-pyrsistent 0.17.3-1.ph4 -&gt; 0.17.3-2.ph4
  python3-setuptools 3.8.6-1.ph4 -&gt; 3.9.1-2.ph4
  python3-urllib3 1.25.10-2.ph4 -&gt; 1.25.11-1.ph4
  python3-xml 3.8.6-1.ph4 -&gt; 3.9.1-2.ph4
  rpm 4.14.2-11.ph4 -&gt; 4.16.1.2-1.ph4
  rpm-libs 4.14.2-11.ph4 -&gt; 4.16.1.2-1.ph4
  rpm-ostree 2020.5-4.ph4 -&gt; 2020.5-5.ph4
  shadow 4.8.1-2.ph4 -&gt; 4.8.1-3.ph4
  shadow-tools 4.8.1-2.ph4 -&gt; 4.8.1-3.ph4
  sudo 1.8.30-2.ph4 -&gt; 1.9.5-1.ph4
  systemd 245.5-3.ph4 -&gt; 247.3-1.ph4
  util-linux 2.36-1.ph4 -&gt; 2.36-2.ph4
  util-linux-libs 2.36-1.ph4 -&gt; 2.36-2.ph4
Added:
  libpcap-1.10.0-1.ph4.x86_64
  python3-Pygments-2.7.2-2.ph4.noarch
  python3-alabaster-0.7.12-1.ph4.noarch
  python3-babel-2.8.0-3.ph4.noarch
  python3-docutils-0.16-1.ph4.noarch
  python3-imagesize-1.2.0-2.ph4.noarch
  python3-pytz-2020.4-2.ph4.noarch
  python3-snowballstemmer-2.0.0-1.ph4.noarch
  python3-sphinx-3.3.0-2.ph4.noarch
  python3-sphinxcontrib-applehelp-1.0.2-1.ph4.noarch
  python3-sphinxcontrib-devhelp-1.0.2-1.ph4.noarch
  python3-sphinxcontrib-htmlhelp-1.0.3-1.ph4.noarch
  python3-sphinxcontrib-jsmath-1.0.1-1.ph4.noarch
  python3-sphinxcontrib-qthelp-1.0.3-1.ph4.noarch
  python3-sphinxcontrib-serializinghtml-1.1.4-1.ph4.noarch
  python3-typing-3.7.4.3-1.ph4.noarch
  systemd-libs-247.3-1.ph4.x86_64
  systemd-pam-247.3-1.ph4.x86_64
  systemd-rpm-macros-247.3-1.ph4.noarch
  systemd-udev-247.3-1.ph4.x86_64
  Run &quot;systemctl reboot&quot; to start a reboot
</code></pre><p>In fact, we can repeat the rollback operation as many times as we want before reboot. On each execution, it&rsquo;s going to change the order. It will not delete any image.<br>However, an upgrade will keep the current default image and will eliminate the other image, whichever that is. So if Photon installation rolled back to an older build, an upgrade will keep that, eliminate the newer version and will replace it with an even newer version at the next upgrade.</p><p>The boot order moved back to original:</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# rpm-ostree status
State: idle
Deployments:
  ostree://photon:photon/4.0/x86_64/minimal
    Version: 4.0_minimal (2021-02-20T07:15:43Z)
Commit: 965c1abeb048e1a8ff77e9cd34ffccc5e3356176cda3332b4ff0e7a6c66b661f
  Diff: 63 upgraded, 20 added

● ostree://photon:photon/4.0/x86_64/minimal
    Version: 4.0_minimal (2020-11-04T02:21:47Z)
Commit: 820b584a6f90bf6b9b8cb6aad8c093064b88d0ab686be8130baa03d68917ad88
</code></pre><p>The current bootable image path moved also back to the original value:</p><pre><code class=language-console data-lang=console>root@photon-host-def [ ~ ]# ostree admin config-diff --print-current-dir
/ostree/deploy/photon/deploy/47899767bdd4276266383fce13c4a26a51ca0304ae754609283d75f7d8aad36e.0
</code></pre><h2 id=installing-packages>Installing Packages</h2><p>You can add more packages onto the system that are not part of the commit composed on the server.</p><pre><code class=language-console data-lang=console>rpm-ostree install &lt;packages&gt;
</code></pre><p><strong>Example</strong>:</p><pre><code class=language-console data-lang=console>rpm-ostree install https://kojipkgs.fedoraproject.org//packages/wget/1.19.5/5.fc29/x86_64/wget-1.19.5-5.fc29.x86_64.rpm
</code></pre><h2 id=uninstalling-packages>Uninstalling Packages</h2><p>To remove layered packages installed from a repository, use</p><pre><code class=language-console data-lang=console>rpm-ostree uninstall &lt;pkg&gt;
</code></pre><p>To remove layered packages installed from a local package, you must specify the full NEVRA of the package.</p><p>For example:</p><pre><code class=language-console data-lang=console>rpm-ostree uninstall ltrace-0.7.91-16.fc22.x86_64
</code></pre><p>To uninstall a package that is a part of the base layer, use</p><pre><code class=language-console data-lang=console>rpm-ostree override remove &lt;pkg&gt;
</code></pre><p>For example:</p><pre><code class=language-console data-lang=console>rpm-ostree override remove firefox
</code></pre><h2 id=deleting-a-deployed-filetree>Deleting a deployed filetree</h2><p>It is possible to delete a deployed tree. You won&rsquo;t need to do that normally, as upgrading to a new image will delete the old one, but if for some reason deploying failed (loss of power, networking issues), you&rsquo;ll want to delete the partially deployed image.<br>The only supported index is 1. (If multiple bootable images will be supported in the future, a larger than one, zero-based index of the image to delete will be supported).<br>You cannot delete the default bootable filetree, so passing 0 will result in an error.</p><pre><code class=language-console data-lang=console>root@photon-host-def [ ~ ]# ostree admin undeploy -v 1
OT: Using bootloader: OstreeBootloaderGrub2
Transaction complete; bootconfig swap: yes deployment count change: -1
Deleted deployment a31a843985e314a9e70bcf09afe8d59f7351817d9fb743c2b6dab84f20833650

root@photon-host-cus1 [ ~ ]# ostree admin undeploy -v 0
OT: Deployment cf357c0f376decb3bae42326737db7e36bcf3568ab901c33dc57800c3718f07b.0 unlocked=0
error: Cannot undeploy currently booted deployment 0
</code></pre><p>Now, we can see that the newer image is gone, the deployment directory for commit a31a has been removed.</p><pre><code class=language-console data-lang=console>root@photon-host-def [ ~ ]# rpm-ostree status
  State: idle
  AutomaticUpdates: disabled
  Deployments:
  * ostree://photon-2:photon/4.0/x86_64/minimal
      Version: 4.0_minimal (2019-09-18T12:48:03Z)
  Commit: cf357c0f376decb3bae42326737db7e36bcf3568ab901c33dc57800c3718f07b
  
  root@photon-host-cus1 [ ~ ]# ls /ostree/deploy/photon/deploy/
  cf357c0f376decb3bae42326737db7e36bcf3568ab901c33dc57800c3718f07b.0
  cf357c0f376decb3bae42326737db7e36bcf3568ab901c33dc57800c3718f07b.0.origin 
</code></pre><p>However the commit is still there in the OSTree repo.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree log 965c
  commit 965c1abeb048e1a8ff77e9cd34ffccc5e3356176cda3332b4ff0e7a6c66b661f
  ContentChecksum:  9bc85673bd8d5599d61a02a99accce9bc9b72612c7a3cebd35427875f6514288
  Date:  2021-02-20 07:15:43 +0000
  Version: 4.0_minimal
  (no subject)
</code></pre><p>But there is nothing to rollback to.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# rpm-ostree rollback
Moving '820b584a6f90bf6b9b8cb6aad8c093064b88d0ab686be8130baa03d68917ad88.0' to be first deployment
Transaction complete; bootconfig swap: yes; deployment count change: 0
Run &quot;systemctl reboot&quot; to start a reboot
</code></pre><p>If we were to upgrade again, it would bring these packages back, but let&rsquo;s just check the differeneces.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# rpm-ostree upgrade --check-diff
  ⠚ Receiving metadata objects: 0/(estimating) -/s 0 bytes... 
  Receiving metadata objects: 0/(estimating) -/s 0 bytes... done
  No updates available.
</code></pre><h2 id=version-skipping-upgrade>Version skipping upgrade</h2><p>Let&rsquo;s assume that after a while, VMware releases version 2 that removes <strong>sudo</strong> and adds <strong>bison</strong> and <strong>tar</strong>. Now, an upgrade will skip version 1 and go directly to 2. Let&rsquo;s first look at what packages are pulled (notice sudo missing, as expected), then upgrade with reboot option.</p><pre><code class=language-console data-lang=console>root@photon-host-def [ ~ ]# rpm-ostree upgrade --check-diff
Updating from: photon:photon/4.0/x86_64/minimal

7 metadata, 13 content objects fetched; 1287 KiB transferred in 0 seconds
+bison-3.0.2-2.ph1.x86_64
+gawk-4.1.0-2.ph1.x86_64
+tar-1.27.1-1.ph1.x86_64
+wget-1.15-1.ph1.x86_64

root@photon-7c2d910d79e9 [ ~ ]# rpm-ostree upgrade -r
⠒ Receiving metadata objects: 0/(estimating) -/s 0 bytes... 
Receiving metadata objects: 0/(estimating) -/s 0 bytes... done
No upgrade available.
</code></pre><p>After reboot, let&rsquo;s check the booting filetrees, the current dir for the current filetree and look at commit differences:</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# rpm-ostree status
State: idle
Deployments:
● ostree://photon:photon/4.0/x86_64/minimal
    Version: 4.0_minimal (2020-11-04T02:21:47Z)
Commit: 820b584a6f90bf6b9b8cb6aad8c093064b88d0ab686be8130baa03d68917ad88

  ostree://photon:photon/4.0/x86_64/minimal
    Version: 4.0_minimal (2021-02-20T07:15:43Z)
Commit: 965c1abeb048e1a8ff77e9cd34ffccc5e3356176cda3332b4ff0e7a6c66b661f


root@photon-7c2d910d79e9 [ ~ ]# ostree admin config-diff --print-current-dir
/ostree/deploy/photon/deploy/820b584a6f90bf6b9b8cb6aad8c093064b88d0ab686be8130baa03d68917ad88.0


root@photon-host-cus1 [ ~ ]# rpm-ostree db diff  8b4b e663
ostree diff commit old: rollback deployment (8b4b9d4ec033d1eb816711bfdda595d1013fecbe5cd340f6a619cdc9d83a3bf2)
ostree diff commit new: booted deployment (e663b2872efa01d80e4c34c823431472beb653373af32de83c7d2480316b8a6a)

root@photon-host-cus1 [ ~ ]# rpm-ostree db diff  82bc 092e
error: Refspec '82bc' not found
Interesting fact: The metadata for commit 82bc has been removed from the local repo.
</code></pre><h2 id=tracking-parent-commits>Tracking parent commits</h2><p>OSTree will display limited commit history - maximum 2 levels, so if you want to traverse the history even though it may not find a commitment by its ID, you can refer to its parent using &lsquo;^&rsquo; suffix, grandfather via &lsquo;^^&rsquo; and so on. We know that 82bc is the parent of 092e:</p><pre><code class=language-console data-lang=console>root@photon-host-def [ ~ ]# rpm-ostree db diff  092e^ 092e
  error: No such metadata object 82bca728eadb7292d568404484ad6889c3f6303600ca8c743a4336e0a10b3817.commit
  error: Refspec '82cb' not found
  root@photon-host-def [ ~ ]# rpm-ostree db diff  092e^^ 092e
  error: No such metadata object 82bca728eadb7292d568404484ad6889c3f6303600ca8c743a4336e0a10b3817.commit
</code></pre><p>So commit 092e knows who its parent is, but its metadata is no longer in the local repo, so it cannot traverse further to its parent to find an existing grandfather.</p><h2 id=resetting-a-branch-to-a-previous-commit>Resetting a branch to a previous commit</h2><p>We can reset the head of a branch in a local repo to a previous commit, for example corresponding to version 0 (3.0_minimal).</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree reset photon:photon/4.0/x86_64/minimal 965c
</code></pre><p>Now if we look again at the branch commit history, the head is at version 0.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree log photon/4.0/x86_64/minimal
commit 965c1abeb048e1a8ff77e9cd34ffccc5e3356176cda3332b4ff0e7a6c66b661f
ContentChecksum:  9bc85673bd8d5599d61a02a99accce9bc9b72612c7a3cebd35427875f6514288
Date:  2021-02-20 07:15:43 +0000
Version: 4.0_minimal
(no subject)
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-9a48799a4bec43b263b76904358449d1>5.13.6 - Creating a Server</h1><p>Photon OS 4.0 includes a <code>rpm-ostree-repo</code> package that can be installed on a VM.</p><p>This package provides an automated script that creates a repo tree that acts as a server.</p><p>Run the following commands to create a server:</p><pre><code class=language-console data-lang=console>tdnf install rpm-ostree-repo
</code></pre><p>A script is created, which provides options to create a server.</p><p>Script to create a Photon OSTree repo
Usage:<pre><code class=language-console data-lang=console>/usr/bin/rpm-ostree-server/mkostreerepo -r=&lt;repo path&gt; 
/usr/bin/rpm-ostree-server/mkostreerepo -r=&lt;repo path&gt; -p=&lt;json treefile&gt;
/usr/bin/rpm-ostree-server/mkostreerepo -c -r=&lt;repo path&gt; -p=&lt;json treefile&gt;
-r|--repopath   &lt;Provide repo path&gt; 
-p|--jsonfile   &lt;Provide Json file&gt; 
-c|--customrepo &lt;Provide custom repo file inside repo path directory&gt;
</code></pre><p><strong>Note</strong></p><ul><li>Use <code>PATH=$PATH:/usr/bin/rpm-ostree-server</code> and then use <code>mkostreerepo</code> from any directory for ease of use.</li><li><code>mkostreerepo</code> is used to create the fresh tree for ostree.</li><li><code>mkostreerepo</code> is also used to update a new commit to the existing tree.</li><li>You can also use custom repo as to create/append the tree.</li></ul><p>Run the following command to initiate the script, choose different help options to create a server.</p><pre><code class=language-console data-lang=console>mkostreerepo
</code></pre><h2 id=manually-composing-your-ostree-repo>Manually Composing your OSTree repo</h2><p>Use the following commands to initialize a new repo and to compose it.</p><pre><code class=language-console data-lang=console>root [ ~ ]# cd /srv/rpm-ostree
root [ /srv/rpm-ostree ]# ostree --repo=repo init --mode=archive-z2
root [ /srv/rpm-ostree ]# rpm-ostree compose tree --repo=repo photon-base.json
</code></pre><p>You can now deploy a host. For more information, see <a href=../../docs/administration-guide/photon-rpm-ostree/file-oriented-server-operations>File oriented server operations</a> and <a href=../../docs/administration-guide/photon-rpm-ostree/package-oriented-server-operations/>Package oriented server operations</a> to learn how to create your own customized file tree.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-51d1d7888a9d42c1f88448d4c263a998>5.13.7 - Installing a Photon RPM-OStree host against a custom server repository</h1><p>Organizations that maintain their own OSTree servers create custom image trees suited to their needs from which hosts can be deployed and upgraded. One single server may make available several branches to install, for example &ldquo;base&rdquo;, &ldquo;minimal&rdquo; and &ldquo;full&rdquo;. Or, if you think in terms of Windows OS SKUs - &ldquo;Home&rdquo;, &ldquo;Professional&rdquo; or &ldquo;Enterprise&rdquo; edition.</p><p>So in fact there are two pieces of information the OSTree host installer needs - the server URL and the branch ref. Also, there are two ways to pass this info - manually via keyboard, when prompted and automated, by reading from a config file.</p><h2 id=manual-install-of-a-custom-host>Manual install of a custom host</h2><p>Installing a Photon RPM-OSTree host that will pull from a server repository of your choice is very similar to the way we installed the host against the default server repo in <a href=../../docs/administration-guide/photon-rpm-ostree/installing-a-host-against-default-server-repository/>this document</a>.</p><p>We will follow the same steps, selecting &ldquo;Photon OSTree Host&rdquo;, and after assigning a host name like <strong>photon-host</strong> and a root password, this time we will click on &ldquo;Custom RPM-OSTree Server&rdquo;.</p><p><img src=../../docs/images/rpmostree-custom.png alt=PhotonHostCustom></p><p>An additional screen will ask for the URL of server repo - just enter the IP address or fully qualified domain name of the <a href=../../docs/administration-guide/photon-rpm-ostree/creating-a-rpm-ostree-server/>server installed in the previous step</a>.</p><p><img src=../../docs/images/rpmostree-url.png alt=PhotonHostCustomURL></p><p>Once this is done and the installation finished, reboot and you are ready to use it.
You may verify - just like in <a href=../../docs/administration-guide/photon-rpm-ostree/concepts-in-action/#querying-the-deployed-filetrees>this document</a> - that you can get an rpm-ostree status. The value for the CommitID should be identical to the <a href=../../docs/administration-guide/photon-rpm-ostree/installing-a-host-against-default-server-repository/>host that installed from default repo</a>, if the <a href=../../docs/administration-guide/photon-rpm-ostree/creating-a-rpm-ostree-server/>server</a> has been installed fresh, from the same ISO.</p><h2 id=automated-install-of-a-custom-host-via-kickstart>Automated install of a custom host via kickstart</h2><p>Photon supports automated install that will not interact with the user, in other words installer will display its progress, but will not prompt for any keys to be clicked, and will boot at the end of installation.</p><p>If not familiar with the way kickstart works, visit <a href=../../docs/user-guide/working-with-kickstart/>Kickstart Support in Photon OS</a>. The kickstart json config for OSTree is similar to minimal or full, except for these settings that should sound familiar:</p><pre><code>    ...
    &quot;type&quot;: &quot;ostree_host&quot;,
    &quot;ostree_repo_url&quot;: &quot;http://192.168.218.249&quot;,
    &quot;ostree_repo_ref&quot;: &quot;photon/4.0/x86_64/minimal&quot;,
    ...
</code></pre><p>Or, for default installation</p><pre><code>    ....
    &quot;type&quot;: &quot;ostree_host&quot;,
    &quot;default_repo&quot;: true,
    ....
</code></pre><p>If the server is a future version of Photon OS, say Photon OS 5.0, and the administrator composed trees for the included json files, the ostree_repo_ref will take either value: <strong>photon/5.0/x86_64/base</strong>, <strong>photon/5.0/x86_64/minimal</strong>, or <strong>photon/5.0/x86_64/full</strong>.</p><p>In most situations, kickstart file is accessed via http from PXE boot. That enables booting from network and end to end install of hosts from pre-defined server URL and branch without assistance from user.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-d4ceeae3e03f91651df3a54320340a53>5.13.8 - Automatic Updates</h1><p>Automatic updates are disabled by default.</p><p>To verify this, run the status command.</p><pre><code>root@photon-7c2d910d79e9 [ ~ ]# rpm-ostree status 
State: idle
Deployments:
● ostree://photon:photon/4.0/x86_64/minimal
   Version: 4.0_minimal (2021-02-20T07:15:43Z)
Commit: 965c1abeb048e1a8ff77e9cd34ffccc5e3356176cda3332b4ff0e7a6c66b661f
</code></pre><h2 id=enable-automatic-updates>Enable Automatic Updates</h2><ol><li>Run the following command:</li></ol><pre><code>$ systemctl restart rpm-ostreed
</code></pre><ol><li><p>To enable automatic background updates, edit the <code>/etc/rpm-ostreed.conf</code>, and include the below lines in the <code>Daemon</code> section:</p><pre><code>[Daemon]
AutomaticUpdatePolicy=stage
#IdleExitTimeout=60
</code></pre></li><li><p>Run the following commands:</p><pre><code>$ systemctl reload rpm-ostreed
$ systemctl enable rpm-ostree-automatic.timer --now  
$ systemctl restart rpm-ostree-automatic
</code></pre></li><li><p>Verify that the automatic update feature has been enabled:</p><pre><code>$ rpm-ostree status -v 
      State: idle

      AutomaticUpdates: stage; rpm-ostreed-automatic.timer: last run 16min ago
</code></pre></li><li><p>On the server machine, perform another commit on the base tree.</p></li></ol><p>Automatic updates are now enabled and will automatically update the host system.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b7d11860a5b7ce11ea16ac719d59deb4>5.13.9 - File Oriented Server Operations</h1><p>In this section, we will checkout a filetree into a writable directory structure on disk, make several file changes and commit the changes back into the repository. Then we will download this commit and apply at the host. As you may have guessed, this chapter is mostly about OSTree - the base technology. I&rsquo;ve not mentioned anything about packages, although it is quite possible to install packages (afler all, packages are made of files, right?) and commit without the help of rpm-ostree, but it&rsquo;s too much of a headache and not worth the effort, since rpm-ostree does it simpler and better.</p><p>When would you want to do that? When you want for all your hosts to get an application or configuration customization that is not encapsulated as part of a package upgrade.</p><h2 id=starting-a-fresh-ostree-repo>Starting a fresh OSTree repo</h2><p>If you want to start fresh with your own branch and/or versioning scheme, you can delete the OSTree repo created during the Photon 3.0 RPM-OSTree server install and re-create it empty.</p><pre><code>root [ /srv/rpm-ostree ]# rm -rf repo/*

root [ /srv/rpm-ostree ]# ostree --repo=repo init --mode=archive-z2

root [ /srv/rpm-ostree ]# ls repo
config  objects  refs  state  tmp  uncompressed-objects-cache

root [ /srv/rpm-ostree ]# cat repo/config
[core]
repo_version=1
mode=archive-z2
</code></pre><h2 id=creating-summary-metadata>Creating summary metadata</h2><p>A newer ostree feature, available in Photon OS 2.0 and higher, allows the OSTree server admin to create server summary metadata, that includes among other things the list of available branches and the list of static deltas, so they could be discovered by hosts. To create a summary, run this command after you committed for your branches:</p><pre><code>root [ /srv/rpm-ostree ]# ostree summary -u &quot;This is BigData's OSTree server, it has three branches&quot;
</code></pre><p>We will find out later how the <a href=../remotes/#list-available-branches>hosts query for branches list</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-80a9484e4b01a64f6235e211efb26409>5.13.10 - Package Oriented Server Operations</h1><p>Now that we have a Photon RPM-OSTree server up and running (if not, see how to <a href=../creating-a-rpm-ostree-server/>install</a>), we will learn how to provide the desired set of packages as input and instruct rpm-ostree to compose a filetree, that will result in creation (or update) of an OSTree repo.<br>The simplest way to explain is to take a look at the files installed by the Photon RPM-OSTree server during setup.</p><pre><code class=language-console data-lang=console>root [ ~ ]# cd /srv/rpm-ostree/
root [ /srv/rpm-ostree ]# ls -l
total 16
-rw-r--r-- 1 root root 7356 Aug 28 19:06 ostree-httpd.conf
-rw-r--r-- 1 root root 1085 Aug 28 19:06 photon-base.json
lrwxrwxrwx 1 root root   35 Aug 28 19:06 photon-extras-ostree.repo -&gt; /etc/yum.repos.d/photon-extras.repo
lrwxrwxrwx 1 root root   32 Aug 28 19:06 photon-iso-ostree.repo -&gt; /etc/yum.repos.d/photon-iso.repo
lrwxrwxrwx 1 root root   28 Aug 28 19:06 photon-ostree.repo -&gt; /etc/yum.repos.d/photon.repo
lrwxrwxrwx 1 root root   36 Aug 28 19:06 photon-updates-ostree.repo -&gt; /etc/yum.repos.d/photon-updates.repo
drwxr-xr-x 7 root root 4096 Aug 20 22:27 repo
</code></pre><h2 id=json-configuration-file>JSON configuration file</h2><p>How can we tell rpm-ostree what packages we want to include, where to get them from and how to compose the filetree? There is JSON file for that. Let&rsquo;s take a look at photon-base.json used by the Photon OS team.</p><pre><code class=language-console data-lang=console>root [ /srv/rpm-ostree ]# cat photon-base.json
</code></pre><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>&#34;comment&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Photon Minimal OSTree&#34;</span><span style=color:#000;font-weight:700>,</span>

    <span style=color:#204a87;font-weight:700>&#34;osname&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;photon&#34;</span><span style=color:#000;font-weight:700>,</span>

    <span style=color:#204a87;font-weight:700>&#34;ref&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;photon/4.0/x86_64/minimal&#34;</span><span style=color:#000;font-weight:700>,</span>

    <span style=color:#204a87;font-weight:700>&#34;automatic_version_prefix&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;4.0_minimal&#34;</span><span style=color:#000;font-weight:700>,</span>

    <span style=color:#204a87;font-weight:700>&#34;repos&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;photon&#34;</span><span style=color:#000;font-weight:700>],</span>

    <span style=color:#204a87;font-weight:700>&#34;selinux&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span>

    <span style=color:#204a87;font-weight:700>&#34;initramfs-args&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;--no-hostonly&#34;</span><span style=color:#000;font-weight:700>],</span>

    <span style=color:#204a87;font-weight:700>&#34;bootstrap_packages&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;filesystem&#34;</span><span style=color:#000;font-weight:700>],</span>

    <span style=color:#204a87;font-weight:700>&#34;documentation&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span>

    <span style=color:#204a87;font-weight:700>&#34;packages&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;glibc&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;zlib&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;binutils&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;gmp&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;mpfr&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;libgcc&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;libstdc++&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;libgomp&#34;</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#4e9a06>&#34;pkg-config&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;ncurses&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;bash&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;bzip2&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;cracklib&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;cracklib-dicts&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;shadow&#34;</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#4e9a06>&#34;procps-ng&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;iana-etc&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;readline&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;coreutils&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;bc&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;libtool&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;net-tools&#34;</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#4e9a06>&#34;findutils&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;xz&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;grub2&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;grub2-pc&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;grub2-efi&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;iproute2&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;util-linux&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;linux&#34;</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#4e9a06>&#34;attr&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;libcap&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;kmod&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;expat&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;dbus&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;file&#34;</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#4e9a06>&#34;sed&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;grep&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;cpio&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;gzip&#34;</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#4e9a06>&#34;openssl&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;ca-certificates&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;curl&#34;</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#4e9a06>&#34;systemd&#34;</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#4e9a06>&#34;openssh&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;iptables&#34;</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#4e9a06>&#34;photon-release&#34;</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#4e9a06>&#34;vim&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;photon-repos&#34;</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#4e9a06>&#34;docker&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;bridge-utils&#34;</span><span style=color:#000;font-weight:700>,</span>
                <span style=color:#4e9a06>&#34;dracut&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;dracut-tools&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;rpm-ostree&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;nss-altfiles&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;which&#34;</span><span style=color:#000;font-weight:700>]</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>There are some mandatory settings, some optional. I&rsquo;m only going to explain the most important ones for our use case.
<strong>osname</strong> and <strong>ref</strong> should be familiar, they have been explained in previous sections <a href=../concepts-in-action/#osname>OSname</a> and <a href=../concepts-in-action#refspec>Refspec</a>. Basicaly, we are asking <code>rpm-ostree</code> to compose a tree for photon OS and photon/3.0/x86_64/minimal branch.</p><p>For more information, see the <a href=https://coreos.github.io/rpm-ostree/treefile/>OS Tree Documentation</a>.</p><h2 id=package-addition-removal-upgrade>Package addition, removal, upgrade</h2><p><strong>packages</strong> is the list of packages that are to be added, in this case, in the &ldquo;minimal&rdquo; installation profile, on top of the packages already included by default. This is not quite the identical set of RPMS you get when you select the minimal profile in the ISO installer, but it&rsquo;s pretty close and that&rsquo;s why it&rsquo;s been named the same.
Let&rsquo;s add to the list three new packages: gawk, sudo and wget using <code>vim photon-base.json</code></p><p><strong>!!!Warning: do not remove any packages from the default list, even an &ldquo;innocent&rdquo; one, as it may bring the system to an unstable condition. During my testing, I&rsquo;ve removed &ldquo;which&rdquo;; it turns out it was used to figure out the grub booting roots: on reboot, the system was left hanging at grub prompt.</strong></p><h2 id=rpms-repository>RPMS repository</h2><p>But where are these packages located? RPM-OStree uses the same standard RPMS repositories, that yum installs from.</p><pre><code class=language-console data-lang=console>root [ /srv/rpm-ostree ]# ls /etc/yum.repos.d/
photon-debuginfo.repo  photon-extras.repo  photon-iso.repo  photon-updates.repo  photon.repo
</code></pre><p>Going back to our JSON file, <strong>repos</strong> is a multi-value setting that tells RPM-OSTree in what RPMS repositories to look for packages. In this case, it looks in the current directory for a &ldquo;photon&rdquo; repo configuration file, that is a .repo file starting with a <code>[photon]</code> section. There is such a file: <strong>photon-ostree.repo</strong>, that is in fact a link to <strong>photon.repo</strong> in /etc/yum.repos.d directory.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#c4a000>root [ /srv/rpm-ostree ]# cat /etc/yum.repos.d/photon.repo </span>
<span style=color:#204a87;font-weight:700>[photon]</span>
<span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>VMware Photon Linux 4.0(x86_64)</span>
<span style=color:#c4a000>baseurl</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>https://packages.vmware.com/photon/4.0/photon_release_$releasever_$basearch</span>
<span style=color:#c4a000>gpgkey</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>file:///etc/pki/rpm-gpg/VMWARE-RPM-GPG-KEY</span>
<span style=color:#c4a000>gpgcheck</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>1</span>
<span style=color:#c4a000>enabled</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>1</span>
<span style=color:#c4a000>skip_if_unavailable</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>True</span>
</code></pre></div><p>In this case, <code>rpm-ostree</code> is instructed to download its packages in RPM format from the VMware Photon Packgaes URL, which is the location of an online RPMS repo maintained by the VMware Photon OS team. To ensure those packages can be validated as being genuine and signed by VMware, the signature is checked against the official VMware public key.</p><p>So what&rsquo;s in an RPMS repository? If we point the browser to <a href=https://packages.vmware.com/photon/photon_publish_rpms/>packages.vmware.com/photon/photon_publish_rpms/</a>, we can see there are three top directories:</p><ul><li>noarch - where all packages that don&rsquo;t depend on the architecture reside. Those may contain scripts, platform neutral source files, configuration.</li><li>x86_64 - platform dependent packages for Intel 32 and 64 bits CPUs.</li><li>repodata - internal repo management data, like a catalog of all packages, and for every package its name, id, version, architecture and full path file/directory list. There is also a compressed XML file containing the history of changelogs extracted from github, as packages in RPM format were built by Photon OS team members from sources.</li></ul><p>Fortunately, in order to compose a tree, you don&rsquo;t need to download the packages from the online repository (which is time consuming - in the order of minutes), unless there are some new ones or updated versions of them, added by the Photon team after shipping 1.0 version or the 1.0 Refresh. A copy of the starter RPMS repository (as of 1.0 shipping date) has been included on the CD-ROM and you can access it.</p><pre><code class=language-console data-lang=console>root [ /srv/rpm-ostree ]# mount /dev/cdrom
root [ /srv/rpm-ostree ]# ls /mnt/cdrom/RPMS
noarch  repodata  x86_64
</code></pre><p>All you have to do now is to replace the <code>"repos": ["photon"]</code> entry by <code>"repos": ["photon-iso"]</code>, which will point to the RPMS repo on CD-ROM, rather than the online repo. This way, composing saves time, bandwidth and reduces to zero the risk of failure because of a networking issue.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#c4a000>root [ /srv/rpm-ostree ]# cat /etc/yum.repos.d/photon-iso.repo</span>
<span style=color:#204a87;font-weight:700>[photon-iso]</span>
<span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>VMWare Photon Linux ISO 4.0(x86_64)</span>
<span style=color:#c4a000>baseurl</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>file:///mnt/cdrom/RPMS</span>
<span style=color:#c4a000>gpgkey</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>file:///etc/pki/rpm-gpg/VMWARE-RPM-GPG-KEY</span>
<span style=color:#c4a000>gpgcheck</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>1</span>
<span style=color:#c4a000>enabled</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>0</span>
<span style=color:#c4a000>skip_if_unavailable</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>True</span>
</code></pre></div><p>There are already in current directory links created to all repositories in /etc/yum.repos.d, so they are found when tree compose command is invoked. You may add any other repo to the list and include packages found in that repo to be part of the image.</p><h2 id=composing-a-tree>Composing a tree</h2><p>After so much preparation, we can execute a tree compose. We have only added 3 new packages and changed the RPMS repo source. Assuming that the JSON file is editted, run the following:</p><pre><code class=language-console data-lang=console>root [ /srv/rpm-ostree ]# rpm-ostree compose tree --repo=repo photon-base.json
Previous commit: 2940e10c4d90ce6da572cbaeeff7b511cab4a64c280bd5969333dd2fca57cfa8

Downloading metadata [=========================================================================] 100%

Transaction: 117 packages
  Linux-PAM-1.1.8-2.ph3.x86_64
  attr-2.4.47-1.ph3.x86_64
  ...
  gawk-4.1.0-2.ph3.x86_64
  ...
  sudo-1.8.11p1-4.ph3.x86_64
  ...
  wget-1.15-1.ph3.x86_64
  which-2.20-1.ph3.x86_64
  xz-5.0.5-2.ph3.x86_64
  zlib-1.2.8-2.ph3.x86_64
Installing packages [==========================================================================] 100%
Writing '/var/tmp/rpm-ostree.TVO089/rootfs.tmp/usr/share/rpm-ostree/treefile.json'
Preparing kernel
Creating empty machine-id
Executing: /usr/bin/dracut -v --tmpdir=/tmp -f /var/tmp/initramfs.img 4.0.9 --no-hostonly
...
*** Including module: bash ***
*** Including module: kernel-modules ***
*** Including module: resume ***
*** Including module: rootfs-block ***
*** Including module: terminfo ***
*** Including module: udev-rules ***
Skipping udev rule: 91-permissions.rules
Skipping udev rule: 80-drivers-modprobe.rules
*** Including module: ostree ***
*** Including module: systemd ***
*** Including module: usrmount ***
*** Including module: base ***
/etc/os-release: line 1: Photon: command not found
*** Including module: fs-lib ***
*** Including module: shutdown ***
*** Including modules done ***
*** Installing kernel module dependencies and firmware ***
*** Installing kernel module dependencies and firmware done ***
*** Resolving executable dependencies ***
*** Resolving executable dependencies done***
*** Stripping files ***
*** Stripping files done ***
*** Store current command line parameters ***
*** Creating image file ***
*** Creating image file done ***
Image: /var/tmp/initramfs.img: 11M
========================================================================
Version: dracut-041-1.ph3

Arguments: -v --tmpdir '/tmp' -f --no-hostonly

dracut modules:
bash
kernel-modules
resume
rootfs-block
terminfo
udev-rules
ostree
systemd
usrmount
base
fs-lib
shutdown
========================================================================
drwxr-xr-x  12 root     root            0 Sep  1 00:52 .
crw-r--r--   1 root     root       5,   1 Sep  1 00:52 dev/console
crw-r--r--   1 root     root       1,  11 Sep  1 00:52 dev/kmsg
...   (long list of files removed)
========================================================================
Initializing rootfs
Migrating /etc/passwd to /usr/lib/
Migrating /etc/group to /usr/lib/
Moving /usr to target
Linking /usr/local -&gt; ../var/usrlocal
Moving /etc to /usr/etc
Placing RPM db in /usr/share/rpm
Ignoring non-directory/non-symlink '/var/tmp/rpm-ostree.TVO089/rootfs.tmp/var/lib/nss_db/Makefile'
Ignoring non-directory/non-symlink '/var/tmp/rpm-ostree.TVO089/rootfs.tmp/var/cache/ldconfig/aux-cache'
Ignoring non-directory/non-symlink '/var/tmp/rpm-ostree.TVO089/rootfs.tmp/var/log/btmp'
Ignoring non-directory/non-symlink '/var/tmp/rpm-ostree.TVO089/rootfs.tmp/var/log/lastlog'
Ignoring non-directory/non-symlink '/var/tmp/rpm-ostree.TVO089/rootfs.tmp/var/log/wtmp'
Moving /boot
Using boot location: both
Copying toplevel compat symlinks
Adding tmpfiles-ostree-integration.conf
Committing '/var/tmp/rpm-ostree.TVO089/rootfs.tmp' ...
photon/1.0/x86_64/minimal =&gt; c505f4bddb4381e8b5213682465f1e5bb150a18228aa207d763cea45c6a81bbe
</code></pre><p>We&rsquo;ve omitted a large portion of the logging output, however you can see that the new filetree adds to the top of the previous (initial) commit <strong>2940e10c4d</strong> and produces a new commit <strong>c505f4bddb</strong>. Our packages <code>gawk-4.1.0-2.ph3.x86_64</code>, <code>sudo-1.8.11p1-4.ph3.x86_64</code> and <code>wget-1.15-1.ph3.x86_64</code> have been added.</p><p>During compose, <code>rpm-ostree</code> checks out the file tree into its uncompressed form, applies the package changes, places the updated RPM repo into /usr/share/rpm and calls <code>ostree</code> to commit its changes back into the OSTree repo. If we were to look at the temp directory during this time:</p><pre><code class=language-console data-lang=console>root [ /srv/rpm-ostree ]# ls /var/tmp/rpm-ostree.TVO089/rootfs.tmp
bin   dev   lib    media  opt     proc  run   srv  sysroot  usr
boot  home  lib64  mnt    ostree  root  sbin  sys  tmp      var
</code></pre><p>If we repeat the command, and there is no change in the JSON file settings and no change in metadata, rpm-ostree will figure out that nothing has changed and stop. You can force however to redo the whole composition.</p><pre><code class=language-console data-lang=console>root [ /srv/rpm-ostree ]# rpm-ostree compose tree --repo=repo photon-base.json
Previous commit: c505f4bddb4381e8b5213682465f1e5bb150a18228aa207d763cea45c6a81bbe

Downloading metadata [=========================================================================] 100%


No apparent changes since previous commit; use --force-nocache to override
</code></pre><p>This takes several minutes. Then why is the RPM-OSTree server installing so fast, in 45 seconds on my SSD? The server doesn&rsquo;t compose the tree, it uses a pre-created OSTree repo that is stored on the CD-ROM. It comes of course at the expense of larger CD-ROM size. This OSTree repo is created from the same set of RPMS on the CD-ROM, so if you compose fresh, you will get the same exact tree, with same commit ID for the &ldquo;minimal&rdquo; ref.</p><h2 id=automatic-version-prefix>Automatic version prefix</h2><p>If you recall the filetree version explained earlier, this is where it comes into play. When a tree is composed from scratch, the first version (0) associated to the initial commit is going to get that human readable value. Any subsequent compose operation will auto-increment to .1, .2, .3 and so on.<br>It&rsquo;s a good idea to start a versionning scheme of your own, so that your customized Photon builds that may get different packages of your choice don&rsquo;t get the same version numbers as the official Photon team builds coming from VMware&rsquo;s OSTree Packages repository. There is no conflict, it&rsquo;s just confusing to have same name for different commits coming from different repos.<br>So if you work for a company named Big Data Inc., you may want to switch to a new versioning scheme <strong>&ldquo;automatic_version_prefix&rdquo;: &ldquo;1.0_bigdata&rdquo;</strong>.</p><h2 id=installing-package-updates>Installing package updates</h2><p>If you want to provide hosts with the package updates that VMware periodically releases, all that you need to do is to add the photon-updates.repo to the list of repos in photon-base.json and then re-compose the usual way.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#c4a000>&#34;repos&#34;: [&#34;photon&#34;, &#34;photon-updates&#34;],</span>
</code></pre></div><p>Even though you may have not modified the &ldquo;packages&rdquo; section in the json file, the newer versions of existing packages will be included in the new image and then downloaded by the host the usual way. Note that upgrading a package shows differently than adding (+) or removing (-). You may still see packages added (or removed) though because they are new dependencies (or no longer dependencies) for the newer versions of other packages, as libssh2 in the example below.</p><pre><code class=language-console data-lang=console>root [ ~ ]# rpm-ostree upgrade --check-diff
Updating from: photon:photon/4.0/x86_64/minimal

8 metadata, 13 content objects fetched; 1002 KiB transferred in 0 seconds
!bridge-utils-1.5-2.ph3.x86_64
=bridge-utils-1.5-3.ph3.x86_64
!bzip2-1.0.6-5.ph3.x86_64
=bzip2-1.0.6-6.ph3.x86_64
!curl-7.47.1-2.ph3.x86_64
=curl-7.51.0-2.ph3.x86_64
!docker-1.11.0-5.ph3.x86_64
=docker-1.12.1-1.ph3.x86_64
...
+libssh2-1.8.0-1.ph3.x86_64
...

root [ ~ ]# rpm-ostree upgrade
Updating from: photon:photon/1.0/x86_64/minimal

258 metadata, 1165 content objects fetched; 76893 KiB transferred in 8 seconds
Copying /etc changes: 6 modified, 0 removed, 14 added
Transaction complete; bootconfig swap: yes deployment count change: 1
Changed:
  bridge-utils 1.5-2.ph3 -&gt; 1.5-3.ph3
  bzip2 1.0.6-5.ph3 -&gt; 1.0.6-6.ph3
  curl 7.47.1-2.ph3 -&gt; 7.51.0-2.ph3
  docker 1.11.0-5.ph3 -&gt; 1.12.1-1.ph3
  ...
Added:
  libssh2-1.8.0-1.ph3.x86_64
Upgrade prepared for next boot; run &quot;systemctl reboot&quot; to start a reboot
</code></pre><p>Now if we want to see what packages have been updated and what issues have been fixed, just run at the host the command that we learned about in chapter 5.4.</p><pre><code class=language-console data-lang=console>root [ ~ ]# rpm-ostree db diff 56ef 396e
ostree diff commit old: 56e (56ef687f1319604b7900a232715718d26ca407de7e1dc89251b206f8e255dcb4)
ostree diff commit new: 396 (396e1116ad94692b8c105edaee4fa12447ec3d8f73c7b3ade4e955163d517497)
Upgraded:
 bridge-utils-1.5-3.ph3.x86_64
* Mon Sep 12 2016 user1 &lt;user1@vmware.com&gt; 1.5-3
-	Update patch to fix-2.

 bzip2-1.0.6-6.ph3.x86_64
* Fri Oct 21 2016 user2 &lt;user2@vmware.com&gt; 1.0.6-6
-       Fixing security bug CVE-2016-3189.

 curl-7.51.0-2.ph3.x86_64
* Wed Nov 30 2016 user3 &lt;user3@vmware.com&gt; 7.51.0-2
-   Enable sftp support.

* Wed Nov 02 2016 user4 &lt;user4@vmware.com&gt; 7.51.0-1
-   	Upgrade curl to 7.51.0

* Thu Oct 27 2016 user4 &lt;user4@vmware.com&gt; 7.47.1-4
-   	Patch for CVE-2016-5421

* Mon Sep 19 2016 user3 &lt;user3@vmware.com&gt; 7.47.1-3
-   	Applied CVE-2016-7167.patch.

 docker-1.12.1-1.ph3.x86_64
* Wed Sep 21 2016 user3 &lt;user3@vmware.com&gt; 1.12.1-1
-   Upgraded to version 1.12.1

* Mon Aug 22 2016 user1 &lt;user1@vmware.com&gt; 1.12.0-2
-   Added bash completion file

* Tue Aug 09 2016 user4 &lt;user4@vmware.com&gt; 1.12.0-1
-   Upgraded to version 1.12.0

* Tue Jun 28 2016 user4 &lt;user4@vmware.com&gt; 1.11.2-1
-   Upgraded to version 1.11.2
...
Added:
 libssh2-1.8.0-1.ph3.x86_64
</code></pre><h2 id=composing-for-a-different-branch>Composing for a different branch</h2><p>RPM-OSTree makes it very easy to create and update new branches, by composing using json config files that include the Refspec as the new branch name, the list of packages and the other settings we are now familiar with. Photon OS RPM-OSTRee Server installer adds two extra files photon-minimal.json and photon-full.json in addition to photon-base.json, that correspond almost identically to the minimal and full profiles installed via tdnf. It also makes &lsquo;photon-base&rsquo; a smaller set of starter branch.</p><p>Of course, you can create your own config files for your branches with desired lists of packages. You may compose on top of the existing tree, or you can <a href=../../docs/administration-guide/photon-rpm-ostree/file-oriented-server-operations/#starting-a-fresh-ostree-repo>start fresh your own OSTRee repo</a>, using your own customized versioning.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-2472b0296edd8e9542da1d39ed9b48cd>5.13.11 - Remotes</h1><p>In Chapter 3 we talked about the Refspec that contains a <strong>photon:</strong> prefix, that is the name of a remote. When a Photon host is installed, a remote is added - which contains the URL for an OSTree repository that is the origin of the commits we are going to pull from and deploy filetrees, in our case the Photon RPM-OSTree server we installed the host from. This remote is named <strong>photon</strong>, which may be confusing, because it&rsquo;s also the OS name and part of the Refspec (branch) path.</p><h2 id=listing-remotes>Listing remotes</h2><p>A host repo can be configured to switch between multiple remotes to pull from, however only one remote is the &ldquo;active&rdquo; one at a time. We can list the remotes created so far, which brings back the expected result.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree remote list
photon
</code></pre><p>We can inquiry about the URL for that remote name, which for the default host is the expected Photon OS online OSTree repo.</p><pre><code class=language-console data-lang=console>root@photon-host-def [ ~ ]# ostree remote show-url photon
https://&lt;host-name&gt;:8080/repo
</code></pre><p>But where is this information stored? The repo&rsquo;s config file has it.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#c4a000>root@photon-host-def [ ~ ]# cat /ostree/repo/config </span>
<span style=color:#204a87;font-weight:700>[core]</span>
<span style=color:#c4a000>repo_version</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>1</span>
<span style=color:#c4a000>mode</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>bare</span>

<span style=color:#204a87;font-weight:700>[remote &#34;photon&#34;]</span>
<span style=color:#c4a000>url</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>http:&lt;Server-IP-Address:port&gt;/repo</span>
<span style=color:#c4a000>gpg-verify</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>false</span>
</code></pre></div><p>If same command is executed on the custom host we&rsquo;ve installed, it&rsquo;s going to reveal the URL of the Photon RPM-OSTree server connected to during setup.</p><pre><code class=language-console data-lang=console>root@photon-7c2d910d79e9 [ ~ ]# ostree remote show-url photon
https://packages.vmware.com/photon/rpm-ostree/base/4.0/x86_64/repo
</code></pre><h2 id=gpg-signature-verification>GPG signature verification</h2><p>You may wonder what is the purpose of <code>gpg-verify=false</code> in the config file, associated with the specific remote. This will instruct any host update to skip the signing verification for the updates that come from server, resulted from tree composed locally at the server, as they are not signed. Without this, host updating will fail.</p><p>There is a whole chapter about signing, importing keys and so on that I will not get into, but the idea is that signing adds an extra layer of security, by validating that everything you download comes from the trusted publisher and has not been altered. That is the case for all Photon OS artifacts downloaded from VMware official site. All OVAs and packages, either from the online RPMS repositories or included in the ISO file - are signed by VMware. We&rsquo;ve seen a similar setting <code>gpgcheck=1</code> in the RPMS repo configuration files that tdnf uses to validate or not the signature for all packages downloaded to be installed.</p><h2 id=switching-repositories>Switching repositories</h2><p>Since mapping name/url is stored in the repo&rsquo;s config file, in principle you can re-assign a different URL, connecting the host to a different server. The next upgrade will get the latest commit chain from the new server.<br>If we edit photon-host-def&rsquo;s repo config and replace the VMware Photon Packages URL by photon-srv1&rsquo;s IP address, all original packages in the original 4.0_minimal version will be preserved, but any new package change (addition, removal, upgrade) added after that (in 4.0_minimal.1, 4.0_minimal.2) will be reverted and all new commits from photon-srv1 (that may have same version) will be applied. This is because the two repos are identical copies, so they have the same original commit ID as a common ancestor, but they diverge from there.</p><p>If the old and new repo have nothing in common (no common ancestor commit), this will undo even the original commit, so all commits from the new tree will be applied.<br>A better solution would be to add a new remote that will identify where the commits come from.</p><h2 id=adding-and-removing-remotes>Adding and removing remotes</h2><p>A cleaner way to switch repositories is to add remotes that point to different servers. Let us add another server that we will refer to as <strong>photon2</strong>, along with (optional) the refspecs for branches that it provides (we will see later that in the newer OSTree versions, we don&rsquo;t need to know the branch names, they could be <a href=#list-available-branches>queried at run-time</a>).</p><pre><code class=language-console data-lang=console>root@photon-host-cus [ ~ ]# ostree remote add --repo=/ostree/repo -v --no-gpg-verify photon2 http://10.197.103.204:8080 photon/4.0/x86_64/minimal photon/4.0/x86_64/full
root@photon-host-cus [ ~ ]# ostree remote list
photon
photon2
root@photon-host-cus [ ~ ]# ostree remote show-url photon2
http://10.0.0.86
</code></pre><p>Where is this information stored? There is an extra config file created per each remote:</p><pre><code class=language-console data-lang=console>root@photon-host-cus [ ~ ]# cat /etc/ostree/remotes.d/photon2.conf 
[remote &quot;photon2&quot;]
url=http://10.0.0.86
branches=photon/4.0/x86_64/minimal;photon/4.0/x86_64/full;
gpg-verify=false
</code></pre><p>You may have guessed what is the effect of <code>--no-gpg-verify option</code>.<br>Obviously, remotes could also be deleted.</p><pre><code class=language-console data-lang=console>root@photon-host-cus [ ~ ]# ostree remote delete photon2
root@photon-host-cus [ ~ ]# ostree remote list
photon
</code></pre><h2 id=list-available-branches>List available branches</h2><p>If a host has been deployed from a specific branch and would like to switch to a different one, maybe from a different server, how would it know what branches are available? In git, you would run <code>git remote show origin</code> or <code>git remote -a</code> (although last command would not show all branches, unless you ran <code>git fetch</code> first).</p><p>In Photon OS, the hosts are able to query the server, if summary metadata has been generated, as we&rsquo;ve seen in <a href=../../docs/administration-guide/photon-rpm-ostree/file-oriented-server-operations/#creating-summary-metadata>Creating summary metadata</a>. This command lists all branches available for remote <strong>photon2</strong>.</p><pre><code class=language-console data-lang=console>root@photon-host-cus [ ~ ]# ostree remote refs photon2 
photon2:photon/4.0/x86_64/base
photon2:photon/4.0/x86_64/full
photon2:photon/4.0/x86_64/minimal
</code></pre><h2 id=switching-branches-rebasing>Switching branches (rebasing)</h2><p>If you have an installed Photon 3.0 that you want to carry to 4.0, you need to rebase it.</p><p>See <a href=../../docs/administration-guide/photon-rpm-ostree/install-or-rebase-to-photon-os-4/>rebasing</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-732a7f8dd299bd9ffbffb4afab9b21f0>5.13.12 - Running container applications between bootable images</h1><p>In this chapter, we want to test a docker application and make sure that all the settings and downloads done in one bootable filetree are going to be saved into writable folders and be available in the other image, in other words after reboot from the other image, everything is available exactly the same way.<br>We are going to do this twice: first, to verify an existing bootable image installed in parallel and then create a new one.</p><h2 id=downloading-a-docker-container-appliance>Downloading a docker container appliance</h2><p>Photon OS comes with docker package installed and configured, but we expect that the docker daemon is inactive (not started). Configuration file /usr/lib/systemd/system/docker.service is read-only (remember /usr is bound as read-only).</p><pre><code class=language-console data-lang=console>root@sample-host-def [ ~ ]# systemctl status docker
* docker.service - Docker Daemon
   Loaded: loaded (/usr/lib/systemd/system/docker.service; disabled)
   Active: inactive (dead)

root@sample-host-def [ ~ ]# cat /usr/lib/systemd/system/docker.service
[Unit]
Description=Docker Application Container Engine
Documentation=https://docs.docker.com
After=network-online.target
Wants=network-online.target

[Service]
Type=notify
# the default is not to use systemd for cgroups because the delegate issues still
# exists and systemd currently does not support the cgroup feature set required
# for containers run by docker
ExecStart=/usr/bin/dockerd
ExecReload=/bin/kill -s HUP $MAINPID
# Having non-zero Limit*s causes performance problems due to accounting overhead
# in the kernel. We recommend using cgroups to do container-local accounting.
LimitNOFILE=infinity
LimitNPROC=infinity
LimitCORE=infinity
# Uncomment TasksMax if your systemd version supports it.
# Only systemd 226 and above support this version.
#TasksMax=infinity
TimeoutStartSec=0
# set delegate yes so that systemd does not reset the cgroups of docker containers
Delegate=yes
# kill only the docker process, not all processes in the cgroup
KillMode=process
# restart the docker process if it exits prematurely
Restart=on-failure
StartLimitBurst=3
StartLimitInterval=60s

[Install]
WantedBy=multi-user.target
</code></pre><p>Now let&rsquo;s enable docker daemon to start at boot time - this will create a symbolic link into writable folder /etc/systemd/system/multi-user.target.wants to its systemd configuration, as with all other systemd controlled services.</p><pre><code class=language-console data-lang=console>root@sample-host-def [ ~ ]# systemctl enable docker
Created symlink /etc/systemd/system/multi-user.target.wants/docker.service -&gt; /lib/systemd/system/docker.service.

root@sample-host-def [ ~ ]# ls -l /etc/systemd/system/multi-user.target.wants
total 0
lrwxrwxrwx 1 root root 34 Sep 10 10:48 docker.service -&gt; /lib/systemd/system/docker.service
lrwxrwxrwx 1 root root 36 Sep  4 04:59 iptables.service -&gt; /lib/systemd/system/iptables.service
lrwxrwxrwx 1 root root 35 Sep  4 04:59 machines.target -&gt; /lib/systemd/system/machines.target
lrwxrwxrwx 1 root root 36 Sep  4 04:59 remote-fs.target -&gt; /lib/systemd/system/remote-fs.target
lrwxrwxrwx 1 root root 39 Sep  4 04:59 sshd-keygen.service -&gt; /lib/systemd/system/sshd-keygen.service
lrwxrwxrwx 1 root root 32 Sep  4 04:59 sshd.service -&gt; /lib/systemd/system/sshd.service
lrwxrwxrwx 1 root root 44 Sep  4 04:59 systemd-networkd.service -&gt; /lib/systemd/system/systemd-networkd.service
lrwxrwxrwx 1 root root 44 Sep  4 04:59 systemd-resolved.service -&gt; /lib/systemd/system/systemd-resolved.service
</code></pre><p>To verify that the symbolic link points to a file in a read-only directory, try to make a change in this file using vim and save. you&rsquo;ll get an error: <code>/usr/lib/systemd/system/docker.service" E166: Can't open linked file for writing</code>.</p><p>Finally, let&rsquo;s start the daemon, check again that is active.</p><pre><code class=language-console data-lang=console>root@sample-host-def [ ~ ]# systemctl start docker

root@sample-host-def [ ~ ]# systemctl status -l docker
* docker.service - Docker Application Container Engine
   Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: disabled)
   Active: active (running) since Tue 2019-09-10 10:54:32 UTC; 14s ago
     Docs: https://docs.docker.com
 Main PID: 2553 (dockerd)
    Tasks: 35 (limit: 4711)
   Memory: 148.2M
   CGroup: /system.slice/docker.service
           |-2553 /usr/bin/dockerd
           `-2566 docker-containerd --config /var/run/docker/containerd/containerd.toml

Sep 10 10:54:31 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:31.421759662Z&quot; level=info msg=&quot;pickfirstBalancer: HandleSubConnStateChange: 0xc420312f90, CONNECTING&quot; module=grpc
Sep 10 10:54:31 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:31.421935355Z&quot; level=info msg=&quot;pickfirstBalancer: HandleSubConnStateChange: 0xc420312f90, READY&quot; module=grpc
Sep 10 10:54:31 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:31.421980614Z&quot; level=info msg=&quot;Loading containers: start.&quot;
Sep 10 10:54:31 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:31.886520281Z&quot; level=info msg=&quot;Default bridge
(docker0) is assigned with an IP address 172.17.0.0/16. Daemon option --bip can be used to set a preferred IP address&quot;
Sep 10 10:54:32 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:32.027763113Z&quot; level=info msg=&quot;Loading containers: done.&quot;
Sep 10 10:54:32 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:32.468277184Z&quot; level=info msg=&quot;Docker daemon&quot;
commit=6d37f41 graphdriver(s)=overlay2 version=18.06.2-ce
Sep 10 10:54:32 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:32.468441587Z&quot; level=info msg=&quot;Daemon has completed initialization&quot;
Sep 10 10:54:32 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:32.684925824Z&quot; level=warning msg=&quot;Could not register builder git source: failed to find git binary: exec: \&quot;git\&quot;: executable file not found in $PATH&quot;
Sep 10 10:54:32 photon-76718dd2fa33 dockerd[2553]: time=&quot;2019-09-10T10:54:32.691070166Z&quot; level=info msg=&quot;API listen on /var/run/docker.sock&quot;
Sep 10 10:54:32 photon-76718dd2fa33 systemd[1]: Started Docker Application Container Engine.
</code></pre><p>We&rsquo;ll ask docker to run Ubuntu Linux in a container. Since it&rsquo;s not present locally, it&rsquo;s going to be downloaded first from the official docker repository <a href=https://hub.docker.com/_/ubuntu/>https://hub.docker.com/_/ubuntu/</a>.</p><pre><code class=language-console data-lang=console>root@sample-host-def [ ~ ]# docker ps -a
CONTAINER ID        IMAGE            COMMAND      CREATED           STATUS              PORTS       NAMES

root@sample-host-def [ ~ ]# docker run -it ubuntu
Unable to find image 'ubuntu:latest' locally
latest: Pulling from library/ubuntu
35c102085707: Pull complete
251f5509d51d: Pull complete
8e829fe70a46: Pull complete
6001e1789921: Pull complete
Digest: sha256:d1d454df0f579c6be4d8161d227462d69e163a8ff9d20a847533989cf0c94d90
Status: Downloaded newer image for ubuntu:latest
</code></pre><p>When downloading is complete, it comes to Ubuntu root prompt with assigned host name 7029a64e7aa3, that is actually the Container ID. Let&rsquo;s verify it&rsquo;s indeed the expected OS.</p><pre><code class=language-console data-lang=console>root@sample-host-def [ ~ ]# docker run -it ubuntu
Unable to find image 'ubuntu:latest' locally
latest: Pulling from library/ubuntu
d3a1f33e8a5a: Pull complete
c22013c84729: Pull complete
d74508fb6632: Pull complete
91e54dfb1179: Already exists
library/ubuntu:latest: The image you are pulling has been verified. Important: image verification is a tech preview feature and should not be relied on to provide security.
Digest: sha256:fde8a8814702c18bb1f39b3bd91a2f82a8e428b1b4e39d1963c5d14418da8fba
Status: Downloaded newer image for ubuntu:latest

root@7029a64e7aa3:/# cat /etc/os-release
NAME=&quot;Ubuntu&quot;
VERSION=&quot;18.04.3 LTS (Bionic Beaver)&quot;
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME=&quot;Ubuntu 18.04.3 LTS&quot;
VERSION_ID=&quot;18.04&quot;
HOME_URL=&quot;https://www.ubuntu.com/&quot;
SUPPORT_URL=&quot;https://help.ubuntu.com/&quot;
BUG_REPORT_URL=&quot;https://bugs.launchpad.net/ubuntu/&quot;
PRIVACY_POLICY_URL=&quot;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&quot;
VERSION_CODENAME=bionic
UBUNTU_CODENAME=bionic
root@7029a64e7aa3:/#
</code></pre><p>Now let&rsquo;s write a file into Ubuntu home directory</p><pre><code class=language-console data-lang=console>echo &quot;Ubuntu file&quot; &gt;&gt; /home/myfile
root@7029a64e7aa3:/home# cat /home/myfile
Ubuntu file
</code></pre><p>We&rsquo;ll exit back to the Photon prompt and if it&rsquo;s stopped, we will re-start it.</p><pre><code class=language-console data-lang=console>root@7029a64e7aa3:/# exit
exit

root@sample-host-def [ ~ ]# docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                       PORTS               NAMES
7029a64e7aa3        ubuntu              &quot;/bin/bash&quot;         6 minutes ago       Exited (0) 11 seconds ago                        gifted_dijkstra

root@photon-host-cus1 [ ~ ]# docker start  7029a64e7aa3
7029a64e7aa3

root@photon-host-cus1 [ ~ ]# docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                       PORTS               NAMES
7029a64e7aa3        ubuntu              &quot;/bin/bash&quot;         7 minutes ago       Up 21 seconds                                    gifted_dijkstra
</code></pre><h2 id=rebooting-into-an-existing-image>Rebooting into an existing image</h2><p>Now let&rsquo;s reboot the machine and select the other image. First, we&rsquo;ll verify that the docker daemon is automaically started.</p><pre><code class=language-console data-lang=console>root@photon-host-cus1 [ ~ ]# systemctl status docker
* docker.service - Docker Application Container Engine
   Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: disabled)
   Active: active (running) since Tue 2019-09-10 10:54:32 UTC; 13min ago
     Docs: https://docs.docker.com
 Main PID: 2553 (dockerd)
    Tasks: 55 (limit: 4711)
   Memory: 261.3M
   CGroup: /system.slice/docker.service
           |-2553 /usr/bin/dockerd
   ...
</code></pre><p>Next, is the Ubuntu OS container still there?</p><pre><code class=language-console data-lang=console>root@photon-host-cus1 [ ~ ]# docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                       PORTS               NAMES
7029a64e7aa3        ubuntu              &quot;/bin/bash&quot;         9 minutes ago       Up 2 minutes                                     gifted_dijkstra
</code></pre><p>It is, so let&rsquo;s start it, attach and verify that our file is persisted, then add another line to it and save, exit.</p><pre><code class=language-console data-lang=console>root@photon-host-cus1 [ ~ ]# docker start -i  7029a64e7aa3
root@7029a64e7aa3:/# cat /home/myfile
Ubuntu file
root@7029a64e7aa3:/# echo &quot;booted into existing image&quot; &gt;&gt; /home/myfile
root@7029a64e7aa3:/# exit
exit
</code></pre><h2 id=reboot-into-a-newly-created-image>Reboot into a newly created image</h2><p>Let&rsquo;s upgrade and replace the .0 image by a .4 build that contains git and also perl_YAML (because it is a dependency of git).</p><pre><code class=language-console data-lang=console>root@photon-host-cus1 [ ~ ]# rpm-ostree status
  TIMESTAMP (UTC)         VERSION               ID             OSNAME     REFSPEC
* 2015-09-04 00:36:37     4.0_minimal     092e21d292     photon     photon:photon/x86_64/minimal
  2015-08-20 22:27:43     4.0_minimal       2940e10c4d     photon     photon:photon/x86_64/minimal

root@photon-host-cus1 [ ~ ]# rpm-ostree upgrade
Updating from: photon:photon/tp2/x86_64/minimal

43 metadata, 209 content objects fetched; 19992 KiB transferred in 0 seconds
Copying /etc changes: 5 modified, 0 removed, 19 added
Transaction complete; bootconfig swap: yes deployment count change: 0
Freed objects: 16.2 MB
Added:
  git-2.1.2-1.ph3tp2.x86_64
  perl-YAML-1.14-1.ph3tp2.noarch
Upgrade prepared for next boot; run &quot;systemctl reboot&quot; to start a reboot

root@photon-host-cus1 [ ~ ]# rpm-ostree status
  TIMESTAMP (UTC)         VERSION               ID             OSNAME     REFSPEC
  2015-09-06 18:12:08     4.0_minimal     d16aebd803     photon     photon:photon/x86_64/minimal
* 2015-09-04 00:36:37     4.0_minimal     092e21d292     photon     photon:photon/x86_64/minimal
</code></pre><p>After reboot from 4.0_minimal. build, let&rsquo;s check that the 3-way /etc merge succeeded as expected. The docker.service slink is still there, and docker demon restarted at boot.</p><pre><code class=language-console data-lang=console>root@photon-host-cus1 [ ~ ]# ls -l /etc/systemd/system/multi-user.target.wants/docker.service
lrwxrwxrwx 1 root root 38 Sep  6 12:50 /etc/systemd/system/multi-user.target.wants/docker.service -&gt; /usr/lib/systemd/system/docker.service

root@photon-host-cus1 [ ~ ]# systemctl status docker
* docker.service - Docker Daemon
   Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled)
   Active: active (running) since Sun 2015-09-06 12:56:33 UTC; 1min 27s ago
 Main PID: 292 (docker)
   CGroup: /system.slice/docker.service
           `-292 /bin/docker -d -s overlay
   ...
</code></pre><p>Let&rsquo;s revisit the Ubuntu container. Is the container still there? is myfile persisted?</p><pre><code class=language-console data-lang=console>root@photon-host-cus1 [ ~ ]# docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                    PORTS               NAMES
7029a64e7aa3        ubuntu              &quot;/bin/bash&quot;         5 days ago          Exited (0) 5 days ago                         gifted_dijkstra
55825c961f95        ubuntu              &quot;/bin/bash&quot;         5 days ago          Exited (127) 5 days ago                       distracted_shannon

root@photon-host-cus1 [ ~ ]# docker start 57dcac5d0490

root@57dcac5d0490:/# cat /home/myfile
Ubuntu file
booted into existing image
root@57dcac5d0490:/# echo &quot;booted into new image&quot; &gt;&gt; /home/myfile
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-f4acccc20969d619858c0e6c930ecb82>5.13.13 - Install or rebase to Photon OS 4.0</h1><p>Photon OS 4.0 provides full RPM-OSTree functionality, it lets the user drive it, rather than provide a pre-defined solution as part of the installation.</p><p>The number of packages included in the RPMS repo in Photon OS 4.0 increased significantly, compared to 1.0. To keep the ISO at reasonable size, the previous versions no longer include the compressed ostree.repo file, that helped optimize both the server and host install in 1.0 or 1.0 Rev2. That decision affected the OSTree features we ship out of the box. Customer could achieve the same results by several additional simple steps, that will be explained in this chapter. In addition, there is a new way to create a host raw image at server.</p><h2 id=composing-your-own-rpm-ostree-server>Composing your own RPM-OSTree Server</h2><p>You can compose your own RPM-OSTRee server in the following two ways:</p><ol><li>By Manually executing the below command:</li></ol><pre><code class=language-console data-lang=console>root [ /srv/rpm-ostree ]# ostree --repo=repo init --mode=archive-z2
root [ /srv/rpm-ostree ]# rpm-ostree compose tree --repo=repo photon-base.json
</code></pre><ol start=2><li>By installing <code>rpm-ostree-repo package</code> . This provides the script to create the repo tree which act as server by executing a single command.</li></ol><h2 id=installing-an-rpm-ostree-host>Installing an RPM-OSTree host</h2><p>Automated host install is supported, as explained in <a href=../../docs/administration-guide/photon-rpm-ostree/installing-a-host-against-custom-server-repository/#automated-install-of-a-custom-host-via-kickstart>Automated install of a custom host via kickstart</a>.</p><h2 id=rebasing-a-host-from-photon-10-to-40>Rebasing a host from Photon 1.0 to 4.0</h2><p>If kickstart sounds too complicated and we still want to go the UI way there is a workaround that requires an extra step. Also, if you have an installed Photon 1.0 or 1.0 Rev2 that you want to carry to 4.0, you need to rebase it. Notice that we didn&rsquo;t say &ldquo;upgrade&rdquo;.</p><p>Practically, the OSTree repo will switch to a different branch on a different server, following the new server&rsquo;s branch versioning scheme. The net result is that the lots of packages will get changed to newer versions listed in the newer OSTree repo, which has been composed from a newer Photon OS 4.0 RPMS repo. Again, we didn&rsquo;t say &ldquo;upgraded&rdquo;, neither the rebase command output, that lists &ldquo;changed&rdquo; packages. Some obsolete packages will be removed, new packages will be added, either because they didn&rsquo;t exist in older repo, or because the new config file includes them.<br>The OS name is the same (Photon), so the content in /var and /etc will be transferred over.</p><ol><li><p>To install fresh, deploy a Photon 4 host default, as described in the section <a href=../../docs/administration-guide/photon-rpm-ostree/installing-a-host-against-default-server-repository/>Installing A Host Against the Default Server Repository</a>. Of course, if you already have an existing Photon OS 3.0 host that you want to move to 4.0, skip this step.</p></li><li><p>Edit /ostree/repo/config and substitute the url, providing the IP address for the Photon OS RPM-OSTree server installed above. This was explained in the &ldquo;Switching Repositories&rdquo; section of the <a href=../../docs/administration-guide/photon-rpm-ostree/remotes/#switching-repositories>Remotes</a> document.<br>Ostree should confirm that is the updated server IP for the &ldquo;photon&rdquo; remote.</p></li></ol><pre><code class=language-console data-lang=console>root@ostree-host [ ~ ]# ostree remote show-url photon
http://10.20.30.175:8000/repo
</code></pre><ol start=3><li>Rebase your host to the new 4.0 server and Refspec.</li></ol><pre><code class=language-console data-lang=console>root@ostree-host [ ~ ]# ostree remote add photon-4 http://10.20.30.204:8000/repo --no-gpg-verify
root@ostree-host [ ~ ]# rpm-ostree rebase photon-4:photon/4.0/x86_64/minimal

Rebasing to photon-4:photon/4.0/x86_64/minimal
⠉ Receiving objects: 99% (1541/1549) 478.3 kB/s 107.1 MB
Receiving objects: 99% (1541/1549) 478.3 kB/s 107.1 MB... done
Staging deployment... done
Upgraded:
  docker 18.06.2-3.ph3 -&gt; 18.06.2-4.ph3
  gmp 6.1.2-2.ph3 -&gt; 6.1.2-3.ph3
  gobject-introspection 1.58.0-2.ph3 -&gt; 1.58.0-3.ph3
  gzip 1.9-1.ph3 -&gt; 1.9-2.ph3
  linux 4.19.65-3.ph3 -&gt; 4.19.69-1.ph3
  mpfr 4.0.1-1.ph3 -&gt; 4.0.1-2.ph3
  ostree 2019.2-1.ph3 -&gt; 2019.2-2.ph3
  ostree-grub2 2019.2-1.ph3 -&gt; 2019.2-2.ph3
  ostree-libs 2019.2-1.ph3 -&gt; 2019.2-2.ph3
  zlib 1.2.11-1.ph3 -&gt; 1.2.11-2.ph3
Added:
  efibootmgr-15-1.ph3.x86_64
  efivar-36-1.ph3.x86_64
  tar-1.30-3.ph3.x86_64
Run &quot;systemctl reboot&quot; to start a reboot
</code></pre><ol><li>Check the status</li></ol><pre><code class=language-console data-lang=console>root@ostree-host [ ~ ]# rpm-ostree status
State: idle
AutomaticUpdates: disabled
Deployments:
* ostree://photon-1:photon/4.0/x86_64/minimal
                Version: 4.0_minimal (2019-09-18T08:22:15Z)
            BaseCommit: c8f2b116b067d7695f9033bf2a99505198269354e157c0f2d5b78266cb874239
        LayeredPackages: createrepo_c rpm wget

  ostree://photon:photon/3.0/x86_64/minimal
                Version: 3.0_minimal.1 (2017-01-11T02:18:42)
            BaseCommit: 28dc49ecb4604c0bc349e4445adc659491a1874c01198e6253a261f4d59708b7
        LayeredPackages: createrepo_c rpm wget
</code></pre><p>You may now reboot to the new Photon OS 4.0 image.</p><h2 id=creating-a-host-raw-image>Creating a host raw image</h2><p>It is now possible to run at server a script that is part of RPM-OStree package, to create a host raw mage.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-87f63a5ed86c6655df43ce9b8c2f6383>5.14 - Support for SELinux</h1><p>SELinux is a labelling system to implement MAC(mandatory access control) for subjects(user, process) over objects (files, dirs, sockets) and to protect the confidentiality of objects. It is a policy driven system where rules can be mapped to the labels which have been given to subjects, objects. It is an extra level of security provided on top of Linux normal file ownership/permissions.</p><p>Photon OS 4.0 offersx support for SELinux. The support covers a minimal set of policies for the container runtime case and it is referred to as the default policy. It is a Multi-Category Security (MCS) policy. So the files on the filesystem can be labeled with multiple categories.The MCS policy is actively used by container runtime as <code>runc/containerd/docker/kubernetes</code> to assign the <code>per-container</code> category.</p><p>The default policy in Photon OS does not use <code>user</code>, <code>role</code> (RBAC) and <code>level</code> (MLS) fields of the file labels.It operates only with the context and category fields. It consists of several modules loaded with priority as <code>100</code>. The user-defined policy can overwrite default modules by using the higher priority.</p><h2 id=enabling-selinux>Enabling SELinux</h2><p>To enable SELinux on Photon OS:</p><ol><li><p>Install default policy and its dependencies. Initial filesystem labeling will be done as RPM post action.</p><p><code>tdnf install -y selinux-policy</code></p></li><li><p>Enable SELinux security model in kernel by adding 2 kernel parameters:</p></li></ol><ul><li><code>security=selinux</code></li><li><code>selinux=1</code></li></ul><p>Ensure that you reboot after adding the kernel parameters.</p><ol><li><p>After reboot, the system runs in SELinux permissive mode. To confirm, check the journal:</p><pre><code class=language-console data-lang=console>journalctl -b0 | grep -i selinux

Feb 26 21:42:09 photon-machine kernel: SELinux:  Initializing.
Feb 26 21:42:09 photon-machine kernel: SELinux:  policy capability ...
Feb 26 21:42:09 photon-machine kernel: audit: type=1403 audit(1589406128.920:2): auid=4294967295 ses=4294967295 lsm=selinux res=1
Feb 26 21:42:09 photon-machine systemd[1]: Successfully loaded SELinux policy in 322.475ms.
</code></pre></li></ol><h2 id=switch-selinux-to-enforcing-mode>Switch SELinux to enforcing mode</h2><p>The three methods to toggle enforcing mode are as follows:</p><ol><li>Run the <code>setenforce 1</code> command (libselinux-utils rpm), Enforcing mode will be set timmediately, but it is not preserved on reboot.</li><li>Edit the <code>/etc/selinux/config</code> file to set <code>SELINUX=enforcing</code> and reboot.</li><li>Add the <code>enforcing=1</code> kernel parameter and reboot.</li></ol><h2 id=developing-customized-policy>Developing Customized Policy</h2><p>Photon OS provides an ability to develop customized additional policy on top of existing default policy.
The following example is for adding the sys_admin capability policy:</p><ol><li><p>Install policy development packages:</p><pre><code class=language-console data-lang=console>tdnf install -y selinux-policy-devel semodule-utils
</code></pre></li><li><p>Create .te file</p><pre><code class=language-console data-lang=console>cat getty_local.te
policy_module(getty_local, 1.0)

gen_require(`
    type getty_t;
      ')
   
allow getty_t self:capability sys_admin;
</code></pre></li><li><p>Compile it into .pp file</p><pre><code class=language-console data-lang=console>make -f /usr/share/selinux/devel/Makefile getty_local.pp
</code></pre></li><li><p>Load it with priority 200. It will permanently alter default policy. And this change will survive reboot cycle.</p><pre><code class=language-console data-lang=console>semodule -i getty_local.pp -X 200
</code></pre></li><li><p>Check result</p><pre><code class=language-console data-lang=console>sesearch -A -s getty_t -t getty_t -c capability
allow getty_t getty_t:capability { chown dac_override dac_read_search fowner fsetid setgid sys_admin sys_resource sys_tty_config };
</code></pre></li><li><p>List of loaded modules and their priorities</p><pre><code class=language-console data-lang=console>semodule -lfull
</code></pre></li></ol><h2 id=debugging-selinux>Debugging SELinux</h2><p>Install the debugging tools as follows:</p><pre><code class=language-console data-lang=console>tdnf install -y setools python3-pip

pip3 install networkx
</code></pre><p>List all actions denied by Selinux using the following command:</p><pre><code class=language-console data-lang=console>journalctl _TRANSPORT=audit -b 0 | grep denied

Feb 26 21:42:43 photon-machine audit[445]: AVC avc:  denied  { sys_admin } for  pid=445 comm=&quot;agetty&quot; capability=21
scontext=system_u:system_r:getty_t:s0-s0:c0.c1023 tcontext=system_u:system_r:getty_t:s0-s0:c0.c1023 tclass=capability permissive=0
</code></pre><p>You can see that the agetty process running in the getty_t context tries to change the capability of getty_t target to obtain <code>sys_admin</code>. To view the capability that getty_t can obtain:</p><pre><code class=language-console data-lang=console>sesearch -A -s getty_t -t getty_t -c capability

allow getty_t getty_t:capability { chown dac_override dac_read_search fowner fsetid setgid sys_resource sys_tty_config };
</code></pre><div class="alert alert-primary" role=alert><h4 class=alert-heading>Note</h4><blockquote><p><code>sys_admind</code> is not listed there but can be added.</p></blockquote></div><h2 id=important-selinux-files>Important SELinux Files</h2><p>Here are some of the important SELinux files:</p><ul><li><p>SELinux config
/etc/selinux/config</p></li><li><p>default policy folder
/etc/selinux/default/</p></li><li><p>Binary policy blob to be loaded to kernel on every boot
/etc/selinux/default/policy/policy.32</p></li><li><p>List of file labels used by the policy
/etc/selinux/default/contexts/files/file_contexts</p></li></ul><h2 id=troubleshooting-compilation-error>Troubleshooting Compilation Error</h2><p>If compilation fails by any reason and it complains on some line number in the <code>.cil</code> file. You can run the pp compiler to get the plain text cil output.</p><pre><code>/usr/libexec/selinux/hll/pp getty_local.pp
(roleattributeset cil_gen_require system_r)
(typeattributeset cil_gen_require getty_t)
(allow getty_t self (capability (sys_admin)))
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-609cd3e20218b5ed125525c70414aa5c>5.15 - Remotely Upgrading a Photon OS Machine</h1><p>The following section describes how to remotely upgrade a Photon OS installation.</p></div><div class=td-content><h1 id=pg-64564c8401761ee407f956d4bdf12d0c>5.15.1 - Remotely Update a Single Photon OS Machine With Photon Management Daemon</h1><p>After you have a configured the Photon Management Daemon on a machine, you can remotely update any installed package on that machine. You can use the <code>root</code> user credentials.</p><p>The update process uses <code>pmd-cli</code> which is supported from Photon Management Daemon. You can initiate the update process from any machine that has Photon Management Daemon CLI installed.</p><h2 id=prerequisites>Prerequisites</h2><ul><li>Have an installed Photon Management Daemon on the client.</li><li>Have in installed Photon Management Daemon CLI (<code>pmd-cli</code>) on a machine from which you perform the updates.</li></ul><h2 id=procedure>Procedure</h2><ol><li><p>To initiate remote update, log in to a machine that has Photon Management Daemon CLI installed over SSH.</p></li><li><p>Identify packages that can be updated on the client machine.</p><ul><li>List the available updates for the machine.</li></ul></li></ol><pre><code class=language-console data-lang=console>pmd-cli --server-name &lt;machine-IP-address&gt; --user root pkg list updates
</code></pre><ol start=3><li>Verify the currently installed version of a package, for example <code>sed</code>.</li></ol><pre><code class=language-console data-lang=console>pmd-cli --server-name &lt;machine-IP-address&gt; --user root pkg installed sed
</code></pre><p>The installed version number shows as earlier than the one listed under the available updates.</p><ol start=4><li>Initiate the update, in this example of the <code>sed</code> package, enter password, and wait for the command to complete.</li></ol><pre><code class=language-console data-lang=console>pmd-cli --server-name &lt;machine-IP-address&gt; --user root pkg update sed
</code></pre><ol start=5><li>(Optional) Verify that the client machine package was updated successfully.<ul><li>Log in to the machine that was updated over SSH.</li><li>List the installed version of the <code>sed</code> package.</li></ul></li></ol><pre><code class=language-console data-lang=console>pmd-cli --server-name &lt;machine-IP-address&gt; --user root pkg installed sed
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-7e033ac460a478424d7c28d77b997e4a>5.15.2 - Remotely Upgrade Multiple Photon OS Machines With Photon Management Daemon</h1><p>After you have a configured the Photon Management Daemon (PMD) on multiple machines, you can remotely upgrade any installed package on these machines.</p><p>Upgrade process uses <code>copenapi_cli</code> that is supported from Photon Management Daemon. You can initiate the upgrade process from any machine that has Photon Management Daemon installed.</p><h2 id=prerequisites>Prerequisites</h2><ul><li>Have installed Photon Management Daemon on the clients.</li></ul><h2 id=procedure>Procedure</h2><ol><li><p>To initiate remote upgrade, log in to a Photon OS machine over SSH to install the Photon Management Daemon CLI.</p><p><code># tdnf install pmd-cli</code></p></li><li><p>Edit the <code>copenapi_cli</code> spec files so that you can specify the machines you want to upgrade and credentials to be used.</p><ol><li><p>Edit the <code>.netrc</code> file to specify machines to be upgraded and credentials for the PMD service.</p><p><code># vi ~/.netrc</code></p></li><li><p>In the file, enter the IP addresses for the machines and administrative credentials, save and close the file.</p><p><code># machine &lt;IP-address> login &lt;pmd-administrative-user> password &lt;pmd-administrative user-password></code></p></li><li><p>(Optional) Get the location of the <code>restapispec.json</code> file.</p><p><code># cat ~/.copenapi</code></p><p>This command returns <code>apispec=/root/restapispec.json</code> as path for the spec file.</p></li><li><p>Edit the <code>restapispec.json</code> file to enter the IP address of the machine to be upgraded.</p><p><code># vi /root/restapispec.json</code></p></li><li><p>Change the <code>host</code> value to the IP address or the hostname of the machine, leave the port number, and save and close the file.</p><p><code>"host":"&lt;ip-address>:2081"</code></p></li></ol></li><li><p>Initiate the upgrade, in this example of the <code>sed</code> package and wait for the command to complete.</p><p>Specify <code>-k</code> to force blind trust of certificates and <code>-n</code> to use the credentials from the <code>.netrc</code> file.
<code># copenapi_cli pkg update --packages sed -kn</code></p></li><li><p>(Optional) Verify that the package was upgraded successfully.</p><ol><li><p>Log in to the machine that was upgraded over SSH.</p></li><li><p>List the installed version of the <code>sed</code> package.</p><p><code># tdnf list installed sed</code></p></li></ol></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-34235c83fd1b0edbbc2dac2b8fb771b2>5.16 - Photon Management Daemon</h1><p>The Photon Management Daemon (PMD) that ships with Photon OS provides the remote management of a Photon instance via several APIs: a command line client (pmd-cli), a REST API, and a Python API. The PMD provides the ability to manage network interfaces, packages, firewalls, users, and user groups.</p></div><div class=td-content><h1 id=pg-7dffd29a0ca59a5a04679d712683415b>5.16.1 - Installing the pmd Package</h1><p>The pmd package is included with your Photon OS 4.0 distribution. To make sure that you have the latest version, you can run:</p><pre><code># tdnf install pmd
# systemctl start pmd
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-b832cd5094aa75f632bd942ae68c5edc>5.16.2 - Available APIs</h1><p>Photon OS includes the following APIs:</p><ul><li>PMD Rest API</li><li>PMD Python API</li><li>PMD C API</li></ul><h2 id=pmd-rest-api>PMD REST API</h2><p>The PMD REST API is an openapi 2.0 specification. Once the pmd package is installed, you can use a Swagger UI tool to browse the REST API specifications (<code>/etc/pmd/restapispec.json</code>).
You can also browse it using the copenapi_cli tool that comes with the pmd package:</p><pre><code class=language-console data-lang=console>copenapi_cli --apispec /etc/pmd/restapispec.json
</code></pre><p>For more information about the copenapi_cli tool, refer to <a href=https://github.com/vmware/copenapi>github.com/vmware/copenapi</a>.</p><h2 id=pmd-python-api>PMD Python API</h2><p>Python3 is included with your Photon OS 3.0 distribution. PMD Python interfaces are available for python3 (pmd-python3) and python2 (pmd-python2). You can use tdnf to ensure that the latest version is installed:</p><pre><code class=language-console data-lang=console># tdnf install pmd-python3
# systemctl start pmd
</code></pre><p>To navigate the help documentation for the pmd Python packages:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#8f5902;font-style:italic># python3</span>
<span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>pmd</span>
<span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>net</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>pmd</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>server</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>net</span>
<span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>help</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>pmd</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p>To show help text for individual interfaces:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>help</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>pmd</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>server</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>net</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>help</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>pmd</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>server</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>pkg</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>help</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>pmd</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>server</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>firewall</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>help</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>pmd</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>server</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>user</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p>For details about the network commands, see also the <a href=../../docs/administration-guide/netmgr.python/>Network Configuration Manager - Python API</a>.</p><h2 id=pmd-c-api>PMD C API</h2><p>PMD C APIs are defined in the header files (<code>pmd_fwmgmt.h</code>, <code>pmd_netmgr.h</code>, <code>pmd_pkgmgmt.h</code>, <code>pmd_usermgmt.h</code>) that are stored in the following location:</p><ul><li><a href=https://github.com/vmware/pmd/tree/master/include>https://github.com/vmware/pmd/tree/master/include</a></li></ul><p>For details about the network commands, see also the <a href=../../docs/administration-guide/managing-network-configuration/netmgr.c/>Network Configuration Manager - C API</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ecf7e357d2a131135219db95eddda49c>6 - User Guide</h1><p>The Photon OS <em>User Guide</em> provides information about how to use Photon OS as a developer.</p><p>The <em>User Guide</em> covers the basics of setting up a Network PXE Boot Server, working with Kickstart and Kubernetes, and mounting remote file systems.</p><p><strong>Product version: 4.0</strong></p><p>This documentation applies to all 4.0.x releases.</p><h2 id=intended-audiences>Intended Audiences</h2><p>This information is intended for Photon OS developers who use Photon OS.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-16393cd33404005ea8f912eb0e0786ed>6.1 - Setting Up Network PXE Boot</h1><p>Photon OS supports the Preboot Execution Environment, or PXE, over a network connection. This document describes how to set up a PXE boot server to install Photon OS.</p><h1 id=server-setup>Server Setup</h1><p>To set up a PXE server, you will need to have the following:</p><ul><li>A DHCP server to allow hosts to get an IP address.</li><li>A TFTP server, which is a file transfer protocol similar to FTP with no authentication.</li><li>Optionally, an HTTP server. The HTTP server will serve the RPMs yum repo, or you can use the official <a href=https://packages.vmware.com/photon/>VMware Photon Packages</a> repo. Also, this HTTP server can be used if you want to provide a kickstart config for unattended installation.</li></ul><p>The instructions to set up the servers assume you have an Ubuntu 14.04 machine with a static IP address of <code>172.16.78.134</code>.</p><h2 id=dhcp-setup>DHCP Setup</h2><ul><li><p>Install the DHCP server:</p><pre><code>sudo apt-get install isc-dhcp-server  
</code></pre></li><li><p>Edit the Ethernet interface in <code>/etc/default/isc-dhcp-server</code> to <code>INTERFACES="eth0"</code></p></li><li><p>Edit the DHCP configuration in <code>/etc/dhcp/dhcpd.conf</code> to allow machines to boot and get an IP address via DHCP in the range <code>172.16.78.230 - 172.16.78.250</code>, for example:</p><pre><code>subnet 172.16.78.0 netmask 255.255.255.0 {
  range 172.16.78.230 172.16.78.250;
  option subnet-mask 255.255.255.0;
  option routers 172.16.78.134;
  option broadcast-address 172.16.78.255;
  filename &quot;pxelinux.0&quot;;
  next-server 172.16.78.134;
}

</code></pre></li><li><p>Restart the DHCP server:</p><pre><code>sudo service isc-dhcp-server restart
</code></pre></li></ul><h2 id=tftp-setup>TFTP Setup</h2><ul><li><p>Install the TFTP server:</p><pre><code>sudo apt-get install tftpd-hpa
</code></pre></li><li><p>Enable the boot service and restart the service:</p><pre><code>sudo update-inetd --enable BOOT
sudo service tftpd-hpa restart
</code></pre></li></ul><h2 id=optional-http-server-setup>Optional: HTTP server setup</h2><p>This step is only needed if you are planning to serve the ks (kickstart) config file through this server; refer to <a href=../working-with-kickstart/>Kickstart support</a> for details.</p><ul><li>Serving your local yum repo.</li></ul><p>You can install apache http web server:</p><pre><code>sudo apt-get install apache2
</code></pre><p>Mount the Photon iso to get the RPMS repo and sample ks config file:</p><pre><code>mkdir /mnt/photon-iso
sudo mount &lt;photon_iso&gt; /mnt/photon-iso/
</code></pre><p>Copy the RPMS repo:</p><pre><code>cp -r /mnt/photon-iso/RPMS /var/www/html/
</code></pre><p>To support ks, you can copy the sample config file from the iso and edit it; refer to <a href=../working-with-kickstart/>Kickstart support</a> for details.</p><pre><code>cp /mnt/photon-iso/isolinux/sample_ks.cfg /var/www/html/my_ks.cfg
</code></pre><h2 id=pxe-boot-files-setup>PXE boot files setup</h2><ul><li>Mount photon.iso to get Linux and initrd images:</li></ul><pre><code>mkdir /mnt/photon-iso
sudo mount &lt;photon_iso&gt; /mnt/photon-iso/
</code></pre><ul><li>Setting the PXE boot files:</li></ul><pre><code>wget https://www.kernel.org/pub/linux/utils/boot/syslinux/syslinux-6.03.tar.gz
tar -xvf syslinux-6.03.tar.gz
pushd /var/lib/tftpboot
cp -r /mnt/photon-iso/isolinux/* .
cp ~/syslinux-6.03/bios/com32/elflink/ldlinux/ldlinux.c32 .
cp ~/syslinux-6.03/bios/com32/lib/libcom32.c32 .
cp ~/syslinux-6.03/bios/com32/libutil/libutil.c32 .
cp ~/syslinux-6.03/bios/com32/menu/vesamenu.c32 .
cp ~/syslinux-6.03/bios/core/pxelinux.0 .
mkdir pxelinux.cfg
mv isolinux.cfg pxelinux.cfg/default
</code></pre><ul><li>Update repo param to point to http yum repo; you may pass official photon packages repo.</li></ul><pre><code>sed -i &quot;s/append/append repo=http:\/\/172.16.78.134\/RPMS/g&quot; menu.cfg
popd
</code></pre><ul><li>Optionally, you can add your ks config file; see <a href=../working-with-kickstart/>Kickstart support</a> for details.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-e3ea9979ca5ac1affcaa6aea392fd501>6.2 - Kickstart Support in Photon OS</h1><p>Photon OS works with kickstart for unattended, automated installations. The kickstart configuration file can either reside in the CD-ROM attached to the host or be served through an HTTP server.</p><ul><li><a href=#kickstart-capabilities>Kickstart Capabilities</a></li><li><a href=#permitted-json-fields>Permitted JSON Fields</a></li><li><a href=#sample-configuration-file>Sample Configuration File</a></li><li><a href=#unattended-installation-through-kickstart>Unattended Installation Through Kickstart</a></li></ul><h2 id=kickstart-capabilities>Kickstart Capabilities</h2><p>Photon OS supports the following configurations with kickstart:</p><ul><li>Setting the hostname</li><li>Setting the password</li><li>Setting the disk to install</li><li>Selecting whether to install the full or the minimal version of Photon OS</li><li>Applying a post-installation script</li><li>Adding public keys to allow the root account to log in through SSH</li></ul><h2 id=permitted-json-fields>Permitted JSON Fields</h2><p>The following is a list of allowed JSON fields and their descriptions:</p><table style=height:170px border=1 width=250 cellspacing=0 cellpadding=10><tbody><tr><td><b>Field</b></td><td><b>Description</b></td></tr><tr><td>hostname</td><td>The host name as string. You can also specify the name in printf format.<p>The hostname must not start with a number or "-" and must be less than 64 characters.<p>Example: "photon-$((RANDOM%4096))"</p></td></tr><tr><td>password:<p>crypted: true/false<p>text: password text</td><td><b>crypted: true</b>:
This indicates that the "text" field is already encrypted. In this case, the specified password is used as is for the root user.<p><b>crypted: false:</b>
This indicates that the "text" field is plain text. It is then encrypted and used to create the root user's password.<p><b>text</b>: Plain text or encrypted password.</td></tr><tr><td>disk</td><td>Indicates the install disk.<p>Example: /dev/sda</td></tr><tr><td>partitions</td><td>An array of partition definitions.<p><b>To create GPT partitions</b><p>Example:<p>[<p>{"mountpoint": "/", "size": 0, "filesystem": "ext4"},<p>{"mountpoint": "/boot", "size": 128, "filesystem": "ext4"},<p>{"mountpoint": "/root", "size": 128, "filesystem": "ext4"},<p>{"size": 128, "filesystem": "swap"}<p>]<p><b>To create LVM partitions</b><p>Example:<p>[<p>{"mountpoint": "/", "size": 0, "filesystem": "ext4", "lvm":{"vg_name":"vg1", "lv_name":"rootfs"}},<p>{"mountpoint": "/boot", "size": 128, "filesystem": "ext4"},<pre><code>            &lt;p&gt;{&quot;mountpoint&quot;: &quot;/root&quot;, &quot;size&quot;: 128, &quot;filesystem&quot;: &quot;ext4&quot;,&quot;lvm&quot;:{&quot;vg_name&quot;:&quot;vg1&quot;, &quot;lv_name&quot;:&quot;root&quot;}},

            &lt;p&gt;{&quot;size&quot;: 128, &quot;filesystem&quot;: &quot;swap&quot;,&quot;lvm&quot;:{&quot;vg_name&quot;:&quot;vg2&quot;, &quot;lv_name&quot;:&quot;swap&quot;}}
</code></pre><p>]</p><p><b>Note</b>: Mounting '/boot' partition as lvm is not supported.</td></tr></tr><tr><td>packagelist_file</td><td>Indicates the name of the file that contains the list of packages to install.<p>Example: { "packagelist_file": "packages_minimal.json" }</td></tr><tr><td>additional_packages</td><td>Specify an array of additional packages.</td></tr><tr><td>install_linux_esx</td><td>Specify a boolean value to use linux esx instead of generic linux.</td></tr><tr><td>postinstall</td><td>Specify an array of bash commands to execute after install.<p>See the example for partitions.<p>Example:
{ "postinstall": [
"#!/bin/sh",
"echo \"Hello World\" > /etc/postinstall" ] }</td></tr><tr><td>public_key</td><td>Optional.<p>The public key that you require to install for password-less logins.<p>This key is created in authorized_keys in the .ssh directory.</td></tr><tr><td>additional_files</td><td>Optional.<p>Contains a list of pairs {source file (or directory), destination file
(or directory)} to copy to the target system. Source file
(directory) will be looked up in "search_path" list.<p>Example: { "additional_files": [
{"resizefs.sh": "/usr/local/bin/resizefs.sh"},
{"resizefs.service": "/lib/systemd/system/resizefs.service"}]}</td></tr><tr><td>additional_rpms_path</td><td>Optional.<p>Provide a path containing additional RPMS that are to be bundled into
the image.</td></tr><tr><td>arch</td><td>Optional.<p>Target system architecture. Should be set if target architecture is
different from the host, for instance x86_64 machine building RPi
image.
Acceptable values are: "x86_64", "aarch64"
Default value: autodetected host architecture<p>Example: { "arch": "aarch64" }</td></tr><tr><td>bootmode</td><td>Optional.<p>Sets the boot type to support: EFI, BIOS or both.<p>Acceptable values are: bios, efi, dualboot<p><b>bios</b><p>Adds special partition (very first) for first stage grub.<p><b>efi</b><p>Adds ESP (Efi Special Partition), format is as FAT and copy there EFI binaries including grub.efi<p><b>dualboot</b><p>Adds two extra partitions for "bios" and "efi" modes. This target will support both modes that can be switched in bios settings without extra actions in the OS.<p>Default value: "dualboot" for x86_64 and "efi" for aarch64<p>Example: { "bootmode": "bios" }</td></tr><tr><td>eject_cdrom</td><td>Optional.<p>Ejects cdrom after installation completed if set to true.<p>Boolean: true or false<p>Default value: true<p>Example: { "eject_cdrom": false }</td></tr><tr><td>live</td><td>Optional.<p>Should be set to flase if target system is not being run on
host machine. When it set to false, installer will not add EFI boot
entries, and will not generate unique machine-id.<p>Default value: false if "disk" is /dev/loop and true otherwise.<p>Example: { "live": false }</td></tr><tr><td>log_level</td><td>Optional.<p>Set installer logging level.<p>Acceptable values are: <b>error</b>, <b>warning</b>, <b>info</b>, <b>debug</b><p>Default value: </b>info</b><p>Example: { "log_level": "debug" }</td></tr><tr><td>ostree</td><td>Optional.<p>Atomic flavour of Photon OS.<p><b>default_repo</b><p>(required)<p>Define the type of repo data used for installing the OS
There are two type:<p>1. Default Repo(comes with ISO)<p>2. Custom Repo (Remote server)<p>Boolean: true or false<p>where true : Default Repo is selected<p>false: Custom Repo is selected<p>Default value: true
Example: { "ostree": {"default_repo": true}}<p><b>repo_url</b><p>(Required, Only If Custom Repo is selected)
Supported Value: Valid "repo" URL of remote server where repo data exists<p><b>repo_ref</b><p>(Required, Only If Custom Repo is selected)
Supported Value: Valid "ref" path which was mentioned for
creation of Base Tree on remote server<p>Example: { "ostree": {
"default_repo": false,
"repo_url": "http://<ip>:<port>/repo",
"repo_ref": "photon/3.0/x86_64/minimal"
}
}</td></tr><tr><td>packages</td><td>Optional if packagelist_file set.<p>Contains list of packages to install.<p>Example: { "packages": ["minimal", "linux", "initramfs"] }</td></tr><tr><td>partition_type</td><td>Optional.<p>Set partition table type. Supported values are: gpt, msdos.<p>Default value: gpt<p>Example: { "partition_type": "msdos" }</td></tr><tr><td>network</td><td>Optional.<p>Used to configure network on a live/installed system.<p><b>type</b><p>required<p>String; must be one of dhcp/static/vlan. Indicates how the network is being configured.<p><b>hostname</b><p>optional; when type == dhcp<p>String; DHCP client hostname<p><b>ip_addr</b><p>required; when type == static<p>IP String; IP address to be configured<p><b>netmask</b><p>required; when type == static<p>IP String; Netmask to be configured<p><b>gateway</b><p>required; when type == static<p>IP String; Gateway IP address to be configured<p><b>nameserver</b><p>required; when type == static<p>IP String; Name server IP address to be configured<p><b>vlan_id</b><p>required; when type == vlan<p>ID String. (1-4094); VLAN ID number expressed as string</td></tr><tr><td>postinstallscripts</td><td>Optional.<p>Contains list of scripts to run on the target after installation.
Scripts will be looked up in "search_path" list.<p>Example: { "postinstallscripts": ["rpi3-custom-patch.sh"] }</td></tr><tr><td>search_path</td><td>Optional.<p>List of directories to search for additional files and scripts.<p>Example: { "search_path": ["/home/user", "/tmp"] }</td></tr><tr><td>shadow_password</td><td>Optional.<p>Contains encrypted root password.
Short form of: { "password": {
"crypted": true,
"text": "encrypted password here"} }</td></tr><tr><td>ui</td><td>Optional.<p>Installer will show progress status in the UI, if it set to true.
Or logging output will be printed to console - default behavior.<p>Boolean: true or false<p>Default value: false<p>Example: { "ui": true }</td></tr></tbody></table><h2 id=sample-configuration-file>Sample Configuration File</h2><p>Here is a sample kickstart configuration file:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>&#34;hostname&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;photon-machine&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span>
        <span style=color:#000;font-weight:700>{</span>
            <span style=color:#204a87;font-weight:700>&#34;crypted&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span>
            <span style=color:#204a87;font-weight:700>&#34;text&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;changeme&#34;</span>
        <span style=color:#000;font-weight:700>},</span>
    <span style=color:#204a87;font-weight:700>&#34;disk&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/dev/sda&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;partitions&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
                        <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;mountpoint&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;size&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;filesystem&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ext4&#34;</span><span style=color:#000;font-weight:700>},</span>
                        <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;mountpoint&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/boot&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;size&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>128</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;filesystem&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ext4&#34;</span><span style=color:#000;font-weight:700>},</span>
                        <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;mountpoint&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/root&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;size&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>128</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;filesystem&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ext4&#34;</span><span style=color:#000;font-weight:700>},</span>
                        <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;size&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>128</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;filesystem&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;swap&#34;</span><span style=color:#000;font-weight:700>}</span>
                    <span style=color:#000;font-weight:700>],</span>
    <span style=color:#204a87;font-weight:700>&#34;packagelist_file&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;packages_minimal.json&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;additional_packages&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;vim&#34;</span><span style=color:#000;font-weight:700>],</span>
    <span style=color:#204a87;font-weight:700>&#34;postinstall&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
                		<span style=color:#4e9a06>&#34;#!/bin/sh&#34;</span><span style=color:#000;font-weight:700>,</span>
                    	<span style=color:#4e9a06>&#34;echo \&#34;Hello World\&#34; &gt; /etc/postinstall&#34;</span>
                   <span style=color:#000;font-weight:700>],</span>
    <span style=color:#204a87;font-weight:700>&#34;public_key&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;&lt;ssh-key-here&gt;&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;install_linux_esx&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;network&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;dhcp&#34;</span>
    <span style=color:#000;font-weight:700>}</span>    
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><h2 id=installing-root-partition-as-lvm>Installing Root Partition as LVM</h2><p>In the kickstart file modify the <strong>partitions</strong> field to mount root partition as LVM.</p><p>For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#4e9a06>&#34;disk&#34;</span><span style=color:#a40000>:</span> <span style=color:#4e9a06>&#34;/dev/sda&#34;</span>
<span style=color:#4e9a06>&#34;partitions&#34;</span><span style=color:#a40000>:</span><span style=color:#000;font-weight:700>[</span>
                <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;mountpoint&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;size&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;filesystem&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ext4&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;lvm&#34;</span><span style=color:#000;font-weight:700>:{</span><span style=color:#204a87;font-weight:700>&#34;vg_name&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;vg1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;lv_name&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;rootfs&#34;</span><span style=color:#000;font-weight:700>}},</span>
                <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;mountpoint&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/boot&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;size&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>128</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;filesystem&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ext4&#34;</span><span style=color:#000;font-weight:700>},</span>

                <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;mountpoint&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/root&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;size&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>128</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;filesystem&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ext4&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#204a87;font-weight:700>&#34;lvm&#34;</span><span style=color:#000;font-weight:700>:{</span><span style=color:#204a87;font-weight:700>&#34;vg_name&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;vg1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;lv_name&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;root&#34;</span><span style=color:#000;font-weight:700>}},</span>

                <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;size&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>128</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;filesystem&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;swap&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#204a87;font-weight:700>&#34;lvm&#34;</span><span style=color:#000;font-weight:700>:{</span><span style=color:#204a87;font-weight:700>&#34;vg_name&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;vg2&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;lv_name&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;swap&#34;</span><span style=color:#000;font-weight:700>}}</span>
<span style=color:#000;font-weight:700>]</span>

</code></pre></div><p><strong>Note</strong>:</p><ul><li>vg_name : Volume Group Name</li><li>lv_name : Logical Volume Name</li></ul><p>In above example <strong>rootfs</strong>, <strong>root</strong> are logical volumes in the volume group <strong>vg1</strong> and <strong>swap</strong> is logical volume in volume group <strong>vg2</strong>, physical volumes are part of disk <strong>/dev/sda</strong>.</p><p>Multiple disks are also supported. For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#4e9a06>&#34;disk&#34;</span><span style=color:#a40000>:</span> <span style=color:#4e9a06>&#34;/dev/sda&#34;</span>
<span style=color:#4e9a06>&#34;partitions&#34;</span><span style=color:#a40000>:</span><span style=color:#000;font-weight:700>[</span>
                <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;mountpoint&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;size&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;filesystem&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ext4&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;lvm&#34;</span><span style=color:#000;font-weight:700>:{</span><span style=color:#204a87;font-weight:700>&#34;vg_name&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;vg1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;lv_name&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;rootfs&#34;</span><span style=color:#000;font-weight:700>}},</span>
                <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;mountpoint&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/boot&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;size&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>128</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;filesystem&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ext4&#34;</span><span style=color:#000;font-weight:700>},</span>

                <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;disk&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/dev/sdb&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;mountpoint&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/root&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;size&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>128</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;filesystem&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ext4&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#204a87;font-weight:700>&#34;lvm&#34;</span><span style=color:#000;font-weight:700>:{</span><span style=color:#204a87;font-weight:700>&#34;vg_name&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;vg1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;lv_name&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;root&#34;</span><span style=color:#000;font-weight:700>}},</span>

                <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;size&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>128</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;filesystem&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;swap&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#204a87;font-weight:700>&#34;lvm&#34;</span><span style=color:#000;font-weight:700>:{</span><span style=color:#204a87;font-weight:700>&#34;vg_name&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;vg1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>&#34;lv_name&#34;</span><span style=color:#000;font-weight:700>:</span><span style=color:#4e9a06>&#34;swap&#34;</span><span style=color:#000;font-weight:700>}}</span>
<span style=color:#000;font-weight:700>]</span>
</code></pre></div><p>If disk name is not specified, the physical volumes will be part of the default disk: <strong>dev/sda</strong>.
In above example <strong>rootfs</strong>,<strong>root</strong> and <strong>swap</strong> are logical volumes in volume group <strong>vg1</strong>, physical volumes are in the disk <strong>/dev/sdb</strong> and partitions are present in <strong>/dev/sda</strong>.</p><p><strong>Note</strong>: Mounting <strong>/boot</strong> partition as LVM is not supported.</p><h2 id=unattended-installation-through-kickstart>Unattended Installation Through Kickstart</h2><p>For an unattended installation, you pass the <code>ks=&lt;config_file></code> parameter to the kernel command. To pass the config file, there are two options: by providing it on the ISO or by serving it from an HTTP server.</p><p>The syntax to pass the config-file to the kernel through the ISO takes the following form:</p><pre><code class=language-console data-lang=console>ks=cdrom:/&lt;config_file_path&gt;
</code></pre><p>Here is an example:</p><pre><code class=language-console data-lang=console>ks=cdrom:/isolinux/my_ks.cfg
</code></pre><p>The syntax to serve the config-file to the kernel from a HTTPS server takes the following form:</p><pre><code class=language-console data-lang=console>ks=https://&lt;server&gt;/&lt;config_file_path&gt;
</code></pre><p>To use HTTP path or self-signed HTTPS path, you have to enable <code>insecure_installation</code> by using insecure_installation=1 along with defining the ks path. The kernel command line argument, <code>insecure_installation</code>, acts as a flag that user can set to 1 to allow some operations that are not normally allowed due to security concerns. This is disabled by default and it is up to the user to the ensure security when this options is enabled.</p><ul><li><p>For HTTP: <code>ks=http://&lt;server>/&lt;config_file_path> insecure_installation=1</code></p></li><li><p>For HTTPS (self-signed): <code>ks=https://&lt;server>/&lt;config_file_path> insecure_installation=1</code></p></li></ul><h2 id=building-an-iso-with-a-kickstart-config-file>Building an ISO with a Kickstart Config File</h2><p>Here&rsquo;s an example of how to add a kickstart config file to the Photon OS ISO by mounting the ISO on an Ubuntu machine and then rebuilding the ISO. The following example assumes you can adapt the sample kickstart configuration file that comes with the Photon OS ISO to your needs. You can obtain the Photon OS ISO for free from VMware at the following URL:</p><p><a href=https://packages.vmware.com/photon>https://packages.vmware.com/photon</a></p><p>Once you have the ISO, mount it.</p><pre><code class=language-console data-lang=console>mkdir /tmp/photon-iso
sudo mount photon.iso /tmp/photon-iso
</code></pre><p>Then copy the content of the ISO to a writable directory and push it into the directory stack:</p><pre><code class=language-console data-lang=console>mkdir /tmp/photon-ks-iso
cp -r /tmp/photon-iso/* /tmp/photon-ks-iso/
pushd /tmp/photon-ks-iso/
</code></pre><p>Next, copy the sample kickstart configuration file that comes with the Photon OS ISO and modify it to suit your needs. In the ISO, the sample kickstart config file appears in the <code>isolinux</code> directory and is named <code>sample_ks.cfg.</code> The name of the directory and the name of the file might be in all uppercase letters.</p><pre><code class=language-console data-lang=console>cp isolinux/sample_ks.cfg isolinux/my_ks.cfg
nano isolinux/my_ks.cfg
</code></pre><p>With a copy of the sample kickstart config file open in nano, make the changes that you want.</p><p>Now add a new item to the installation menu by modifying <code>isolinux/menu.cfg</code>:</p><pre><code class=language-console data-lang=console>cat &gt;&gt; isolinux/menu.cfg &lt;&lt; EOF
label my_unattended
	menu label ^My Unattended Install
	menu default
	kernel vmlinuz
	append initrd=initrd.img root=/dev/ram0 loglevel=3 photon.media=cdrom
EOF
</code></pre><p>Finally, rebuild the ISO so that it includes your kickstart config file:</p><pre><code class=language-console data-lang=console>mkisofs -R -l -L -D -b isolinux/isolinux.bin -c isolinux/boot.cat \
		-no-emul-boot -boot-load-size 4 -boot-info-table -V &quot;PHOTON_$(date +%Y%m%d)&quot; \
		. &gt; &lt;new_iso_path&gt;.iso

popd
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-79efb1f65c2452f0b90208ebaf1a084a>6.3 - Kickstart Through HTTP</h1><p>You can serve the kickstart configuration file through an HTTP server. You can use a Packer template to set variables through command line or a JSON file.</p><p>The steps in this section describe how you can use the preset to kick start a full build or build a VMware Workstation or Fusion vagrant box.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b338b8d42ae84dbcbff83de1753e995c>6.3.1 - Prerequisites</h1><p>Before you kick start a build, verify that you have the following resources:</p><ul><li>Packer 0.8 or later version.</li><li>VMware Fusion or Workstation</li><li>VirtualBox (optional)</li><li>Photon Packer template. The template contains the following artifacts:<ul><li><code>packer-photon.json</code> file</li><li><code>scripts</code> folder. The folder that contains the scripts you require to kickstart Photon OS.</li><li><code>vars</code> folder. The folder that contains the Photon OS 3.0 ISO URL.</li></ul></li><li><code>packages_minimal.json</code> file. The JSON file that contains the install profile you require.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-c6671d9a6869cb4af2c047b4f76575c9>6.3.2 - Procedure</h1><p>To build Photon OS using the Packer template, set the variables that the template uses and run the build commands.</p><ul><li><a href=#set-variables>Set Variables</a></li><li><a href=#kick-start-build>Kick Start Build</a></li><li><a href=#build-vmware-workstation-or-fusion-vagrant-box>Build VMware Workstation or Fusion Vagrant Box</a></li></ul><h2 id=set-variables>Set Variables</h2><p>To use the Packer template, you must set the variables that the template uses. You can set the variables through command line or a JSON file.</p><p>Set the following variables:</p><ul><li><code>iso_file</code> - The photon ISO for the build. This file can be local or remote.</li><li><code>iso_sha1sum</code> – The SHA1 sum of the ISO you want to build.</li><li><code>product_version</code> - The Photon OS release version that you want to build. This version is added to the image filename.</li></ul><p>Preset JSON files with the required parameters are located in the <code>photon-packer-templates/vars</code> folder.</p><h2 id=kick-start-build>Kick Start Build</h2><p>To kick start a build using the JSON file, run the following command:</p><pre><code>packer build -var-file=vars/iso-3.0GA.json packer-photon.json
</code></pre><p>To build Photon OS manually, run the following:</p><pre><code>packer build \
        -var 'iso_file=https://packages.vmware.com/photon/4.0/GA/iso/photon-4.0-1526e30ba.iso' \
        -var 'iso_sha1sum=2221ab214b517a15c60bd5e2aacdb9388581bcd9' \
        -var 'product_version=4.0GA' \
        packer-photon.json
</code></pre><h2 id=build-vmware-workstation-or-fusion-vagrant-box>Build VMware Workstation or Fusion Vagrant Box</h2><p>To build only a VMware Workstation or Fusion vagrant box, run:</p><pre><code>packer build -only=vagrant-vmware_desktop -var-file=vars/iso-4.0GA.json packer-photon.json
</code></pre><p>or:</p><pre><code>packer build \
       -only=vagrant-vmware_desktop \
       -var 'iso_file= https://packages.vmware.com/photon/4.0/GA/iso/photon-4.0-1526e30ba.iso ' \
       -var 'iso_sha1sum= 2221ab214b517a15c60bd5e2aacdb9388581bcd9' \
       -var 'product_version=4.0GA' \
       packer-photon.json
</code></pre><p>You can build to one of the following targets:</p><ul><li><code>vagrant-vmware_desktop</code> - Generates the <code>vmware_desktop</code> compatible box found on Atlas as <code>vmware/photon</code>.</li><li><code>vagrant-virtualbox</code> - Generates the <code>virtualbox</code> compatible box found on Atlas as <code>vmware/photon</code>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-7721e9f0e5e555bb6640c7092e191a79>6.3.3 - Photon Packer Template</h1><p>The Photon Packer template folder has the following structure:</p><pre><code>photon-packer-templates/
.
├── README.md
├── packer-photon.json
├── scripts
│   ├── photon-kickstart.json
│   ├── photon-package_provisioning.sh
│   ├── photon-security_check.sh
│   ├── photon-sharedfolders_prep.sh
│   ├── photon-vagrant-user_provisioning.sh
│   ├── photon-vagrant-vbox_additions.sh
│   ├── photon-vagrantfile.rb
│   └── photon-virtualbox-load-module.conf
└── vars
    └── iso-4.0GA.json

2 directories, 11 files
</code></pre><h2 id=packer-photonjson>packer-photon.json</h2><p>The following are the contents of the <code>photon-packer-templates/packer-photon.json</code> file:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>&#34;variables&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>&#34;iso_file&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;iso_sha1sum&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;product_version&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;root_password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;changeme&#34;</span>
  <span style=color:#000;font-weight:700>},</span>
  <span style=color:#204a87;font-weight:700>&#34;builders&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
    <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;vagrant-vmware_desktop&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;vm_name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;photon&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;vmdk_name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;photon-disk1&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;vmware-iso&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;headless&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;disk_size&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>20480</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;disk_type_id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;guest_os_type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;other3xlinux-64&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;iso_url&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;{{user `iso_file`}}&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;iso_checksum&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;{{user `iso_sha1sum`}}&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;iso_checksum_type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;sha1&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;ssh_username&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;root&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;ssh_password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;{{user `root_password`}}&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;ssh_wait_timeout&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;60m&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;boot_wait&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;5s&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;shutdown_command&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;shutdown -h now&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;http_directory&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;scripts&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;version&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>11</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;vmx_data&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#204a87;font-weight:700>&#34;scsi0.virtualDev&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;pvscsi&#34;</span><span style=color:#000;font-weight:700>,</span>
        <span style=color:#204a87;font-weight:700>&#34;ethernet0.virtualDev&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;vmxnet3&#34;</span>
        <span style=color:#000;font-weight:700>},</span>
      <span style=color:#204a87;font-weight:700>&#34;vmx_data_post&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#204a87;font-weight:700>&#34;displayname&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;VMware Photon&#34;</span><span style=color:#000;font-weight:700>,</span>
        <span style=color:#204a87;font-weight:700>&#34;usb.present&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;false&#34;</span>
        <span style=color:#000;font-weight:700>},</span>
        <span style=color:#204a87;font-weight:700>&#34;boot_command&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
          <span style=color:#4e9a06>&#34;&lt;esc&gt;&lt;wait&gt;&#34;</span><span style=color:#000;font-weight:700>,</span>
          <span style=color:#4e9a06>&#34;vmlinuz initrd=initrd.img root=/dev/ram0 loglevel=3 ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/photon-kickstart.json photon.media=cdrom&#34;</span><span style=color:#000;font-weight:700>,</span>
          <span style=color:#4e9a06>&#34;&lt;enter&gt;&#34;</span>
        <span style=color:#000;font-weight:700>]</span>
    <span style=color:#000;font-weight:700>},</span>
    <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;vagrant-virtualbox&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;vm_name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;photon&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;virtualbox-iso&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;headless&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;hard_drive_interface&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;scsi&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;disk_size&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>20480</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;guest_os_type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Linux_64&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;iso_url&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;{{user `iso_file`}}&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;iso_checksum&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;{{user `iso_sha1sum`}}&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;iso_checksum_type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;sha1&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;ssh_username&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;root&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;ssh_password&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;{{user `root_password`}}&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;ssh_wait_timeout&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;60m&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;boot_wait&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;5s&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;http_directory&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;scripts&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;shutdown_command&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;shutdown -h now&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;boot_command&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
        <span style=color:#4e9a06>&#34;&lt;esc&gt;&lt;wait&gt;&#34;</span><span style=color:#000;font-weight:700>,</span>
        <span style=color:#4e9a06>&#34;vmlinuz initrd=initrd.img root=/dev/ram0 loglevel=3 ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/photon-kickstart.json&#34;</span><span style=color:#000;font-weight:700>,</span>
        <span style=color:#4e9a06>&#34;&lt;enter&gt;&#34;</span>
      <span style=color:#000;font-weight:700>]</span>
    <span style=color:#000;font-weight:700>}</span>
  <span style=color:#000;font-weight:700>],</span>
    <span style=color:#204a87;font-weight:700>&#34;provisioners&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
    <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;shell&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;script&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;scripts/photon-package_provisioning.sh&#34;</span>
    <span style=color:#000;font-weight:700>},</span>
    <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;shell&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;only&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;vagrant-vmware_desktop&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;vagrant-virtualbox&#34;</span><span style=color:#000;font-weight:700>],</span>
      <span style=color:#204a87;font-weight:700>&#34;script&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;scripts/photon-vagrant-user_provisioning.sh&#34;</span>
    <span style=color:#000;font-weight:700>},</span>
    <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;shell&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;only&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;vagrant-vmware_desktop&#34;</span><span style=color:#000;font-weight:700>],</span>
      <span style=color:#204a87;font-weight:700>&#34;script&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;scripts/photon-sharedfolders_prep.sh&#34;</span>
    <span style=color:#000;font-weight:700>},</span>
    <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;shell&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;only&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;vagrant-virtualbox&#34;</span><span style=color:#000;font-weight:700>],</span>
      <span style=color:#204a87;font-weight:700>&#34;script&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;scripts/photon-vagrant-vbox_additions.sh&#34;</span>
    <span style=color:#000;font-weight:700>},</span>
    <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;file&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;only&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;vagrant-virtualbox&#34;</span><span style=color:#000;font-weight:700>],</span>
      <span style=color:#204a87;font-weight:700>&#34;source&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;scripts/photon-virtualbox-load-module.conf&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;destination&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/etc/modules-load.d/virtualbox.conf&#34;</span>
    <span style=color:#000;font-weight:700>},</span>
    <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;shell&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;inline&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;sed -i &#39;/linux/ s/$/ net.ifnames=0/&#39; /boot/grub2/grub.cfg&#34;</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#000;font-weight:700>},</span>
    <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;shell&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;inline&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;echo &#39;GRUB_CMDLINE_LINUX=\&#34;net.ifnames=0\&#34;&#39; &gt;&gt; /etc/default/grub&#34;</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#000;font-weight:700>},</span>
    <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;shell&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;script&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;scripts/photon-security_check.sh&#34;</span>
    <span style=color:#000;font-weight:700>},</span>
    <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;shell&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;inline&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;sed -i &#39;s/OS/Linux/&#39; /etc/photon-release&#34;</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#000;font-weight:700>}</span>
  <span style=color:#000;font-weight:700>],</span>
  <span style=color:#204a87;font-weight:700>&#34;post-processors&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
    <span style=color:#000;font-weight:700>{</span>
      <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;vagrant&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;only&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;vagrant-vmware_desktop&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;vagrant-virtualbox&#34;</span><span style=color:#000;font-weight:700>],</span>
      <span style=color:#204a87;font-weight:700>&#34;compression_level&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>9</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;vagrantfile_template&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;scripts/photon-vagrantfile.rb&#34;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#204a87;font-weight:700>&#34;output&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;photon-{{user `product_version`}}-{{.BuildName}}.box&#34;</span>
    <span style=color:#000;font-weight:700>}</span>
  <span style=color:#000;font-weight:700>]</span>
  <span style=color:#000;font-weight:700>}</span>
</code></pre></div><h2 id=photon-kickstartjson>photon-kickstart.json</h2><p>The following are the contents of the <code>photon-packer-templates/scripts/photon-kickstart.json</code> file:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>&#34;hostname&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;photon&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;password&#34;</span><span style=color:#000;font-weight:700>:</span>
        <span style=color:#000;font-weight:700>{</span>
            <span style=color:#204a87;font-weight:700>&#34;crypted&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>,</span>
            <span style=color:#204a87;font-weight:700>&#34;text&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;2RQrZ83i79N6szpvZNX6&#34;</span>
        <span style=color:#000;font-weight:700>},</span>
    <span style=color:#204a87;font-weight:700>&#34;disk&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/dev/sda&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;packagelist_file&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;packages_minimal.json&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;postinstall&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
                    <span style=color:#4e9a06>&#34;#!/bin/sh&#34;</span><span style=color:#000;font-weight:700>,</span>
                    <span style=color:#4e9a06>&#34;sed -i &#39;s/PermitRootLogin no/PermitRootLogin yes/g&#39; /etc/ssh/sshd_config&#34;</span><span style=color:#000;font-weight:700>,</span>
                    <span style=color:#4e9a06>&#34;systemctl restart sshd.service&#34;</span>
                   <span style=color:#000;font-weight:700>]</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><h2 id=iso-40gajson>iso-4.0GA.json</h2><p>The following are the contents of the <code>photon-packer-templates/vars/iso-4.0GA.json</code> file:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
   <span style=color:#204a87;font-weight:700>&#34;product_version&#34;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;4.0GA&#34;</span><span style=color:#000;font-weight:700>,</span>
   <span style=color:#204a87;font-weight:700>&#34;iso_sha1sum&#34;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;2221ab214b517a15c60bd5e2aacdb9388581bcd9&#34;</span><span style=color:#000;font-weight:700>,</span>
   <span style=color:#204a87;font-weight:700>&#34;iso_file&#34;</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;https://packages.vmware.com/photon/4.0/GA/iso/photon-4.0-1526e30ba.iso&#34;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>For more information about the template, see <a href=https://github.com/vmware/photon-packer-templates>Photon Packer Template</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-b3fb62a9ed54be9848715232ab3fd71e>6.3.4 - packages_minimal.json File</h1><p>The <code>packages_minimal.json</code> file contains the install profile that you require.</p><p>The contents of the file are as follows:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>&#34;packages&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
                 <span style=color:#4e9a06>&#34;minimal&#34;</span><span style=color:#000;font-weight:700>,</span>
                 <span style=color:#4e9a06>&#34;linux&#34;</span><span style=color:#000;font-weight:700>,</span>
                 <span style=color:#4e9a06>&#34;initramfs&#34;</span>
                 <span style=color:#000;font-weight:700>]</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>&lsquo;minimal` is a meta package contains a number of default packages.</p><p>For more imformation, see <a href=https://github.com/vmware/photon/blob/4.0/SPECS/minimal/minimal.spec>4.0 minimal.spec</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-3e27135293bfebb45948275ce7512443>6.4 - Kubernetes on Photon OS</h1><p>You can use Kubernetes with Photon OS. The instructions in this section present a manual configuration that gets one worker node running to help you understand the underlying packages, services, ports, and so forth.</p><p>The Kubernetes package provides several services: kube-apiserver, kube-scheduler, kube-controller-manager, kubelet, kube-proxy. These services are managed by systemd. Their configuration resides in a central location: /etc/kubernetes.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8be233206817193d67a60d7415f17ef9>6.4.1 - Prerequisites</h1><p>You need two or more machines with version 3.0 &ldquo;GA&rdquo; or later of Photon OS installed. It is recommended to use the latest 4.0 GA version.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ea490ab437c762e0efed3eb8be4354d4>6.4.2 - Running Kubernetes on Photon OS</h1><p>The procedure describes how to break the services up between the hosts.</p><p>The first host, <code>photon-master</code>, is the Kubernetes master. This host runs the <code>kube-apiserver</code>, <code>kube-controller-manager</code>, and <code>kube-scheduler</code>. In addition, the master also runs <code>etcd</code>. Although <code>etcd</code> is not needed on the master if <code>etcd</code> runs on a different host, this guide assumes that <code>etcd</code> and the Kubernetes master run on the same host. The remaining host, <code>photon-node</code>, is the node and runs <code>kubelet</code>, <code>proxy</code>, and <code>docker</code>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-a1d2e42542f91c88d6de82a65837b7e5>6.4.2.1 - System Information</h1><p>Hosts:</p><pre><code>photon-master = 192.168.121.9
photon-node = 192.168.121.65
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-6a11cf2f4ce782f763245a10cdcfc7b9>6.4.2.2 - Prepare the Hosts</h1><p>The following packages have to be installed. If the <code>tdnf</code> command returns &ldquo;Nothing to do,&rdquo; the package is already installed.</p><ul><li><p>Install Kubernetes on all hosts (both <code>photon-master</code> and <code>photon-node</code>).</p><pre><code class=language-console data-lang=console>tdnf install kubernetes
</code></pre></li><li><p>Install iptables on photon-master and photon-node:</p><pre><code class=language-console data-lang=console>tdnf install iptables
</code></pre></li><li><p>Open the tcp port 8080 (api service) on the photon-master in the firewall</p><pre><code class=language-console data-lang=console>iptables -A INPUT -p tcp --dport 8080 -j ACCEPT
</code></pre></li><li><p>Open the tcp port 10250 (api service) on the photon-node in the firewall</p><pre><code class=language-console data-lang=console>iptables -A INPUT -p tcp --dport 10250 -j ACCEPT
</code></pre></li><li><p>Install Docker on photon-node:</p><pre><code class=language-console data-lang=console>tdnf install docker
</code></pre></li><li><p>Add master and node to /etc/hosts on all machines (not needed if the hostnames are already in DNS). Make sure that communication works between photon-master and photon-node by using a utility such as ping.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;192.168.121.9	photon-master
</span><span style=color:#4e9a06>192.168.121.65	photon-node&#34;</span> &gt;&gt; /etc/hosts
</code></pre></div></li><li><p>Edit /etc/kubernetes/config, which will be the same on all the hosts (master and node), so that it contains the following lines:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#8f5902;font-style:italic># Comma separated list of nodes in the etcd cluster</span>
<span style=color:#c4a000>KUBE_MASTER</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--master=http://photon-master:8080&#34;</span>

<span style=color:#8f5902;font-style:italic># logging to stderr routes it to the systemd journal</span>
<span style=color:#c4a000>KUBE_LOGTOSTDERR</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--logtostderr=true&#34;</span>

<span style=color:#8f5902;font-style:italic># journal message level, 0 is debug</span>
<span style=color:#c4a000>KUBE_LOG_LEVEL</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--v=0&#34;</span>

<span style=color:#8f5902;font-style:italic># Should this cluster be allowed to run privileged docker containers</span>
<span style=color:#c4a000>KUBE_ALLOW_PRIV</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--allow_privileged=false&#34;</span>
</code></pre></div></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-fe4d3e3b9b42532a4e4db9ae8a685b08>6.4.2.3 - Configure Kubernetes Services on the Master</h1><p>Perform the following steps to configure Kubernetes services on the master:</p><ol><li><p>Edit <code>/etc/kubernetes/apiserver</code> to appear as such. The <code>service_cluster_ip_range</code> IP addresses must be an unused block of addresses, not used anywhere else. They do not need to be routed or assigned to anything.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#8f5902;font-style:italic># The address on the local server to listen to.</span>
<span style=color:#c4a000>KUBE_API_ADDRESS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--address=0.0.0.0&#34;
</span><span style=color:#4e9a06>   </span>
<span style=color:#8f5902;font-style:italic># Comma separated list of nodes in the etcd cluster</span>
<span style=color:#c4a000>KUBE_ETCD_SERVERS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--etcd-servers=http://127.0.0.1:4001&#34;
</span><span style=color:#4e9a06>   </span>
<span style=color:#8f5902;font-style:italic># Address range to use for services</span>
<span style=color:#c4a000>KUBE_SERVICE_ADDRESSES</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--service-cluster-ip-range=10.254.0.0/16&#34;
</span><span style=color:#4e9a06>   </span>
<span style=color:#8f5902;font-style:italic># Add your own</span>
<span style=color:#c4a000>KUBE_API_ARGS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>
</code></pre></div></li><li><p>Start the appropriate services on master:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#204a87;font-weight:700>for</span> SERVICES in etcd kube-apiserver kube-controller-manager kube-scheduler<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>do</span>
    systemctl restart <span style=color:#000>$SERVICES</span>
    systemctl <span style=color:#204a87>enable</span> <span style=color:#000>$SERVICES</span>
    systemctl status <span style=color:#000>$SERVICES</span>
<span style=color:#204a87;font-weight:700>done</span>
</code></pre></div></li><li><p>To add the other node, create the following <code>node.json</code> file on the Kubernetes master node:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>&#34;apiVersion&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;v1&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;kind&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Node&#34;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#204a87;font-weight:700>&#34;metadata&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;photon-node&#34;</span><span style=color:#000;font-weight:700>,</span>
        <span style=color:#204a87;font-weight:700>&#34;labels&#34;</span><span style=color:#000;font-weight:700>:{</span> <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;photon-node-label&#34;</span><span style=color:#000;font-weight:700>}</span>
    <span style=color:#000;font-weight:700>},</span>
    <span style=color:#204a87;font-weight:700>&#34;spec&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#204a87;font-weight:700>&#34;externalID&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;photon-node&#34;</span>
    <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div></li><li><p>Create a node object internally in your Kubernetes cluster by running the following command:</p><pre><code class=language-console data-lang=console>$ kubectl create -f ./node.json
   
$ kubectl get nodes
NAME                LABELS              STATUS
photon-node         name=photon-node-label     Unknown
</code></pre></li></ol><p><strong>Note</strong>: The above example only creates a representation for the node <code>photon-node</code> internally. It does not provision the actual <code>photon-node</code>. Also, it is assumed that <code>photon-node</code> (as specified in <code>name</code>) can be resolved and is reachable from the Kubernetes master node.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8bb2c13b46e9ad89de8e37d2b8c8929b>6.4.2.4 - Configure the Kubernetes services on Node</h1><p>Perform the following steps to configure the kubelet on the node:</p><ol><li><p>Edit /etc/kubernetes/kubelet to appear like this:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#8f5902;font-style:italic>###</span>
<span style=color:#8f5902;font-style:italic># Kubernetes kubelet (node) config</span>
   
<span style=color:#8f5902;font-style:italic># The address for the info server to serve on (set to 0.0.0.0 or &#34;&#34; for all interfaces)</span>
<span style=color:#c4a000>KUBELET_ADDRESS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--address=0.0.0.0&#34;
</span><span style=color:#4e9a06>   </span>
<span style=color:#8f5902;font-style:italic># You may leave this blank to use the actual hostname</span>
<span style=color:#c4a000>KUBELET_HOSTNAME</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--hostname_override=photon-node&#34;
</span><span style=color:#4e9a06>   </span>
<span style=color:#8f5902;font-style:italic># location of the api-server</span>
<span style=color:#c4a000>KUBELET_API_SERVER</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--kubeconfig=/etc/kubernetes/kubeconfig&#34;
</span><span style=color:#4e9a06>   </span>
<span style=color:#8f5902;font-style:italic># Add your own</span>
<span style=color:#8f5902;font-style:italic>#KUBELET_ARGS=&#34;&#34;</span>
</code></pre></div></li><li><p>Start the appropriate services on the node (photon-node):</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#204a87;font-weight:700>for</span> SERVICES in kube-proxy kubelet docker<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>do</span> 
    systemctl restart <span style=color:#000>$SERVICES</span>
    systemctl <span style=color:#204a87>enable</span> <span style=color:#000>$SERVICES</span>
    systemctl status <span style=color:#000>$SERVICES</span> 
<span style=color:#204a87;font-weight:700>done</span>
</code></pre></div></li><li><p>Check to make sure that the cluster can now see the photon-node on photon-master and that its status changes to <em>Ready</em>.</p><pre><code class=language-console data-lang=console>kubectl get nodes
NAME                LABELS              STATUS
photon-node          name=photon-node-label     Ready
</code></pre><p>If the node status is <code>NotReady</code>, verify that the firewall rules are permissive for Kubernetes.</p><ul><li>Deletion of nodes: To delete <em>photon-node</em> from your Kubernetes cluster, one should run the following on photon-master (please do not do it, it is just for information):</li></ul><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kubectl delete -f ./node.json
</code></pre></div></li></ol><h2 id=result>Result</h2><p>You should have a functional cluster. You can now launch a test pod. For an introduction to working with Kubernetes, see <a href=http://kubernetes.io/docs/home/>Kubernetes documentation</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b667c012d3f48edb1e0e30433c8f9a6e>6.5 - Photon NFS Utilities for Mounting Remote File Systems</h1><p>This document describes how to mount a remote file system on Photon OS by using nfs-utils, a commonly used package that contains tools to work with the Network File System protocol (NFS).</p><h2 id=check-a-remote-server>Check a Remote Server</h2><pre><code>showmount  -e nfs-servername or ip
</code></pre><p>Example:</p><pre><code>showmount -e eastern-filer.eng.vmware.com
showmount -e 10.109.87.129
</code></pre><h2 id=mount-a-remote-file-system-in-photon-full>Mount a Remote File System in Photon Full</h2><p>The nfs-utils package is installed by default in the full version of Photon OS. Here is how to mount a directory through NFS on Photon OS:</p><pre><code>mount -t nfs nfs-ServernameOrIp:/exportfolder /mnt/folder
</code></pre><p>Example:</p><pre><code>mount -t nfs eastern-filer.eng.vmware.com:/export/filer /mnt/filer
mount -t nfs 10.109.87.129:/export /mnt/export
</code></pre><h2 id=mount-a-remote-file-system-in-photon-minimal>Mount a Remote File System in Photon Minimal</h2><p>The nfs-utils package is not installed in the minimal version of Photon OS. You install it by running the following command:</p><pre><code>tdnf install nfs-utils
</code></pre><p>For more information on installing packages with the tdnf command, see the <a href=../../administration-guide/>Photon OS Administration Guide</a>.</p><p>Once nfs-utils is installed, you can mount a file system by running the following commands, replacing the placeholders with the path of the directory that you want to mount:</p><pre><code>mount nfs
mount -t nfs nfs-ServernameOrIp:/exportfolder /mnt/folder
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-8b6282a218a1c99be95898ab027a0a44>7 - Command-Line Reference</h1><p>The Photon OS <em>Command-Line Reference</em> provides information about the command-line interfaces available in Photon OS.</p><p><strong>Product version: 4.0</strong></p><p>This documentation applies to all 4.0.x releases.</p><h2 id=intended-audiences>Intended Audiences</h2><p>This information is intended for Photon OS administrators and users.</p></div><div class=td-content><h1 id=pg-108c8be60349f80ed2fa1d40951c15a7>7.1 - Command-line Interfaces</h1><p>Photon OS includes the following command-line utilities:</p></div><div class=td-content><h1 id=pg-f05528a6ba8fdbf06e535912d97d5811>7.1.1 - Photon Management Daemon Command-line Interface (pmd-cli)</h1><p>Photon OS provides the Photon Management Daemon command line interface (pmd-cli).</p><ul><li><a href=#setup-steps>Setup Steps</a></li><li><a href=#syntax>Syntax</a></li><li><a href=#firewall-management>Firewall Management</a></li><li><a href=#network-management>Network Management</a></li><li><a href=#package-management>Package Management</a></li><li><a href=#user-management>User Management</a></li></ul><h1 id=setup-steps>Setup Steps</h1><p>The pmd-cli utility is included with your Photon OS distribution. To make sure that you have the latest version, you can run:</p><pre><code class=language-console data-lang=console>tdnf install pmd-cli
</code></pre><h1 id=syntax>Syntax</h1><pre><code class=language-console data-lang=console>pmd-cli [connection_auth_options] &lt;component&gt; &lt;command&gt; [command_options]
</code></pre><p>Passed-in parameter values can be enclosed in single (') or double-quotes (") as long as you use matching characters to denote the beginning and end of the value. Unless a parameter value contains special characters or spaces, you can also omit quotes altogether.</p><h2 id=connection--authorization-options>Connection / Authorization Options</h2><h3 id=local-connections>Local Connections</h3><p>For local connections, you omit the connection and authorization options:</p><pre><code class=language-console data-lang=console>pmd-cli &lt;component&gt; &lt;cmd&gt; &lt;options&gt;
</code></pre><p>Permissions for the currently logged-in user apply when executing commands. This is the same as specifying &ndash;servername localhost.</p><h3 id=remote-connections>Remote Connections</h3><p>For connecting to a remote server (a server other than the local server), you specify two connection / authorization options:</p><ul><li><code>--servername</code>: name of the server</li><li><code>--user</code>: username of a user account on the server</li></ul><p><strong>Note:</strong> For authentication, you can specify the username (–user &lt;username>) on the command line, but never the password. For security reasons, the system must prompt you for the password.</p><p>The option for remote connection is as follows:</p><p><strong>System User</strong></p><pre><code class=language-console data-lang=console>pmd-cli --servername &lt;server&gt; --user &lt;username&gt;
</code></pre><h2 id=component>Component</h2><p><code>&lt;component></code> is one of the following values:</p><ul><li><code>firewall</code></li><li><code>net</code></li><li><code>pkg</code></li><li><code>usr</code></li></ul><h1 id=firewall-management>Firewall Management</h1><p>The Photon Management Daemon provides CLI commands to help you get information about the firewall.</p><h2 id=syntax-1>Syntax</h2><pre><code class=language-console data-lang=console>pmd-cli [connection_auth_options] firewall &lt;command&gt; [command_options]
</code></pre><h2 id=firewall-help>firewall help</h2><p>Get help for firewall CLI commands.</p><pre><code class=language-console data-lang=console>pmd-cli firewall help
</code></pre><h2 id=firewall-rules>firewall rules</h2><p>Get a list of the current persistent firewall rules.</p><pre><code class=language-console data-lang=console>pmd-cli firewall rules [command-options]
</code></pre><p>This command returns information about each firewall rule, such as the chain to which it belongs, the policy to enforce, the table to manipulate, and so on.</p><p>Add a new firewall rule.</p><pre><code class=language-console data-lang=console>pmd-cli firewall rules --chain &lt;chain_name&gt; --add &lt;rule_specification&gt;
</code></pre><p>Example:</p><pre><code class=language-console data-lang=console>pmd-cli firewall rules --chain INPUT --add &quot;-p tcp -m tcp --dport 21 -j ACCEPT&quot;
</code></pre><p><strong>Note:</strong> To confirm that the firewall rule was added, run iptables -S. Running pmd-cli firewall rules lists only persistent rules.</p><p>Delete a new firewall rule.</p><pre><code class=language-console data-lang=console>pmd-cli firewall rules --chain &lt;chain_name&gt; --delete &lt;rule_specification&gt;
</code></pre><p><strong>Note:</strong> To confirm that the firewall rule was removed, run iptables -S. Running pmd-cli firewall rules lists only persistent rules.</p><p>Make firewall rule changes peristent (add &ndash;persist flag)</p><pre><code class=language-console data-lang=console>pmd-cli firewall rules --chain &lt;chain_name&gt; --add &lt;rule_specification&gt; --persist
</code></pre><h2 id=firewall-version>firewall version</h2><p>Get the version number of the fwmgmt component on the server.</p><pre><code class=language-console data-lang=console>pmd-cli firewall version
</code></pre><h1 id=network-management>Network Management</h1><p>The Photon Management Daemon provides CLI commands to help you manage network interfaces.</p><h2 id=syntax-2>Syntax</h2><pre><code class=language-console data-lang=console>pmd-cli [connection_auth_options] net &lt;command&gt; [command_options]

Query and control the netmanager subsystem.
  -h --help                    Show this help message and exit
  -v --version                 Show package version
</code></pre><p>Many of these commands require the interface name (–interface &lt;ifname>). Command options are described below.</p><pre><code class=language-console data-lang=console>    Command                      Command Option                                     Description

----------------------------------------------------------------------------------------------------

 
    set-mtu                      [LINK] [MTU]                                          Set Link MTU

    set-mac                      [LINK] [MAC]                                          Set Link MAC

    set-link-mode                [LINK] [MODE { yes | no | on | off | 1 | 0} ]         Set Link managed by networkd

    set-dhcp-mode                [LINK] [DHCP-MODE { yes | no | ipv4 | ipv6 } ]        Set Link DHCP setting

    set-dhcp4-client-identifier  [LINK] [IDENTIFIER { mac | duid | duid-only}

    set-dhcp-iaid                [LINK] [IAID]                                         Sets the DHCP Identity Association
                                                                                       Identifier (IAID) for the
                                                                                       interface, a 32-bit unsigned
                                                                                       integer.

    set-dhcp-duid                [LINK | system] [DUID { link-layer-time |             Sets the DHCP Client DUID type which
                                 vendor | link-layer | uuid } ] [RAWDATA]              specifies how the DUID should be 
                                                                                       generated and [RAWDATA] to overides the
                                                                                       global DUIDRawData.

    set-link-state               [LINK] [STATE { up | down } ]                         Set Link State

    add-link-address             [LINK] [ADDRESS] [PEER] ]                             Add Link Address

    delete-link-address          [LINK]                                                Removes Address from Link

    add-default-gateway          [LINK] [GW address] onlink [ONLINK                    Add Link Default Gateway
                                 { yes | no | on | off | 1 | 0}] 

    delete-gateway               [LINK]                                                Removes Gateway from Link

    add-route                    [LINK] [GW address] metric [METRIC { number }]        Set Link route

    delete-route                 [LINK]                                                Removes route from Link

    add-additional-gw            [LINK] [ADDRESS] [ROUTE address] [GW address]         Configures additional gateway for   
                                 [ROUTING POLICY TABLE number]                         another NIC with routing policy rules

    set-hostname                 [HOSTNAME]                                            Sets hostname

    add-dns                      [LINK | system] [ADDRESS]                             Set Link DNS servers

    add-domain                   [LINK | system] [DOMAIN]                              Set Link DOMAIN 

    revert-resolve-link          [LINK]                                                Flushes all DNS server and Domain 
                                                                                       settings of the link

    set-link-local-address       [LINK] [LinkLocalAddressing                           Set Link link-local
                                 { yes | no | on | off | 1 | 0}]                        address autoconfiguration


    set-ipv4ll-route             [LINK] [IPv4LLRoute                                   Set the route needed                              
                                 { yes | no | on | off | 1 | 0}]                       for non-IPv4LL hosts to communicate
                                                                                       with IPv4LL-only hosts

    set-llmnr                    [LINK] [LLMNR { yes | no | on | off | 1 | 0}]         Set Link Link-Local Multicast Name
                                                                                       Resolution

    set-multicast-dns            [LINK] [MulticastDNS { yes | no | on | off | 1 | 0}]  Set Link Multicast DNS

    set-lldp                     [LINK] [LLDP { yes | no | on | off | 1 | 0}]          Set Link Ethernet LLDP packet reception

    set-emit-lldp                [LINK] [EmitLLDP { yes | no | on | off | 1 | 0}]      Set Link Ethernet LLDP packet emission

    set-ipforward                [LINK] [IPForward { yes | no | on | off | 1 | 0}]     Set Link IP packet forwarding for the system

    set-ipv6acceptra             [LINK] [IPv6AcceptRA { yes | no | on | off | 1 | 0}]  Set Link IPv6 Router Advertisement (RA) reception
                                                                                       support for the interface

    set-ipmasquerade             [LINK] [IPMasquerade { yes | no | on | off | 1 | 0}]  Set IP masquerading for the network interface

    set-dhcp4-use-dns            [LINK] [UseDNS { yes | no | on | off | 1 | 0}]        Set Link DHCP4 Use DNS

    set-dhcp4-use-domains        [LINK] [UseDomains { yes | no | on | off | 1 | 0}]    Set Link DHCP4 Use DOMAINS

    set-dhcp4-use-mtu            [LINK] [UseMTU { yes | no | on | off | 1 | 0}]        Set Link DHCP4 Use MTU

    set-dhcp4-use-ntp            [LINK] [UseNTP { yes | no | on | off | 1 | 0}]        Set Link DHCP4 Use NTP

    set-dhcp4-use-dns            [LINK] [UseDNS { yes | no | on | off | 1 | 0}]        Set Link DHCP4 Use DNS

    set-dhcp6-use-dns            [LINK] [UseDNS { yes | no | on | off | 1 | 0}]        Set Link DHCP6 Use DNS

    set-dhcp6-use-ntp            [LINK] [UseNTP { yes | no | on | off | 1 | 0}]        Set Link DHCP6 Use NTP

    add-ntp                      [LINK] [NTP]                                          Add Link NTP server address. This option may be
                                                                                       specified more than once.
                                                                                       This setting is read by systemd-timesyncd.service(8)

    set-ntp                      [LINK] [NTP]                                          Set Link NTP server address. This option may be 
                                                                                       specified more than once.
                                                                                       This setting is read by systemd-timesyncd.service(8)

    delete-ntp                   [LINK] [NTP]                                          Delete Link NTP server address. This option may be
                                                                                       specified more than once.
                                                                                       This setting is read by systemd-timesyncd.service(8)

    disable-ipv6                 [LINK]                                                Disables IPv6 on the interface.

    enable-ipv6                  [LINK]                                                Enables IPv6 on the interface.

    create-vlan                  [VLAN name] dev [LINK master] id [ID INTEGER]         Creates vlan netdev and sets master to device

    create-bridge                [BRIDGE name] [LINK] [LINK] ...                       Creates bridge netdev and sets master to device

    create-bond                  [BOND name] mode [MODE {balance-rr                    Creates bond netdev and sets master to device
                                 | active-backup | balance-xor | broadcast
                                 | 802.3ad | balance-tlb | balance-alb}]
                                 [LINK] [LINK] ...

    create-vxlan                 [VXLAN name] [dev LINK] vni [INTEGER]                 Creates vxlan VXLAN
                                 [local ADDRESS] [remote ADDRESS]                      (Virtual eXtensible Local Area Network) tunneling.                
                                 [port PORT] 
                                 [independent { yes | no | on | off | 1 | 0}].

    create-macvlan               [MACVLAN name] dev [LINK] mode                        Creates macvlan virtualized bridged networking.
                                 [MODE {private | vepa | bridge | passthru | source}]
                                  

    create-macvtap               [MACVTAP name] dev [LINK] mode [MODE                  Creates macvtap virtualized bridged networking.
                                 {private | vepa | bridge | passthru | source}] 

    create-ipvlan                [IPVLAN name] dev [LINK] mode                         Creates ipvlan, virtual LAN, separates    
                                 [MODE {l2 | l3 | l3s}]                                broadcast domains by adding tags to network packet.

    create-ipvtap                [IPVTAP name] dev [LINK]                              Create ipvtap.
                                 mode [MODE {l2 | l3 | l3s}]

    create-vrf                   [VRF name] table [INTEGER}]                           Creates Virtual routing and forwarding (VRF).

    create-veth                  [VETH name] peer [PEER name}]                         Creates virtual Ethernet devices.

    create-ipip                  [IPIP name] [dev LINK] local [ADDRESS]                Creates ipip tunnel.
                                 remote [ADDRESS] [independent
                                 { yes | no | on | off | 1 | 0}]

    create-sit                   [SIT name] [dev LINK] local [ADDRESS]                 Creates sit tunnel.
                                 remote [ADDRESS] [independent 
                                 { yes | no | on | off | 1 | 0}]

    create-vti                    [VTI name] [dev LINK] local [ADDRESS]                Creates vti tunnel.
                                  remote [ADDRESS] [independent
                                  { yes | no | on | off | 1 | 0}]

    create-gre                   [GRE name] [dev LINK] local [ADDRESS]                 Creates gre tunnel.
                                 remote [ADDRESS] [independent 
                                 { yes | no | on | off | 1 | 0}]

    create-wg                    [WIREGUARD name] private-key [PRIVATEKEY]             Creates a wireguard tunnel.
                                 listen-port [PORT INTEGER] public-key
                                 [PUBLICKEY] preshared-key [PRESHAREDKEY]
                                 allowed-ips [IP,IP ...] endpoint [IP:PORT]

    reload                                                                             Reload .network and .netdev files.

    reconfigure                  [LINK]                                                Reconfigure Link.

    add-nft-table                [FAMILY {ipv4 | ipv6 | ip}] [TABLE]                   Adds a new table.

    get-nft-tables               [FAMILY {ipv4 | ipv6 | ip}] [TABLE]                   shows nftable's tables.

    delete-nft-table             [FAMILY {ipv4 | ipv6 | ip}] [TABLE]                   deletes a existing nftable's table.

    add-nft-chain                [FAMILY {ipv4 | ip}] [TABLE] [CHAIN]                  adds a new nftable's chain.

    get-nft-chains               [FAMILY {ipv4 | ipv6 | ip}] [TABLE] [CHAIN]           shows nftable's chains.

    delete-nft-chain             [FAMILY {ipv4 | ipv6 | ip}] [TABLE] [CHAIN]           deletes a nftable's chain from table

    add-nft-rule                 [FAMILY {ipv4 | ipv6 | ip}] [TABLE] [CHAIN]           configures a nft rule for a port.     
                                 [PROTOCOL { tcp | udp}] 
                                 [SOURCE PORT / DESTINATION PORT {sport|dport}]
                                 [PORT] [ACTION {accept | drop}]

    get-nft-rules                [TABLE]                                               shows nftable's rules.

    delete-nft-rule              [FAMILY {ipv4 | ipv6 | ip}] [TABLE]                   deletes a nftable's rule from table
                                 [CHAIN] [HANDLE] 

    nft-run                                                                            runs a nft command.  See man NFT(8)

    is-networkd-running                                                                Check if systemd-networkd is running or not. 

    get-hostname                                                                       Gets hostname

    get-dns-servers                                                                    Gets DNS Servers

    get-dns-domains                                                                    Gets DNS Server DOMAINS

    get-ntp                      [LINK]                                                Get Link NTP server address

    get-link-address             [LINK]                                                Get Link Address

    get-link-route               [LINK]                                                Get Link route

    get-dhcp-mode                [LINK]                                                Get Link DHCP setting. 
                                 [DHCP-MODE { yes | no | ipv4 | ipv6 }]

    get-mac                      [LINK]                                                Get Link MAC


    get-mtu                      [LINK]                                                Get Link MTU

    get-dhcp-iaid                [LINK]                                                Get the DHCP Identity Association Identifier (IAID)
                                                                                       for the interface, a 32-bit unsigned integer.

 
    get-dhcp4-client-identifier  [LINK]                                                Get Link DHCP4 Client Identifier.



    net                          -v                                                    Get the network-config-manager supported version
</code></pre><div class="alert alert-primary" role=alert><h4 class=alert-heading>Note</h4><blockquote><p>You can add (+) or remove (-) a parameter by prepending the parameter name with <code>+</code> or <code>-</code>.</p></blockquote></div><h1 id=package-management>Package Management</h1><p>The Photon Management Daemon provides CLI commands to help you manage packages and repositories.</p><h2 id=syntax-3>Syntax</h2><pre><code class=language-console data-lang=console>pmd-cli [connection options] pkg &lt;command&gt; [command options]
</code></pre><p>If a command allows for multiple package names, simply specify on the command line, separated by spaces.</p><pre><code class=language-console data-lang=console>pmd-cli pkg info &lt;package_name_1&gt; &lt;package_name_2&gt; &lt;package_name_3&gt; ...
</code></pre><h2 id=pkg-check-local>pkg check-local</h2><p>Checks local rpm folder for problems.</p><pre><code class=language-console data-lang=console>pmd-cli pkg check-local 
</code></pre><h2 id=pkg-check-update>pkg check-update</h2><p>Check for available package upgrades.</p><pre><code class=language-console data-lang=console>pmd-cli pkg check-update
</code></pre><h2 id=pkg-clean-all>pkg clean all</h2><p>Remove cached data from tdnf.</p><pre><code class=language-console data-lang=console>pmd-cli pkg clean all
</code></pre><h2 id=pkg-help>pkg help</h2><p>Get help text for pkg CLI commands.</p><pre><code class=language-console data-lang=console>pmd-cli pkg help
</code></pre><h2 id=pkg-count>pkg count</h2><p>Get the total number of packages in all repos (including installed).</p><pre><code class=language-console data-lang=console>pmd-cli pkg count
</code></pre><h2 id=pkg-distro-sync>pkg distro-sync</h2><p>Synchronize installed packages to the latest available versions. If no packages are specified, then all available packages are synchronized.</p><pre><code class=language-console data-lang=console>pmd-cli pkg distro-sync
</code></pre><h2 id=pkg-downgrade>pkg downgrade</h2><p>Downgrade the specified package(s). If no packages are specified, then all available packages are downgraded.</p><pre><code class=language-console data-lang=console>pmd-cli pkg downgrade &lt;package_name&gt;
</code></pre><h2 id=pkg-erase>pkg erase</h2><p>Remove the specified package(s).</p><pre><code class=language-console data-lang=console>pmd-cli pkg erase &lt;package_name&gt;
</code></pre><h2 id=pkg-info>pkg info</h2><p>Get general information about the specified package(s), such as name, version, release, repository, install size, and so on.</p><pre><code class=language-console data-lang=console>pmd-cli pkg info &lt;package_name&gt;
</code></pre><p>If no packages are specified, then this command returns information about all packages.</p><pre><code class=language-console data-lang=console>pmd-cli pkg install
</code></pre><p>Install the specified package(s). Update the package if an update is available.</p><pre><code class=language-console data-lang=console>pmd-cli pkg install &lt;package_name&gt;
</code></pre><h2 id=pkg-list>pkg list</h2><p>Get a list of packages or groups of packages.</p><pre><code class=language-console data-lang=console>pmd-cli pkg list
</code></pre><p>You can filter by group: all, available, installed, extras, obsoletes, recent, and upgrades.</p><pre><code class=language-console data-lang=console>pmd-cli pkg list upgrades
</code></pre><p>You can also filter by wildcards.</p><pre><code class=language-console data-lang=console>pmd-cli pkg list ph\*
</code></pre><h2 id=pkg-provides-openssh>pkg provides openssh</h2><p>Find what package provides the given binary.</p><pre><code class=language-console data-lang=console>pmd-cli pkg provides openssh
</code></pre><h2 id=pkg-reinstall>pkg reinstall</h2><p>Reinstall the specified package(s).</p><pre><code class=language-console data-lang=console>pmd-cli pkg reinstall &lt;package_name&gt;
</code></pre><h2 id=pkg-repolist>pkg repolist</h2><p>Get a list of the configured software repositories.</p><pre><code class=language-console data-lang=console>pmd-cli pkg repolist
</code></pre><p>This command returns a list of the configured software repositories, including the repository ID, repitory name, and status.</p><h2 id=pkg-search-ssh>pkg search ssh</h2><p>Search package details for the given string.</p><pre><code class=language-console data-lang=console>pmd-cli pkg search ssh
</code></pre><p>If no parameters are specified, then all available packages are updated.</p><h2 id=pkg-update>pkg update</h2><p>Update the specified package(s).</p><pre><code class=language-console data-lang=console>pmd-cli pkg update *package_name*
</code></pre><p>If no parameters are specified, then all available packages are updated.</p><h2 id=pkg-updateinfo>pkg updateinfo</h2><p>Get the update information on all enabled repositories (status = enabled). If this command returns nothing, then the update information may not exist on the server.</p><pre><code class=language-console data-lang=console>pmd-cli pkg updateinfo
</code></pre><h1 id=user-management>User Management</h1><p>The Photon Management Daemon provides CLI commands to help you manage users and user groups.</p><h2 id=syntax-4>Syntax</h2><pre><code class=language-console data-lang=console>pmd-cli [connection options] usr &lt;command&gt; [command options]
</code></pre><h2 id=usr-help>usr help</h2><p>Display help text for user commands.</p><pre><code class=language-console data-lang=console>pmd-cli usr users
</code></pre><h2 id=usr-users>usr users</h2><p>Get a list of users. This command returns information about each user, including their user name, user ID, user group (if applicable), home directory, and default shell.</p><pre><code class=language-console data-lang=console>pmd-cli usr users
</code></pre><h2 id=usr-useradd>usr useradd</h2><p>Add a new user. Specify the username.</p><pre><code class=language-console data-lang=console>pmd-cli usr useradd &lt;username&gt;
</code></pre><p>The system assigns a user ID, home directory, and default shell to the new user. The user group is unspecified.</p><h2 id=usr-userdel>usr userdel</h2><p>Delete the specified user.</p><pre><code class=language-console data-lang=console>pmd-cli usr userdel &lt;username&gt;
</code></pre><h2 id=usr-userid>usr userid</h2><p>Get the user ID of the specified user (by name). Used to determine whether the specified user exists.</p><pre><code class=language-console data-lang=console>pmd-cli usr userid &lt;username&gt;
</code></pre><h2 id=usr-groups>usr groups</h2><p>Get a list of user groups. This command returns the following information about each user group: user group name and user group ID.</p><pre><code class=language-console data-lang=console>pmd-cli usr groups
</code></pre><h2 id=usr-groupadd>usr groupadd</h2><p>Add a new user group.</p><pre><code class=language-console data-lang=console>pmd-cli usr groupadd &lt;user_group_name&gt;
</code></pre><p>The system assigns a group ID to the new user group.</p><h2 id=usr-groupdel>usr groupdel</h2><p>Delete the specified user group.</p><pre><code class=language-console data-lang=console>pmd-cli usr groupdel &lt;user_group_name&gt;
</code></pre><h2 id=usr-groupid>usr groupid</h2><p>Get the group ID for the specified user group (by name). Used to determine whether the specified user group exists.</p><pre><code class=language-console data-lang=console>pmd-cli usr groupid &lt;user_group_name&gt;
</code></pre><h2 id=usr-version>usr version</h2><p>Get the version of the usermgmt component at the server.</p><pre><code class=language-console data-lang=console>pmd-cli usr version
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-0451f1b066f757da7d2004f4800d8c68>7.1.2 - Photon Network Config Manager Command-line Interface (nmctl)</h1><p>For locally logged-on users, Photon OS provides a command line interface to manage network configuration of the system.</p><p>The network-config-manager <code>nmctl</code> allows to configure and introspect the state of the network links as seen by <code>systemd-networkd</code>.</p><p>Query and control the netmanager subsystem.</p><pre><code> -h --help                    Show this help message and exit

 -v --version                 Show package version


**Command                      Option                                    Description**


show                                                                Show system status

status                                                              List links

status                       [LINK]                                 Show link status


set-mtu                      [LINK] [MTU]                           Set Link MTU

set-mac                      [LINK] [MAC]                           Set Link MAC 

set-link-mode                [LINK] [MODE
                             { yes | no | on | off | 1 | 0} ]       Set Link managed by networkd


set-dhcp-mode                [LINK] [DHCP-MODE 
                             { yes | no | ipv4 | ipv6 } ]            Set Link DHCP setting

set-dhcp4-client-identifier  [LINK] [IDENTIFIER 
                             { mac | duid | duid-only} ]


set-dhcp-iaid                [LINK] [IAID]                            Sets the DHCP Identity Association Identifier
                                                                     (IAID) for the interface, a 32-bit unsigned
                                                                      integer.

set-dhcp-duid                [LINK | system] [DUID 
                             { link-layer-time | vendor 
                             | link-layer | uuid } ] [RAWDATA]         Sets the DHCP Client 
                                                                       DUID type which specifies how the DUID 
                                                                        should be generated and [RAWDATA] to 
                                                                        overides the global DUIDRawData.


set-link-state               [LINK] [STATE { up | down } ]              Set Link State

add-link-address             [LINK] [ADDRESS] [PEER] ]                  Add Link Address

delete-link-address          [LINK]                                     Removes Address from Link

add-default-gateway          [LINK] [GW address] onlink 
                             [ONLINK { yes | no | on | off | 1 | 0}]    Add Link Default Gateway

delete-gateway               [LINK]                                     Removes Gateway from Link

add-route                    [LINK] [GW address] metric 
                             [METRIC { number }]                        Set Link route

delete-route                 [LINK]                                     Removes route from Link

add-additional-gw            [LINK] [ADDRESS] [ROUTE address] 
                             [GW address] [ROUTING POLICY TABLE number] configures additional gateway for
                                                                        another NIC with routing policy rules

set-hostname                 [HOSTNAME]                                  Sets hostname

show-dns                                                                 Show DNS Servers

add-dns                      [LINK | system] [ADDRESS]                   Set Link DNS servers

add-domain                   [LINK | system] [DOMAIN]                     Set Link DOMAIN 

show-domains                                                               Show DNS Server DOMAINS

revert-resolve-link          [LINK]                                      Flushes all DNS server and Domain settings
                                                                           of the link

set-link-local-address       [LINK] [LinkLocalAddressing 
                             { yes | no | on | off | 1 | 0}]          Set Link link-local address autoconfiguration

set-ipv4ll-route             [LINK] [IPv4LLRoute 
                             { yes | no | on | off | 1 | 0}]           Set the route needed for non-IPv4LL hosts to
                                                                        communicate with IPv4LL-only hosts
      
                                  
set-llmnr                    [LINK] [LLMNR 
                             { yes | no | on | off | 1 | 0}]          Set Link Link-Local Multicast Name Resolution

set-multicast-dns            [LINK] [MulticastDNS  
                             { yes | no | on | off | 1 | 0}]            Set Link Multicast DNS

set-lldp                     [LINK] [LLDP 
                             { yes | no | on | off | 1 | 0}]           Set Link Ethernet LLDP packet reception

set-emit-lldp                [LINK] [EmitLLDP 
                             { yes | no | on | off | 1 | 0}]           Set Link Ethernet LLDP packet emission

set-ipforward                [LINK] [IPForward 
                             { yes | no | on | off | 1 | 0}]          Set Link IP packet forwarding for the system

set-ipv6acceptra             [LINK] [IPv6AcceptRA 
                             { yes | no | on | off | 1 | 0}]          Set Link IPv6 Router Advertisement (RA) 
                                                                      reception support for the interface

set-ipmasquerade             [LINK] [IPMasquerade 
                             { yes | no | on | off | 1 | 0}]          Set IP masquerading for the network interface

set-dhcp4-use-dns            [LINK] [UseDNS 
                             { yes | no | on | off | 1 | 0}]           Set Link DHCP4 Use DNS

set-dhcp4-use-domains        [LINK] [UseDomains 
                             { yes | no | on | off | 1 | 0}]            Set Link DHCP4 Use DOMAINS

set-dhcp4-use-mtu            [LINK] [UseMTU 
                             { yes | no | on | off | 1 | 0}]              Set Link DHCP4 Use MTU

set-dhcp4-use-ntp            [LINK] [UseNTP 
                             { yes | no | on | off | 1 | 0}]             Set Link DHCP4 Use NTP


set-dhcp4-use-dns            [LINK] [UseDNS 
                              { yes | no | on | off | 1 | 0}]            Set Link DHCP4 Use DNS


set-dhcp6-use-dns            [LINK] [UseDNS 
                             { yes | no | on | off | 1 | 0}]              Set Link DHCP6 Use DNS


set-dhcp6-use-ntp            [LINK] [UseNTP 
                             { yes | no | on | off | 1 | 0}]              Set Link DHCP6 Use NTP


add-ntp                      [LINK] [NTP]                                 Add Link NTP server address. This option
                                                                          may be specified more than once.
                                                                          This setting is read by 
                                                                          systemd-timesyncd.service(8)


set-ntp                      [LINK] [NTP]                                  Set Link NTP server address. This option
                                                                           may be specified more than once.
                                                                           This setting is read by 
                                                                           systemd-timesyncd.service(8)


delete-ntp                   [LINK]                                          Delete Link NTP server addresses.
                                                                             This setting is read by 
                                                                             systemd-timesyncd.service(8)


disable-ipv6                 [LINK]                                            Disables IPv6 on the interface.


enable-ipv6                  [LINK]                                           Enables IPv6 on the interface.


create-vlan                  [VLAN name] dev [LINK master] id [ID INTEGER]   Creates vlan netdev and sets master to
                                                                             device


create-bridge                [BRIDGE name] [LINK] [LINK] ...                 Creates bridge netdev and sets master
                                                                             to device



create-bond                  [BOND name] mode [MODE {balance-rr | 
                             active-backup | balance-xor | broadcast         Creates bond netdev and sets master to
                             | 802.3ad | balance-tlb | balance-alb}]         device
                               [LINK] [LINK] ...       

             
create-vxlan                 [VXLAN name] [dev LINK] vni [INTEGER]        Creates vxlan VXLAN (Virtual eXtensible
                             [local ADDRESS] [remote ADDRESS]             Local Area Network) tunneling.
                             [port PORT] [independent 
                             { yes | no | on | off | 1 | 0}]. 
			                                         
                             
create-macvlan               [MACVLAN name] dev [LINK] mode              Creates macvlan virtualized bridged
                             [MODE {private | vepa | bridge | passthru    networking.
                             | source}] 
                                   
                              
create-macvtap               [MACVTAP name] dev [LINK] mode              Creates macvtap virtualized bridged
                             [MODE {private | vepa | bridge              networking.
                             | passthru | source}]                    
                                                        
    
create-ipvlan                [IPVLAN name] dev [LINK]                Creates ipvlan, virtual LAN, separates broadcast 
                             mode [MODE {l2 | l3 | l3s}]             domains by adding tags to network packet.   


create-ipvtap                [IPVTAP name] dev [LINK] 
                             mode [MODE {l2 | l3 | l3s}]             Create ipvtap.


create-vrf                   [VRF name] table [INTEGER}]            Creates Virtual routing and forwarding (VRF).


create-veth                  [VETH name] peer [PEER name}]          Creates virtual Ethernet devices


create-ipip                  [IPIP name] [dev LINK] 
                             local [ADDRESS] remote [ADDRESS] 
                             [independent 
                             { yes | no | on | off | 1 | 0}]                  Creates ipip tunnel.


create-sit                   [SIT name] [dev LINK] local 
                             [ADDRESS] remote [ADDRESS] 
                             [independent 
                             { yes | no | on | off | 1 | 0}]                  Creates sit tunnel.


create-vti                   [VTI name] [dev LINK] local [ADDRESS]
                             remote [ADDRESS] [independent 
                             { yes | no | on | off | 1 | 0}]                   Creates vti tunnel.


create-gre                   [GRE name] [dev LINK] local [ADDRESS]
                             remote [ADDRESS] [independent 
                              { yes | no | on | off | 1 | 0}]                  Creates gre tunnel.


create-wg                    [WIREGUARD name] private-key [PRIVATEKEY]
                             listen-port [PORT INTEGER] public-key 
                              [PUBLICKEY] preshared-key [PRESHAREDKEY]
                                allowed-ips [IP,IP ...] endpoint [IP:PORT]      Creates a wireguard tunnel.


reload                                                                         Reload .network and .netdev files.

reconfigure                   [LINK]                                           Reconfigure Link.


generate-config-from-yaml     [FILE]                                           Generates network file configuration 
                                                                               from yaml file.


apply-yaml-config                                                              Generates network file configuration from
                                                                               yaml files found in 
                                                                               /etc/network-config-manager/yaml.


generate-config-from-cmdline [FILE | COMMAND LINE]                            Generates network file configuration from 
                                                                            command kernel command line or command line.


add-nft-table                [FAMILY {ipv4 | ipv6 | ip}] [TABLE]              adds a new table.

show-nft-tables              [FAMILY {ipv4 | ipv6 | ip}]                      shows nftable's tables.


delete-nft-table             [FAMILY {ipv4 | ipv6 | ip}] [TABLE]             deletes a existing nftable's table.


add-nft-chain                [FAMILY {ipv4 | ip}] [TABLE] [CHAIN]               adds a new nftable's chain.


show-nft-chains              [FAMILY {ipv4 | ipv6 | ip}] [TABLE]               shows nftable's chains.


delete-nft-chain             [FAMILY {ipv4 | ipv6 | ip}] [TABLE] [CHAIN]       deletes a nftable's chain from table


add-nft-rule                 [FAMILY {ipv4 | ipv6 | ip}] 
                              [TABLE] [CHAIN] [PROTOCOL 
                             { tcp | udp}] [SOURCE PORT / DESTINATION PORT
                              {sport|dport}] PORT] [ACTION {accept | drop}]    configures a nft rule for a port.


show-nft-rules               [TABLE]                                           shows nftable's rules.

delete-nft-rule              [FAMILY {ipv4 | ipv6 | ip}] [TABLE] 
                              [CHAIN] [HANDLE]                                 deletes a nftable's rule from table

nft-run                                                                        runs a nft command.  See man NFT(8)</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-11a388c580ecc399f748da69eeed2d7d>7.1.3 - Photon Real-Time Operating System Command-line Interface</h1><p>Photon Real-Time Operating System provides commands for manipulating real-time properties of processes.</p><h2 id=tuna>tuna</h2><p>The tuna utility can be used to view and modify process priorities, CPU isolation and other real time characteristics in the system.</p><p>Examples:</p><p>View processes and their RT scheduling policies and priorities:
$ tuna -P</p><pre><code>                 thread    ctxt_switches

pid   SCHED_rtpri  affinity   voluntary    nonvoluntary                    cmd

  1    OTHER    0         0       1211           917                     systemd 

  2    OTHER     0        0       281             0                      kthreadd 

  3    OTHER     0        0         3             1                         rcu_gp

  4    OTHER     0        0         2             1                    rcu_par_gp

  6    OTHER     0        0         8             1            kworker/0:0H-kblockd

 13    FIFO      1        0       317             1                     rcu_sched

 16    FIFO     99        0         3             2                posixcputmr/0 

 17    FIFO     99        0         6             2                    migration/0

679    FIFO     50        0     1647541           1                irq/58-eth0-rxt
</code></pre><p>The following tasks are performed by using the <code>tuna</code> command:</p><ul><li><p>Isolate a set of CPUs</p><p><code>$ tuna -c &lt;cpulist> -i (where &lt;cpulist> can be X,Y-Z)</code></p></li><li><p>See the list of processes running on the specific CPUs before and after isolation</p><pre><code>  $ tuna -c &lt;cpulist&gt; --show_threads
  $ tuna -c &lt;cpulist&gt; -i --show_threads
</code></pre></li></ul><h2 id=taskset>taskset</h2><p>The taskset command can be used to get/set CPU affinity of tasks:</p><ul><li><p>Run a program bound to a set of CPUs</p><p><code>$ taskset -c &lt;cpulist> ./program (where &lt;cpulist> can be X,Y-Z)</code></p></li><li><p>Move a running task to a set of CPUs
<code>$ taskset -c p &lt;cpulist> &lt;pid></code></p></li><li><p>View the CPU affinity settings of a running task
<code>$ taskset -c -p &lt;pid></code></p></li></ul><h2 id=chrt>chrt</h2><p>The <code>chrt</code> command can be used to get or set the real-time scheduling policies and priorities of processes:</p><ul><li>Modify the scheduling policy and priority of a running task</li></ul><p><code>$ chrt -f -p &lt;priority> &lt;pid></code> (sets the task with pid <pid>to SCHED_FIFO policy with priority <priority>)</p><ul><li><p>View the current scheduling policy and priority of a running task</p><p><code>$ chrt -p &lt;pid></code></p></li></ul><h2 id=ps>ps</h2><p>The <code>ps</code> command can be used to list processes with their scheduling policies and priorities:</p><pre><code>$ ps -eo cmd,pid,cpu,pri,cls


 `CMD `                                              ` PID  CPU   PRI    CLS`

`/lib/systemd/systemd --swit `                       ` 1     -    19    TS`

`[kthreadd]`                                         ` 2     -    19    TS`
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-fd5b9e03b9ec98a8e94a78696bd95809>8 - Troubleshooting Guide</h1><p>The Photon OS <em>Troubleshooting Guide</em> provides solutions for common problems that you might encounter while using Photon OS.</p><p><strong>Product version: 4.0</strong></p><p>This documentation applies to all 4.0.x releases.</p><h2 id=intended-audiences>Intended Audiences</h2><p>This information is intended for Photon OS administrators who install and set up Photon OS.</p></div><div class=td-content><h1 id=pg-d1a2c64570ea618afcac34853d3591b8>8.1 - Introduction</h1><p>The <em>Troubleshooting Guide</em> covers the basics of troubleshooting systemd, packages, network interfaces, services such as SSH and Sendmail, the file system, and the Linux kernel. The guide also includes information about the tools that you can use for troubleshooting with examples, how to access the logs, and best practices.</p></div><div class=td-content><h1 id=pg-0c24d695daaa503ab5b136189f98b352>8.1.1 - Systemd and TDNF</h1><p>By using systemd, Photon OS adopts a contemporary Linux standard to bootstrap the user space and concurrently start services, an architecture that differs from traditional Linux systems such as SUSE Linux Enterprise Server 11.</p><p>A traditional Linux system contains an initialization system called SysVinit. With SLES 11, for instance, SysVinit-style init programs control how the system starts up and shuts down. Init implements system runlevels. A SysVinit runlevel defines a state in which a process or service runs. In contrast to a SysVinit system, systemd defines no such runlevels. Instead, systemd uses a dependency tree of <em>targets</em> to determine which services to start when.</p><p>Because the systemd commands differ from those of an init.d-based Linux system, a section later in this guide illustrates how to troubleshoot by using systemctl commands instead of init.d-style commands.</p><p>Tdnf keeps the operating system as small as possible while preserving yum&rsquo;s robust package-management capabilities. On Photon OS, tdnf is the default package manager for installing new packages. Since troubleshooting with tdnf differs from using yum, a later section of this guide describes how to solve problems with packages and repositories by using tdnf commands.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c51d8fa43bbff78136c63ead3844946b>8.1.2 - The Root Account and the `sudo` and `su` Commands</h1><p>The <em>Troubleshooting Guide</em> assumes that you are logged in to Photon OS with the root account and running commands as root. The <code>sudo</code> program comes with the full version of Photon OS. On the minimal version, you must install <code>sudo</code> with tdnf if you want to use it. As an alternative to installing <code>sudo</code> on the minimal version, you can switch users as needed with the <code>su</code> command to run commands that require root privileges.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-5160821fa4b3d287aa428b4db0b0377e>8.1.3 - Checking the Version and Build Number</h1><p>To check the version and build number of Photon OS, concatenate <code>/etc/photon-release</code>.</p><p>Example:</p><pre><code>cat /etc/photon-release
VMware Photon Linux 1.0
PHOTON_BUILD_NUMBER=a6f0f63
</code></pre><p>The build number in the results maps to the commit number on the VMware Photon OS GitHub <a href=https://github.com/vmware/photon/commits/master>commits page</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-24401492a50648e7339365977f2b076b>8.1.4 - General Best Practices</h1><p>When troubleshooting, it is recommended that you follow some general best practices:</p><ul><li><p><strong>Take a snapshot.</strong> Before you do anything to a virtual machine running Photon OS, take a snapshot of the VM so that you can restore it if need be.</p></li><li><p><strong>Make a backup copy.</strong> Before you change a configuration file, make a copy of the original file. For example: <code>cp /etc/tdnf/tdnf.conf /etc/tdnf/tdnf.conf.orig</code></p></li><li><p><strong>Collect logs.</strong> Save the log files associated with a Photon OS problem. Include not only the log files on the guest but also the <code>vmware.log</code> file on the host. The <code>vmware.log</code> file is in the host&rsquo;s directory that contains the VM.</p></li><li><p><strong>Know what is in your toolbox.</strong> View the man page for a tool before you use it so that you know what your options are. The options can help focus the command&rsquo;s output on the problem you&rsquo;re trying to solve.</p></li><li><p><strong>Understand the system.</strong> The more you know about the operating system and how it works, the better you can troubleshoot.</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-c4fee82bb026acdb479d18f12f8cadfd>8.1.5 - Photon OS Logs</h1><p>On Photon OS, all the system logs except the installation logs and the cloud-init logs are written into the systemd journal. The <code>journalctl</code> command queries the contents of the systemd journal.</p><p>The installation log files and the cloud-init log files reside in <code>/var/log</code>. If Photon OS is running on a virtual machine in a VMware hypervisor, the log file for the VMware tools, <code>vmware-vmsvc.log</code>, also resides in <code>/var/log</code>.</p><p>##Journalctl
Journalctl is a utility to query and display logs from journald and systemd’s logging service. Since journald stores log data in a binary format instead of a plain text format, <code>journalctl</code> is the standard way of reading log messages processed by journald.</p><p>Journald is a service provided by systemd. To see the staus of the daemon, run the following commands:</p><pre><code># systemctl status systemd-journald
● systemd-journald.service - Journal Service
Loaded: loaded (/lib/systemd/system/systemd-journald.service; static; vendor preset: enabled)
Active: active (running) since Tue 2020-04-07 14:33:41 CST; 2 days ago
Docs: man:systemd-journald.service(8)
man:journald.conf(5)
Main PID: 943 (systemd-journal)
Status: &quot;Processing requests...&quot;
Tasks: 1 (limit: 4915)
Memory: 18.0M
CGroup: /system.slice/systemd-journald.service
└─943 /lib/systemd/systemd-journald



Apr 07 14:33:41 photon-4a0e7f2307d4 systemd-journald[943]: Journal started
Apr 07 14:33:41 photon-4a0e7f2307d4 systemd-journald[943]: Runtime journal (/run/log/journal/b8cebc61a6cb446a968ee1d4c5bbbbd5) is 8.0M, max 1.5G, 1.5G free.
Apr 07 14:33:41 photon-4a0e7f2307d4 systemd-journald[943]: Time spent on flushing to /var is 88.263ms for 1455 entries.
Apr 07 14:33:41 photon-4a0e7f2307d4 systemd-journald[943]: System journal (/var/log/journal/b8cebc61a6cb446a968ee1d4c5bbbbd5) is 40.0M, max 4.0G, 3.9G free.
root@photon-4a0e7f2307d4 [ ~ ]#
</code></pre><p>The following command are related to <code>journalctl</code>:</p><ul><li><code>journalctl</code> : This command displays all the logs after the system has booted up. <code>journalctl</code> splits the results into pages, similar to the <code>less</code> command in Linux. You can navigate using the arrow keys, the Page Up, Page Down keys or the Space bar. To quit navigation, press the <strong>q</strong> key.</li><li><code>journalctl -b</code> : This command displays the logs for the current boot.</li></ul><p>The following commands pull logs based on a time range:</p><ul><li><code>journalctl --since "1 hour ago"</code> : This command displays the journal logs from the past 1 hour.</li><li><code>journalctl --since "2 days ago"</code> : This command displays the logs generated in the past 2 days.</li><li><code>journalctl --since "2020-03-25 00:00:00" --until "2020-04-09 00:00:00"</code> : This command displays the logs generated between the mentioned time frame.</li></ul><p>To traverse for logs in the reverse order, run the following command:</p><ul><li><code>journalctl -r</code> : This command displays the logs in reverse order.</li></ul><p><strong>Note</strong>: If you add <code>-r</code> at the end of a command, the logs are displayed in the reverse order. For example: <code>journalctl -u unit.service -r</code></p><p>To pull logs related to a particular daemon, run the following command:</p><ul><li><code>journalctl -u unit.service</code> : This command displays logs for a specific service. mention the name of the service instead of <code>unit</code>. This command helps when a service is not behaving properly or when there are crash/core dumps.</li></ul><p>To see Journal logs by their priority, run the following command:</p><ul><li><code>journalctl -p "emerg".."crit</code> : This command displays logs <strong>emerg</strong> to <strong>critical</strong>. For example: core dumps.</li></ul><p>Journalctl can print log messages to the console as they are added, like the Linux <code>tail</code> command. Add the <code>-f</code> switch to follow a specific service or daemon.</p><pre><code>journalctl -u unit.service -f
</code></pre><p>To list the boots of the system, run the following command:</p><pre><code>journalctl --list-boots
</code></pre><p>You can maintain the journalctl logs manually, by running the following <code>vacuum</code> commands:</p><ul><li><code>journalctl --vacuum-time=2d</code> : This command retains the logs from the last 2 days.</li><li><code>journalctl --vacuum-size=500M</code> : This command helps retain logs with a maximum size of 500 MB.</li></ul><p>You can configure Journald using the conf file located at <strong>/etc/systemd/journald.conf</strong>. Run the following command to configure the file:</p><pre><code class=language-console data-lang=console># cat /etc/systemd/journald.conf
</code></pre><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#8f5902;font-style:italic># This file is part of systemd.</span>
<span style=color:#8f5902;font-style:italic>#</span>
<span style=color:#8f5902;font-style:italic># systemd is free software; you can redistribute it and/or modify it</span>
<span style=color:#8f5902;font-style:italic># under the terms of the GNU Lesser General Public License as published by</span>
<span style=color:#8f5902;font-style:italic># the Free Software Foundation; either version 2.1 of the License, or</span>
<span style=color:#8f5902;font-style:italic># (at your option) any later version.</span>
<span style=color:#8f5902;font-style:italic>#</span>
<span style=color:#8f5902;font-style:italic># Entries in this file show the compile time defaults.</span>
<span style=color:#8f5902;font-style:italic># You can change settings by editing this file.</span>
<span style=color:#8f5902;font-style:italic># Defaults can be restored by simply deleting this file.</span>
<span style=color:#8f5902;font-style:italic>#</span>
<span style=color:#8f5902;font-style:italic># See journald.conf(5) for details.</span>

<span style=color:#204a87;font-weight:700>[Journal]</span>
<span style=color:#8f5902;font-style:italic>#Storage=auto</span>
<span style=color:#8f5902;font-style:italic>#Compress=yes</span>
<span style=color:#8f5902;font-style:italic>#Seal=yes</span>
<span style=color:#8f5902;font-style:italic>#SplitMode=uid</span>
<span style=color:#8f5902;font-style:italic>#SyncIntervalSec=5m</span>
<span style=color:#8f5902;font-style:italic>#RateLimitIntervalSec=30s</span>
<span style=color:#8f5902;font-style:italic>#RateLimitBurst=10000</span>
<span style=color:#8f5902;font-style:italic>#SystemMaxUse=</span>
<span style=color:#8f5902;font-style:italic>#SystemKeepFree=</span>
<span style=color:#8f5902;font-style:italic>#SystemMaxFileSize=</span>
<span style=color:#8f5902;font-style:italic>#SystemMaxFiles=100</span>
<span style=color:#8f5902;font-style:italic>#RuntimeMaxUse=</span>
<span style=color:#8f5902;font-style:italic>#RuntimeKeepFree=</span>
<span style=color:#8f5902;font-style:italic>#RuntimeMaxFileSize=</span>
<span style=color:#8f5902;font-style:italic>#RuntimeMaxFiles=100</span>
<span style=color:#8f5902;font-style:italic>#MaxRetentionSec=</span>
<span style=color:#8f5902;font-style:italic>#MaxFileSec=1month</span>
<span style=color:#8f5902;font-style:italic>#ForwardToSyslog=no</span>
<span style=color:#8f5902;font-style:italic>#ForwardToKMsg=no</span>
<span style=color:#8f5902;font-style:italic>#ForwardToConsole=no</span>
<span style=color:#8f5902;font-style:italic>#ForwardToWall=yes</span>
<span style=color:#8f5902;font-style:italic>#TTYPath=/dev/console</span>
<span style=color:#8f5902;font-style:italic>#MaxLevelStore=debug</span>
<span style=color:#8f5902;font-style:italic>#MaxLevelSyslog=debug</span>
<span style=color:#8f5902;font-style:italic>#MaxLevelKMsg=notice</span>
<span style=color:#8f5902;font-style:italic>#MaxLevelConsole=info</span>
<span style=color:#8f5902;font-style:italic>#MaxLevelWall=emerg</span>
<span style=color:#8f5902;font-style:italic>#LineMax=48K</span>
<span style=color:#c4a000>root@photon-4a0e7f2307d4 [ ~ ]#</span>
</code></pre></div><p>By default <code>rotate</code> is disabled in Photon. Once the changes are made to the conf file, for the changes to take effect you must restart the systemd-journald by running the <code>systemctl restart systemd-journald</code> command.</p><h2 id=cloud-init-logs>Cloud-init Logs</h2><p>Cloud-init is the industry standard multi-distribution method for cross-platform cloud instance initialisation.</p><p>If there are with the Cloud-init behaviour, we can debug them by looking at the logs. Run the following command to look at Cloud-init logs:</p><pre><code class=language-console data-lang=console>journalctl -u cloud-init
</code></pre><p>For better understanding/debugging, You can also look at logs from the following locations:</p><ul><li><strong>/var/log/cloud-init.log</strong> : This log contains information from each stage of Cloud-init.</li><li><strong>/var/log/cloud-init-output.log</strong> : This log contains errors, warnings, etc..</li></ul><h2 id=syslog>Syslog</h2><p>Syslog is the general standard for logging system and program messages in the Linux environment.</p><p>Photon provides the following two packages to support syslog:</p><ul><li><strong>syslog-ng</strong> : syslog-ng is syslog with some advanced next gen features. It supports TLS encryption, TCP for transport with other existing features. Configurations can be added to the <code>/etc/syslog-ng/syslog-ng.conf</code> file.</li><li><strong>rsyslog</strong> : The official RSYSLOG website defines the utility as &ldquo;the rocket-fast system for log processing&rdquo;. rsyslog supports some advanced features like relp, imfile, omfile, gnutls protocols. Configurations can be added to the <code>/etc/rsyslog.conf</code> file. You can configure the required TLS certificates by editing the conf file.</li></ul><h2 id=logs-for-rpms-on-photon>Logs for RPMS on Photon</h2><p>Logs for a particular RPM can be checked in the following ways:</p><ul><li>If the RPM provides a daemon, we can see the status of daemon by running <code>systemctl</code> command and check logs using <code>journactl -u &lt;service name></code> command.</li><li>For additional logs, check if a conf file is provided by the RPM by running the <code>rpm -ql &lt;rpm name> | grep conf</code> command and find the file path of the log file. You can also check the <strong>/var/log</strong> folder.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-dd1666053f4fa67749224c02b1c8be5a>8.1.6 - Troubleshooting Progression</h1><p>If you encounter a problem running an application or appliance on Photon OS and you suspect it involves the operating system, you can troubleshoot by proceeding as follows.</p><ol><li><p>Check the services running on Photon OS:</p><p><code>systemctl status</code></p></li><li><p>Check your application log files for errors. For VMware applications, see <a href="https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=1021806">Location of Log Files for VMware Products</a>.)</p></li><li><p>Check the service controller or service monitor for your application or appliance.</p></li><li><p>Check the network interfaces and other aspects of the network service with <code>systemd-network</code> commands.</p></li><li><p>Check the operating system log files:</p><p><code>journalctl</code></p><p>Next, run the following commands to view all services according to the order in which they were started:</p><p><code>systemd-analyze critical-chain</code></p></li><li><p>Use the troubleshooting tool that you think is most likely to help with the issue at hand. For example, use <code>strace</code> to identify the location of the failure.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-f1d4a7ec328436687337c431d2f92fe7>8.2 - Solutions to Common Problems</h1><p>This section describes solutions to problems that you might encounter when using or managing Photon OS.</p></div><div class=td-content><h1 id=pg-1f1ad9ca2f9874120dd824aae9b7fb29>8.2.1 - Boot in Emergency Mode</h1><p>If you encounter problems during normal boot, you can boot in Emergency Mode.</p><p>Perform the following steps to boot in Emergency Mode:</p><ol><li><p>Restart the Photon OS machine or the virtual machine running Photon OS.</p><p>When the Photon OS splash screen appears, as it restarts, type the letter <code>e</code> quickly.</p></li><li><p>Append <code>emergency</code> to the kernel command line.</p></li><li><p>Press <code>F10</code> to proceed with the boot.</p></li><li><p>At the command prompt, provide the root password to log in to Emergency Mode.</p><p>By default, <code>/</code> is mounted as read-only.</p><p>To make modifications, run the following command to remount with write access:</p><p><code>mount -o remount,rw /</code></p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-3b774a1d8adcb06d7ddc820bab2163c4>8.2.2 - Resetting a Lost Root Password</h1><p>Perform the following steps to rest a lost password:</p><ol><li><p>Restart the Photon OS machine or the virtual machine running Photon OS.</p><p>When the Photon OS splash screen appears as it restarts, type the letter <code>e</code> to go to the GNU GRUB edit menu quickly. Because Photon OS reboots so quickly, you won&rsquo;t have much time to type <code>e</code>. Remember that in vSphere and Workstation, you might have to give the console focus by clicking in its window before it will register input from the keyboard.</p></li></ol><p>Second, in the GNU GRUB edit menu, go to the end of the line that starts with <code>linux</code>, add a space, and then add the following code exactly as it appears below:</p><pre><code>rw init=/bin/bash
</code></pre><p>After you add this code, the GNU GRUB edit menu should look exactly like this:</p><p><img src=../../docs/images/grub-edit-menu-changepw.png alt="The modified GNU GRUB edit menu"></p><p>Now type <code>F10</code>.</p><p>At the command prompt, type <code>passwd</code> and then type (and re-enter) a new root password that conforms to the password complexity rules of Photon OS. Remember the password.</p><p>Next, type the following command:</p><pre><code>umount /
</code></pre><p>Finally, type the following command. You must include the <code>-f</code> option to force a reboot; otherwise, the kernel enters a state of panic.</p><pre><code>reboot -f
</code></pre><p>This sequence of commands should look like this:</p><p><img src=../../docs/images/resetpw.png alt="The series of commands to reset the root password"></p><p>After the Photon OS machine reboots, log in with the new root password.</p><h2 id=resetting-the-failed-logon-count>Resetting the failed logon count</h2><p>Resetting the root password will not reset the failed logon count, if you&rsquo;ve had to many failed attempts, you may not be able to logon after resetting the password.</p><p>You will know if this is the case, if you see <code>Account locked due to X failed logins</code> at the photon console.</p><p>To reset the count, before you unmount the filesystem, run the following&mldr;</p><pre><code>/sbin/pam_tally2 --reset --user root
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-ac6ea7a2ae283997a41310a5017afebf>8.2.3 - Fixing Permissions on Network Config Files</h1><p>When you create a new network configuration file as root user, the network service might be unable to process it until you set the file mode bits (i.e. <code>chmod</code>) to <code>644</code>.</p><p>If you query the journal with <code>journalctl -u systemd-networkd</code>, you might see the following error message along with an indication that the network service did not start:</p><p><code>could not load configuration files. permission denied</code></p><p>The permissions on the network files might cause this problem. Without the correct permissions, <code>networkd-systemd</code> cannot parse and apply the settings, and the network configuration that you created will not be loaded.</p><p>After you create a network configuration file with a <code>.network</code> extension, you must run the <code>chmod</code> command to set the new file&rsquo;s mode bits to <code>644</code>. Example:</p><p><code>chmod 644 10-static-en.network</code></p><p>For Photon OS to apply the new configuration, you must restart the <code>systemd-networkd</code> service by running the following command:</p><p><code>systemctl restart systemd-networkd</code></p></div><div class=td-content style=page-break-before:always><h1 id=pg-dcc310ada5d14b412cd7a0a3b235f5a9>8.2.4 - Permitting Root Login with SSH</h1><p>The full version of Photon OS prevents root login with SSH by default. To permit root login over SSH, open <code>/etc/ssh/sshd_config</code> with the vim text editor and set <code>PermitRootLogin</code> to <code>yes</code>.</p><p>Vim is the default text editor available in Photon OS. The developer version also contains Nano. After you modify the SSH daemon&rsquo;s configuration file, you must restart the sshd daemon for the changes to take effect.</p><p>Example:</p><pre><code class=language-console data-lang=console>vim /etc/ssh/sshd_config
</code></pre><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#8f5902;font-style:italic># override default of no subsystems</span>
<span style=color:#c4a000>Subsystem       sftp    /usr/libexec/sftp-server</span>

<span style=color:#8f5902;font-style:italic># Example of overriding settings on a per-user basis</span>
<span style=color:#8f5902;font-style:italic>#Match User anoncvs</span>
<span style=color:#8f5902;font-style:italic>#       X11Forwarding no</span>
<span style=color:#8f5902;font-style:italic>#       AllowTcpForwarding no</span>
<span style=color:#8f5902;font-style:italic>#       PermitTTY no</span>
<span style=color:#8f5902;font-style:italic>#       ForceCommand cvs server</span>
<span style=color:#c4a000>PermitRootLogin yes</span>
<span style=color:#c4a000>UsePAM yes</span>
</code></pre></div><p>Save your changes in vim and then restart the sshd daemon:</p><pre><code class=language-console data-lang=console>systemctl restart sshd
</code></pre><p>You can then connect to the Photon OS machine with the root account over SSH:</p><pre><code class=language-console data-lang=console>user@ubuntu:~$ ssh root@10.0.0.131
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-70929a5c761504aaa356aca81dcf5de7>8.2.5 - Fixing Sendmail</h1><p>If Sendmail is not behaving as expected or hangs during installation, it might be because FQDN is not set.</p><p>Perform the following steps:</p><ol><li><p>Set an FQDN for your Photon OS machine.</p></li><li><p>Run the following commands in the order below:</p><pre><code>echo $(hostname -f) &gt; /etc/mail/local-host-names
       
    cat &gt; /etc/mail/aliases &lt;&lt; &quot;EOF&quot;
        postmaster: root
        MAILER-DAEMON: root
        EOF
   
    /bin/newaliases
   
    cd /etc/mail
   
    m4 m4/cf.m4 sendmail.mc &gt; sendmail.cf
   
    chmod 700 /var/spool/clientmqueue
   
    chown smmsp:smmsp /var/spool/clientmqueue
</code></pre></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-12ed3b235a2c62adb1a16a7644accee1>8.3 - Photon OS General Troubleshooting</h1><p>The section includes general troubleshooting instruction for Photon OS.</p></div><div class=td-content><h1 id=pg-664cc9cec9a044cfca15b926a17dd983>8.3.1 - Photon Code</h1><p>Photon is an RPM based Linux distribution similar to variants like CentOS and Fedora. With RPM based distributions granular updates as opposed to updating the whole OS image is possible.</p><p>##SPEC File
The &ldquo;Recipe&rdquo; for creating an RPM package is a spec file. The Photon code base&rsquo;s <strong>SPECS</strong> folder hast the following directory structure:</p><pre><code>SourceRoot

       SPECS
            linux
                patch1
                patch2
                linux.spec
</code></pre><h2 id=check-if-a-package-is-signed>Check if a package is signed</h2><p>Run the following commands to check if the package is signed:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#8f5902;font-style:italic>#check if a package is signed</span>
rpm -q linux --qf <span style=color:#4e9a06>&#39;%{NAME}-%{VERSION}-%{RELEASE} %{SIGPGP:pgpsig} %{SIGGPG:pgpsig}\n&#39;</span>
linux-4.19.79-2.ph3 RSA/SHA1, Thu <span style=color:#0000cf;font-weight:700>31</span> Oct <span style=color:#0000cf;font-weight:700>2019</span> 10:05:05 AM UTC, Key ID c0b5e0ab66fd4949 <span style=color:#ce5c00;font-weight:700>(</span>none<span style=color:#ce5c00;font-weight:700>)</span>
 
<span style=color:#8f5902;font-style:italic>#or</span>
rpm -qi linux <span style=color:#000;font-weight:700>|</span> grep <span style=color:#4e9a06>&#34;Signature&#34;</span>
Signature   : RSA/SHA1, Thu <span style=color:#0000cf;font-weight:700>31</span> Oct <span style=color:#0000cf;font-weight:700>2019</span> 10:05:05 AM UTC, Key ID c0b5e0ab66fd4949
 
<span style=color:#8f5902;font-style:italic>#Last 8 chars of Key ID: 66fd4949</span>
<span style=color:#8f5902;font-style:italic>#See if it matches the version of any of the gpg keys installed.</span>
rpm -qa <span style=color:#000;font-weight:700>|</span> grep gpg-pubkey <span style=color:#000;font-weight:700>|</span> xargs -n1 rpm -q --queryformat <span style=color:#4e9a06>&#34;%{NAME} %{VERSION} %{PACKAGER}\n&#34;</span>
gpg-pubkey 66fd4949 VMware, Inc. -- Linux Packaging Key -- linux-packages@vmware.com
gpg-pubkey 3e1ba8d5 Google Cloud Packages RPM Signing Key gc-team@google.com
</code></pre></div><h2 id=check-if-an-image-has-vulnerabilities>Check if an image has vulnerabilities</h2><p>Use the security scanners to find security issues. Alternatively The <code>tdnf updateinfo info</code> command displays all the applicable security updates the host needs.</p><h2 id=check-if-a-cve-is-fixed>Check if a CVE is Fixed</h2><p>The Photon team fixes vulnerabilities and publishes advisories to <a href=https://github.com/vmware/photon/wiki/Security-Advisories>https://github.com/vmware/photon/wiki/Security-Advisories</a>.</p><h2 id=to-check-if-security-updates-are-available>To Check if Security Updates are Available</h2><p>Use the <code>tdnf updateinfo info</code>, <code>tdnf update --security</code> or <code>tdnf update ---sec-severity &lt;level></code> commands to check if security updates are available. For example:</p><p>Check if there are any security updates</p><pre><code class=language-console data-lang=console>root@photon [ ~ ]# tdnf updateinfo
70 Security notice(s)
</code></pre><p>Check if there are security updates for libssh2. note this is relative to what is installed in local</p><pre><code class=language-console data-lang=console>root@photon[ ~ ]# tdnf updateinfo list libssh2
patch:PHSA-2020-3.0-0047 Security libssh2-1.9.0-2.ph3.x86_64.rpm
patch:PHSA-2019-3.0-0025 Security libssh2-1.9.0-1.ph3.x86_64.rpm
patch:PHSA-2019-3.0-0009 Security libssh2-1.8.2-1.ph3.x86_64.rpm
patch:PHSA-2019-3.0-0008 Security libssh2-1.8.0-2.ph3.x86_64.rpm
</code></pre><p>Show details of all the libssh2 updates
root@photon [ ~ ]# tdnf updateinfo info libssh2
Name : libssh2-1.9.0-2.ph3.x86_64.rpm
Update ID : patch:PHSA-2020-3.0-0047
Type : Security
Updated : Wed Jan 15 10:48:25 2020
Needs Reboot: 0
Description : Security fixes for {&lsquo;CVE-2019-17498&rsquo;}
Name : libssh2-1.9.0-1.ph3.x86_64.rpm
Update ID : patch:PHSA-2019-3.0-0025
Type : Security
Updated : Sat Aug 17 16:14:35 2019
Needs Reboot: 0
Description : Security fixes for {&lsquo;CVE-2019-13115&rsquo;}
Name : libssh2-1.8.2-1.ph3.x86_64.rpm
Update ID : patch:PHSA-2019-3.0-0009
Type : Security
Updated : Sat Apr 13 03:34:22 2019
Needs Reboot: 0
Description : Security fixes for {&lsquo;CVE-2019-3859&rsquo;, &lsquo;CVE-2019-3862&rsquo;, &lsquo;CVE-2019-3861&rsquo;, &lsquo;CVE-2019-3857&rsquo;, &lsquo;CVE-2019-3858&rsquo;, &lsquo;CVE-2019-3863&rsquo;, &lsquo;CVE-2019-3860&rsquo;, &lsquo;CVE-2019-3856&rsquo;}
Name : libssh2-1.8.0-2.ph3.x86_64.rpm
Update ID : patch:PHSA-2019-3.0-0008
Type : Security
Updated : Fri Mar 29 16:04:18 2019
Needs Reboot: 0
Description : Security fixes for {&lsquo;CVE-2019-3855&rsquo;}</p><pre><code> 
install all security updates &gt;= score 9.0 (CVSS_v3.0_Severity)

```console
root@photon [ ~ ]# tdnf update --sec-severity 9.0
Upgrading:
apache-tomcat                  noarch          8.5.50-1.ph3         photon-updates    9.00M 9440211
bash                           x86_64          4.4.18-2.ph3         photon-updates    3.16M 3315720
bzip2                          x86_64          1.0.8-1.ph3          photon-updates  124.99k 127990
bzip2-libs                     x86_64          1.0.8-1.ph3          photon-updates   74.31k 76096
file                           x86_64          5.34-2.ph3           photon-updates   43.02k 44056
file-libs                      x86_64          5.34-2.ph3           photon-updates    5.21M 5458536
git                            x86_64          2.23.1-2.ph3         photon-updates   24.34M 25519969
glib                           x86_64          2.58.0-4.ph3         photon-updates    3.11M 3265152
libseccomp                     x86_64          2.4.0-2.ph3          photon-updates  315.79k 323368
libssh2                        x86_64          1.9.0-2.ph3          photon-updates  238.41k 244136
linux-esx                      x86_64          4.19.97-2.ph3        photon-updates   12.68M 13299655
 
Total installed size:  58.28M 61114889
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-5404bf48493f97cd2de8f602f761fc79>8.3.2 - Package Management</h1><p><a href=https://github.com/vmware/tdnf>TDNF</a> is the default package manager for Photon OS. The standard syntax for <code>tdnf</code> commands is the same as that for DNF and YUM. TDNF reads YUM repositories from <strong>/etc/yum.repos.d/</strong>.</p><p>To find the main configuration file and see its contents, run the following command:</p><pre><code>cat /etc/tdnf/tdnf.conf
[main]
gpgcheck=1
installonly_limit=3
clean_requirements_on_remove=true
repodir=/etc/yum.repos.d
cachedir=/var/cache/tdnf
</code></pre><p>Repositories have a <strong>.repo</strong> file extension, The following repositories are available in <strong>/etc/yum.repos.d/</strong> :</p><pre><code>ls /etc/yum.repos.d/
photon-extras.repo
photon-iso.repo
photon-updates.repo
photon.repo
</code></pre><p>Use the <code>tdnf repolist</code> command to list the repositories. Tdnf filters the results by their status <strong>enabled</strong>, <strong>disabled</strong>, and <strong>all</strong>. Running the <code>tdnf repolist</code> command without arguments displays the enabled repositories.</p><pre><code>#tdnf repolist

repo id repo name status
photon-extras        VMware Photon Extras 3.0(x86_64) enabled
photon-debuginfo VMware Photon Linux debuginfo 3.0(x86_64)enabled
photon                    VMware Photon Linux 3.0(x86_64) enabled
photon-updates     VMware Photon Linux 3.0(x86_64) Updates enabled
root@photon-75829bfd01d0 [ ~ ]#
</code></pre><p>The following repositories are important for Photon:</p><ul><li>photon-updates : This repo contains RPM updates for CVE/version and updates/others fixes.</li><li>photon-debuginfo : This repo contains information about RPMs with debug symbols.</li><li>photon : This repo generally contains the RPM versions packaged with the released ISO.</li></ul><p>To check the local cache data from the repository, run the following command:</p><pre><code># ls -l /var/cache/tdnf/photon
total 12
-r--r----- 1 root root 0 Apr 3 22:34 lastrefresh
drwxr-x--- 2 root root 4096 Apr 3 22:34 repodata
drwxr-x--- 4 root root 4096 Feb 4 14:31 rpms
drwxr-x--- 2 root root 4096 Apr 3 22:34 solvcache
</code></pre><p>##Usage
The <code>tdnf</code> command can be used in the following ways:</p><p><code>#tdnf repolist --refresh</code> : This command is used to refresh the repolist. Generally there is a cache of the repo data stored in the local VM.</p><p><code>#tdnf install &lt;rpm name></code> : This command is used to install a RPM. This command installs the latest version of the RPM.</p><p><code>#tdnf install &lt;pkg-name>-&lt;verison>-&lt;release>.&lt;photon-release></code> : This command is used to install a particular RPM version. For example, run <code># tdnf install systemd-239-11.ph3</code>.</p><p><code>#tdnf list systemd</code> : This command is used to list the available RPM versions in the repository.</p><p><code>#tdnf makecache</code> : This command updates the cached binary metadata for all known repositories.</p><p><code>tdnf clean all</code> : This command cleans up temporary files, data, and metadata. It takes the argument <code>all</code>.</p><pre><code>#tdnf list systemd

Refreshing metadata for: 'VMware Photon Linux 3.0(x86_64)'

systemd.x86_64                                                                       239-15.ph3                                            @System

systemd.x86_64                                                                       239-11.ph3                                     photon-updates

systemd.x86_64                                                                       239-12.ph3                                     photon-updates

systemd.x86_64                                                                       239-13.ph3                                     photon-updates

systemd.x86_64                                                                       239-14.ph3                                     photon-updates

systemd.x86_64                                                                       239-15.ph3                                     photon-updates

systemd.x86_64                                                                       239-17.ph3                                     photon-updates

systemd.x86_64                                                                       239-18.ph3                                     photon-updates

systemd.x86_64                                                                       239-19.ph3                                     photon-updates

systemd.x86_64                                                                       239-10.ph3                                             photon

systemd.x86_64                                                                       239-10.ph3                                             photon

root@photon-4a0e7f2307d4 [ /WS/photon-dev/photon ]#
</code></pre><p>Here, <code>@System</code> indicates that the particular RPM is installed in the VM.</p><p>To upgrade/downgrade RPMs run the following commands:</p><pre><code>#tdnf upgrade &lt;pkg-name&gt;

#tdnf downgrade &lt;pkg-name&gt;
</code></pre><p>After upgrade/downgrade the dependent packages must be manually upgraded/downgraded as well. Use the <code>#tdnf remove &lt;pkg-name></code> command to remove packages and <code># tdnf clean all</code> to clear cached packages, metadata, dbcache, plugins and expire-cache.</p><p>#RPM
RPM is an open source package management system capable of building software from source into easily distributable packages. It is used for installing, updating and uninstalling packaged software.
RPM can also be used to query detailed information about the packaged software and to check if a particular package is installed or not.</p><p>You can do the following operation using the RPM binaries:</p><ul><li>Install/Upgrade/Downgrade/Remove RPMs from a virtual machine.</li><li>Check the version of the packages installed.</li><li>Check the package contents.</li><li>Check the dependencies of a package.</li><li>Find the source package of a file.</li></ul><p>To find the package that contains a particular binary, run <code>rpm -q —whatprovides &lt;binary/file path></code> command.</p><p>##Usage
The <code>rpm</code> command can be used in the following ways:</p><ul><li><code>rpm -ivh &lt;rpm file path></code> : This command installs the RPM in a virtual machine.</li><li><code>rpm -Uvh &lt;rpm file path></code> : This command is used to upgrade/downgrade the RPM.</li><li><code>rpm -e &lt;rpm file path></code> : This command uninstalls the RPM from the virtual machine.</li><li><code>rpm -qp &lt;rpm file path> --provides</code> : This displays the libraries provided by the RPM.</li><li><code>rpm -qp &lt;rpm file path> --requires</code> : This displays the binaries/libraries required to install a particular rpm.</li><li><code>rpm -qa</code> : This displays a list of all installed packages.</li><li><code>rpm -ql &lt;package file.rpm></code> : This command lists all files in the package file.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-ff9fc3434cbe8db979342d9736dbfeb6>8.3.3 - Network Configuration</h1><p>systemd-networkd is a system daemon that manages network configurations. It detects and configures network devices as they appear. It can also create virtual network devices.</p><p>##Configuration Examples
All configurations are stored as <strong>foo.network</strong> in the <strong>/etc/systemd/network/</strong>, <strong>/lib/systemd/network/</strong> and <strong>/run/systemd/network/</strong> folder. Use the <code>networkctl list</code> command to list all the devices on the system.</p><p>After making changes to a configuration file, restart the <strong>systemd-networkd.service</strong> if version is &lt; 245, for other version run the following commands:</p><pre><code>root@photon [ /home/sus ]# networkctl reload
root@photon [ /home/sus ]# networkctl reconfigure eth0
</code></pre><p><strong>Note</strong>:</p><ul><li>The options mentioned in the configuration files are case sensitive.</li><li>Set <code>DHCP=yes</code> to accept IPv4 and IPv6 DHCP requests.</li><li>Set <code>DHCP=ipv4</code> to accept IPv4 DHCP requests.</li><li>Set LinkLocalAddressing=no to disable IPv6. Please do not disable IPv6 via sysctl. When <code>LinkLocalAddressing=no</code> in the .network file, the kernel drops addresses starting with <strong>fe80</strong>, for example <strong>fe80::20c:29ff:fe4c:7eca</strong>. If IPv6LL address is not available networkd will not start IPv6 configurations.</li></ul><p>To link network configurations using DHCPv4 (IPv6 disabled), run the following command:</p><pre><code>/etc/systemd/network/20-eth0.network
[Match]
Name=eth0

[Network]
LinkLocalAddressing=no

DHCP=ipv4
</code></pre><p>To link network configurations using DHCPv6, run the following command:</p><pre><code>/etc/systemd/network/20-eth0.network
[Match]
Name=eth0

[Network]
IPv6AcceptRA=yes

DHCP=ipv6
</code></pre><p>To link network configurations using a static IP address, run the following command:</p><pre><code>/etc/systemd/network/20-wired.network
[Match]
Name=enp1s0

[Network]
Address=10.1.10.9/24
Gateway=10.1.10.1
DNS=10.1.10.1
</code></pre><p>Here <code>Address=</code> can be used more than once to configure multiple IPv4 or IPv6 addresses.</p><p>A <strong>.link</strong> file can be used to rename an interface. For example, set a predictable interface name for a Ethernet adapter based on its MAC address by running the following command:</p><pre><code>/etc/systemd/network/10-test0.link
[Match]
MACAddress=12:34:56:78:90:ab

[Link]
Description=my custom name
Name=test123
</code></pre><p>##Configuration Files
Configuration files are located in <strong>/usr/lib/systemd/network/</strong> folder, the volatile runtime network directory in <strong>/run/systemd/network/</strong> folder and the local administration network directory in <strong>/etc/systemd/network/</strong> folder. Configuration files in <strong>/etc/systemd/network/</strong> folder have the highest priority.</p><p>There are three types of configuration files and they use a format similar to systemd unit files.</p><ul><li><p><strong>.network</strong> : These files apply a network configuration to a matching device.</p></li><li><p><strong>.netdev</strong> : These files are used to create a virtual network device for a matching environment.</p></li><li><p><strong>.link</strong> : When a network device appears, udev looks for the first matching <strong>.link</strong> file.
These link files follow the following rules:</p></li><li><p>Only if all conditions in the <code>[Match]</code> section are matched, the profile will be activated.</p></li><li><p>An empty <code>[Match]</code> section means the profile can apply to any case (can be compared to the * wild card)</p></li><li><p>All configuration files are collectively sorted and processed in lexical order, regardless of the directory it resides in.</p></li><li><p>Files with identical names replace each other.</p></li></ul><p>##Dupliate Matches
If we have multiple configuration files matching an interface, the first (in lexical order) network file matching a given device is applied. All other files are ignored even if they match. The following is an example of matching configuration files:</p><pre><code>builder@localhost [ ~ ]$ cat /etc/systemd/network/10-eth0.network
[Match]
Name=eth0
[Network]
DHCP=yes
  
builder@localhost [ ~ ]$ cat /etc/systemd/network/99-dhcp-en.network
[Match]
Name=e*
 
[Network]
DHCP=yes
IPv6AcceptRA=no
</code></pre><p>##Network Files
These files are used to set network configuration variables for servers and containers.
<strong>.network</strong> files have the following sections:</p><p>###<code>[Match]</code></p><table><thead><tr><th>Parameter</th><th>Description</th><th>Accepted Values</th></tr></thead><tbody><tr><td><code>Name=</code></td><td>Matches device names. For example: <code>en*</code>. By using <code>!</code> prefix the list can be inverted.</td><td>Device names separated by a white space, logical negation (!).</td></tr><tr><td><code>MACAddress=</code></td><td>Matches MAC addresses. For example: <code>MACAddress=01:23:45:67:89:ab 00-11-22-33-44-55 AABB.CCDD.EEFF</code></td><td>MAC addresses with full colon-, hyphen- or dot-delimited hexadecimal separated by a white space.</td></tr><tr><td><code>Host=</code></td><td>Matches the host name or the machine ID of the host.</td><td>Hostname string or Machine ID</td></tr><tr><td><code>Virtualization=</code></td><td>Checks whether the system is running in a virtual environment. <code>Virtualization=false</code> will only match your host machine, while <code>Virtualization=true</code> matches containers or VMs. It is also possible to check for a specific virtualization type or implementation.</td><td>boolean, logical negation (!), type (vm, container), implementation (qemu, kvm, zvm, vmware, microsoft, oracle, xen, bochs, uml, bhyve, qnx, openvz, lxc, lxc-libvirt, systemd-nspawn, docker, podman, rkt, wsl, acrn)</td></tr></tbody></table><p>###<code>[Link]</code></p><ul><li><code>MACAddress=</code> : Used to spoof MAC address.</li><li><code>MTUBytes=</code> : Setting a larger MTU value (For example: when using jumbo frames) can significantly speed up your network transfers.</li><li><code>Multicast</code> : Enables the use of multicast on interface(s).</li></ul><p>###<code>[Network]</code></p><table><thead><tr><th>Parameter</th><th>Description</th><th>Accepted Values</th><th>Default Value</th></tr></thead><tbody><tr><td><code>DHCP=</code></td><td>Controls DHCPv4 and/or DHCPv6 client support.</td><td>Boolean, <code>ipv4</code>, <code>ipv6</code></td><td>false</td></tr><tr><td><code>DHCPServer=</code></td><td>If enabled, a DHCPv4 server will be started.</td><td>Boolean</td><td>false</td></tr><tr><td><code>MulticastDNS=</code></td><td>Enables multicast DNS support. When set to <code>resolve</code>, only resolution is enabled.</td><td>Boolean, <code>resolve</code></td><td>false</td></tr><tr><td><code>DNSSEC=</code></td><td>Controls the DNSSEC DNS validation support on the link. When set to <code>allow-downgrade</code>, compatibility with non-DNSSEC capable networks is increased, by automatically turning off DNSSEC.</td><td>Boolean, <code>allow-downgrade</code></td><td>false</td></tr><tr><td><code>DNS=</code></td><td>Configures static DNS addresses. can be specified more than once.</td><td><code>inet_pton</code></td><td></td></tr><tr><td><code>Domains=</code></td><td>Indicates domains which must be resolved using the DNS servers.</td><td>domain name, optionally prefixed with a <strong>~</strong></td><td></td></tr><tr><td><code>IPForward=</code></td><td>If enabled, incoming packets on any network interface will be forwarded to any other interfaces according to the routing table.</td><td>Boolean, <code>ipv4</code>, <code>ipv6</code></td><td>false</td></tr><tr><td><code>IPMasquerade=</code></td><td>If enabled, packets forwarded from the network interface appear as if they are coming from the local host.</td><td>Boolean</td><td>false</td></tr><tr><td><code>IPv6PrivacyExtensions=</code></td><td>Configures use of stateless temporary addresses that change over time. When set to <code>prefer-public</code>, the privacy extensions are enabled, but prefers public addresses over temporary addresses. When set to <code>kernel</code>, the kernel&rsquo;s default setting will be left in place.</td><td>Boolean, <code>prefer-public</code>, <code>kernel</code></td><td>false</td></tr></tbody></table><p>###<code>[Address]</code>
<code>Address=</code> option is mandatory unless DHCP is used.</p><p>###<code>[Route]</code></p><ul><li><code>Gateway=</code> option is mandatory unless DHCP is used.</li><li><code>Destination=</code> option defines the destination prefix of the route, possibly followed by a slash and the prefix length.
If Destination is not present in <code>[Route]</code> section it is treated as a default route.
<strong>Note:</strong> You can add the <code>Address=</code> and <code>Gateway=</code> keys in the <code>[Network]</code> section as a short-hand, if the <code>[Address]</code> section contains only an Address key and <code>[Route]</code> section contains only a Gateway key.</li></ul><p>###DHCP</p><table><thead><tr><th>Parameter</th><th>Description</th><th>Accepted Values</th><th>Default Value</th></tr></thead><tbody><tr><td><code>UseDNS=</code></td><td>Defines the DHCP server to be used.</td><td>Boolean</td><td>true</td></tr><tr><td><code>Anonymize=</code></td><td>When set to <code>true</code>, the options sent to the DHCP server will follow RFC7844 (Anonymity Profiles for DHCP Clients) to minimize disclosure of identifying information.</td><td>Boolean</td><td>false</td></tr><tr><td><code>UseDomains=</code></td><td>Defines the DHCP server to be used as the DNS search domain. If set to <code>route</code>, the domain name received from the DHCP server will be used for routing DNS queries only and not for searching. This option can sometimes fix local name resolving when using systemd-resolved.</td><td>Boolean, <code>route</code></td><td>false</td></tr></tbody></table><p>###<code>[DHCPServer]</code>
The following is an example of a DHCP server configuration which works well with hostapd to create a wireless hotspot. <code>IPMasquerade</code> adds the firewall rules for NAT and <code>IPForward</code> enables packet forwarding.</p><pre><code>/etc/systemd/network/wlan0.network
[Match]
Name=wlan0

[Network]
Address=10.1.1.1/24
DHCPServer=true
IPMasquerade=true
IPForward=true

[DHCPServer]
PoolOffset=100
PoolSize=20
EmitDNS=yes
DNS=9.9.9.9
</code></pre><p>##Netdev Files
These files create virtual network devices. They have the following two sections:</p><p>###<code>[Match]</code></p><ul><li><code>Host=</code> : The host name.</li><li><code>Virtualization=</code> : Checks if it is running in a virtual environment.</li></ul><p>###<code>[NetDev]</code></p><ul><li><code>Name=</code> : The interface&rsquo;s name. This is a mandatory field.</li><li><code>Kind=</code> : For example: bridge, bond, vlan, veth, sit, etc. This is a mandatory field.</li></ul><p>##Link Files
These files are an alternative to custom udev rules and will be applied by udev as the device appears. They have the following two sections:</p><p>###<code>[Match]</code></p><ul><li><code>MACAddress=</code> : The MAC address.</li><li><code>Host=</code> : The host name.</li><li><code>Virtualization=</code> : Checks if it is running in a virtual environment.</li><li><code>Type=</code> : the device type. For example: vlan.</li></ul><p>###<code>[Link]</code></p><ul><li><code>MACAddressPolicy=</code> : Persistent or random addresses.</li><li><code>MACAddress=</code> : The MAC address.
<strong>Note:</strong> The system <strong>/usr/lib/systemd/network/99-default.link</strong> file is sufficient for most cases.</li></ul><p>##Debugging Systemd-networkd
The log can be generated by creating a drop-in config. For example:</p><pre><code># /etc/systemd/system/systemd-networkd.service.d/override.conf
[Service]
Environment=SYSTEMD_LOG_LEVEL=debug
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-51e16a96644c046ffe6a824b4489b09d>8.3.4 - Cloud-init</h1><p>Cloud-init is mixture of Python and Shell scripts that initialize cloud instances of Linux machines.
Cloud-init performs boot time configuration of a system.
We can configure users, hostname, host network, write files to disk, manage packages, run custom scripts and so on.</p><p>##DataSources
Datasource is the source of configuration data for cloud-init that is typically given by a user (For example: userdata) or obtained from the cloud that created the configuration drive (For example: metadata).
Userdata includes files, YAML configuration files and shell scripts.
Metadata includes server name, instance id, display name and other cloud specific details.</p><p>Currently there are two datasources used in Photon OS, it&rsquo;s usage is described in the following sections:</p><ul><li>DataSourceOVF - Used for GuestOS customization in vSphere.</li><li>VMwareGuestInfo - Used to read meta, user, and vendor data from VMware vSphere&rsquo;s GuestInfo interface and initialize the system.</li></ul><p>###DataSourceOVF
The OVF (Open Virtualization Format) Datasource provides a datasource for reading data from an OVF transport ISO.
The vmtoolsd service extracts the customization spec cab file from the OVF and calls either cloud-init or the GuestOS customization scripts.
The <code>disable_vmware_customization</code> flag in <strong>/etc/cloud/cloud.cfg</strong> file determines if GOSC scripts or cloud-init is used.</p><ul><li><code>disable_vmware_customization: false</code> : Cloud-init is used for Guest OS customization</li><li><code>disable_vmware_customization: true</code> : GuestOS customization scripts is used for Guest OS customization</li></ul><p><strong>Note</strong>:
The default value for <code>disable_vmware_customization</code> is set to <code>true</code> in the <strong>/etc/cloud/cloud.cfg</strong> file</p><p>###VMwareGuestInfo
VMwareGuestInfo data source is configured by setting <code>guestinfo</code> properties on a VM. This can be set by performing one of the following:</p><ul><li>Using the vmware-rpctool provided by open-vmtools.</li><li>Modifying the <strong>vmx</strong> file to set the guestinfo properties.</li></ul><p>##Debugging Cloud-init Failures
Cloud-init has four services which are started in the following sequence:</p><ol><li>cloud-init-local - This service locates local data sources and applies networking configurations provided n the metadata (If there is no metadata it applies Fallback). Use <code>$ systemctl status cloud-init-local</code> command to check its status.</li><li>cloud-init - This service processes any user-data that is found and runs the cloud_init_modules in <strong>/etc/cloud/cloud.cfg</strong>. Use <code>$ systemctl status cloud-init</code> command to check its status.</li><li>cloud-config - This service runs the cloud_config_modules in <strong>/etc/cloud/cloud.cfg</strong> file. Use <code>$ systemctl status cloud-config</code> command to check its status.</li><li>cloud-final - This service runs any script that a user is accustomed to running after logging into a system (For example: package installations, configs, user-scripts) and runs cloud_final_modules in <strong>/etc/cloud/cloud.cfg</strong> file. Use <code>$ systemctl status cloud-final</code> command to check its status.</li></ol><p>Cloud-init logs are available in the <strong>/var/log/cloud-init.log</strong> file. Logs for GuestOS customization using DataSourceOVF are available in the <strong>/var/log/vmware-imc/toolsDeployPkg.log</strong> and <strong>/var/log/cloud-init.log</strong> files.</p><p>To analyze the cloud-init boot time performance, run the following commands:</p><ul><li><code>$ cloud-init analyze blame</code> - The blame command prints in descending order, the units that took the longest to run. This output is useful for observe where cloud-init is spending its time during execution.</li><li><code>$ cloud-init analyze show</code> - The show command prints a list of units, the time they started and how long they took to complete. It also prints a summary of total time per boot.</li><li><code>$ cloud-init analyze dump</code> - The dump command dumps the cloud-init logs for the analyze modules and displays a list of dictionaries that can be consumed for other reporting needs.</li><li><code>$ cloud-init status</code> - To know the overall status of clouf-init.</li></ul><p>Cloud-init doesn&rsquo;t configure the network if <strong>/etc/cloud/cloud.cfg.d/99-disable-networking-config.cfg</strong> file is present and has the following content:</p><ul><li>network:Item</li><li>config: disabled</li></ul><p>Take a backup of <strong>/etc/cloud/cloud.cfg.d/99-disable-networking-config.cfg</strong> file and remove it from it&rsquo;s location.
Reconfigure the machine using metadata, userdata and vendordata.
Once the configurations are done copy the backup file to the same location.
Cloud-init will push it&rsquo;s fallback configuration when service is restarted or rebooted and there is no local datasource to configure. To avoid this <strong>/etc/cloud/cloud.cfg.d/99-disable-networking-config.cfg</strong> file is required.</p><p>##Run Cloud-init Manually
To run cloud-init manually, run the following commands:</p><pre><code>/usr/bin/cloud-init -d init  (-d for debug)
/usr/bin/cloud-init -d modules (run all modules)
/usr/bin/cloud-init --file &lt;config-yaml-file-path&gt; init (if you want to run cloud-init with a configuration yaml file)
</code></pre><p>When cloud-init is running, to force it to run with all configs engaged run the following command:</p><pre><code>rm -rf /var/lib/cloud/*
</code></pre><p>For more information about cloud-init, see
<a href=https://cloudinit.readthedocs.io/en/latest/index.html>https://cloudinit.readthedocs.io/en/latest/index.html</a><a href=https://cloudinit.readthedocs.io/en/latest/index.html>https://cloudinit.readthedocs.io/en/latest/index.html</a></p><p>For more information about cloud-init CLI, see
<a href=https://cloudinit.readthedocs.io/en/latest/topics/cli.html>https://cloudinit.readthedocs.io/en/latest/topics/cli.html</a><a href=https://cloudinit.readthedocs.io/en/latest/topics/cli.html>https://cloudinit.readthedocs.io/en/latest/topics/cli.html</a></p><p><strong>Note</strong>:Include the cloud-init log tarball and the vmtoolsd logs when you raise an issue.</p><ol><li>Collect cloud-init log tarball by running the <code>cloud-init collect-logs</code> command.</li><li>Collect the vmtoolsd logs from <strong>/var/log/vmware-imc/toolsDeployPkg.log</strong> file.</li><li>Attach the collected logs to the issue ticket.</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-bc1ceb0533f29196c7d5f82d8eea575e>8.3.5 - Open-vm-tools/Vmtoolsd</h1><p>Vmtoolsd is a systemd service, using which we can set guestinfo properties metadata, userdata and vendordata etc., which in turn are consumed by cloud-init.
VMwareGuestInfo Datasource uses this guestinfo properties and applies them to the system.</p><p>vmware-rpctool is a utility provided by open-vm-tools to set metadata, userdata and vendordata.
vmware-rpctool provides info.set and info.get options to set and get the guestinfo properties respectively.</p><p>##Debugging
To check the status of the vmtoolsd service (vmtoolsd is dependant on vgauthd), run the following commands:</p><pre><code>$ systemctl status vmtoolsd vgauthd

$ journalctl -u vmtoolsd

$ journalctl -u vgauthd
</code></pre><p>To set and get metadata, userdata and vendordata, run the following commands:</p><pre><code>$ /usr/bin/vmware-rpctool 'info-get guestinfo.metadata'

$ /usr/bin/vmware-rpctool 'info-get guestinfo.userdata'

$ /usr/bin/vmware-rpctool 'info-get guestinfo.vendordata'
</code></pre><p>A YAML file can be used as input to the <strong>rpctool</strong> using following commands:</p><pre><code>vmware-rpctool &quot;info-set guestinfo.userdata.encoding base64&quot;
vmware-rpctool &quot;info-set guestinfo.metadata.encoding base64&quot;

vmware-rpctool &quot;info-set guestinfo.metadata ${metadata file contents}&quot;

vmware-rpctool &quot;info-set guestinfo.userdata ${userdata file contents}&quot;
</code></pre><p><strong>Note</strong>:Include the cloud-init log tarball and the vmtoolsd logs when you raise an issue.</p><ol><li>Collect cloud-init log tarball by running the <code>cloud-init collect-logs</code> command.</li><li>Collect the vmtoolsd logs from <strong>/var/log/vmware-imc/toolsDeployPkg.log</strong> file.</li><li>Attach the logs collected to the issue ticket.</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-d65d5ffc0a2bedf288766d2b9faf15ce>8.4 - Troubleshooting Tools</h1><p>Photon OS includes tools that help troubleshoot problems. These tools are installed by default on the full version of Photon OS. On the minimal version of Photon OS, you might have to install a tool before you can use it.</p><p>There is a man page on Photon OS for all the tools covered in this section. The man pages provide more information about each tool&rsquo;s commands, options, and output. To view a tool&rsquo;s man page, on the Photon OS command line, type <code>man</code> and then the name of the tool. Example:</p><pre><code>man strace</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-04a89d7f32cd8174c5a820a6ee655974>8.4.1 - Common Tools</h1><p>The following are some tools that you can use to troubleshoot:</p><ul><li><a href=#top>top</a></li><li><a href=#ps>ps</a></li><li><a href=#netstat>netstat</a></li><li><a href=#find>find</a></li><li><a href=#locate>locate</a></li><li><a href=#df>df</a></li><li><a href=#md5sum>md5sum</a></li><li><a href=#sha256sum>sha256sum</a></li><li><a href=#strace>strace</a></li><li><a href=#file>file</a></li><li><a href=#stat>stat</a></li><li><a href=#watch>watch</a></li><li><a href=#vmstat-and-fdisk>vmstat and fdisk</a></li><li><a href=#lsof>lsof</a></li><li><a href=#fuser>fuser</a></li><li><a href=#ldd>ldd</a></li><li><a href=#gdb>gdb</a></li></ul><p><strong>Note</strong>: Some of the examples in this section are marked as abridged with ellipsis (<code>...</code>).</p><h2 id=top>top</h2><p>The <code>top</code> tool monitors system resources, workloads, and performance. It can unmask problems caused by processes or applications overconsuming CPUs, time, or RAM.</p><p>To view a textual display of resource consumption, run the <code>top</code> command:</p><pre><code>top
</code></pre><p>Use can use &lsquo;top&rsquo; to kill a runaway or stalled process by typing <code>k</code> followed by its process ID (PID).</p><p><img src=../../docs/images/top-in-photon-os.png alt="Top on Photon OS"></p><p>If the percent of CPU utilization is consistently high with little idle time, there might be a runaway process overconsuming CPUs. Restarting the service might solve the problem.</p><p>To troubleshoot an unknown issue, run Top in the background in batch mode to write its output to a file and collect data about performance:</p><pre><code class=language-console data-lang=console>top d 120 b &gt;&gt; top120second.output
</code></pre><p>For a list of options that filter top output and other information, see the man page for <code>top</code>.</p><h2 id=ps>ps</h2><p>The <code>ps</code> tool shows the processes running on the machine. The <code>ps</code> tool derives flexibility and power from its options, all of which are covered in the tool&rsquo;s Photon OS man page:</p><pre><code class=language-console data-lang=console>man ps
</code></pre><p>You can use the following options of <code>ps</code> for troubleshooting:</p><ul><li><p>Show processes by user:
<code>ps aux</code></p></li><li><p>Show processes and child processes by user:
<code>ps auxf</code></p></li><li><p>Show processes containing the string <code>ssh</code>:
<code>ps aux | grep ssh</code></p></li><li><p>Show processes and the command and options with which they were started:
<code>ps auxww</code></p></li></ul><p>Example abridged output:</p><pre><code class=language-console data-lang=console>ps auxww
USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root          1  0.0  0.9  32724  3300 ?        Ss   07:51   0:32 /lib/systemd/systemd --switched-root --system --deserialize 22
</code></pre><h2 id=netstat>netstat</h2><p>The <code>netstat</code> command can identify bottlenecks causing performance issues. It lists network connections, listening sockets, port information, and interface statistics for different protocols. Examples:</p><pre><code class=language-console data-lang=console>netstat --statistics
netstat --listening
</code></pre><h2 id=find>find</h2><p>Use the <code>find</code> command to troubleshoot a Photon OS machine that has stopped working. The following command lists the files in the root directory that have changed in the past day:</p><pre><code class=language-console data-lang=console>find / -mtime -1 
</code></pre><p>See the <code>find</code> <a href=https://www.gnu.org/software/findutils/manual/find.html>manual</a>. Take note of the security considerations listed in the <code>find</code> manual if you are using <code>find</code> to troubleshoot an appliance running on Photon OS.</p><h2 id=locate>locate</h2><p>The <code>locate</code> command is a fast way to find files and directories you onlay have a keyword. This command is similar to <code>find</code> and part of the same <code>findutils</code> package preinstalled on the full version of Photon OS by default. It finds file names in the file names database.</p><p>Before you can use <code>locate</code> accurately, update its database:</p><pre><code class=language-console data-lang=console>updatedb
</code></pre><p>Then run <code>locate</code> to quickly find a file, such as any file name containing <code>.network</code>, which can be helpful to see all the system&rsquo;s <code>.network</code> configuration files. The following is an abridged example:</p><pre><code class=language-console data-lang=console>locate .network
/etc/dbus-1/system.d/org.freedesktop.network1.conf
/etc/systemd/network/10-dhcp-en.network
/usr/lib/systemd/network/80-container-host0.network
/usr/lib/systemd/network/80-container-ve.network
/usr/lib/systemd/system/busnames.target.wants/org.freedesktop.network1.busname
/usr/lib/systemd/system/dbus-org.freedesktop.network1.service
/usr/lib/systemd/system/org.freedesktop.network1.busnname
/usr/share/dbus-1/system-services/org.freedesktop.network1.service
</code></pre><p>The <code>locate</code> command is also a quick way to see whether a troubleshooting tool is installed on Photon OS. Examples:</p><pre><code class=language-console data-lang=console>locate strace
/usr/bin/strace
/usr/bin/strace-graph
/usr/bin/strace-log-merge
/usr/share/man/man1/strace.1.gz
/usr/share/vim/vim74/syntax/strace.vim

locate traceroute

</code></pre><p>In this example, the <code>strace</code> tool is installed but <code>traceroute</code> is not.</p><p>You can install <code>traceroute</code> from the Photon OS repository:</p><pre><code class=language-console data-lang=console>tdnf install traceroute
</code></pre><h2 id=df>df</h2><p>The <code>df</code> command reports the disk space available on the file system. Running out of disk space can lead an application to fail and a quick check of the available space makes sense as an early troubleshooting step:</p><pre><code class=language-console data-lang=console>df -h
</code></pre><p>The <code>-h</code> option prints out the available and used space in human-readable sizes. After checking the space, you should also check the number of available inodes. Too few available inodes can lead to difficult-to-diagnose problems:</p><pre><code class=language-console data-lang=console>df -i
</code></pre><h2 id=md5sum>md5sum</h2><p>The <code>md5sum</code> tool calculates 128-bit RSA Data Security, Inc. MD5 Message Digest Algorithm hashes (a message digest, or digital signature, of a file) to uniquely identify a file and verify its integrity after file transfers, downloads, or disk errors when the security of the file is not in question.</p><p><code>md5sum</code> can help troubleshooting installation issues by verifying that the version of Photon OS being installed matches the version on the public VMware Photon Packages download page. If, for instance, bytes were dropped during the download, the checksums will not match. Try downloading it again.</p><h2 id=sha256sum>sha256sum</h2><p>The <code>sha256sum</code> tool calculates the authenticity of a file to prevent tampering when security is a concern. Photon OS also includes <code>shasum</code>, <code>sha1sum</code>, <code>sha384sum</code>, and <code>sha512sum</code>. See the man pages for <code>md3sum</code>, <code>sha256sum</code>, and the other SHA utilities.</p><h2 id=strace>strace</h2><p>The <code>strace</code> utility follows system calls and signals as they are executed so that you can see what an application, command, or process is doing. <code>strace</code> can trace failed commands, identify where a process obtains its configuration, monitor file activity, and find the location of a crash.</p><p>By tracing system calls, <code>strace</code> can help troubleshoot a broad range of problems, including issues with input-output, memory, interprocess communication, network usage, and application performance.</p><p>For troubleshooting a problem that gives off few or no clues, the following command displays every system call:</p><pre><code class=language-console data-lang=console>strace ls -al
</code></pre><p>With strace commands, you can route the output to a file to make it easier to analyze:</p><pre><code class=language-console data-lang=console>strace -o output.txt ls -al
</code></pre><p><code>strace</code> can reveal the files that an application tries to open with the <code>-eopen</code> option. This combination can help troubleshoot an application that is failing because it is missing files or being denied access to a file it needs. If, for example, you see &ldquo;No such file or directory&rdquo; in the results of <code>strace -eopen</code>, something might be wrong:</p><pre><code class=language-console data-lang=console>strace -eopen sshd
open(&quot;/usr/lib/x86_64/libpam.so.0&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
open(&quot;/usr/lib/libpam.so.0&quot;, O_RDONLY|O_CLOEXEC) = 3
</code></pre><p>The results above indicate that the first file is missing because it is found in the next line. In other cases, the application might be unable to open one of its configuration files or it might be reading the wrong one. If the results say &ldquo;permission denied&rdquo; for one of the files, check the permissions of the file with <code>ls -l</code> or <code>stat</code>.</p><p>When troubleshooting with <code>strace</code>, you can include the process ID in its commands. Here&rsquo;s an example of how to find a process ID:</p><pre><code class=language-console data-lang=console>ps -ef | grep apache
</code></pre><p>You can then use <code>strace</code> to examine the file a process is working with:</p><pre><code class=language-console data-lang=console>strace -e trace=file -p 1719
</code></pre><p>A similar command can trace network traffic:</p><pre><code class=language-console data-lang=console>strace -p 812 -e trace=network
</code></pre><p>If an application is crashing, use <code>strace</code> to trace the application and then analyze what happens right before the application crashes.</p><p>You can also trace the child processes that an application spawns with the fork system call, and you can do so with <code>systemctl</code> commands that start a process to identify why an application crashes immediately or fails to start:</p><pre><code class=language-console data-lang=console>strace -f -o output.txt systemctl start httpd
</code></pre><p>Example: If <code>journalctl</code> is showing that networkd is failing, you can run strace to troubleshoot:</p><pre><code class=language-console data-lang=console>strace -o output.txt systemctl restart systemd-networkd
</code></pre><p>Then <code>grep</code> inside the results for something, such as <em>exit</em> or <em>error</em>:</p><pre><code class=language-console data-lang=console>grep exit output.txt
</code></pre><p>If the results indicate <code>systemd-resolved</code> is going wrong, you can then strace it:</p><pre><code class=language-console data-lang=console>strace -f -o output.txt systemctl restart systemd-resolved
</code></pre><h2 id=file>file</h2><p>The <code>file</code> command determines the file type, which can help troubleshoot problems when an application mistakes one type of file for another, leading it to errors. Example:</p><pre><code class=language-console data-lang=console>file /usr/sbin/sshd
/usr/sbin/sshd: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.32, stripped
</code></pre><h2 id=stat>stat</h2><p>The <code>stat</code> command can help troubleshoot problems with files or the file system by showing the last date it was modified and other information. Example:</p><pre><code class=language-console data-lang=console>stat /dev/sda1
File: '/dev/sda1'
Size: 0               Blocks: 0          IO Block: 4096   block special file
Device: 6h/6d   Inode: 6614        Links: 1     Device type: 8,1
Access: (0660/brw-rw----)  Uid: (    0/    root)   Gid: (    8/    disk)
Access: 2016-09-02 12:23:56.135999936 +0000
Modify: 2016-09-02 12:23:52.879999981 +0000
Change: 2016-09-02 12:23:52.879999981 +0000
Birth: -
</code></pre><p>On Photon OS, <code>stat</code> is handy to show permissions for a file or directory in both their absolute octal notation and their read-write-execute abbreviation; truncated example:</p><pre><code class=language-console data-lang=console>chmod 777 tester.md
stat tester.md
	File: 'tester.md'
	Size: 0               Blocks: 0          IO Block: 4096   regular empty file
	Device: 801h/2049d      Inode: 316385      Links: 1
	Access: (0777/-rwxrwxrwx)  Uid: (    0/    root)   Gid: (    0/    root)
</code></pre><h2 id=watch>watch</h2><p>The <code>watch</code> utility runs a command at regular intervals so you can observe how its output changes over time. <code>watch</code> can help dynamically monitor network links, routes, and other information when you are troubleshooting networking or performance issues. Examples:</p><pre><code class=language-console data-lang=console>watch -n0 --differences ss
watch -n1 --differences ip route
</code></pre><p>The following is an example with a screenshot of the output. This command monitors the traffic on your network links. The highlighted numbers are updated every second so you can see the traffic fluctuating:</p><pre><code class=language-console data-lang=console>watch -n1 --differences ip -s link show up
</code></pre><p><img src=../../docs/images/watchcmd.png alt="The dynamic output of the watch utility"></p><h2 id=vmstat-and-fdisk>vmstat and fdisk</h2><p>The <code>vmstat</code> tool displays statistics about virtual memory, processes, block input-output, disks, and CPU activity. This tool can help diagnose performance problems, especially system bottlenecks.</p><p>Its output on a Photon OS virtual machine running in VMware Workstation 12 Pro without a heavy load looks like this:</p><pre><code class=language-console data-lang=console>vmstat
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
	r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
	0  0      0   5980  72084 172488    0    0    27    44  106  294  1  0 98  1  0
</code></pre><p>These codes are explained in the <code>vmstat</code> man page.</p><ul><li>If <code>r</code>, the number of runnable processes, is higher than 10, the machine is under stress; consider intervening to reduce the number of processes or to distribute some of the processes to other machines. In other words, the machine has a bottleneck in executing processes.</li><li>If <code>cs</code>, the number of context switches per second, is really high, there may be too many jobs running on the machine.</li><li>If <code>in</code>, the number of interrupts per second, is relatively high, there might be a bottleneck for network or disk IO.</li></ul><p>You can investigate disk IO further by using vmstat&rsquo;s <code>-d</code> option to report disk statistics. The following is an abridged example on a machine with little load:</p><pre><code class=language-console data-lang=console>vmstat -d
disk- ------------reads------------ ------------writes----------- -----IO------
		total merged sectors      ms  total merged sectors      ms    cur    sec
ram0       0      0       0       0      0      0       0       0      0      0
ram1       0      0       0       0      0      0       0       0      0      0
loop0      0      0       0       0      0      0       0       0      0      0
loop1      0      0       0       0      0      0       0       0      0      0
sr0        0      0       0       0      0      0       0       0      0      0
sda    22744    676  470604   12908  72888  24949  805224  127692      0    130
</code></pre><p>The <code>-D</code> option summarizes disk statistics:</p><pre><code class=language-console data-lang=console>vmstat -D
    26 	disks
     2	partitions
 22744 	total reads
   676 	merged reads
470604  read sectors
 12908 	milli reading
 73040 	writes
 25001 	merged writes
806872  written sectors
127808  milli writing
     0	inprogress IO
   130 	milli spent IO
</code></pre><p>You can also get statistics about a partition. First, run the <code>fdisk -l</code> command to list the machine&rsquo;s devices. Then run <code>vmstat -p</code> with the name of a device to view its stats:</p><pre><code class=language-console data-lang=console>fdisk -l
Disk /dev/ram0: 4 MiB, 4194304 bytes, 8192 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes
...
Device        Start      End  Sectors Size Type
/dev/sda1      2048 16771071 16769024   8G Linux filesystem
/dev/sda2  16771072 16777182     6111   3M BIOS boot

vmstat -p /dev/sda1
sda1          reads   read sectors  writes    requested writes
				22579     473306      78510     866088
</code></pre><p>See the <code>vmstat</code> man page for more options.</p><h2 id=lsof>lsof</h2><p>The <code>lsof</code> command lists open files. The tool&rsquo;s definition of an open file includes directories, libraries, streams, domain sockets, and Internet sockets. THis enables it to identify the files a process is using. Because a Linux system like Photon OS uses files to do its work, you can run <code>lsof</code> as root to see how the system is using them and to see how an application works.</p><p>If you cannot unmount a disk because it is in use, you can run <code>lsof</code> to identify the files on the disk that are being used.</p><p>The following is an example that shows the processes that are using the root directory:</p><pre><code class=language-console data-lang=console>lsof /root
COMMAND    PID USER   FD   TYPE DEVICE SIZE/OFF   NODE NAME
bash       879 root  cwd    DIR    8,1     4096 262159 /root
bash      1265 root  cwd    DIR    8,1     4096 262159 /root
sftp-serv 1326 root  cwd    DIR    8,1     4096 262159 /root
gdb       1351 root  cwd    DIR    8,1     4096 262159 /root
bash      1395 root  cwd    DIR    8,1     4096 262159 /root
lsof      1730 root  cwd    DIR    8,1     4096 262159 /root
</code></pre><p>You can do the same with an application or virtual appliance by running <code>lsof</code> with the user name or process ID of the app. The following example lists the open files used by the Apache HTTP Server:</p><pre><code class=language-console data-lang=console>lsof -u apache
</code></pre><p>Running the command with the <code>-i</code> option lists all the open network and Internet files, which can help troubleshoot network problems:</p><pre><code class=language-console data-lang=console>lsof -i
</code></pre><p>See the Unix socket addresses of a user like <em>zookeeper</em>:</p><pre><code class=language-console data-lang=console>lsof -u zookeeper -U
</code></pre><p>The following example shows the processes running on Ports 1 through 80:</p><pre><code class=language-console data-lang=console>lsof -i TCP:1-80
COMMAND  PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
httpd    403   root    3u  IPv6  10733      0t0  TCP *:http (LISTEN)
httpd    407 apache    3u  IPv6  10733      0t0  TCP *:http (LISTEN)
httpd    408 apache    3u  IPv6  10733      0t0  TCP *:http (LISTEN)
httpd    409 apache    3u  IPv6  10733      0t0  TCP *:http (LISTEN)
sshd     820   root    3u  IPv4  11336      0t0  TCP *:ssh (LISTEN)
sshd     820   root    4u  IPv6  11343      0t0  TCP *:ssh (LISTEN)
sshd    1258   root    3u  IPv4  48040      0t0  TCP 198.51.100.143:ssh-&gt;198.51.100.1:49759 (ESTABLISHED)
sshd    1319   root    3u  IPv4  50866      0t0  TCP 198.51.100.143:ssh-&gt;198.51.100.1:51054 (ESTABLISHED)
sshd    1388   root    3u  IPv4  56438      0t0  TCP 198.51.100.143:ssh-&gt;198.51.100.1:60335 (ESTABLISHED)
</code></pre><p>You can also inspect the files opened by a process ID. The following example queries the files open by the systemd network service:</p><pre><code class=language-console data-lang=console>lsof -p 1917
COMMAND    PID            USER   FD      TYPE             DEVICE SIZE/OFF   NODE NAME
systemd-n 1917 systemd-network  cwd       DIR                8,1     4096      2 /
systemd-n 1917 systemd-network  txt       REG                8,1   887896 272389 /usr/lib/systemd/systemd-networkd
systemd-n 1917 systemd-network  mem       REG                8,1   270680 262267 /usr/lib/libnss_files-2.22.so
systemd-n 1917 systemd-network    0r      CHR                1,3      0t0   5959 /dev/null
systemd-n 1917 systemd-network    1u     unix 0x0000000000000000      0t0  45734 type=STREAM
systemd-n 1917 systemd-network    3u  netlink                         0t0   6867 ROUTE
systemd-n 1917 systemd-network    4u     unix 0x0000000000000000      0t0  45744 type=DGRAM
systemd-n 1917 systemd-network    9u  netlink                         0t0  45754 KOBJECT_UEVENT
systemd-n 1917 systemd-network   12u  a_inode               0,11        0   5955 [timerfd]
systemd-n 1917 systemd-network   13u     IPv4             104292      0t0    UDP 198.51.100.143:bootpc
</code></pre><h2 id=fuser>fuser</h2><p>The <code>fuser</code> command identifies the process IDs of processes using files or sockets. The term <em>process</em> is, in this case, synonymous with <em>user</em>. To identify the process ID of a process using a socket, run <code>fuser</code> with its namespace option and specify <code>tcp</code> or <code>udp</code> and the name of the process or port. Examples:</p><pre><code class=language-console data-lang=console>fuser -n tcp ssh
ssh/tcp:               940  1308
fuser -n tcp http
http/tcp:              592   594   595   596
fuser -n tcp 80
80/tcp:                592   594   595   596
</code></pre><h2 id=ldd>ldd</h2><p>By revealing the shared libraries that a program depends on, <code>ldd</code> can help troubleshoot an application that is missing a library or finding the wrong one.</p><p>For example, if you get a &ldquo;file not found&rdquo; output, check the path to the library.</p><pre><code class=language-console data-lang=console>ldd /usr/sbin/sshd
linux-vdso.so.1 (0x00007ffc0e3e3000)
libpam.so.0 =&gt; (file not found)
libcrypto.so.1.0.0 =&gt; /usr/lib/libcrypto.so.1.0.0 (0x00007f624e570000)
</code></pre><p>You can also use the <code>objdump</code> command to show dependencies for a program&rsquo;s object files; example:</p><pre><code class=language-console data-lang=console>objdump -p /usr/sbin/sshd | grep NEEDED
</code></pre><h2 id=gdb>gdb</h2><p>The <code>gdb</code> tool is the GNU debugger. It lets you see inside a program while it executes or when it crashes so that you can catch errors as they occur. The <code>gdb</code> tool is typically used to debug programs written in C and C++. On Photon OS, <code>gdb</code> can help you determine why an application crashed. See the man page for <code>gdb</code> for instructions on how to run it.</p><p>For an extensive example on how to use <code>gdb</code> to troubleshoot Photon OS running on a VM when you cannot login to Photon OS, see the section on troubleshooting boot and logon problems.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f13d060552ebaf87170062c96f0cb71b>8.4.2 - Troubleshooting Tools Installed by Default</h1><p>The following troubleshooting tools are included in the full version of Photon OS:</p><ul><li><code>grep</code>. Searches files for patterns.</li><li><code>ping</code>. Tests network connectivity.</li><li><code>strings</code>. Displays the characters in a file to identify its contents.</li><li><code>lsmod</code>. Lists loaded modules.</li><li><code>ipcs</code>. Shows data about the inter-process communication (IPC) resources to which a process has read access. This data includes shared memory segments, message queues, and semaphore arrays.</li><li><code>nm</code>. Lists symbols from object files.</li><li><code>diff</code>. Compares files side by side. This tool is useful to compare configuration files of two versions when one version works and the other does not.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-8541e2426271c83233d26031263d756e>8.4.3 - Installing Tools from Repositories</h1><p>You can install several troubleshooting tools from the Photon OS repositories by using the default package management system, <code>tdnf</code>.</p><p>If a tool you require is not installed, search the repositories to see if it is available.</p><p>For example, the traceroute tool is not installed by default. You can search for it in the repositories as follows:</p><pre><code>tdnf search traceroute
traceroute : Traces the route taken by packets over an IPv4/IPv6 network
</code></pre><p>The results of the above command show that traceroute exists in the repository. You install it with <code>tdnf</code>:</p><pre><code>tdnf install traceroute
</code></pre><p>The following tools are not installed by default but are in the repository and can be installed with <code>tdnf</code>:</p><ul><li><p><code>net-tools</code>. Networking tools.</p></li><li><p><code>ltrace</code>. Tool for intercepting and recording dynamic library calls. It can identify the function an application was calling when it crashed, making it useful for debugging.</p></li><li><p><code>nfs-utils</code>. Client tools for the kernel Network File System, or NFS, including showmount. These are installed by default in the full version of Photon OS but not in the minimal version.</p></li><li><p><code>pcstat</code>. A tool that inspects which pages of a file or files are being cached by the Linux kernel.</p></li><li><p><code>sysstat</code> and <code>sar</code>. Utilities to monitor system performance and usage activity. Installing sysstat also installs sar.</p></li><li><p><code>systemtap</code> and <code>crash</code>. The systemtap utility is a programmable instrumentation system for diagnosing problems of performance or function. Installing systemtap also installs crash, which is a kernel crash analysis utility for live systems and dump files.</p></li><li><p><code>dstat</code>. Tool for viewing and analyzing statistics about system resources.</p><p>The <code>dstat</code> tool can help troubleshoot system performance. The tool shows live, running list of statistics about system resources:</p><pre><code>  dstat
  You did not select any stats, using -cdngy by default.
  ----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--
  usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw
    1   0  98   1   0   0|4036B   42k|   0     0 |   0     0 |  95   276
    1   0  98   1   0   0|   0    64k|  60B  940B|   0     0 | 142   320
    1   1  98   0   0   0|   0    52k|  60B  476B|   0     0 | 149   385
</code></pre></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-3dc35a0dd7f3bbf95344f20fea8d9dc4>8.4.4 - Linux Troubleshooting Tools</h1><p>The following Linux troubleshoot tools are neither installed on Photon OS by default nor available in the Photon OS repositories:</p><ul><li>iostat</li><li>telnet (use SSH instead)</li><li>Iprm</li><li>hdparm</li><li>syslog (use journalctl instead)</li><li>ddd</li><li>ksysmoops</li><li>xev</li><li>GUI tools (because Photon OS has no GUI)</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-e6dc8e85bd84cbb48db5ca550e3adf9c>8.5 - Systemd</h1><p>Photon OS manages services with <code>systemd</code> and <code>systemctl</code>, its command-line utility for inspecting and controlling the system. It does not use the deprecated commands of <code>init.d</code>.</p><p>Basic system administration commands on Photon OS differ from those on operating systems that use SysVinit. Since Photon OS uses systemd instead of SysVinit, you must use systemd commands to manage services.</p><p>For example, instead of running the /etc/init.d/ssh script to stop and start the OpenSSH server on a init.d-based Linux system, you control the service by running the following systemctl commands on Photon OS:</p><pre><code>systemctl stop sshd
systemctl start sshd
</code></pre><p>For an overview of systemd, see <a href=https://www.freedesktop.org/wiki/Software/systemd/>systemd System and Service Manager</a> and the <a href=https://www.freedesktop.org/software/systemd/man/systemd.html>man page for systemd</a>. The systemd man pages are listed at <a href=https://www.freedesktop.org/software/systemd/man/>https://www.freedesktop.org/software/systemd/man/</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-45a60780101b99e8a21a9620bfe7ca73>8.5.1 - Enabling 'systemd' Debug Shell During Boot</h1><p>To diagnose <code>systemd</code> related boot issues, you can enable early shell access during boot.</p><p>Perform the following steps to enable early shell access:</p><ol><li><p>Restart the Photon OS machine or the virtual machine running Photon OS.</p><p>When the Photon OS splash screen appears, as it restarts, type the letter <code>e</code> quickly.</p></li><li><p>Append <code>systemd.debug-shell=1</code> to the kernel command line.</p><p>Optionally, to change logging level to debug, you can append <code>systemd.log_level=debug</code>.</p></li><li><p>Press <code>F10</code> to proceed with the boot.</p></li><li><p>Press <code>Alt+Ctrl+F9</code> to switch to <code>tty9</code> to access the debug shell.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-2222dbb3d5c5a8cb432250b8b95f41ff>8.5.2 - Troubleshooting Services With 'systemctl'</h1><p>To view a description of all the active, loaded units, execute the systemctl command without any options or arguments:</p><pre><code>systemctl
</code></pre><p>To see all the loaded, active, and inactive units and their description, run this command:</p><pre><code>systemctl --all
</code></pre><p>To see all the unit files and their current status but no description, run this command:</p><pre><code>systemctl list-unit-files
</code></pre><p>The <code>grep</code> command filters the services by a search term, a helpful tactic to recall the exact name of a unit file without looking through a long list of names. Example:</p><pre><code>systemctl list-unit-files | grep network
org.freedesktop.network1.busname           static
dbus-org.freedesktop.network1.service      enabled
systemd-networkd-wait-online.service       enabled
systemd-networkd.service                   enabled
systemd-networkd.socket                    enabled
network-online.target                      static
network-pre.target                         static
network.target  
</code></pre><p>For example, to list all the services that you can manage on Photon OS, you run the following command instead of <code>ls /etc/rc.d/init.d/</code>:</p><pre><code>systemctl list-unit-files --type=service
</code></pre><p>Similarly, to check whether the <code>sshd</code> service is enabled, on Photon OS you run the following command instead of <code>chkconfig sshd</code>:</p><pre><code>systemctl is-enabled sshd
</code></pre><p>The <code>chkconfig --list</code> command that shows which services are enabled for which runlevel on a SysVinit computer becomes substantially different on Photon OS because there are no runlevels, only targets:</p><pre><code>ls /etc/systemd/system/*.wants
</code></pre><p>You can also display similar information with the following command:</p><pre><code>systemctl list-unit-files --type=service
</code></pre><p>The following is list of some of the systemd commands that take the place of <code>SysVinit</code> commands on Photon OS:</p><pre><code>USE THIS SYSTEMD COMMAND 	INSTEAD OF THIS SYSVINIT COMMAND
systemctl start sshd 		service sshd start
systemctl stop sshd 		service sshd stop
systemctl restart sshd 		service sshd restart
systemctl reload sshd 		service sshd reload
systemctl condrestart sshd 	service sshd condrestart
systemctl status sshd 		service sshd status
systemctl enable sshd 		chkconfig sshd on
systemctl disable sshd 		chkconfig sshd off
systemctl daemon-reload		chkconfig sshd --add
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-37ee182b89ad2f34aa7aafa527b6186b>8.5.3 - Analyzing System Logs with 'journalctl'</h1><p>The journalctl tool queries the contents of the systemd journal. On Photon OS, all the system logs except the installation log and the cloud-init log are written into the systemd journal.</p><p>When you run the <code>journalctl</code> command without any parameters, it displays all the contents of the journal, beginning with the oldest entry.</p><p>To display the output in reverse order with new entries first, include the <code>-r</code> option in the command:</p><pre><code class=language-console data-lang=console>journalctl -r
</code></pre><p>The <code>journalctl</code> command includes many options to filter its output. For help troubleshooting systemd, two journalctl queries are particularly useful:</p><ul><li><p>Showing the log entries for the last boot.</p><p>The following command displays the messages that systemd generated during the last time the machine started:</p></li></ul><pre><code class=language-console data-lang=console>journalctl -b
</code></pre><ul><li><p>Showing the log entries for a systemd service unit.Item</p><p>The following command reveals the messages for only the systemd service unit specified by the <code>-u</code> option, which in the following example is the auditing service:</p></li></ul><pre><code class=language-console data-lang=console>journalctl -u auditd
</code></pre><p>You can look at the messages for systemd itself or for the network service:</p><pre><code class=language-console data-lang=console>journalctl -u systemd
journalctl -u systemd-networkd
</code></pre><p>Example:</p><pre><code class=language-console data-lang=console>root@photon-1a0375a0392e [ ~ ]# journalctl -u systemd-networkd
-- Logs begin at Tue 2016-08-23 14:35:50 UTC, end at Tue 2016-08-23 23:45:44 UTC. --
Aug 23 14:35:52 photon-1a0375a0392e systemd[1]: Starting Network Service...
Aug 23 14:35:52 photon-1a0375a0392e systemd-networkd[458]: Enumeration completed
Aug 23 14:35:52 photon-1a0375a0392e systemd[1]: Started Network Service.
Aug 23 14:35:52 photon-1a0375a0392e systemd-networkd[458]: eth0: Gained carrier
Aug 23 14:35:53 photon-1a0375a0392e systemd-networkd[458]: eth0: DHCPv4 address 198.51.100.1
Aug 23 14:35:54 photon-1a0375a0392e systemd-networkd[458]: eth0: Gained IPv6LL
Aug 23 14:35:54 photon-1a0375a0392e systemd-networkd[458]: eth0: Configured
</code></pre><p>For more information, see <a href=https://www.freedesktop.org/software/systemd/man/journalctl.html>journalctl</a> or the journalctl man page by running this command: <code>man journalctl</code></p></div><div class=td-content style=page-break-before:always><h1 id=pg-a3e35c7adc2aa5828f3d0a03d03c0bf3>8.5.4 - Inspecting Services with 'systemd-analyze'</h1><p>The <code>systemd-analyze</code> command reveals performance statistics for boot times, traces system services, and verifies unit files. It can help troubleshoot slow system boots and incorrect unit files. See the man page for a list of options.</p><p>Examples:</p><pre><code>systemd-analyze blame

systemd-analyze dump</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-21502ba89b3fba5480b548821dfd1e69>8.5.5 - Inspecting Services with 'systemd-analyze'</h1><p>systemd is a suite of basic building blocks for a Linux system. It provides a system and service manager that runs as Process ID 1 and starts the rest of the system.</p><p>To manage the services run the following commands:</p><ul><li><code>systemctl</code> or <code>systemctl list-units</code> : This command lists the running units.</li><li><code>systemctl --failed</code> : This command lists failed units.</li><li><code>systemctl list-unit-files</code> : This command lists all the installed unit files. The unit files are usually present in <strong>/usr/lib/systemd/system/</strong> and <strong>/etc/systemd/system/</strong>.</li><li><code>systemctl status pid</code> : This command displays the cgroup slice, memory and parent for a PID.</li><li><code>systemctl start unit</code> : This command starts a unit immediately.</li><li><code>systemctl stop unit</code> : This command stops a unit.</li><li><code>systemctl restart unit</code> : This command restarts a unit.</li><li><code>systemctl reload unit</code> : This command asks a unit to reload its configuration.</li><li><code>systemctl status unit</code> : This command displays the status of a unit.</li><li><code>systemctl enable unit</code> : This command enables a unit to run on startup.</li><li><code>systemctl enable --now unit</code> : This command enables a unit to run on startup and start immediately.</li><li><code>systemctl disable unit</code> : This command disables a unit and removes it from the startup program.</li><li><code>systemctl mask unit</code> : This command masks a unit to make it impossible to start.</li><li><code>systemctl unmask unit</code> : This command unmasks a unit.</li></ul><p>To get an overview of the system boot-up time, run the following command:</p><pre><code>systemd-analyze
</code></pre><p>To view a list of all running units, sorted by the time they took to initialize (highest time on top), run the following command:</p><pre><code>systemd-analyze blame
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-641b474d7b8d4100941d5a2750526038>8.6 - Network Troubleshooting</h1><p>Use the <code>systemd</code> suite of commands and not deprecated <code>init.d</code> commands or other deprecated commands, to manage networking.</p><ul><li><a href=../../docs/troubleshooting-guide/network-troubleshooting/managing-the-network-configuration/>Managing the Network Configuration</a></li><li><a href=../../docs/troubleshooting-guide/network-troubleshooting/inspecting-ip-addresses/>Inspecting IP Addresses</a></li><li><a href=../../docs/troubleshooting-guide/network-troubleshooting/inspecting-network-links-with-networkctl/>Inspecting the Status of Network Links with <code>networkctl</code></a></li><li><a href=../../docs/troubleshooting-guide/network-troubleshooting/network-debugging/>Network Debugging</a></li><li><a href=../../docs/troubleshooting-guide/network-troubleshooting/checking-firewall-rules/>Checking Firewall Rules</a></li><li><a href=../../docs/troubleshooting-guide/network-troubleshooting/inspect-network-settings-with-netmgr/>Inspect Network Settings with <code>netmgr</code></a></li></ul><p>For information about tcpdump and netcat, see <a href=../../docs/administration-guide/managing-network-configuration/installing-the-packages-for-tcpdump-and-netcat-with-tdnf/>Installing the Packages for tcpdump and netcat with tdnf</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-7443880a71f96c7150bcd520d1ab0dd2>8.6.1 - Managing the Network Configuration</h1><p>The network service, which is enabled by default, starts when the system boots. You manage the network service by using systemd commands, such as <code>systemd-networkd</code>, <code>systemd-resolvd</code>, and <code>networkctl</code>.</p><p>You can check the status of the network service by running the following command:</p><pre><code>systemctl status systemd-networkd
</code></pre><p>The following is a result of the command:</p><pre><code>* systemd-networkd.service - Network Service
   Loaded: loaded (/usr/lib/systemd/system/systemd-networkd.service; enabled; vendor preset: enabled)
   Active: active (running) since Fri 2016-04-29 15:08:51 UTC; 6 days ago
     Docs: man:systemd-networkd.service(8)
 Main PID: 291 (systemd-network)
   Status: &quot;Processing requests...&quot;
   CGroup: /system.slice/systemd-networkd.service
           `-291 /lib/systemd/systemd-networkd
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-86f4c5c53619c0832267e20fef9c5119>8.6.2 - Inspecting IP Addresses</h1><p>VMware recommends that you use the <code>ip</code> or <code>ss</code> commands as the <code>ifconfig</code> and <code>netstat</code> commands are deprecated.</p><p>To display a list of network interfaces, run the <code>ss</code> command. Similarly, to display information for IP addresses, run the <code>ip addr</code> command.</p><p>Examples:</p><pre><code>USE THIS IPROUTE COMMAND 	INSTEAD OF THIS NET-TOOL COMMAND
ip addr 					ifconfig -a
ss 							netstat
ip route 					route
ip maddr 					netstat -g
ip link set eth0 up 		ifconfig eth0 up
ip -s neigh					arp -v
ip link set eth0 mtu 9000	ifconfig eth0 mtu 9000
</code></pre><p>Use the <code>ip route</code> version of a command instead of the net-tools to get accurate information:</p><pre><code>ip neigh
198.51.100.2 dev eth0 lladdr 00:50:56:e2:02:0f STALE
198.51.100.254 dev eth0 lladdr 00:50:56:e7:13:d9 STALE
198.51.100.1 dev eth0 lladdr 00:50:56:c0:00:08 DELAY

arp -a
? (198.51.100.2) at 00:50:56:e2:02:0f [ether] on eth0
? (198.51.100.254) at 00:50:56:e7:13:d9 [ether] on eth0
? (198.51.100.1) at 00:50:56:c0:00:08 [ether] on eth0
</code></pre><p><strong>Important:</strong> If you modify an IPv6 configuration or add an IPv6 interface, you must restart <code>systemd-networkd</code>. Traditional methods of using <code>ifconfig</code> commands will be inadequate to register the changes. Run the following command instead:</p><pre><code>systemctl restart systemd-networkd
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-7bdf729c29d245264a8c0847b910259e>8.6.3 - Inspecting the Status of Network Links with 'networkctl'</h1><p>The <code>networkctl</code> command displays information about network connections that helps you configure networking services and troubleshoot networking problems.</p><p>You can progressively add options and arguments to the <code>networkctl</code> command to move from general information about network connections to specific information about a network connection.</p><p>Running <code>networkctl</code> without options defaults to the list command:</p><pre><code>networkctl
IDX LINK             TYPE               OPERATIONAL SETUP
  1 lo               loopback           carrier     unmanaged
  2 eth0             ether              routable    configured
  3 docker0          ether              routable    unmanaged
 11 vethb0aa7a6      ether              degraded    unmanaged
 4 links listed.
</code></pre><p>Run the <code>networkctl</code> with the status command to display active network links with IP addresses for not only the Ethernet connection, but also the Docker container.</p><pre><code>root@photon-rc [ ~ ]# networkctl status
*      State: routable
     Address: 198.51.100.131 on eth0
              172.17.0.1 on docker0
              fe80::20c:29ff:fe55:3ca6 on eth0
              fe80::42:f0ff:fef7:bd81 on docker0
              fe80::4c84:caff:fe76:a23f on vethb0aa7a6
     Gateway: 198.51.100.2 on eth0
         DNS: 198.51.100.2
</code></pre><p>You can add a network link, such as the Ethernet connection, as the argument of the status command to show specific information about the link:</p><pre><code>root@photon-rc [ ~ ]# networkctl status eth0
* 2: eth0
       Link File: /usr/lib/systemd/network/99-default.link
    Network File: /etc/systemd/network/10-dhcp-en.network
            Type: ether
           State: routable (configured)
            Path: pci-0000:02:01.0
          Driver: e1000
      HW Address: 00:0c:29:55:3c:a6 (VMware, Inc.)
             MTU: 1500
         Address: 198.51.100.131
                  fe80::20c:29ff:fe55:3ca6
         Gateway: 198.51.100.2
             DNS: 198.51.100.2
        CLIENTID: ffb6220feb00020000ab116724f520a0a77337
</code></pre><p>You can add a Docker container as follows:</p><pre><code>networkctl status docker0
* 3: docker0
       Link File: /usr/lib/systemd/network/99-default.link
    Network File: n/a
            Type: ether
           State: routable (unmanaged)
          Driver: bridge
      HW Address: 02:42:f0:f7:bd:81
             MTU: 1500
         Address: 172.17.0.1
                  fe80::42:f0ff:fef7:bd81
</code></pre><p>In the example above, the output indicates that state of the Docker container is unmanaged. Docker uses the bridge drive to handle managing the networking for the containers and not <code>systemd-resolved</code> or <code>systemd-networkd</code>.</p><p>For more information about <code>networkctl</code> commands and options, see <a href=https://www.freedesktop.org/software/systemd/man/networkctl.html>https://www.freedesktop.org/software/systemd/man/networkctl.html</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ead329f4a50d05b1e092b3096d4f90b4>8.6.4 - Network Debugging</h1><p>You can set <code>systemd-networkd</code> to work in debug mode so that you can analyze log files with debugging information to help troubleshoot networking problems.</p><p>The following procedure turns on network debugging by adding a drop-in file in <code>/etc/systemd</code> to customize the default systemd configuration in <code>/usr/lib/systemd</code>.</p><ol><li><p>Run the following command as root to create a directory with this exact name, including the <code>.d</code> extension:</p><pre><code class=language-console data-lang=console>mkdir -p /etc/systemd/system/systemd-networkd.service.d/
</code></pre><p>``</p></li><li><p>Run the following command as root to establish a systemd drop-in unit with a debugging configuration for the network service:</p><pre><code class=language-console data-lang=console>cat &gt; /etc/systemd/system/systemd-networkd.service.d/10-loglevel-debug.conf &lt;&lt; &quot;EOF&quot;
    [Service]
    Environment=SYSTEMD_LOG_LEVEL=debug
    EOF
</code></pre></li><li><p>Reload the <code>systemctl</code> daemon and restart the <code>systemd-networkd</code> service for the changes to take effect:</p><pre><code class=language-console data-lang=console>systemctl daemon-reload
systemctl restart systemd-networkd
</code></pre></li><li><p>Verify that your changes took effect:</p><pre><code class=language-console data-lang=console>systemd-delta --type=extended`
</code></pre><p>``</p></li><li><p>View the log files by running this command:</p><pre><code class=language-console data-lang=console>journalctl -u systemd-networkd`
</code></pre><p>``</p></li><li><p>After debugging the network connections, turn debugging off by deleting the drop-in file:</p><pre><code class=language-console data-lang=console>rm /etc/systemd/system/systemd-networkd.service.d/10-loglevel-debug.conf
</code></pre><p>``</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-6c30537e08221469979d45c47f7dc8c4>8.6.5 - Checking Firewall Rules</h1><p>The design of Photon OS emphasizes security. On the minimal and full versions of Photon OS, the default security policy turns on the firewall and drops packets from external interfaces and applications. As a result, you might need to add rules to iptables to permit forwarding, allow protocols like HTTP, and open ports. In other words, you must configure the firewall for your applications and requirements.</p><p>The default iptables settings on the full version look like this:</p><pre><code class=language-console data-lang=console>iptables --list
Chain INPUT (policy DROP)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:ssh

Chain FORWARD (policy DROP)
target     prot opt source               destination

Chain OUTPUT (policy DROP)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
</code></pre><p>To find out how to adjust the settings, see the <code>man</code> page for <code>iptables</code>.</p><p>Although the default iptables policy accepts SSH connections, the <code>sshd</code> configuration file on the full version of Photon OS is set to reject SSH connections. See <a href=../../docs/troubleshooting-guide/solutions-to-common-problems/permitting-root-login-with-ssh/>Permitting Root Login with SSH</a>.</p><p>If you are unable to ping a Photon OS machine, check the firewall rules. Verify if the rules allow connectivity for the port and protocol.</p><p>You can supplement the <code>iptables</code> commands by using <code>lsof</code> to, for instance, see the processes listening on ports:</p><pre><code class=language-console data-lang=console>	lsof -i -P -n
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-46e6e1e0a8903d55cdd88d1f424ce291>8.6.6 - Inspect Network Settings with 'netmgr'</h1><p>If you are running a VMware appliance on Photon OS and the VAMI module has problems or if there are networking issues, you can use the Photon OS <code>netmgr</code> utility to inspect the networking settings. Make sure that the IP addresses for the DNS server and other infrastructure are correct. Use <code>tcpdump</code> to analyze the issues.</p><p>The error code that you get from netmgr is a standard Unix error code. Enter it into a search engine to obtain more information on the error.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9bc167ac28d85c2f0972b58d26097676>8.7 - File System Troubleshooting</h1><p>Photon OS includes commands to check and troubleshoot file systems.</p></div><div class=td-content><h1 id=pg-47439fb3c02145fdc25f8c11bf0b5e3f>8.7.1 - Checking Disk Space</h1><p>One of the first simple steps to take while troubleshooting is to check how much disk space is available by running the <code>df</code> command:</p><pre><code>df -h</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-abc971fcad72a9dad157e05c66304fb6>8.7.2 - Adding a Disk and Partitioning It</h1><p>If the <code>df</code> command shows that the file system is indeed nearing capacity, you can add a new disk on the fly and partition it to increase capacity.</p><ol><li><p>Add a new disk.</p><p>For example, you can add a new disk to a virtual machine by using the VMware vSphere Client. After adding a new disk, check for the new disk by using <code>fdisk</code>. In the following example, the new disk is named <code>/dev/sdb</code>:</p></li></ol><pre><code class=language-console data-lang=console>fdisk -l
Device        Start      End  Sectors Size Type
/dev/sda1      2048 16771071 16769024   8G Linux filesystem
/dev/sda2  16771072 16777182     6111   3M BIOS boot

Disk /dev/sdb: 1 GiB, 1073741824 bytes, 2097152 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
</code></pre><ol><li><p>Partition it with the <code>parted</code> wizard.</p><p>The command to partition the disk on Photon OS is as follows:</p></li></ol><pre><code class=language-console data-lang=console>parted /dev/sdb
</code></pre><p>Use the <code>parted</code> wizard to create it as follows:</p><pre><code class=language-console data-lang=console>mklabel gpt
mkpart ext3 1 1024
</code></pre><ol><li>Create a file system on the partition:</li></ol><pre><code class=language-console data-lang=console>mkfs -t ext3 /dev/sdb1
</code></pre><ol><li>Make a directory where you will mount the new file system:</li></ol><pre><code class=language-console data-lang=console>mkdir /newdata
</code></pre><ol><li>Open <code>/etc/fstab</code> and add the new file system with the options that you require:</li></ol><pre><code class=language-console data-lang=console>	#system mnt-pt  type    options dump    fsck
	/dev/sda1       /       ext4    defaults,barrier,noatime,noacl,data=ord$
	/dev/cdrom      /mnt/cdrom      iso9660 ro,noauto       0       0
	/dev/sdb1       /newdata        ext3    defaults        0		0
</code></pre><ol><li>Mount it using the following command:</li></ol><pre><code class=language-console data-lang=console>mount /newdata
</code></pre><p>Verify the results:</p><pre><code class=language-console data-lang=console>df -h
	Filesystem      Size  Used Avail Use% Mounted on
	/dev/root       7.8G  4.4G  3.1G  59% /
	devtmpfs        172M     0  172M   0% /dev
	tmpfs           173M     0  173M   0% /dev/shm
	tmpfs           173M  664K  172M   1% /run
	tmpfs           173M     0  173M   0% /sys/fs/cgroup
	tmpfs           173M   36K  173M   1% /tmp
	tmpfs            35M     0   35M   0% /run/user/0
	/dev/sdb1       945M  1.3M  895M   1% /newdata
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-4a539020bc72ef2270f43ba0b05f0192>8.7.3 - Expanding Disk Partition</h1><p>If you require more space, you can expand the last partition of your disk after resizing the disk.</p><p>The commands in this section assume <code>sda</code> as disk device.</p><ol><li>After the disk is resized in the virtual machine, use the following command to enable the system to recognize the new disk ending boundary without rebooting:</li></ol><pre><code class=language-console data-lang=console>echo 1 &gt; /sys/class/block/sda/device/rescan
</code></pre><ol start=2><li>Install the <code>parted</code> package to resize the disk partition by running the following command to install it:</li></ol><pre><code class=language-console data-lang=console>tdnf install parted.
parted /dev/sda

GNU Parted 3.2
Using /dev/sda
Welcome to GNU Parted! Type 'help' to view a list of commands.
</code></pre><ol start=3><li>List all partitions available to fix the GPT and check the last partition number:</li></ol><pre><code>(parted) print

Warning: Not all of the space available to /dev/sda appears to be used, you can
fix the GPT to use all of the space (an extra 4194304 blocks) or continue with
the current setting? 
Fix/Ignore?

Press `f` to fix the GPT layout.

Model: VMware Virtual disk (scsi)
Disk /dev/sda: 34.4GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size    File system  Name  Flags
1      1049kB  3146kB  2097kB                     bios_grub
2      3146kB  8590MB  8587MB  ext4

</code></pre><p>In this case we have the partition <code>2</code> as last, then we extend the partition to 100% of the remaining size:</p><pre><code class=language-console data-lang=console>(parted) resizepart 2 100%
</code></pre><ol start=4><li>Expand the filesystem to the new size:</li></ol><pre><code class=language-console data-lang=console>resize2fs /dev/sda2
	resize2fs 1.42.13 (17-May-2015)
	Filesystem at /dev/sda2 is mounted on /; on-line resizing required
	old_desc_blocks = 1, new_desc_blocks = 2
	The filesystem on /dev/sda2 is now 8387835 (4k) blocks long.
</code></pre><p>The new space is already available in the system:</p><pre><code class=language-console data-lang=console>df -h
	Filesystem      Size  Used Avail Use% Mounted on
	/dev/root        32G  412M   30G   2% /
	devtmpfs       1001M     0 1001M   0% /dev
	tmpfs          1003M     0 1003M   0% /dev/shm
	tmpfs          1003M  252K 1003M   1% /run
	tmpfs          1003M     0 1003M   0% /sys/fs/cgroup
	tmpfs          1003M     0 1003M   0% /tmp
	tmpfs           201M     0  201M   0% /run/user/0
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-3affa41adcd49c9555f8960c2615e3aa>8.7.4 - List Disk Partitions with 'fdisk'</h1><p>The <code>fdisk</code> command manipulates the disk partition table. You can, for example, use <code>fdisk</code> to list the disk partitions so that you can identify the root Linux file system.</p><p>The following example shows <code>/dev/sda1</code> to be the root Linux partition:</p><pre><code class=language-console data-lang=console>fdisk -l
	Disk /dev/ram0: 4 MiB, 4194304 bytes, 8192 sectors
	Units: sectors of 1 * 512 = 512 bytes
	Sector size (logical/physical): 512 bytes / 4096 bytes
	I/O size (minimum/optimal): 4096 bytes / 4096 bytes

	...
	
	Disk /dev/sda: 8 GiB, 8589934592 bytes, 16777216 sectors
	Units: sectors of 1 * 512 = 512 bytes
	Sector size (logical/physical): 512 bytes / 512 bytes
	I/O size (minimum/optimal): 512 bytes / 512 bytes
	Disklabel type: gpt
	Disk identifier: 3CFA568B-2C89-4290-8B52-548732A3972D

	Device        Start      End  Sectors Size Type
	/dev/sda1      2048 16771071 16769024   8G Linux filesystem
	/dev/sda2  16771072 16777182     6111   3M BIOS boot
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-497391c40467e0c63cef258c129588cd>8.7.5 - File System Consistency Check Tool</h1><p>You can manually check the file system by using the file system consistency check tool, <code>fsck</code>, after you unmount the file system.</p><p>The Photon OS file system includes btrfs and ext4. The default root file system is ext4, which you can see by looking at the file system configuration file, <code>/etc/fstab</code>:</p><pre><code class=language-console data-lang=console>cat /etc/fstab
	#system mnt-pt  type    options dump    fsck
	/dev/sda1       /       ext4    defaults,barrier,noatime,noacl,data=ordered     1       1
	/dev/cdrom      /mnt/cdrom      iso9660 ro,noauto       0       0
</code></pre><p>The <code>1</code> in the fifth column, under <code>fsck</code>, indicates that fsck checks the file system when the system boots.</p><p>You can also perform a read-only check without unmounting it:</p><pre><code class=language-console data-lang=console>fsck -nf /dev/sda1
	fsck from util-linux 2.27.1
	e2fsck 1.42.13 (17-May-2015)
	Warning!  /dev/sda1 is mounted.
	Warning: skipping journal recovery because doing a read-only filesystem check.
	Pass 1: Checking inodes, blocks, and sizes
	Pass 2: Checking directory structure
	Pass 3: Checking directory connectivity
	Pass 4: Checking reference counts
	Pass 5: Checking group summary information
	Free blocks count wrong (1439651, counted=1423942).
	Fix? no
	Free inodes count wrong (428404, counted=428397).
	Fix? no
	/dev/sda1: 95884/524288 files (0.3% non-contiguous), 656477/2096128 blocks
</code></pre><p>The inodes count might be wrong because the file system is mounted and in use.</p><p>To fix errors, you must first unmount the file system and then run fsck again:</p><pre><code class=language-console data-lang=console>umount /dev/sda1
umount: /: target is busy
</code></pre><p>You can find information about processes that use the device by using <code>lsof</code> or <code>fuser</code>.</p><pre><code class=language-console data-lang=console>lsof | grep ^jbd2/sd
	jbd2/sda1   99                root  cwd       DIR                8,1     4096          2 /
	jbd2/sda1   99                root  rtd       DIR                8,1     4096          2 /
	jbd2/sda1   99                root  txt   unknown                                        /proc/99/exe
</code></pre><p>The above example indicates that file system is in use.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0d8a66f1aaaa1d930b395e737a470b71>8.7.6 - Fixing File System Errors When fsck Fails</h1><p>Sometimes when <code>fsck</code> runs during startup, it encounters an error that prevents the system from fully booting until you fix the issue by running <code>fsck</code> manually. This error might occur when Photon OS is the operating system for a VM running an appliance.</p><p>If <code>fsck</code> fails when the computer boots and an error message says to run fsck manually, you can troubleshoot by restarting the VM, altering the GRUB edit menu to enter emergency mode before Photon OS fully boots, and running <code>fsck</code>.</p><p>Perform the following steps:</p><ol><li><p>Take a snapshot of the virtual machine.</p></li><li><p>Restart the virtual machine running Photon OS.</p><p>When the Photon OS splash screen appears as it restarts, type the letter <code>e</code> quickly to go to the <code>GNU GRUB</code> edit menu.</p><p><strong>Note</strong>: You must type <code>e</code> quickly as Photon OS reboots quickly. Also, in VMware vSphere or VMware Workstation Pro, you might have to give the console focus by clicking in its window before it will register input from the keyboard.</p></li><li><p>In the <code>GNU GRUB</code> edit menu, go to the end of the line that starts with <code>linux</code>, add a space, and then add the following code exactly as it appears below:</p><p><code>systemd.unit=emergency.target</code></p></li><li><p>Type <code>F10</code>.</p></li><li><p>In the bash shell, run one of the following commands to fix the file system errors, depending on whether <code>sda1</code> or <code>sda2</code> represents the root file system:</p><p><code>e2fsck -y /dev/sda1</code></p><p>or</p><p><code>e2fsck -y /dev/sda2</code></p></li><li><p>Restart the virtual machine.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-45fccef9bd97bc1ac84237b20daca982>8.8 - Troubleshooting Packages</h1><p>On Photon OS, <code>tdnf</code> is the default package manager. The standard syntax for <code>tdnf</code> commands is the same as that for DNF and Yum:</p><pre><code class=language-console data-lang=console>tdnf [options] &lt;command&gt; [&lt;arguments&gt;...]
</code></pre><p>The main configuration files reside in <code>/etc/tdnf/tdnf.conf</code>. The repositories appear in <code>/etc/yum.repos.d/</code> with <code>.repo</code> file extensions. For more information, see the <a href=../../docs/administration-guide/>Photon OS Administration Guide</a>.</p><p>The cache files for data and metadata reside in <code>/var/cache/tdnf</code>. The local cache is populated with data from the repository:</p><pre><code class=language-console data-lang=console>ls -l /var/cache/tdnf/photon
	total 8
	drwxr-xr-x 2 root root 4096 May 18 22:52 repodata
	d-wxr----t 3 root root 4096 May  3 22:51 rpms
</code></pre><p>You can clear the cache to help troubleshoot a problem, but doing so might slow the performance of <code>tdnf</code> until the cache becomes repopulated with data. Cleaning the cache can remove stale information. Clear the cache as follows:</p><pre><code class=language-console data-lang=console>tdnf clean all
	Cleaning repos: photon photon-extras photon-updates 
	Cleaning up everything
</code></pre><p>Some tdnf commands can help you troubleshoot problems with packages:</p><ul><li><p><code>makecache</code></p><p>This command updates the cached binary metadata for all known repositories. You can run it after you clean the cache to make sure you are working with the latest repository data as you troubleshoot.</p><p>Example:</p><pre><code>tdnf makecache
        Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)Updates'
        Refreshing metadata for: 'VMware Photon Extras 1.0(x86_64)'
        Refreshing metadata for: 'VMware Photon Linux 1.0(x86_64)'
        Metadata cache created.
</code></pre></li><li><p><code>tdnf check-local</code></p><p>This command resolves dependencies by using the local RPMs to help check RPMs for quality assurance before publishing them. To check RPMs with this command, you must create a local directory and place your RPMs in it. The command, which includes no options, takes the path to the local directory containing the RPMs as its argument. The command does not, however, recursively parse directories; it checks the RPMs only in the directory that you specify.</p><p>For example, after creating a directory named <code>/tmp/myrpms</code> and placing your RPMs in it, you can run the following command to check them:</p><pre><code>tdnf check-local /tmp/myrpms
    Checking all packages from: /tmp/myrpms
    Found 10 packages
    Check completed without issues
</code></pre><pre><code>
</code></pre></li><li><p><code>tdnf provides</code></p><p>This command finds the packages that provide the package that you supply as an argument. If you are used to a package name for another system, you can use <code>tdnf provides</code> to find the corresponding name of the package on Photon OS.</p><p>Example:</p><pre><code>tdnf provides docker
    docker-1.11.0-1.ph1.x86_64 : Docker
    Repo     : photon
    docker-1.11.0-1.ph1.x86_64 : Docker
    Repo     : @System
</code></pre><pre><code>
 For a file, you must provide the full path. Example: 
   
</code></pre><pre><code> tdnf provides /usr/include/stdio.h
     glibc-devel-2.22-8.ph1.x86_64 : Header files for glibc
     Repo     : photon
     glibc-devel-2.22-8.ph1.x86_64 : Header files for glibc
     Repo     : @System
</code></pre><pre><code>
 The following example shows you how to find the package that provides a pluggable authentication module, which you might need to find if the system is mishandling passwords. 

</code></pre><p>tdnf provides /etc/pam.d/system-account
shadow-4.2.1-7.ph1.x86_64 : Programs for handling passwords in a secure way
Repo : photon
shadow-4.2.1-8.ph1.x86_64 : Programs for handling passwords in a secure way
Repo : photon-updates</p><pre><code>
For more commands see the [Photon OS Administration Guide](../../administration-guide/).

</code></pre></li></ul><p>If a package that is installed is not working, try re-installing it.
Example:</p><pre><code>```
tdnf reinstall shadow
	Reinstalling:
	shadow 	x86_64 	4.2.1-7.ph1   3.85 M
```
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-249cb7133f08d5ee19182ae009f48b92>8.9 - Kernel Problems and Boot and Login Errors</h1><p>Photon OS includes commands to troubleshoot kernel problems and boot and login errors.</p><ul><li><a href=../../docs/troubleshooting-guide/kernel-problems-and-boot-and-login-errors/kernel-overview/>Kernel Overview</a></li><li><a href=../../docs/troubleshooting-guide/kernel-problems-and-boot-and-login-errors/boot-process-overview/>Boot Process Overview</a></li><li><a href=../../docs/troubleshooting-guide/kernel-problems-and-boot-and-login-errors/blank-screen-on-reboot/>Blank Screen on Reboot</a></li><li><a href=../../docs/troubleshooting-guide/kernel-problems-and-boot-and-login-errors/investigating-strange-behavior/>Investigating Unexpected Behavior</a></li><li><a href=../../docs/troubleshooting-guide/kernel-problems-and-boot-and-login-errors/investigating-the-guest-kernel/>Investigating the Guest Kernel</a></li><li><a href=../../docs/troubleshooting-guide/kernel-problems-and-boot-and-login-errors/kernel-log-replication-with-vprobes/>Kernel Log Replication with VProbes</a></li><li><a href=../../docs/troubleshooting-guide/kernel-problems-and-boot-and-login-errors/troubleshooting-linux-kernel/>Troubleshooting Linux Kernel</a></li></ul></div><div class=td-content><h1 id=pg-fb6a01033307d1364f3304460e9609eb>8.9.1 - Kernel Overview</h1><p>You can use <code>dmesg</code> command to troubleshooting kernel errors. The <code>dmesg</code> command prints messages from the kernel ring buffer.</p><p>The following command, for example, presents kernel messages in a human-readable format:</p><pre><code>dmesg --human --kernel
</code></pre><p>To examine kernel messages as you perform actions, such as reproducing a problem, in another terminal, you can run the command with the <code>--follow</code> option, which waits for new messages and prints them as they occur:</p><pre><code>dmesg --human --kernel --follow
</code></pre><p>The kernel buffer is limited in memory size. As a result, the kernel cyclically overwrites the end of the information in the buffer from which <code>dmesg</code> pulls information. The systemd journal, however, saves the information from the buffer to a log file so that you can access older information.</p><p>To view it, run the following command:</p><pre><code>journalctl -k
</code></pre><p>If required, you can check the modules that are loaded on your Photon OS machine by running the <code>lsmod</code> command. For example:</p><pre><code>lsmod
Module                  Size  Used by
vmw_vsock_vmci_transport    28672  1
vsock                  36864  2 vmw_vsock_vmci_transport
coretemp               16384  0
hwmon                  16384  1 coretemp
crc32c_intel           24576  0
hid_generic            16384  0
usbhid                 28672  0
hid                   106496  2 hid_generic,usbhid
xt_conntrack           16384  1
iptable_nat            16384  0
nf_conntrack_ipv4      16384  2
nf_defrag_ipv4         16384  1 nf_conntrack_ipv4
nf_nat_ipv4            16384  1 iptable_nat
nf_nat                 24576  1 nf_nat_ipv4
iptable_filter         16384  1
ip_tables              24576  2 iptable_filter,iptable_nat
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-1bc1d49db5f317bcf9d37ee4fbc9e850>8.9.2 - Boot Process Overview</h1><p>When a Photon OS machine boots, the BIOS initializes the hardware and uses a boot loader to start the kernel. After the kernel starts, <code>systemd</code> takes over and boots the rest of the operating system.</p><p>The BIOS checks the memory and initializes the keyboard, the screen, and other peripherals. When the BIOS finds the first hard disk, the boot loader&ndash;GNU GRUB 2.02&ndash;takes over. From the hard disk, GNU GRUB loads the master boot record (MBR) and initializes the root partition of the random-access memory by using initrd. The device manager, udev, provides initrd with the drivers it needs to access the device containing the root file system. Here&rsquo;s what the GNU GRUB edit menu looks like in Photon OS with its default commands to load the boot record and initialize the RAM disk:</p><p><img src=../../docs/images/grub-edit-menu-orig.png alt="The GNU GRUB edit menu in Photon OS"></p><p>At this point, the Linux kernel in Photon OS, which is kernel version 4.4.8, takes control. Systemd kicks in, initializes services in parallel, mounts the rest of the file system, and checks the file system for errors.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-d493e733f13166e75be33c14d5041e24>8.9.3 - Blank Screen on Reboot</h1><p>If the Photon OS kernel enters a state of panic during a reboot and all you see is a blank screen, note the name of the virtual machine running Photon OS and then power off the VM.</p><p>In the host, open the <code>vmware.log</code> file for the VM. When a kernel panics, the guest VM prints the entire kernel log in <code>vmware.log</code> in the host directory containing the VM. This log file contains the output of the <code>dmesg</code> command from the guest, and you can analyze it to help identify the cause of the boot problem.</p><p><strong>Example</strong></p><p>After searching for <code>Guest:</code> in the following abridged <code>vmware.log</code>, this line appears, identifying the root cause of the reboot problem:</p><pre><code class=language-log data-lang=log>2016-08-30T16:02:43.220-07:00| vcpu-0| I125: Guest: 
	&lt;0&gt;[1.125804] Kernel panic - not syncing: 
	VFS: Unable to mount root fs on unknown-block(0,0)
</code></pre><p>Further inspection finds the following lines:</p><pre><code class=language-log data-lang=log>2016-08-30T16:02:43.217-07:00| vcpu-0| I125: Guest: 
&lt;4&gt;[    1.125782] VFS: Cannot open root device &quot;sdc1&quot; or unknown-block(0,0): error -6
2016-08-30T16:02:43.217-07:00| vcpu-0| I125: Guest: 
&lt;4&gt;[    1.125783] Please append a correct &quot;root=&quot; boot option; 
here are the available partitions: 
2016-08-30T16:02:43.217-07:00| vcpu-0| I125: Guest: 
&lt;4&gt;[    1.125785] 0100            4096 ram0  (driver?)
...
0800         8388608 sda  driver: sd
2016-08-30T16:02:43.220-07:00| vcpu-0| I125: Guest: 
&lt;4&gt;[    1.125802]   0801         8384512 sda1 611e2d9a-a3da-4ac7-9eb9-8d09cb151a93
2016-08-30T16:02:43.220-07:00| vcpu-0| I125: Guest: 
&lt;4&gt;[    1.125803]   0802            3055 sda2 8159e59c-b382-40b9-9070-3c5586f3c7d6
</code></pre><p>In this unlikely case, the GRUB configuration points to a root device named <code>sdc1</code> instead of the correct root device, <code>sda1</code>. You can resolve the problem by restoring the GRUB GNU edit screen and the GRUB configuration file (<code>/boot/grub/grub.cfg</code>) to their original configurations.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-acbad8eeeb152ca4b47202019d5e6fbc>8.9.4 - Investigating Unexpected Behavior</h1><p>If you rebooted to address unexpected behavior before the reboot or if you encountered unexpected behavior during the reboot but have reached the shell, you must analyze what happened since the previous boot.</p><ol><li><p>Run the following command to check the logs:</p><pre><code>`journalctl`
</code></pre></li><li><p>Run the following command to look at what happened since the penultimate reboot:</p><p><code>journalctl --boot=-1</code></p><p>Look at the log from the reboot:</p><p><code>journalctl -b</code></p></li><li><p>If required, examine the logs for the kernel:</p><pre><code>`journalctl -k`
</code></pre></li><li><p>Check which kernel is in use:</p><p><code>uname -r</code></p><p>The kernel version of Photon OS in the full version is 4.4.8. The kernel version of in the OVA version is 4.4.8-esx. With the ESX version of the kernel, some services might not start.</p></li><li><p>Run this command to check the overall status of services:</p><p><code>systemctl status</code></p><p>If a service is in red, check it:</p><pre><code> systemctl status service-name
</code></pre><p>Start it if required:</p><pre><code> systemctl start service-name
</code></pre></li><li><p>If looking at the journal and checking the status of services does not resolve your error, run the following <code>systemd-analyze</code> commands to examine the boot time and the speed with which services start.</p><pre><code>systemd-analyze time
    systemd-analyze blame
    systemd-analyze critical-chain
</code></pre></li></ol><p><strong>Note</strong>: The output of these commands might be misleading because one service might just be waiting for another service to finish initializing.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0e252e3664ed9f5e850a0bbbc6d40b21>8.9.5 - Investigating the Guest Kernel</h1><p>If a VM running Photon OS and an application or virtual appliance is behaving preventing you from logging in to the machine, you can troubleshoot by extracting the kernel logs from the guest&rsquo;s memory and analyzing them with <code>gdb</code>.</p><p>This advanced troubleshooting method works when you are running Photon OS as the operating system for an application or appliance on VMware Workstation, Fusion, or ESXi. The procedure in this section assumes that the virtual machine running Photon OS is functioning normally.</p><p>The process to use this troubleshooting method varies by environment. The examples in this section assume that the troublesome Photon OS virtual machine is running in VMware Workstation 12 Pro on a Microsoft Windows 8 Enterprise host. The examples also use an additional, fully functional Photon OS virtual machine running in Workstation.</p><p>You can use other hosts, hypervisors, and operating systems&ndash;but you will have to adapt the example process below to them. Directory paths, file names, and other aspects might be different on other systems.</p><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#procedure-overview>Procedure Overview</a></li><li><a href=#procedure>Procedure</a></li></ul><h2 id=prerequisites>Prerequisites</h2><p>Verify that you have the following resources:</p><ul><li>Root access to a Linux machine other than the one you are troubleshooting. It can be another Photon OS machine, Ubuntu, or another Linux variant.</li><li>The <code>vmss2core</code> utility from VMware. It is installed by default in VMware Workstation and some other VMware products. If your system doesn&rsquo;t already contain it, you can download it for free from <a href=https://labs.vmware.com/flings/vmss2core>https://labs.vmware.com/flings/vmss2core</a>.</li><li>A local copy of the Photon OS ISO of the exact same version and release number as the Photon OS machine that you are troubleshooting.</li></ul><h2 id=procedure-overview>Procedure Overview</h2><p>The process to apply this troubleshooting method is as follows:</p><ul><li>On a local computer, you open a file on the Photon OS ISO that contains Linux debugging information. Then you suspend the troublesome Photon OS VM and extract the kernel memory logs from the VMware hypervisor running Photon OS.</li><li>Next, you use the vmss2core tool to convert the memory logs into core dump files. The vmss2core utility converts VMware checkpoint state files into formats that third-party debugging tools understand. It can handle both suspend (.vmss) and snapshot (.vmsn) checkpoint state files (hereafter referred to as a <em>vmss file</em>) as well as monolithic and non-monolithic (separate .vmem file) encapsulation of checkpoint state data. See <a href=http://www.vmware.com/pdf/snapshot2core_technote.pdf>Debugging Virtual Machines with the Checkpoint to Core Tool</a>.</li><li>Finally, you prepare to run the gdb tool by using the debug info file from the ISO to create a <code>.gdbinit</code> file, which you can then analyze with the gdb shell on your local Linux machine.</li></ul><p>All three components must be in the same directory on a Linux machine.</p><h2 id=procedure>Procedure</h2><ol><li><p>Obtain a local copy of the Photon OS ISO of the exact same version and release number as the Photon OS machine that you are troubleshooting and mount the ISO on a Linux machine (or open it on a Windows machine):</p><pre><code>mount /mnt/cdrom
</code></pre></li><li><p>Locate the following file. (If you opened the Photon OS ISO on a Windows computer, copy the following file to the root folder of a Linux machine.)</p><pre><code>/RPMS/x86_64/linux-debuginfo-4.4.8-6.ph1.x86_64.rpm
</code></pre></li><li><p>On a Linux machine, run the following <code>rpm2cpio</code> command to convert the RPM file to a cpio file and to extract the contents of the RPM to the current directory:</p><pre><code>rpm2cpio /mnt/cdrom/RPMS/x86_64/linux-debuginfo-4.4.8-6.ph1.x86_64.rpm | cpio -idmv
</code></pre></li><li><p>From the extracted files, copy the following file to your current directory:</p><pre><code>cp usr/lib/debug/lib/modules/4.4.8/vmlinux-4.4.8.debug
</code></pre></li><li><p>Run the following command to download the dmesg functions that will help extract the kernel log from the coredump:</p><pre><code>wget https://www.kernel.org/doc/Documentation/kdump/gdbmacros.txt
wget https://github.com/vmware/photon/blob/master/tools/scripts/gdbmacros-for-linux.txt
</code></pre></li><li><p>Move the file as follows:</p><pre><code>mv gdbmacros-for-linux.txt .gdbinit
</code></pre></li><li><p>Switch to your host machine so you can get the kernel memory files from the VM. Suspend the troublesome VM and locate the <code>.vmss</code> and <code>.vmem</code> files in the virtual machine&rsquo;s directory on the host.</p><p>Example:</p><pre><code>C:\Users\tester\Documents\Virtual Machines\VMware Photon 64-bit (7)&gt;dir
     Volume in drive C is Windows
     Directory of C:\Users\tester\Documents\Virtual Machines\VMware Photon 64-bit
     (7)
    09/20/2016  12:22 PM    &lt;DIR&gt;          .
    09/20/2016  12:22 PM    &lt;DIR&gt;          ..
    09/19/2016  03:39 PM       402,653,184 VMware Photon 64-bit (7)-f6b070cd.vmem
    09/20/2016  12:11 PM         5,586,907 VMware Photon 64-bit (7)-f6b070cd.vmss
    09/20/2016  12:11 PM     1,561,001,984 VMware Photon 64-bit (7)-s001.vmdk
    ...
    09/20/2016  12:11 PM           300,430 vmware.log
    ...
</code></pre></li><li><p>Now that you have located the <code>.vmss</code> and <code>.vmem</code> files, convert them to one or more core dump files by using the vmss2core tool that comes with Workstation. Here is an example of how to run the command. Be careful with your pathing, escaping, file names, and so forth&ndash;all of which might be different from this example on your Windows machine.</p><pre><code>   
    C:\Users\shoenisch\Documents\Virtual Machines\VMware Photon 64-bit (7)&gt;C:\&quot;Program Files (x86)\VMware\VMware Workstation&quot;\vmss2core.exe &quot;VMware Photon 64-bit (7)-f6b070cd.vmss&quot; &quot;VMware Photon 64-bit (7)-f6b070cd.vmem&quot;
   
The result of this command is one or more files with a `.core` extension plus a digit. Truncated example: 
   
    C:\Users\tester\Documents\Virtual Machines\VMware Photon 64-bit (7)&gt;dir
     Directory of C:\Users\tester\Documents\Virtual Machines\VMware Photon 64-bit(7)
    09/20/2016  12:22 PM       729,706,496 vmss.core0
</code></pre></li><li><p>Copy the <code>.core</code> file or files to the your current directory on the Linux machine where you so that you can analyze it with gdb.</p><p>Run the following <code>gdb</code> command to enter the gdb shell attached to the memory core dump file. You might have to change the name of the <code>vmss.core</code> file in the example to match your <code>.core</code> file:</p></li></ol><pre><code>gdb vmlinux-4.4.8.debug vmss.core0

	GNU gdb (GDB) 7.8.2
	Copyright (C) 2014 Free Software Foundation, Inc.
	License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
	This is free software: you are free to change and redistribute it. 
	There is NO WARRANTY, to the extent permitted by law. ...
	Type &quot;show configuration&quot; for configuration details.
	For bug reporting instructions, please see:
	&lt;http://www.gnu.org/software/gdb/bugs/&gt;.
	Find the GDB manual and other documentation resources online at: &lt;http://www.gnu.org/software/gdb/documentation/&gt;.
	For help, type &quot;help&quot;.
	Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;...
	Reading symbols from vmlinux-4.4.8.debug...done.
	warning: core file may not match specified executable file.
	[New LWP 12345]
	Core was generated by `GuestVM'.
	Program terminated with signal SIGSEGV, Segmentation fault.
	#0  0xffffffff813df39a in insb (count=0, addr=0xffffc90000144000, port=&lt;optimized out&gt;)
	    at arch/x86/include/asm/io.h:316
	316     arch/x86/include/asm/io.h: No such file or directory.
	(gdb)
</code></pre><p><strong>Result</strong></p><p>In the results above, the <em>(gdb)</em> of the last line is the prompt of the gdb shell. You can now analyze the core dump by using commands like <code>bt</code>, to perform a backtrace, and <code>dmesg</code>, to view the Photon OS kernel log and see Photon OS kernel error messages.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-daeaab5c036a9bfeb7dc2da74aa8256a>8.9.6 - Kernel Log Replication with VProbes</h1><p>Replicating the Photon OS kernel logs on the VMware ESXi host is an advanced but powerful method of troubleshooting a kernel problem.</p><ul><li><a href=#replication-method>Replication Method</a></li><li>[Using VProbes Script with a Hard-Coded Address](#using-vprobes-script- with-a-hard-coded-address)</li><li><a href=#a-reusable-vprobe-script-using-the-kallsyms-file>A Reusable VProbe Script Using the kallsyms File</a></li></ul><h2 id=replication-method>Replication Method</h2><p>This method is applicable when the virtual machine running Photon OS is hanging or inaccessible because, for instance, the hard disk has failed.</p><p>As a prerequisite, you must have preemptively enabled the VMware VProbes facility on the VM before an error rendered it inaccessible. You must also create a VProbes script on the ESXi host, but you can do that after the error.</p><p>The method is useful in analyzing kernel issues when testing an application or appliance that is running on Photon OS.</p><p>There are two similar ways in which you can replicate the Photon OS kernel logs on ESXi by using VProbes.</p><ul><li><p>The first modifies the VProbes script so that it works only for the VM that you set. It uses a hard-coded address.</p></li><li><p>The second uses an abstraction instead of a hard-coded address so that the same VProbes script can be used for any VM on an ESXi host that you have enabled for VProbe and copied its kernel symbol table (kallsyms) to ESXi.</p></li></ul><p>For more information on VMware VProbes, see <a href=https://labs.vmware.com/vmtj/vprobes-deep-observability-into-the-esxi-hypervisor>VProbes: Deep Observability Into the ESXi Hypervisor</a> and the <a href=http://www.vmware.com/pdf/ws7_f3_vprobes_reference.pdf>VProbes Programming Reference</a>.</p><h2 id=using-vprobes-script-with-a-hard-coded-address>Using VProbes Script with a Hard-Coded Address</h2><p>Perform the following steps to set a VProbe for an individual VM:</p><ol><li><p>Power off the VM so that you can turn on the VProbe facility.</p><p>Edit the <code>.vmx</code> configuration file for the VM. The file resides in the directory that contains the VM in the ESXi data store. Add the following line of code to the <code>.vmx</code> file and then power the VM on:</p><pre><code> vprobe.enable = &quot;TRUE&quot;
</code></pre><p>When you edit the <code>.vmx</code> file to add the above line of code, you must first turn off the VM&ndash;otherwise, your changes will not persist.</p></li><li><p>Obtain the kernel <code>log_store</code> function address by connecting to the VM with SSH and running the following commands as root.</p><p>Photon OS uses the <code>kptr_restrict</code> setting to place restrictions on the kernel addresses exposed through <code>/proc</code> and other interfaces. This setting hides exposed kernel pointers to prevent attackers from exploiting kernel write vulnerabilities. When you are done using VProbes, you should return <code>kptr_restrict</code> to the original setting of <code>2</code> by rebooting.)</p><pre><code> echo 0 &gt; /proc/sys/kernel/kptr_restrict
 grep log_store /proc/kallsyms
</code></pre><p>The output of the <code>grep</code> command will look similar to the following string. The first set of characters (without the <code>t</code>) is the log_store function address:</p><pre><code> ffffffff810bb680 t log_store
</code></pre></li><li><p>Connect to the ESXi host with SSH so that you can create a VProbes script.</p><p>Below is the template for the script. <code>log_store</code> in the first line is a placeholder for the VM&rsquo;s log_store function address:</p><pre><code>GUEST:ENTER:log_store {
           string dst;
           getgueststr(dst, getguest(RSP+16) &amp; 0xff, getguest(RSP+8));
           printf(&quot;%s\n&quot;, dst);
        }
</code></pre><p>On the ESXi host, create a new file, add the template to it, and then change <code>log_store</code> to the function address that was the output from the grep command on the VM.</p></li><li><p>Add a <code>0x</code> prefix to the function address. In this example, the modified template looks like this:</p><pre><code>GUEST:ENTER:0xffffffff810bb680 {
       string dst;
       getgueststr(dst, getguest(RSP+16) &amp; 0xff, getguest(RSP+8));
       printf(&quot;%s\n&quot;, dst);
    }
</code></pre></li><li><p>Save your VProbes script as <code>console.emt</code> in the <code>/tmp</code> directory. (The file extension for VProbe scripts is <code>.emt</code>.)</p><p>While still connected to the ESXi host with SSH, run the following command to obtain the ID of the virtual machine that you want to troubleshoot:</p><pre><code> vim-cmd vmsvc/getallvms
</code></pre><p>This command lists all the VMs running on the ESXi host. Find the VM you want to troubleshoot in the list and make a note of its ID.</p></li><li><p>Run the following command to print all the kernel messages from Photon OS in your SSH console; replace <code>&lt;VM ID></code> with the ID of your VM:</p><p><code>vprobe -m &lt;VM ID> /tmp/console.emt</code></p><p>When you&rsquo;re done, type <code>Ctrl-C</code> to stop the loop.</p></li></ol><h2 id=a-reusable-vprobe-script-using-the-kallsyms-file>A Reusable VProbe Script Using the kallsyms File</h2><p>Perform the following steps to create one VProbe script and use for all the VMs on your ESXi host.</p><ol><li><p>Power off the VM and turn on the VProbe facility on each VM that you want to be able to analyze.</p><p>Add <code>vprobe.enable = "TRUE"</code> to the VM&rsquo;s <code>.vmx</code> configuration file. See the instructions above.</p></li><li><p>Power on the VM, connect to it with SSH, and run the following command as root:</p><pre><code>`echo 0 &gt; /proc/sys/kernel/kptr_restrict`
</code></pre></li><li><p>Connect to the ESXi host with SSH to create the following VProbes script and save it as <code>/tmp/console.emt</code>:</p><pre><code>GUEST:ENTER:log_store {
       string dst;
       getgueststr(dst, getguest(RSP+16) &amp; 0xff, getguest(RSP+8));
       printf(&quot;%s\n&quot;, dst);
    }
</code></pre></li><li><p>From the ESXi host, run the following command to copy the VM&rsquo;s <code>kallysms</code> file to the <code>tmp</code> directory on the ESXi host:</p><pre><code>`scp root@&lt;vm ip address&gt;:/proc/kallsyms /tmp`
</code></pre><p>While still connected to the ESXi host with SSH, run the following command to obtain the ID of the virtual machine that you want to troubleshoot:</p><pre><code> `vim-cmd vmsvc/getallvms`
</code></pre><p>This command lists all the VMs running on the ESXi host. Find the VM you want to troubleshoot in the list and make a note of its ID.</p></li><li><p>Run the following command to print all the kernel messages from Photon OS in your SSH console.</p><p>Replace <code>&lt;VM ID></code> with the ID of your VM. When you&rsquo;re done, type <code>Ctrl-C</code> to stop the loop.</p><p><code>vprobe -m &lt;VM ID> -k /tmp/kallysyms /tmp/console.emt</code></p><p>You can use a directory other than <code>tmp</code> if you want.</p></li></ol><blockquote></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-f8bffb3e220b96d1c691fab6b2f4b171>8.9.7 - Linux Kernel</h1><p>The Linux kernel is the main component of Photon OS and is the core interface between a computer’s hardware and its processes. It communicates between the two, managing resources as efficiently as possible.</p><p>##Kernel Flavours and Versions
The following list contains the different Linux kernel flavours available:</p><ul><li><code>linux</code> - A generic kernel designed to run everywhere and support everything.</li><li><code>linux-esx</code> - Optimized to run only on VMware hypervisor (ESXi, WS, Fusion). It has minimal set of device drivers to support VMware virtual devices. <code>uname -r</code> displays <code>Linux</code> . For additional features switch to the generic flavour.</li><li><code>linux-secure</code> - Security hardened variant of the generic kernel. <code>uname -r</code> displays <code>-secure</code> suffix.</li><li><code>linux-rt</code> - This is a Photon Real Time kernel. <code>uname -r</code> displays <code>-rt</code> suffix.</li><li><code>linux-aws</code> - Optimized for AWS hypervisor kernel. <code>uname -r</code> displays <code>-aws</code> suffix.</li></ul><p>To see the version of kernel installed, run the following command:</p><pre><code># rpm -qa | grep -e &quot;^linux\(\|-esx\|-secure\|rt\|aws\)-[[:digit:]]&quot;
linux-4.9.111-1.ph2.x86_64
linux-esx-4.9.111-1.ph2.x86_64
</code></pre><p>To see the version of the Kernel that is running currently, run the following command:</p><pre><code># uname -r
4.9.107-1.ph2-esx
</code></pre><p>From the output, you can see that the kernel running currently doesn&rsquo;t match the installer. This happens when linux-* rpms were updated but was not restarted. Restart is required.</p><p>##Configuration</p><p>To find the configurations of the installed Kernel, check the <strong>/boot</strong> directory by running the following command:</p><pre><code># ls /boot/config-*
config-4.9.111-1.ph2 config-4.9.111-1.ph2-esx
</code></pre><p>To get a copy of the kernel configuration (Not all flavours support this feature), run the <code>zcat /proc/config.gz</code> command.</p><p>##Boot Parameters and initrd
Several kernel flavors can be installed on the system, but only one is used during boot.
<strong>/boot/photon.cfg</strong> symlink points to the kernel which is used for boot.</p><pre><code># ls -l /boot/photon.cfg
lrwxrwxrwx 1 root root 23 Jun 12  2018 /boot/photon.cfg -&gt; linux-4.9.111-1.ph2.cfg
</code></pre><p>Its contents can be checked by running the following command:</p><pre><code># cat /boot/photon.cfg

# GRUB Environment Block

photon_cmdline=init=/lib/systemd/systemd ro loglevel=3 quiet no-vmw-sta

photon_linux=vmlinuz-4.9.111-1.ph2

photon_initrd=initrd.img-4.9.111-1.ph2
</code></pre><p>Where:</p><ul><li><code>photon_cmdline</code> - Kernel parameters. This list will be extended by values from <strong>/boot/systemd.cfg</strong> file and the values are hardcoded to <strong>/boot/grub2/grub.cfg</strong> file (For example: root=).</li><li><code>photon_linux</code> - Kernel image to boot.</li><li><code>photon_initrd</code> - Initrd to use at boot.</li></ul><p>Parameters of the kernel loading currently can be found by running the <code>/proc/cmdline</code> command:</p><pre><code># cat /proc/cmdline

BOOT_IMAGE=/boot/vmlinuz-4.9.107-1.ph2-esx root=PARTUUID=29194d05-4a6e-4e0c-b1f4-5020e5e8472c net.ifnames=0 init=/lib/systemd/systemd ro loglevel=3 quiet no-vmw-sta
</code></pre><p>##Dmesg</p><p>To view message buffer of the kernel run the <code>dmesg</code> command.</p><p>##Sysctl State</p><p>To view a list of all active units run the <code>systemctl list-units</code> command.</p><p>##Kernel Statistics</p><p>The kernel statitics can be found by running the following commands:</p><ul><li><code>procfs</code></li><li><code>sysfs</code></li><li><code>debugfs</code></li></ul><p>##Kernel Modules</p><p>To view the kernel log buffer run the <code>journalctl -k</code> command.</p><p>To view a list of available kernel modules run the <code>lsmod</code> command.</p><p>To view detailed information about all connected PCI buses run the <code>lspci</code> command.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-db6c8d892731b711d7d08232c88d660e>8.10 - Performance Issues</h1><p>Performance issues can be difficult to troubleshoot because so many variables play a role in overall system performance. Interpreting performance data often depends on the context and the situation. To better identify and isolate variables and to gain insight into performance data, you can use the troubleshooting tools on Photon OS to diagnose the system.</p><ul><li><a href=general_performance_guidelines.md>General Guidelines</a></li><li><a href=throughput_performance.md>Throughput Performance</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-d7dfe1c13df4b2c19bc5a19455b7c5c6>8.10.1 - General Performance Guidelines</h1><p>If you have no indication what the cause of a performance degradation might be, start by getting a high-level picture of the system&rsquo;s state. Then look for signs in the data that might point to a cause.</p><p>Use the following guidelines to gain insight into performance data:</p><ul><li><p>Start with the <code>systemd journal</code>.</p></li><li><p>The <code>top</code> tool can unmask problems caused by processes or applications overconsuming CPUs, time, or RAM. If the percent of CPU utilization is consistently high with little idle time, for example, there might be a runaway process. Restart it.</p></li><li><p>The <code>netstat --statistics</code> command can identify bottlenecks causing performance issues. It lists interface statistics for different protocols.</p></li><li><p>If <code>top</code> and <code>netstat</code> reveal no errors, run the <code>strace ls -al</code> to view every system call.</p></li><li><p>The <code>watch</code> command can help dynamically monitor a command to help troubleshoot performance issues:</p><p><code>watch -n0 --differences &lt;command></code></p><p>You can also combine <code>watch</code> with the <code>vmstat</code> command to dig deeper into statistics about virtual memory, processes, block input-output, disks, and CPU activity. Are there any bottlenecks?</p></li><li><p>You can use the <code>dstat</code> utility to see the live, running list of statistics about system resources.</p></li><li><p>The <code>systemd-analyze</code> reveals performance statistics for boot time and can help troubleshoot slow system boots and incorrect unit files.</p></li></ul><p>The additional tools that you select depend on the clues that your initial investigation reveals. The following tools can also help troubleshoot performance: <code>sysstat</code>, <code>sar</code>, <code>systemtap</code>, and <code>crash</code>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0be0e0ec49fb47fcbab6983167f5f866>8.10.2 - Throughput Performance</h1><p>Throughtput performance over TCP might be reduced.</p><p>This might occur because timestamps are enabled by default and the parameter <code>net.ipv4.tcp_timestamps</code> has a value of 1.</p><p>Setting a value of 1 or 2 for this parameter may impact performance. Setting a value of 0 or 2 for this parameter might cause a security vulnerability.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-72c6e6702f26ff779b1da5b328a144b1>9 - Security Advisories</h1><p>Security Advisories can be found at: <a href=https://github.com/vmware/photon/wiki/Security-Advisories>https://github.com/vmware/photon/wiki/Security-Advisories</a></p></div></main></div></div><div class=container><footer class="container-fluid p-0 m-0 py-5 row d-print-none"><div class="container-fluid p-0"><div class="row d-flex justify-content-between align-items-center mx-0"><div class="order-sm-1 left-links"><ul class="list-inline mb-0"><li class="list-inline-item h1 px-3 m-0" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class="text-dark ml-4" target=_blank rel="noopener noreferrer" href=https://github.com/vmware/photon#readme><i class="fab fa-github">&nbsp;</i>
GitHub</a></li><li class="list-inline-item h1 px-3 m-0" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class="text-dark ml-4" target=_blank rel="noopener noreferrer" href=https://vmwarecode.slack.com><i class="fab fa-slack">&nbsp;</i>
Slack</a></li></ul></div><div class="order-sm-3 justify-items-end footer-logo"><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 511.4375 135.7375" height="135.7375" width="511.4375" id="svg3355"><defs id="defs3359"><clipPath id="clipPath3387" clipPathUnits="userSpaceOnUse"><path id="path3389" d="M142.293 245.191l494.93 337.36L74.8398 348.098"/></clipPath><linearGradient id="linearGradient3391" spreadMethod="pad" gradientTransform="matrix(-493.8,-339.007,339.007,-493.8,601.845,634.081)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3393" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3395" offset="1" style="stop-opacity:1;stop-color:#80c64c"/></linearGradient><clipPath id="clipPath3405" clipPathUnits="userSpaceOnUse"><path id="path3407" d="M85.2852 570.719 516.813 593.84 54.5195 690.582"/></clipPath><linearGradient id="linearGradient3409" spreadMethod="pad" gradientTransform="matrix(-304.079,-208.759,208.759,-304.079,420.197,734.568)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3411" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3413" offset="1" style="stop-opacity:1;stop-color:#22437e"/></linearGradient><clipPath id="clipPath3423" clipPathUnits="userSpaceOnUse"><path id="path3425" d="m538.137 270.234 95.324 293.5-205.699-247.089"/></clipPath><linearGradient id="linearGradient3427" spreadMethod="pad" gradientTransform="matrix(-255.101,-175.134,175.134,-255.101,686.667,486.234)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3429" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3431" offset="1" style="stop-opacity:1;stop-color:#65a5de"/></linearGradient><clipPath id="clipPath3441" clipPathUnits="userSpaceOnUse"><path id="path3443" d="M857.758 94.3906 656.035 546.801 745.172 53.6406"/></clipPath><linearGradient id="linearGradient3445" spreadMethod="pad" gradientTransform="matrix(-102.35,-449.574,449.574,-102.35,800.888,513.826)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3447" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3449" offset="1" style="stop-opacity:1;stop-color:#c6da3a"/></linearGradient><clipPath id="clipPath3459" clipPathUnits="userSpaceOnUse"><path id="path3461" d="M481.316 864.746 635.938 602.125l-41.313 301.32"/></clipPath><linearGradient id="linearGradient3463" spreadMethod="pad" gradientTransform="matrix(67.7401,274.401,-274.401,67.7401,532.514,627.656)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3465" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3467" offset="1" style="stop-opacity:1;stop-color:#c6da3a"/></linearGradient><clipPath id="clipPath3477" clipPathUnits="userSpaceOnUse"><path id="path3479" d="M1085.54 913.828 683.598 585.359l456.522 219.75"/></clipPath><linearGradient id="linearGradient3481" spreadMethod="pad" gradientTransform="matrix(441.375,262.068,-262.068,441.375,675.147,599.59)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3483" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3485" offset="1" style="stop-opacity:1;stop-color:#22638b"/></linearGradient><clipPath id="clipPath3495" clipPathUnits="userSpaceOnUse"><path id="path3497" d="M1177.19 335.031 693.664 556.211 1106.69 235.887"/></clipPath><linearGradient id="linearGradient3499" spreadMethod="pad" gradientTransform="matrix(450.785,-274.875,274.875,450.785,694.818,558.101)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3501" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3503" offset="1" style="stop-opacity:1;stop-color:#a6dbe7"/></linearGradient><clipPath id="clipPath3513" clipPathUnits="userSpaceOnUse"><path id="path3515" d="M209.754 773.73l382.32-187.417L280.926 872.391"/></clipPath><linearGradient id="linearGradient3517" spreadMethod="pad" gradientTransform="matrix(-360.263,223.047,-223.047,-360.263,601.957,602.271)" gradientUnits="userSpaceOnUse" y2="0" x2="1" y1="0" x1="0"><stop id="stop3519" offset="0" style="stop-opacity:1;stop-color:#ffffff"/><stop id="stop3521" offset="1" style="stop-opacity:1;stop-color:#a6dbe7"/></linearGradient></defs><g transform="matrix(1.25,0,0,-1.25,0,135.7375)" id="g3363"><g transform="scale(0.1,0.1)" id="g3365"><path id="path3367" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m1544.2 536.77c69.27.0 114.66 37.031 114.66 91.972v1.192c0 59.726-44.79 90.781-112.28 90.781h-105.7V536.77h103.32zm-150.51 203.652c0 13.141 10.75 23.891 23.29 23.891h133.19c94.36.0 156.47-50.172 156.47-132.586v-1.192c0-90.183-75.25-136.765-164.24-136.765h-101.52V367.148c0-13.132-10.76-23.886-23.9-23.886-12.54.0-23.29 10.754-23.29 23.886v373.274"/><path id="path3369" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m1765.51 743.41c0 13.141 10.76 23.887 23.29 23.887 13.14.0 23.9-10.746 23.9-23.887V578.574h241.28V743.41c0 13.141 10.74 23.887 23.88 23.887 12.55.0 23.3-10.746 23.3-23.887V367.148c0-13.132-10.75-23.886-23.3-23.886-13.14.0-23.88 10.754-23.88 23.886v167.227H1812.7V367.148c0-13.132-10.76-23.886-23.9-23.886-12.53.0-23.29 10.754-23.29 23.886V743.41"/><path id="path3371" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m2554.86 554.082v1.203c0 94.957-69.28 172.598-164.83 172.598-95.56.0-163.65-76.445-163.65-171.406v-1.192c0-94.961 69.28-172.597 164.84-172.597 95.55.0 163.64 76.445 163.64 171.394zm-377.45.0v1.203c0 115.262 86.6 216.192 213.81 216.192 127.2.0 212.6-99.739 212.6-215v-1.192c0-115.265-86.59-216.203-213.79-216.203-127.22.0-212.62 99.738-212.62 215"/><path id="path3373" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m2756.35 720.715h-121.24c-11.94.0-22.09 9.555-22.09 21.5.0 11.941 10.15 22.098 22.09 22.098h290.26c11.94.0 22.1-10.157 22.1-22.098.0-11.945-10.16-21.5-22.1-21.5h-121.23V367.148c0-13.132-10.75-23.886-23.9-23.886-13.13.0-23.89 10.754-23.89 23.886v353.567"/><path id="path3375" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m3332.78 554.082v1.203c0 94.957-69.28 172.598-164.83 172.598-95.56.0-163.65-76.445-163.65-171.406v-1.192c0-94.961 69.28-172.597 164.84-172.597 95.55.0 163.64 76.445 163.64 171.394zm-377.45.0v1.203c0 115.262 86.6 216.192 213.81 216.192 127.2.0 212.6-99.739 212.6-215v-1.192c0-115.265-86.59-216.203-213.79-216.203-127.22.0-212.62 99.738-212.62 215"/><path id="path3377" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m3458.31 742.813c0 12.539 10.75 23.292 23.29 23.292h6.57c10.75.0 17.32-5.375 23.89-13.742l253.83-323.691v315.332c0 12.547 10.14 23.293 23.29 23.293 12.54.0 22.69-10.746 22.69-23.293V366.555c0-12.539-8.96-22.09-21.5-22.09h-2.4c-10.14.0-17.31 5.965-24.48 14.324l-259.2 331.465V366.555c0-12.539-10.14-23.293-23.29-23.293-12.54.0-22.69 10.754-22.69 23.293v376.258"/><path id="path3379" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m3982.91 759.98c0 4.528 3.13 7.665 7.66 7.665h2.09c3.14.0 5.22-1.395 6.97-3.829l37.6-58.503 38.3 58.503c1.74 2.434 3.83 3.829 6.61 3.829h2.09c3.83.0 7.32-3.485 7.32-7.665v-94.011c0-4.18-3.49-7.66-7.66-7.66-4.18.0-7.31 3.48-7.31 7.66v72.426l-32.38-48.403c-1.75-2.785-3.83-4.527-6.97-4.527-3.13.0-5.22 1.742-6.96 4.527l-32.04 48.403v-72.426c0-4.18-3.48-7.66-7.66-7.66s-7.66 3.48-7.66 7.66v94.011zm-73.47-7.308h-28.91c-3.82.0-7.3 3.48-7.3 7.308.0 3.836 3.48 7.317 7.3 7.317h72.78c4.18.0 7.31-3.481 7.31-7.317.0-3.828-3.13-7.308-7.31-7.308h-28.55v-86.703c0-4.18-3.48-7.66-8.01-7.66-4.18.0-7.31 3.48-7.31 7.66v86.703"/><path id="path3381" style="fill:#696566;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m597.898 989.039c-236.39.0-428.714-192.324-428.714-428.719.0-236.39 192.324-428.715 428.714-428.715 236.395.0 428.722 192.325 428.722 428.715.0 236.395-192.327 428.719-428.722 428.719zm0-954.289c-289.796.0-525.566 235.773-525.566 525.57s235.77 525.57 525.566 525.57c289.801.0 525.572-235.773 525.572-525.57S887.699 34.75 597.898 34.75"/><g id="g3383"><g clip-path="url(#clipPath3387)" id="g3385"><path id="path3397" style="fill:url(#linearGradient3391);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M142.293 245.191l494.93 337.36L74.8398 348.098"/></g></g><path id="path3399" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m167.938 304.09c-4.524 34.332-36.024 58.496-70.356 53.973-34.332-4.52-58.5-36.02-53.9765-70.352 4.5234-34.336 36.0234-58.5 70.3555-53.977 34.332 4.524 58.5 36.02 53.977 70.356"/><g id="g3401"><g clip-path="url(#clipPath3405)" id="g3403"><path id="path3415" style="fill:url(#linearGradient3409);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M85.2852 570.719 516.813 593.84 54.5195 690.582"/></g></g><path id="path3417" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m124.875 636.605c-4.523 34.333-36.0234 58.5-70.3555 53.977C20.1875 686.059-3.98047 654.559.542969 620.227 5.06641 585.895 36.5664 561.727 70.8984 566.25c34.3356 4.523 58.4996 36.023 53.9766 70.355"/><g id="g3419"><g clip-path="url(#clipPath3423)" id="g3421"><path id="path3433" style="fill:url(#linearGradient3427);fill-opacity:1;fill-rule:nonzero;stroke:none" d="m538.137 270.234 95.324 293.5-205.699-247.089"/></g></g><path id="path3435" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m541.352 289.715c-4.524 34.332-36.024 58.5-70.356 53.973-34.336-4.52-58.5-36.02-53.976-70.352 4.523-34.336 36.023-58.5 70.355-53.977 34.332 4.524 58.496 36.024 53.977 70.356"/><g id="g3437"><g clip-path="url(#clipPath3441)" id="g3439"><path id="path3451" style="fill:url(#linearGradient3445);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M857.758 94.3906 656.035 546.801 745.172 53.6406"/></g></g><path id="path3453" style="fill:#b9d110;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m846.91 110.883c-26.609 22.164-66.144 18.558-88.308-8.051-22.164-26.6132-18.559-66.1406 8.05-88.3125 26.61-22.16013 66.145-18.55075 88.309 8.0586 22.164 26.6016 18.559 66.1446-8.051 88.3049"/><g id="g3455"><g clip-path="url(#clipPath3459)" id="g3457"><path id="path3469" style="fill:url(#linearGradient3463);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M481.316 864.746 635.938 602.125l-41.313 301.32"/></g></g><path id="path3471" style="fill:#b9d110;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m491.863 848.059c26.203-22.645 65.797-19.758 88.442 6.441 22.64 26.203 19.758 65.797-6.446 88.441-26.199 22.645-65.796 19.758-88.437-6.445-22.645-26.199-19.762-65.797 6.441-88.437"/><g id="g3473"><g clip-path="url(#clipPath3477)" id="g3475"><path id="path3487" style="fill:url(#linearGradient3481);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M1085.54 913.828 683.598 585.359l456.522 219.75"/></g></g><path id="path3489" style="fill:#22638b;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m1050.12 855.145c2.26-34.555 32.1-60.743 66.66-58.485 34.55 2.254 60.74 32.098 58.48 66.653-2.25 34.554-32.09 60.742-66.65 58.484-34.56-2.254-60.74-32.098-58.49-66.652"/><g id="g3491"><g clip-path="url(#clipPath3495)" id="g3493"><path id="path3505" style="fill:url(#linearGradient3499);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M1177.19 335.031 693.664 556.211 1106.69 235.887"/></g></g><path id="path3507" style="fill:#91d2e1;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m1108.75 338.84c-29.47-18.176-38.63-56.805-20.46-86.281 18.18-29.477 56.81-38.637 86.29-20.461 29.47 18.179 38.63 56.808 20.45 86.285-18.17 29.476-56.8 38.637-86.28 20.457"/><g id="g3509"><g clip-path="url(#clipPath3513)" id="g3511"><path id="path3523" style="fill:url(#linearGradient3517);fill-opacity:1;fill-rule:nonzero;stroke:none" d="M209.754 773.73l382.32-187.417L280.926 872.391"/></g></g><path id="path3525" style="fill:#91d2e1;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m278.168 769.453c29.598 17.977 39.02 56.543 21.043 86.145-17.977 29.597-56.543 39.019-86.145 21.043-29.597-17.977-39.019-56.543-21.043-86.141 17.977-29.602 56.543-39.023 86.145-21.047"/><path id="path3527" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m714.422 718.262c8.172-9.321 22.351-10.246 31.672-2.074 9.316 8.175 10.246 22.355 2.07 31.675-8.172 9.317-22.351 10.246-31.672 2.071-9.316-8.172-10.246-22.356-2.07-31.672"/><path id="path3529" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m827.305 484.969c8.175-9.321 22.355-10.25 31.672-2.074 9.32 8.171 10.25 22.355 2.074 31.671-8.172 9.321-22.356 10.247-31.672 2.075-9.32-8.176-10.246-22.356-2.074-31.672"/><path id="path3531" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m906.813 877.289c8.175-9.316 22.355-10.246 31.675-2.07 9.317 8.172 10.246 22.351 2.071 31.672-8.172 9.32-22.356 10.246-31.672 2.074-9.321-8.176-10.246-22.356-2.074-31.676"/><path id="path3533" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m987.531 166.984c8.172-9.32 22.359-10.246 31.669-2.074 9.32 8.176 10.25 22.356 2.08 31.676-8.18 9.316-22.358 10.242-31.678 2.07-9.317-8.176-10.247-22.355-2.071-31.672"/><path id="path3535" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m140.008 473.707c8.172-9.32 22.351-10.246 31.672-2.074 9.316 8.176 10.246 22.355 2.074 31.676-8.176 9.316-22.356 10.246-31.676 2.07-9.316-8.172-10.246-22.356-2.07-31.672"/><path id="path3537" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m609.063 315.641c8.171-9.321 22.355-10.246 31.671-2.075 9.321 8.176 10.246 22.356 2.075 31.676-8.176 9.317-22.356 10.246-31.676 2.071-9.317-8.172-10.246-22.352-2.07-31.672"/><path id="path3539" style="fill:#62b92c;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m458.551 398.422c8.172-9.317 22.351-10.246 31.672-2.07 9.32 8.171 10.246 22.351 2.074 31.671-8.176 9.317-22.356 10.247-31.676 2.071-9.316-8.172-10.246-22.352-2.07-31.672"/><path id="path3541" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m518.754 661.82c8.176-9.32 22.355-10.246 31.672-2.074 9.32 8.176 10.25 22.356 2.074 31.676-8.176 9.316-22.355 10.246-31.672 2.07-9.32-8.172-10.25-22.355-2.074-31.672"/><path id="path3543" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m744.523 394.66c8.172-9.32 22.356-10.246 31.672-2.074 9.321 8.176 10.246 22.355 2.075 31.676-8.176 9.316-22.356 10.246-31.672 2.07-9.321-8.172-10.25-22.355-2.075-31.672"/><path id="path3545" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m714.422 605.379c8.172-9.32 22.351-10.246 31.672-2.074 9.316 8.172 10.246 22.355 2.07 31.672-8.172 9.32-22.351 10.246-31.672 2.074-9.316-8.176-10.246-22.356-2.07-31.672"/><path id="path3547" style="fill:#133a73;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m368.242 469.918c8.172-9.32 22.356-10.25 31.672-2.074 9.32 8.172 10.246 22.355 2.074 31.672-8.175 9.32-22.355 10.246-31.675 2.074-9.317-8.176-10.247-22.356-2.071-31.672"/><path id="path3549" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m633.461 620.176c8.172-9.317 22.355-10.246 31.672-2.071 9.32 8.172 10.246 22.356 2.074 31.672-8.176 9.321-22.355 10.246-31.676 2.075-9.316-8.176-10.246-22.356-2.07-31.676"/><path id="path3551" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m646.691 752.129c8.172-9.32 22.352-10.25 31.672-2.074 9.321 8.172 10.246 22.355 2.075 31.672-8.176 9.32-22.356 10.246-31.676 2.074-9.317-8.176-10.246-22.356-2.071-31.672"/><path id="path3553" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m819.777 334.453c8.176-9.316 22.356-10.246 31.676-2.07 9.317 8.172 10.246 22.351 2.07 31.672-8.171 9.32-22.351 10.246-31.671 2.074-9.321-8.176-10.247-22.356-2.075-31.676"/><path id="path3555" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m812.242 571.512c8.176-9.321 22.356-10.246 31.676-2.074 9.316 8.175 10.246 22.355 2.07 31.675-8.172 9.317-22.351 10.246-31.672 2.071-9.316-8.172-10.246-22.356-2.074-31.672"/><path id="path3557" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m382.156 392.988c8.172-9.316 22.356-10.246 31.672-2.07 9.32 8.172 10.246 22.355 2.074 31.672-8.175 9.32-22.355 10.246-31.672 2.074-9.32-8.176-10.25-22.355-2.074-31.676"/><path id="path3559" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m613.543 476.398c8.176-9.32 22.355-10.25 31.676-2.074 9.316 8.176 10.246 22.356 2.07 31.672-8.172 9.32-22.355 10.246-31.672 2.074-9.32-8.175-10.246-22.355-2.074-31.672"/><path id="path3561" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m435.969 645.902c8.172-9.32 22.351-10.246 31.672-2.074 9.32 8.176 10.246 22.356 2.074 31.676-8.176 9.316-22.356 10.246-31.676 2.07-9.316-8.172-10.246-22.355-2.07-31.672"/><path id="path3563" style="fill:#4194d7;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m629.688 164.293c8.171-9.32 22.355-10.246 31.671-2.074 9.321 8.176 10.246 22.355 2.075 31.676-8.176 9.316-22.356 10.246-31.672 2.07-9.321-8.172-10.25-22.356-2.074-31.672"/><path id="path3565" style="fill:#b9d110;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m499.398 462.395c12.329-1.301 23.379 7.632 24.684 19.96 1.305 12.325-7.633 23.375-19.961 24.68-12.324 1.305-23.375-7.633-24.68-19.957-1.304-12.328 7.633-23.379 19.957-24.683"/><path id="path3567" style="fill:#b9d110;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m721.23 510.641c-12.3 1.527-23.511-7.207-25.039-19.508-1.527-12.301 7.207-23.512 19.508-25.039 12.301-1.528 23.512 7.207 25.039 19.508 1.528 12.3-7.207 23.507-19.508 25.039"/><path id="path3569" style="fill:#22638b;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m594.34 420.676c-7.543 9.836-21.629 11.695-31.469 4.152-9.836-7.543-11.691-21.633-4.148-31.469s21.632-11.695 31.468-4.152 11.696 21.633 4.149 31.469"/><path id="path3571" style="fill:#22638b;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m594.828 581.156c-7.543 9.836-21.633 11.696-31.469 4.153s-11.695-21.633-4.152-31.469c7.547-9.836 21.633-11.695 31.469-4.152 9.836 7.542 11.695 21.632 4.152 31.468"/><path id="path3573" style="fill:#91d2e1;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m458.199 576.973c5.156 11.273.199 24.59-11.07 29.75-11.274 5.156-24.59.199-29.746-11.071-5.16-11.273-.203-24.589 11.066-29.75 11.274-5.156 24.594-.199 29.75 11.071"/><path id="path3575" style="fill:#91d2e1;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m635.691 569.449c-5.234-11.234-.367-24.59 10.868-29.82 11.238-5.234 24.589-.371 29.824 10.867 5.234 11.234.367 24.586-10.867 29.82-11.239 5.235-24.59.372-29.825-10.867"/></g></g></svg></div></div><div class="row d-flex m-0 my-4 justify-content-end align-items-end"><small class="text-dark align-content-center mx-3">&copy; 2021 Photon OS Authors. <a href=https://vmware.github.io>A VMware Backed Project</a></small><div class=text-right><a href=../../><img class=vmw-footer-logo src=../../img/vmware-logo.svg></a></div></div></footer></div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=../../js/main.min.906bd02f142be20eb94bb49539a18a3e93ec0b9ff5f5dcf3796eed436a6103d2.js integrity="sha256-kGvQLxQr4g65S7SVOaGKPpPsC5/19dzzeW7tQ2phA9I=" crossorigin=anonymous></script><script src=../../js/animated.js></script></body></html>